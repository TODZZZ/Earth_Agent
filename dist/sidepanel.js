var SS=Object.defineProperty;var PS=(t,e,n)=>e in t?SS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var en=(t,e,n)=>PS(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function ju(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function kS(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var F_={exports:{}},Lu={},U_={exports:{}},re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vo=Symbol.for("react.element"),xS=Symbol.for("react.portal"),AS=Symbol.for("react.fragment"),OS=Symbol.for("react.strict_mode"),CS=Symbol.for("react.profiler"),TS=Symbol.for("react.provider"),RS=Symbol.for("react.context"),IS=Symbol.for("react.forward_ref"),NS=Symbol.for("react.suspense"),$S=Symbol.for("react.memo"),jS=Symbol.for("react.lazy"),Am=Symbol.iterator;function LS(t){return t===null||typeof t!="object"?null:(t=Am&&t[Am]||t["@@iterator"],typeof t=="function"?t:null)}var z_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B_=Object.assign,V_={};function Aa(t,e,n){this.props=t,this.context=e,this.refs=V_,this.updater=n||z_}Aa.prototype.isReactComponent={};Aa.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Aa.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function H_(){}H_.prototype=Aa.prototype;function Ph(t,e,n){this.props=t,this.context=e,this.refs=V_,this.updater=n||z_}var kh=Ph.prototype=new H_;kh.constructor=Ph;B_(kh,Aa.prototype);kh.isPureReactComponent=!0;var Om=Array.isArray,Z_=Object.prototype.hasOwnProperty,xh={current:null},q_={key:!0,ref:!0,__self:!0,__source:!0};function G_(t,e,n){var r,s={},a=null,i=null;if(e!=null)for(r in e.ref!==void 0&&(i=e.ref),e.key!==void 0&&(a=""+e.key),e)Z_.call(e,r)&&!q_.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=n;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:vo,type:t,key:a,ref:i,props:s,_owner:xh.current}}function DS(t,e){return{$$typeof:vo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ah(t){return typeof t=="object"&&t!==null&&t.$$typeof===vo}function MS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Cm=/\/+/g;function Hc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?MS(""+t.key):e.toString(36)}function Sl(t,e,n,r,s){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var i=!1;if(t===null)i=!0;else switch(a){case"string":case"number":i=!0;break;case"object":switch(t.$$typeof){case vo:case xS:i=!0}}if(i)return i=t,s=s(i),t=r===""?"."+Hc(i,0):r,Om(s)?(n="",t!=null&&(n=t.replace(Cm,"$&/")+"/"),Sl(s,e,n,"",function(u){return u})):s!=null&&(Ah(s)&&(s=DS(s,n+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(Cm,"$&/")+"/")+t)),e.push(s)),1;if(i=0,r=r===""?".":r+":",Om(t))for(var o=0;o<t.length;o++){a=t[o];var l=r+Hc(a,o);i+=Sl(a,e,n,l,s)}else if(l=LS(t),typeof l=="function")for(t=l.call(t),o=0;!(a=t.next()).done;)a=a.value,l=r+Hc(a,o++),i+=Sl(a,e,n,l,s);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return i}function zo(t,e,n){if(t==null)return t;var r=[],s=0;return Sl(t,r,"","",function(a){return e.call(n,a,s++)}),r}function FS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var dt={current:null},Pl={transition:null},US={ReactCurrentDispatcher:dt,ReactCurrentBatchConfig:Pl,ReactCurrentOwner:xh};function W_(){throw Error("act(...) is not supported in production builds of React.")}re.Children={map:zo,forEach:function(t,e,n){zo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return zo(t,function(){e++}),e},toArray:function(t){return zo(t,function(e){return e})||[]},only:function(t){if(!Ah(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};re.Component=Aa;re.Fragment=AS;re.Profiler=CS;re.PureComponent=Ph;re.StrictMode=OS;re.Suspense=NS;re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=US;re.act=W_;re.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=B_({},t.props),s=t.key,a=t.ref,i=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,i=xh.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(l in e)Z_.call(e,l)&&!q_.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:vo,type:t.type,key:s,ref:a,props:r,_owner:i}};re.createContext=function(t){return t={$$typeof:RS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:TS,_context:t},t.Consumer=t};re.createElement=G_;re.createFactory=function(t){var e=G_.bind(null,t);return e.type=t,e};re.createRef=function(){return{current:null}};re.forwardRef=function(t){return{$$typeof:IS,render:t}};re.isValidElement=Ah;re.lazy=function(t){return{$$typeof:jS,_payload:{_status:-1,_result:t},_init:FS}};re.memo=function(t,e){return{$$typeof:$S,type:t,compare:e===void 0?null:e}};re.startTransition=function(t){var e=Pl.transition;Pl.transition={};try{t()}finally{Pl.transition=e}};re.unstable_act=W_;re.useCallback=function(t,e){return dt.current.useCallback(t,e)};re.useContext=function(t){return dt.current.useContext(t)};re.useDebugValue=function(){};re.useDeferredValue=function(t){return dt.current.useDeferredValue(t)};re.useEffect=function(t,e){return dt.current.useEffect(t,e)};re.useId=function(){return dt.current.useId()};re.useImperativeHandle=function(t,e,n){return dt.current.useImperativeHandle(t,e,n)};re.useInsertionEffect=function(t,e){return dt.current.useInsertionEffect(t,e)};re.useLayoutEffect=function(t,e){return dt.current.useLayoutEffect(t,e)};re.useMemo=function(t,e){return dt.current.useMemo(t,e)};re.useReducer=function(t,e,n){return dt.current.useReducer(t,e,n)};re.useRef=function(t){return dt.current.useRef(t)};re.useState=function(t){return dt.current.useState(t)};re.useSyncExternalStore=function(t,e,n){return dt.current.useSyncExternalStore(t,e,n)};re.useTransition=function(){return dt.current.useTransition()};re.version="18.3.1";U_.exports=re;var Me=U_.exports;const zS=ju(Me);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BS=Me,VS=Symbol.for("react.element"),HS=Symbol.for("react.fragment"),ZS=Object.prototype.hasOwnProperty,qS=BS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,GS={key:!0,ref:!0,__self:!0,__source:!0};function K_(t,e,n){var r,s={},a=null,i=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(i=e.ref);for(r in e)ZS.call(e,r)&&!GS.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:VS,type:t,key:a,ref:i,props:s,_owner:qS.current}}Lu.Fragment=HS;Lu.jsx=K_;Lu.jsxs=K_;F_.exports=Lu;var W=F_.exports,ef={},J_={exports:{}},zt={},Q_={exports:{}},X_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(x,E){var A=x.length;x.push(E);e:for(;0<A;){var I=A-1>>>1,F=x[I];if(0<s(F,E))x[I]=E,x[A]=F,A=I;else break e}}function n(x){return x.length===0?null:x[0]}function r(x){if(x.length===0)return null;var E=x[0],A=x.pop();if(A!==E){x[0]=A;e:for(var I=0,F=x.length,ie=F>>>1;I<ie;){var ve=2*(I+1)-1,ge=x[ve],Ot=ve+1,Uo=x[Ot];if(0>s(ge,A))Ot<F&&0>s(Uo,ge)?(x[I]=Uo,x[Ot]=A,I=Ot):(x[I]=ge,x[ve]=A,I=ve);else if(Ot<F&&0>s(Uo,A))x[I]=Uo,x[Ot]=A,I=Ot;else break e}}return E}function s(x,E){var A=x.sortIndex-E.sortIndex;return A!==0?A:x.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var i=Date,o=i.now();t.unstable_now=function(){return i.now()-o}}var l=[],u=[],c=1,d=null,f=3,h=!1,y=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(x){for(var E=n(u);E!==null;){if(E.callback===null)r(u);else if(E.startTime<=x)r(u),E.sortIndex=E.expirationTime,e(l,E);else break;E=n(u)}}function w(x){if(m=!1,_(x),!y)if(n(l)!==null)y=!0,V(b);else{var E=n(u);E!==null&&z(w,E.startTime-x)}}function b(x,E){y=!1,m&&(m=!1,g(R),R=-1),h=!0;var A=f;try{for(_(E),d=n(l);d!==null&&(!(d.expirationTime>E)||x&&!K());){var I=d.callback;if(typeof I=="function"){d.callback=null,f=d.priorityLevel;var F=I(d.expirationTime<=E);E=t.unstable_now(),typeof F=="function"?d.callback=F:d===n(l)&&r(l),_(E)}else r(l);d=n(l)}if(d!==null)var ie=!0;else{var ve=n(u);ve!==null&&z(w,ve.startTime-E),ie=!1}return ie}finally{d=null,f=A,h=!1}}var P=!1,k=null,R=-1,Z=5,M=-1;function K(){return!(t.unstable_now()-M<Z)}function Qe(){if(k!==null){var x=t.unstable_now();M=x;var E=!0;try{E=k(!0,x)}finally{E?At():(P=!1,k=null)}}else P=!1}var At;if(typeof p=="function")At=function(){p(Qe)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,N=j.port2;j.port1.onmessage=Qe,At=function(){N.postMessage(null)}}else At=function(){v(Qe,0)};function V(x){k=x,P||(P=!0,At())}function z(x,E){R=v(function(){x(t.unstable_now())},E)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(x){x.callback=null},t.unstable_continueExecution=function(){y||h||(y=!0,V(b))},t.unstable_forceFrameRate=function(x){0>x||125<x?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Z=0<x?Math.floor(1e3/x):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(x){switch(f){case 1:case 2:case 3:var E=3;break;default:E=f}var A=f;f=E;try{return x()}finally{f=A}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(x,E){switch(x){case 1:case 2:case 3:case 4:case 5:break;default:x=3}var A=f;f=x;try{return E()}finally{f=A}},t.unstable_scheduleCallback=function(x,E,A){var I=t.unstable_now();switch(typeof A=="object"&&A!==null?(A=A.delay,A=typeof A=="number"&&0<A?I+A:I):A=I,x){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=A+F,x={id:c++,callback:E,priorityLevel:x,startTime:A,expirationTime:F,sortIndex:-1},A>I?(x.sortIndex=A,e(u,x),n(l)===null&&x===n(u)&&(m?(g(R),R=-1):m=!0,z(w,A-I))):(x.sortIndex=F,e(l,x),y||h||(y=!0,V(b))),x},t.unstable_shouldYield=K,t.unstable_wrapCallback=function(x){var E=f;return function(){var A=f;f=E;try{return x.apply(this,arguments)}finally{f=A}}}})(X_);Q_.exports=X_;var WS=Q_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KS=Me,Mt=WS;function C(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Y_=new Set,Vi={};function ms(t,e){sa(t,e),sa(t+"Capture",e)}function sa(t,e){for(Vi[t]=e,t=0;t<e.length;t++)Y_.add(e[t])}var Kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tf=Object.prototype.hasOwnProperty,JS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Tm={},Rm={};function QS(t){return tf.call(Rm,t)?!0:tf.call(Tm,t)?!1:JS.test(t)?Rm[t]=!0:(Tm[t]=!0,!1)}function XS(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function YS(t,e,n,r){if(e===null||typeof e>"u"||XS(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ft(t,e,n,r,s,a,i){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=i}var qe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){qe[t]=new ft(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];qe[e]=new ft(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){qe[t]=new ft(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){qe[t]=new ft(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){qe[t]=new ft(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){qe[t]=new ft(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){qe[t]=new ft(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){qe[t]=new ft(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){qe[t]=new ft(t,5,!1,t.toLowerCase(),null,!1,!1)});var Oh=/[\-:]([a-z])/g;function Ch(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Oh,Ch);qe[e]=new ft(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Oh,Ch);qe[e]=new ft(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Oh,Ch);qe[e]=new ft(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){qe[t]=new ft(t,1,!1,t.toLowerCase(),null,!1,!1)});qe.xlinkHref=new ft("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){qe[t]=new ft(t,1,!1,t.toLowerCase(),null,!0,!0)});function Th(t,e,n,r){var s=qe.hasOwnProperty(e)?qe[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(YS(e,n,s,r)&&(n=null),r||s===null?QS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var sr=KS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Bo=Symbol.for("react.element"),Rs=Symbol.for("react.portal"),Is=Symbol.for("react.fragment"),Rh=Symbol.for("react.strict_mode"),nf=Symbol.for("react.profiler"),ev=Symbol.for("react.provider"),tv=Symbol.for("react.context"),Ih=Symbol.for("react.forward_ref"),rf=Symbol.for("react.suspense"),sf=Symbol.for("react.suspense_list"),Nh=Symbol.for("react.memo"),hr=Symbol.for("react.lazy"),nv=Symbol.for("react.offscreen"),Im=Symbol.iterator;function Ba(t){return t===null||typeof t!="object"?null:(t=Im&&t[Im]||t["@@iterator"],typeof t=="function"?t:null)}var Se=Object.assign,Zc;function gi(t){if(Zc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Zc=e&&e[1]||""}return`
`+Zc+t}var qc=!1;function Gc(t,e){if(!t||qc)return"";qc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),a=r.stack.split(`
`),i=s.length-1,o=a.length-1;1<=i&&0<=o&&s[i]!==a[o];)o--;for(;1<=i&&0<=o;i--,o--)if(s[i]!==a[o]){if(i!==1||o!==1)do if(i--,o--,0>o||s[i]!==a[o]){var l=`
`+s[i].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=i&&0<=o);break}}}finally{qc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?gi(t):""}function e1(t){switch(t.tag){case 5:return gi(t.type);case 16:return gi("Lazy");case 13:return gi("Suspense");case 19:return gi("SuspenseList");case 0:case 2:case 15:return t=Gc(t.type,!1),t;case 11:return t=Gc(t.type.render,!1),t;case 1:return t=Gc(t.type,!0),t;default:return""}}function af(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Is:return"Fragment";case Rs:return"Portal";case nf:return"Profiler";case Rh:return"StrictMode";case rf:return"Suspense";case sf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case tv:return(t.displayName||"Context")+".Consumer";case ev:return(t._context.displayName||"Context")+".Provider";case Ih:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Nh:return e=t.displayName||null,e!==null?e:af(t.type)||"Memo";case hr:e=t._payload,t=t._init;try{return af(t(e))}catch{}}return null}function t1(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return af(e);case 8:return e===Rh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ir(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function rv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function n1(t){var e=rv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(i){r=""+i,a.call(this,i)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(i){r=""+i},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Vo(t){t._valueTracker||(t._valueTracker=n1(t))}function sv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=rv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Hl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function of(t,e){var n=e.checked;return Se({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Nm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ir(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function av(t,e){e=e.checked,e!=null&&Th(t,"checked",e,!1)}function lf(t,e){av(t,e);var n=Ir(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?uf(t,e.type,n):e.hasOwnProperty("defaultValue")&&uf(t,e.type,Ir(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function $m(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function uf(t,e,n){(e!=="number"||Hl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var yi=Array.isArray;function Ws(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ir(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function cf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(C(91));return Se({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function jm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(C(92));if(yi(n)){if(1<n.length)throw Error(C(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ir(n)}}function iv(t,e){var n=Ir(e.value),r=Ir(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Lm(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ov(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function df(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ov(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ho,lv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ho=Ho||document.createElement("div"),Ho.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ho.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Hi(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ti={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},r1=["Webkit","ms","Moz","O"];Object.keys(Ti).forEach(function(t){r1.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ti[e]=Ti[t]})});function uv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ti.hasOwnProperty(t)&&Ti[t]?(""+e).trim():e+"px"}function cv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=uv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var s1=Se({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ff(t,e){if(e){if(s1[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(C(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(C(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(C(61))}if(e.style!=null&&typeof e.style!="object")throw Error(C(62))}}function hf(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var pf=null;function $h(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var mf=null,Ks=null,Js=null;function Dm(t){if(t=Eo(t)){if(typeof mf!="function")throw Error(C(280));var e=t.stateNode;e&&(e=zu(e),mf(t.stateNode,t.type,e))}}function dv(t){Ks?Js?Js.push(t):Js=[t]:Ks=t}function fv(){if(Ks){var t=Ks,e=Js;if(Js=Ks=null,Dm(t),e)for(t=0;t<e.length;t++)Dm(e[t])}}function hv(t,e){return t(e)}function pv(){}var Wc=!1;function mv(t,e,n){if(Wc)return t(e,n);Wc=!0;try{return hv(t,e,n)}finally{Wc=!1,(Ks!==null||Js!==null)&&(pv(),fv())}}function Zi(t,e){var n=t.stateNode;if(n===null)return null;var r=zu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(C(231,e,typeof n));return n}var gf=!1;if(Kn)try{var Va={};Object.defineProperty(Va,"passive",{get:function(){gf=!0}}),window.addEventListener("test",Va,Va),window.removeEventListener("test",Va,Va)}catch{gf=!1}function a1(t,e,n,r,s,a,i,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Ri=!1,Zl=null,ql=!1,yf=null,i1={onError:function(t){Ri=!0,Zl=t}};function o1(t,e,n,r,s,a,i,o,l){Ri=!1,Zl=null,a1.apply(i1,arguments)}function l1(t,e,n,r,s,a,i,o,l){if(o1.apply(this,arguments),Ri){if(Ri){var u=Zl;Ri=!1,Zl=null}else throw Error(C(198));ql||(ql=!0,yf=u)}}function gs(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function gv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Mm(t){if(gs(t)!==t)throw Error(C(188))}function u1(t){var e=t.alternate;if(!e){if(e=gs(t),e===null)throw Error(C(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var a=s.alternate;if(a===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return Mm(s),t;if(a===r)return Mm(s),e;a=a.sibling}throw Error(C(188))}if(n.return!==r.return)n=s,r=a;else{for(var i=!1,o=s.child;o;){if(o===n){i=!0,n=s,r=a;break}if(o===r){i=!0,r=s,n=a;break}o=o.sibling}if(!i){for(o=a.child;o;){if(o===n){i=!0,n=a,r=s;break}if(o===r){i=!0,r=a,n=s;break}o=o.sibling}if(!i)throw Error(C(189))}}if(n.alternate!==r)throw Error(C(190))}if(n.tag!==3)throw Error(C(188));return n.stateNode.current===n?t:e}function yv(t){return t=u1(t),t!==null?_v(t):null}function _v(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=_v(t);if(e!==null)return e;t=t.sibling}return null}var vv=Mt.unstable_scheduleCallback,Fm=Mt.unstable_cancelCallback,c1=Mt.unstable_shouldYield,d1=Mt.unstable_requestPaint,Ae=Mt.unstable_now,f1=Mt.unstable_getCurrentPriorityLevel,jh=Mt.unstable_ImmediatePriority,wv=Mt.unstable_UserBlockingPriority,Gl=Mt.unstable_NormalPriority,h1=Mt.unstable_LowPriority,bv=Mt.unstable_IdlePriority,Du=null,Nn=null;function p1(t){if(Nn&&typeof Nn.onCommitFiberRoot=="function")try{Nn.onCommitFiberRoot(Du,t,void 0,(t.current.flags&128)===128)}catch{}}var pn=Math.clz32?Math.clz32:y1,m1=Math.log,g1=Math.LN2;function y1(t){return t>>>=0,t===0?32:31-(m1(t)/g1|0)|0}var Zo=64,qo=4194304;function _i(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Wl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,a=t.pingedLanes,i=n&268435455;if(i!==0){var o=i&~s;o!==0?r=_i(o):(a&=i,a!==0&&(r=_i(a)))}else i=n&~s,i!==0?r=_i(i):a!==0&&(r=_i(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,a=e&-e,s>=a||s===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-pn(e),s=1<<n,r|=t[n],e&=~s;return r}function _1(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function v1(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,a=t.pendingLanes;0<a;){var i=31-pn(a),o=1<<i,l=s[i];l===-1?(!(o&n)||o&r)&&(s[i]=_1(o,e)):l<=e&&(t.expiredLanes|=o),a&=~o}}function _f(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Ev(){var t=Zo;return Zo<<=1,!(Zo&4194240)&&(Zo=64),t}function Kc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function wo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-pn(e),t[e]=n}function w1(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-pn(n),a=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~a}}function Lh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-pn(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var de=0;function Sv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Pv,Dh,kv,xv,Av,vf=!1,Go=[],br=null,Er=null,Sr=null,qi=new Map,Gi=new Map,yr=[],b1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Um(t,e){switch(t){case"focusin":case"focusout":br=null;break;case"dragenter":case"dragleave":Er=null;break;case"mouseover":case"mouseout":Sr=null;break;case"pointerover":case"pointerout":qi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gi.delete(e.pointerId)}}function Ha(t,e,n,r,s,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},e!==null&&(e=Eo(e),e!==null&&Dh(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function E1(t,e,n,r,s){switch(e){case"focusin":return br=Ha(br,t,e,n,r,s),!0;case"dragenter":return Er=Ha(Er,t,e,n,r,s),!0;case"mouseover":return Sr=Ha(Sr,t,e,n,r,s),!0;case"pointerover":var a=s.pointerId;return qi.set(a,Ha(qi.get(a)||null,t,e,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,Gi.set(a,Ha(Gi.get(a)||null,t,e,n,r,s)),!0}return!1}function Ov(t){var e=Gr(t.target);if(e!==null){var n=gs(e);if(n!==null){if(e=n.tag,e===13){if(e=gv(n),e!==null){t.blockedOn=e,Av(t.priority,function(){kv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function kl(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=wf(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);pf=r,n.target.dispatchEvent(r),pf=null}else return e=Eo(n),e!==null&&Dh(e),t.blockedOn=n,!1;e.shift()}return!0}function zm(t,e,n){kl(t)&&n.delete(e)}function S1(){vf=!1,br!==null&&kl(br)&&(br=null),Er!==null&&kl(Er)&&(Er=null),Sr!==null&&kl(Sr)&&(Sr=null),qi.forEach(zm),Gi.forEach(zm)}function Za(t,e){t.blockedOn===e&&(t.blockedOn=null,vf||(vf=!0,Mt.unstable_scheduleCallback(Mt.unstable_NormalPriority,S1)))}function Wi(t){function e(s){return Za(s,t)}if(0<Go.length){Za(Go[0],t);for(var n=1;n<Go.length;n++){var r=Go[n];r.blockedOn===t&&(r.blockedOn=null)}}for(br!==null&&Za(br,t),Er!==null&&Za(Er,t),Sr!==null&&Za(Sr,t),qi.forEach(e),Gi.forEach(e),n=0;n<yr.length;n++)r=yr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<yr.length&&(n=yr[0],n.blockedOn===null);)Ov(n),n.blockedOn===null&&yr.shift()}var Qs=sr.ReactCurrentBatchConfig,Kl=!0;function P1(t,e,n,r){var s=de,a=Qs.transition;Qs.transition=null;try{de=1,Mh(t,e,n,r)}finally{de=s,Qs.transition=a}}function k1(t,e,n,r){var s=de,a=Qs.transition;Qs.transition=null;try{de=4,Mh(t,e,n,r)}finally{de=s,Qs.transition=a}}function Mh(t,e,n,r){if(Kl){var s=wf(t,e,n,r);if(s===null)ad(t,e,r,Jl,n),Um(t,r);else if(E1(s,t,e,n,r))r.stopPropagation();else if(Um(t,r),e&4&&-1<b1.indexOf(t)){for(;s!==null;){var a=Eo(s);if(a!==null&&Pv(a),a=wf(t,e,n,r),a===null&&ad(t,e,r,Jl,n),a===s)break;s=a}s!==null&&r.stopPropagation()}else ad(t,e,r,null,n)}}var Jl=null;function wf(t,e,n,r){if(Jl=null,t=$h(r),t=Gr(t),t!==null)if(e=gs(t),e===null)t=null;else if(n=e.tag,n===13){if(t=gv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Jl=t,null}function Cv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(f1()){case jh:return 1;case wv:return 4;case Gl:case h1:return 16;case bv:return 536870912;default:return 16}default:return 16}}var vr=null,Fh=null,xl=null;function Tv(){if(xl)return xl;var t,e=Fh,n=e.length,r,s="value"in vr?vr.value:vr.textContent,a=s.length;for(t=0;t<n&&e[t]===s[t];t++);var i=n-t;for(r=1;r<=i&&e[n-r]===s[a-r];r++);return xl=s.slice(t,1<r?1-r:void 0)}function Al(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Wo(){return!0}function Bm(){return!1}function Bt(t){function e(n,r,s,a,i){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=a,this.target=i,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(a):a[o]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Wo:Bm,this.isPropagationStopped=Bm,this}return Se(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Wo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Wo)},persist:function(){},isPersistent:Wo}),e}var Oa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Uh=Bt(Oa),bo=Se({},Oa,{view:0,detail:0}),x1=Bt(bo),Jc,Qc,qa,Mu=Se({},bo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==qa&&(qa&&t.type==="mousemove"?(Jc=t.screenX-qa.screenX,Qc=t.screenY-qa.screenY):Qc=Jc=0,qa=t),Jc)},movementY:function(t){return"movementY"in t?t.movementY:Qc}}),Vm=Bt(Mu),A1=Se({},Mu,{dataTransfer:0}),O1=Bt(A1),C1=Se({},bo,{relatedTarget:0}),Xc=Bt(C1),T1=Se({},Oa,{animationName:0,elapsedTime:0,pseudoElement:0}),R1=Bt(T1),I1=Se({},Oa,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),N1=Bt(I1),$1=Se({},Oa,{data:0}),Hm=Bt($1),j1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},L1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},D1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function M1(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=D1[t])?!!e[t]:!1}function zh(){return M1}var F1=Se({},bo,{key:function(t){if(t.key){var e=j1[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Al(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?L1[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zh,charCode:function(t){return t.type==="keypress"?Al(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Al(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),U1=Bt(F1),z1=Se({},Mu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zm=Bt(z1),B1=Se({},bo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zh}),V1=Bt(B1),H1=Se({},Oa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Z1=Bt(H1),q1=Se({},Mu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),G1=Bt(q1),W1=[9,13,27,32],Bh=Kn&&"CompositionEvent"in window,Ii=null;Kn&&"documentMode"in document&&(Ii=document.documentMode);var K1=Kn&&"TextEvent"in window&&!Ii,Rv=Kn&&(!Bh||Ii&&8<Ii&&11>=Ii),qm=" ",Gm=!1;function Iv(t,e){switch(t){case"keyup":return W1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ns=!1;function J1(t,e){switch(t){case"compositionend":return Nv(e);case"keypress":return e.which!==32?null:(Gm=!0,qm);case"textInput":return t=e.data,t===qm&&Gm?null:t;default:return null}}function Q1(t,e){if(Ns)return t==="compositionend"||!Bh&&Iv(t,e)?(t=Tv(),xl=Fh=vr=null,Ns=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Rv&&e.locale!=="ko"?null:e.data;default:return null}}var X1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!X1[t.type]:e==="textarea"}function $v(t,e,n,r){dv(r),e=Ql(e,"onChange"),0<e.length&&(n=new Uh("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ni=null,Ki=null;function Y1(t){Zv(t,0)}function Fu(t){var e=Ls(t);if(sv(e))return t}function eP(t,e){if(t==="change")return e}var jv=!1;if(Kn){var Yc;if(Kn){var ed="oninput"in document;if(!ed){var Km=document.createElement("div");Km.setAttribute("oninput","return;"),ed=typeof Km.oninput=="function"}Yc=ed}else Yc=!1;jv=Yc&&(!document.documentMode||9<document.documentMode)}function Jm(){Ni&&(Ni.detachEvent("onpropertychange",Lv),Ki=Ni=null)}function Lv(t){if(t.propertyName==="value"&&Fu(Ki)){var e=[];$v(e,Ki,t,$h(t)),mv(Y1,e)}}function tP(t,e,n){t==="focusin"?(Jm(),Ni=e,Ki=n,Ni.attachEvent("onpropertychange",Lv)):t==="focusout"&&Jm()}function nP(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Fu(Ki)}function rP(t,e){if(t==="click")return Fu(e)}function sP(t,e){if(t==="input"||t==="change")return Fu(e)}function aP(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var gn=typeof Object.is=="function"?Object.is:aP;function Ji(t,e){if(gn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!tf.call(e,s)||!gn(t[s],e[s]))return!1}return!0}function Qm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Xm(t,e){var n=Qm(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Qm(n)}}function Dv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Dv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Mv(){for(var t=window,e=Hl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Hl(t.document)}return e}function Vh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function iP(t){var e=Mv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Dv(n.ownerDocument.documentElement,n)){if(r!==null&&Vh(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=r.end===void 0?a:Math.min(r.end,s),!t.extend&&a>r&&(s=r,r=a,a=s),s=Xm(n,a);var i=Xm(n,r);s&&i&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==i.node||t.focusOffset!==i.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(i.node,i.offset)):(e.setEnd(i.node,i.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var oP=Kn&&"documentMode"in document&&11>=document.documentMode,$s=null,bf=null,$i=null,Ef=!1;function Ym(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ef||$s==null||$s!==Hl(r)||(r=$s,"selectionStart"in r&&Vh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),$i&&Ji($i,r)||($i=r,r=Ql(bf,"onSelect"),0<r.length&&(e=new Uh("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=$s)))}function Ko(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var js={animationend:Ko("Animation","AnimationEnd"),animationiteration:Ko("Animation","AnimationIteration"),animationstart:Ko("Animation","AnimationStart"),transitionend:Ko("Transition","TransitionEnd")},td={},Fv={};Kn&&(Fv=document.createElement("div").style,"AnimationEvent"in window||(delete js.animationend.animation,delete js.animationiteration.animation,delete js.animationstart.animation),"TransitionEvent"in window||delete js.transitionend.transition);function Uu(t){if(td[t])return td[t];if(!js[t])return t;var e=js[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Fv)return td[t]=e[n];return t}var Uv=Uu("animationend"),zv=Uu("animationiteration"),Bv=Uu("animationstart"),Vv=Uu("transitionend"),Hv=new Map,eg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(t,e){Hv.set(t,e),ms(e,[t])}for(var nd=0;nd<eg.length;nd++){var rd=eg[nd],lP=rd.toLowerCase(),uP=rd[0].toUpperCase()+rd.slice(1);Dr(lP,"on"+uP)}Dr(Uv,"onAnimationEnd");Dr(zv,"onAnimationIteration");Dr(Bv,"onAnimationStart");Dr("dblclick","onDoubleClick");Dr("focusin","onFocus");Dr("focusout","onBlur");Dr(Vv,"onTransitionEnd");sa("onMouseEnter",["mouseout","mouseover"]);sa("onMouseLeave",["mouseout","mouseover"]);sa("onPointerEnter",["pointerout","pointerover"]);sa("onPointerLeave",["pointerout","pointerover"]);ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ms("onBeforeInput",["compositionend","keypress","textInput","paste"]);ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var vi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cP=new Set("cancel close invalid load scroll toggle".split(" ").concat(vi));function tg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,l1(r,e,void 0,t),t.currentTarget=null}function Zv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var i=r.length-1;0<=i;i--){var o=r[i],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==a&&s.isPropagationStopped())break e;tg(s,o,u),a=l}else for(i=0;i<r.length;i++){if(o=r[i],l=o.instance,u=o.currentTarget,o=o.listener,l!==a&&s.isPropagationStopped())break e;tg(s,o,u),a=l}}}if(ql)throw t=yf,ql=!1,yf=null,t}function pe(t,e){var n=e[Af];n===void 0&&(n=e[Af]=new Set);var r=t+"__bubble";n.has(r)||(qv(e,t,2,!1),n.add(r))}function sd(t,e,n){var r=0;e&&(r|=4),qv(n,t,r,e)}var Jo="_reactListening"+Math.random().toString(36).slice(2);function Qi(t){if(!t[Jo]){t[Jo]=!0,Y_.forEach(function(n){n!=="selectionchange"&&(cP.has(n)||sd(n,!1,t),sd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Jo]||(e[Jo]=!0,sd("selectionchange",!1,e))}}function qv(t,e,n,r){switch(Cv(e)){case 1:var s=P1;break;case 4:s=k1;break;default:s=Mh}n=s.bind(null,e,n,t),s=void 0,!gf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function ad(t,e,n,r,s){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var i=r.tag;if(i===3||i===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(i===4)for(i=r.return;i!==null;){var l=i.tag;if((l===3||l===4)&&(l=i.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;i=i.return}for(;o!==null;){if(i=Gr(o),i===null)return;if(l=i.tag,l===5||l===6){r=a=i;continue e}o=o.parentNode}}r=r.return}mv(function(){var u=a,c=$h(n),d=[];e:{var f=Hv.get(t);if(f!==void 0){var h=Uh,y=t;switch(t){case"keypress":if(Al(n)===0)break e;case"keydown":case"keyup":h=U1;break;case"focusin":y="focus",h=Xc;break;case"focusout":y="blur",h=Xc;break;case"beforeblur":case"afterblur":h=Xc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Vm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=O1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=V1;break;case Uv:case zv:case Bv:h=R1;break;case Vv:h=Z1;break;case"scroll":h=x1;break;case"wheel":h=G1;break;case"copy":case"cut":case"paste":h=N1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Zm}var m=(e&4)!==0,v=!m&&t==="scroll",g=m?f!==null?f+"Capture":null:f;m=[];for(var p=u,_;p!==null;){_=p;var w=_.stateNode;if(_.tag===5&&w!==null&&(_=w,g!==null&&(w=Zi(p,g),w!=null&&m.push(Xi(p,w,_)))),v)break;p=p.return}0<m.length&&(f=new h(f,y,null,n,c),d.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",f&&n!==pf&&(y=n.relatedTarget||n.fromElement)&&(Gr(y)||y[Jn]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(y=n.relatedTarget||n.toElement,h=u,y=y?Gr(y):null,y!==null&&(v=gs(y),y!==v||y.tag!==5&&y.tag!==6)&&(y=null)):(h=null,y=u),h!==y)){if(m=Vm,w="onMouseLeave",g="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(m=Zm,w="onPointerLeave",g="onPointerEnter",p="pointer"),v=h==null?f:Ls(h),_=y==null?f:Ls(y),f=new m(w,p+"leave",h,n,c),f.target=v,f.relatedTarget=_,w=null,Gr(c)===u&&(m=new m(g,p+"enter",y,n,c),m.target=_,m.relatedTarget=v,w=m),v=w,h&&y)t:{for(m=h,g=y,p=0,_=m;_;_=_s(_))p++;for(_=0,w=g;w;w=_s(w))_++;for(;0<p-_;)m=_s(m),p--;for(;0<_-p;)g=_s(g),_--;for(;p--;){if(m===g||g!==null&&m===g.alternate)break t;m=_s(m),g=_s(g)}m=null}else m=null;h!==null&&ng(d,f,h,m,!1),y!==null&&v!==null&&ng(d,v,y,m,!0)}}e:{if(f=u?Ls(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var b=eP;else if(Wm(f))if(jv)b=sP;else{b=nP;var P=tP}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=rP);if(b&&(b=b(t,u))){$v(d,b,n,c);break e}P&&P(t,f,u),t==="focusout"&&(P=f._wrapperState)&&P.controlled&&f.type==="number"&&uf(f,"number",f.value)}switch(P=u?Ls(u):window,t){case"focusin":(Wm(P)||P.contentEditable==="true")&&($s=P,bf=u,$i=null);break;case"focusout":$i=bf=$s=null;break;case"mousedown":Ef=!0;break;case"contextmenu":case"mouseup":case"dragend":Ef=!1,Ym(d,n,c);break;case"selectionchange":if(oP)break;case"keydown":case"keyup":Ym(d,n,c)}var k;if(Bh)e:{switch(t){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Ns?Iv(t,n)&&(R="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(R="onCompositionStart");R&&(Rv&&n.locale!=="ko"&&(Ns||R!=="onCompositionStart"?R==="onCompositionEnd"&&Ns&&(k=Tv()):(vr=c,Fh="value"in vr?vr.value:vr.textContent,Ns=!0)),P=Ql(u,R),0<P.length&&(R=new Hm(R,t,null,n,c),d.push({event:R,listeners:P}),k?R.data=k:(k=Nv(n),k!==null&&(R.data=k)))),(k=K1?J1(t,n):Q1(t,n))&&(u=Ql(u,"onBeforeInput"),0<u.length&&(c=new Hm("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:u}),c.data=k))}Zv(d,e)})}function Xi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ql(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=Zi(t,n),a!=null&&r.unshift(Xi(t,a,s)),a=Zi(t,e),a!=null&&r.push(Xi(t,a,s))),t=t.return}return r}function _s(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ng(t,e,n,r,s){for(var a=e._reactName,i=[];n!==null&&n!==r;){var o=n,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,s?(l=Zi(n,a),l!=null&&i.unshift(Xi(n,l,o))):s||(l=Zi(n,a),l!=null&&i.push(Xi(n,l,o)))),n=n.return}i.length!==0&&t.push({event:e,listeners:i})}var dP=/\r\n?/g,fP=/\u0000|\uFFFD/g;function rg(t){return(typeof t=="string"?t:""+t).replace(dP,`
`).replace(fP,"")}function Qo(t,e,n){if(e=rg(e),rg(t)!==e&&n)throw Error(C(425))}function Xl(){}var Sf=null,Pf=null;function kf(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xf=typeof setTimeout=="function"?setTimeout:void 0,hP=typeof clearTimeout=="function"?clearTimeout:void 0,sg=typeof Promise=="function"?Promise:void 0,pP=typeof queueMicrotask=="function"?queueMicrotask:typeof sg<"u"?function(t){return sg.resolve(null).then(t).catch(mP)}:xf;function mP(t){setTimeout(function(){throw t})}function id(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Wi(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Wi(e)}function Pr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ag(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ca=Math.random().toString(36).slice(2),Tn="__reactFiber$"+Ca,Yi="__reactProps$"+Ca,Jn="__reactContainer$"+Ca,Af="__reactEvents$"+Ca,gP="__reactListeners$"+Ca,yP="__reactHandles$"+Ca;function Gr(t){var e=t[Tn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Jn]||n[Tn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=ag(t);t!==null;){if(n=t[Tn])return n;t=ag(t)}return e}t=n,n=t.parentNode}return null}function Eo(t){return t=t[Tn]||t[Jn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ls(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(C(33))}function zu(t){return t[Yi]||null}var Of=[],Ds=-1;function Mr(t){return{current:t}}function me(t){0>Ds||(t.current=Of[Ds],Of[Ds]=null,Ds--)}function he(t,e){Ds++,Of[Ds]=t.current,t.current=e}var Nr={},st=Mr(Nr),wt=Mr(!1),as=Nr;function aa(t,e){var n=t.type.contextTypes;if(!n)return Nr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in n)s[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function bt(t){return t=t.childContextTypes,t!=null}function Yl(){me(wt),me(st)}function ig(t,e,n){if(st.current!==Nr)throw Error(C(168));he(st,e),he(wt,n)}function Gv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(C(108,t1(t)||"Unknown",s));return Se({},n,r)}function eu(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Nr,as=st.current,he(st,t),he(wt,wt.current),!0}function og(t,e,n){var r=t.stateNode;if(!r)throw Error(C(169));n?(t=Gv(t,e,as),r.__reactInternalMemoizedMergedChildContext=t,me(wt),me(st),he(st,t)):me(wt),he(wt,n)}var Hn=null,Bu=!1,od=!1;function Wv(t){Hn===null?Hn=[t]:Hn.push(t)}function _P(t){Bu=!0,Wv(t)}function Fr(){if(!od&&Hn!==null){od=!0;var t=0,e=de;try{var n=Hn;for(de=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Hn=null,Bu=!1}catch(s){throw Hn!==null&&(Hn=Hn.slice(t+1)),vv(jh,Fr),s}finally{de=e,od=!1}}return null}var Ms=[],Fs=0,tu=null,nu=0,Ht=[],Zt=0,is=null,Zn=1,qn="";function Vr(t,e){Ms[Fs++]=nu,Ms[Fs++]=tu,tu=t,nu=e}function Kv(t,e,n){Ht[Zt++]=Zn,Ht[Zt++]=qn,Ht[Zt++]=is,is=t;var r=Zn;t=qn;var s=32-pn(r)-1;r&=~(1<<s),n+=1;var a=32-pn(e)+s;if(30<a){var i=s-s%5;a=(r&(1<<i)-1).toString(32),r>>=i,s-=i,Zn=1<<32-pn(e)+s|n<<s|r,qn=a+t}else Zn=1<<a|n<<s|r,qn=t}function Hh(t){t.return!==null&&(Vr(t,1),Kv(t,1,0))}function Zh(t){for(;t===tu;)tu=Ms[--Fs],Ms[Fs]=null,nu=Ms[--Fs],Ms[Fs]=null;for(;t===is;)is=Ht[--Zt],Ht[Zt]=null,qn=Ht[--Zt],Ht[Zt]=null,Zn=Ht[--Zt],Ht[Zt]=null}var Lt=null,$t=null,_e=!1,dn=null;function Jv(t,e){var n=qt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function lg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Lt=t,$t=Pr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Lt=t,$t=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=is!==null?{id:Zn,overflow:qn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=qt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Lt=t,$t=null,!0):!1;default:return!1}}function Cf(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Tf(t){if(_e){var e=$t;if(e){var n=e;if(!lg(t,e)){if(Cf(t))throw Error(C(418));e=Pr(n.nextSibling);var r=Lt;e&&lg(t,e)?Jv(r,n):(t.flags=t.flags&-4097|2,_e=!1,Lt=t)}}else{if(Cf(t))throw Error(C(418));t.flags=t.flags&-4097|2,_e=!1,Lt=t}}}function ug(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Lt=t}function Xo(t){if(t!==Lt)return!1;if(!_e)return ug(t),_e=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!kf(t.type,t.memoizedProps)),e&&(e=$t)){if(Cf(t))throw Qv(),Error(C(418));for(;e;)Jv(t,e),e=Pr(e.nextSibling)}if(ug(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(C(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){$t=Pr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}$t=null}}else $t=Lt?Pr(t.stateNode.nextSibling):null;return!0}function Qv(){for(var t=$t;t;)t=Pr(t.nextSibling)}function ia(){$t=Lt=null,_e=!1}function qh(t){dn===null?dn=[t]:dn.push(t)}var vP=sr.ReactCurrentBatchConfig;function Ga(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(C(309));var r=n.stateNode}if(!r)throw Error(C(147,t));var s=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(i){var o=s.refs;i===null?delete o[a]:o[a]=i},e._stringRef=a,e)}if(typeof t!="string")throw Error(C(284));if(!n._owner)throw Error(C(290,t))}return t}function Yo(t,e){throw t=Object.prototype.toString.call(e),Error(C(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function cg(t){var e=t._init;return e(t._payload)}function Xv(t){function e(g,p){if(t){var _=g.deletions;_===null?(g.deletions=[p],g.flags|=16):_.push(p)}}function n(g,p){if(!t)return null;for(;p!==null;)e(g,p),p=p.sibling;return null}function r(g,p){for(g=new Map;p!==null;)p.key!==null?g.set(p.key,p):g.set(p.index,p),p=p.sibling;return g}function s(g,p){return g=Or(g,p),g.index=0,g.sibling=null,g}function a(g,p,_){return g.index=_,t?(_=g.alternate,_!==null?(_=_.index,_<p?(g.flags|=2,p):_):(g.flags|=2,p)):(g.flags|=1048576,p)}function i(g){return t&&g.alternate===null&&(g.flags|=2),g}function o(g,p,_,w){return p===null||p.tag!==6?(p=pd(_,g.mode,w),p.return=g,p):(p=s(p,_),p.return=g,p)}function l(g,p,_,w){var b=_.type;return b===Is?c(g,p,_.props.children,w,_.key):p!==null&&(p.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===hr&&cg(b)===p.type)?(w=s(p,_.props),w.ref=Ga(g,p,_),w.return=g,w):(w=$l(_.type,_.key,_.props,null,g.mode,w),w.ref=Ga(g,p,_),w.return=g,w)}function u(g,p,_,w){return p===null||p.tag!==4||p.stateNode.containerInfo!==_.containerInfo||p.stateNode.implementation!==_.implementation?(p=md(_,g.mode,w),p.return=g,p):(p=s(p,_.children||[]),p.return=g,p)}function c(g,p,_,w,b){return p===null||p.tag!==7?(p=ts(_,g.mode,w,b),p.return=g,p):(p=s(p,_),p.return=g,p)}function d(g,p,_){if(typeof p=="string"&&p!==""||typeof p=="number")return p=pd(""+p,g.mode,_),p.return=g,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Bo:return _=$l(p.type,p.key,p.props,null,g.mode,_),_.ref=Ga(g,null,p),_.return=g,_;case Rs:return p=md(p,g.mode,_),p.return=g,p;case hr:var w=p._init;return d(g,w(p._payload),_)}if(yi(p)||Ba(p))return p=ts(p,g.mode,_,null),p.return=g,p;Yo(g,p)}return null}function f(g,p,_,w){var b=p!==null?p.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return b!==null?null:o(g,p,""+_,w);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Bo:return _.key===b?l(g,p,_,w):null;case Rs:return _.key===b?u(g,p,_,w):null;case hr:return b=_._init,f(g,p,b(_._payload),w)}if(yi(_)||Ba(_))return b!==null?null:c(g,p,_,w,null);Yo(g,_)}return null}function h(g,p,_,w,b){if(typeof w=="string"&&w!==""||typeof w=="number")return g=g.get(_)||null,o(p,g,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Bo:return g=g.get(w.key===null?_:w.key)||null,l(p,g,w,b);case Rs:return g=g.get(w.key===null?_:w.key)||null,u(p,g,w,b);case hr:var P=w._init;return h(g,p,_,P(w._payload),b)}if(yi(w)||Ba(w))return g=g.get(_)||null,c(p,g,w,b,null);Yo(p,w)}return null}function y(g,p,_,w){for(var b=null,P=null,k=p,R=p=0,Z=null;k!==null&&R<_.length;R++){k.index>R?(Z=k,k=null):Z=k.sibling;var M=f(g,k,_[R],w);if(M===null){k===null&&(k=Z);break}t&&k&&M.alternate===null&&e(g,k),p=a(M,p,R),P===null?b=M:P.sibling=M,P=M,k=Z}if(R===_.length)return n(g,k),_e&&Vr(g,R),b;if(k===null){for(;R<_.length;R++)k=d(g,_[R],w),k!==null&&(p=a(k,p,R),P===null?b=k:P.sibling=k,P=k);return _e&&Vr(g,R),b}for(k=r(g,k);R<_.length;R++)Z=h(k,g,R,_[R],w),Z!==null&&(t&&Z.alternate!==null&&k.delete(Z.key===null?R:Z.key),p=a(Z,p,R),P===null?b=Z:P.sibling=Z,P=Z);return t&&k.forEach(function(K){return e(g,K)}),_e&&Vr(g,R),b}function m(g,p,_,w){var b=Ba(_);if(typeof b!="function")throw Error(C(150));if(_=b.call(_),_==null)throw Error(C(151));for(var P=b=null,k=p,R=p=0,Z=null,M=_.next();k!==null&&!M.done;R++,M=_.next()){k.index>R?(Z=k,k=null):Z=k.sibling;var K=f(g,k,M.value,w);if(K===null){k===null&&(k=Z);break}t&&k&&K.alternate===null&&e(g,k),p=a(K,p,R),P===null?b=K:P.sibling=K,P=K,k=Z}if(M.done)return n(g,k),_e&&Vr(g,R),b;if(k===null){for(;!M.done;R++,M=_.next())M=d(g,M.value,w),M!==null&&(p=a(M,p,R),P===null?b=M:P.sibling=M,P=M);return _e&&Vr(g,R),b}for(k=r(g,k);!M.done;R++,M=_.next())M=h(k,g,R,M.value,w),M!==null&&(t&&M.alternate!==null&&k.delete(M.key===null?R:M.key),p=a(M,p,R),P===null?b=M:P.sibling=M,P=M);return t&&k.forEach(function(Qe){return e(g,Qe)}),_e&&Vr(g,R),b}function v(g,p,_,w){if(typeof _=="object"&&_!==null&&_.type===Is&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Bo:e:{for(var b=_.key,P=p;P!==null;){if(P.key===b){if(b=_.type,b===Is){if(P.tag===7){n(g,P.sibling),p=s(P,_.props.children),p.return=g,g=p;break e}}else if(P.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===hr&&cg(b)===P.type){n(g,P.sibling),p=s(P,_.props),p.ref=Ga(g,P,_),p.return=g,g=p;break e}n(g,P);break}else e(g,P);P=P.sibling}_.type===Is?(p=ts(_.props.children,g.mode,w,_.key),p.return=g,g=p):(w=$l(_.type,_.key,_.props,null,g.mode,w),w.ref=Ga(g,p,_),w.return=g,g=w)}return i(g);case Rs:e:{for(P=_.key;p!==null;){if(p.key===P)if(p.tag===4&&p.stateNode.containerInfo===_.containerInfo&&p.stateNode.implementation===_.implementation){n(g,p.sibling),p=s(p,_.children||[]),p.return=g,g=p;break e}else{n(g,p);break}else e(g,p);p=p.sibling}p=md(_,g.mode,w),p.return=g,g=p}return i(g);case hr:return P=_._init,v(g,p,P(_._payload),w)}if(yi(_))return y(g,p,_,w);if(Ba(_))return m(g,p,_,w);Yo(g,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,p!==null&&p.tag===6?(n(g,p.sibling),p=s(p,_),p.return=g,g=p):(n(g,p),p=pd(_,g.mode,w),p.return=g,g=p),i(g)):n(g,p)}return v}var oa=Xv(!0),Yv=Xv(!1),ru=Mr(null),su=null,Us=null,Gh=null;function Wh(){Gh=Us=su=null}function Kh(t){var e=ru.current;me(ru),t._currentValue=e}function Rf(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Xs(t,e){su=t,Gh=Us=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(vt=!0),t.firstContext=null)}function Qt(t){var e=t._currentValue;if(Gh!==t)if(t={context:t,memoizedValue:e,next:null},Us===null){if(su===null)throw Error(C(308));Us=t,su.dependencies={lanes:0,firstContext:t}}else Us=Us.next=t;return e}var Wr=null;function Jh(t){Wr===null?Wr=[t]:Wr.push(t)}function ew(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Jh(e)):(n.next=s.next,s.next=n),e.interleaved=n,Qn(t,r)}function Qn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var pr=!1;function Qh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tw(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Gn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function kr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,oe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Qn(t,n)}return s=r.interleaved,s===null?(e.next=e,Jh(r)):(e.next=s.next,s.next=e),r.interleaved=e,Qn(t,n)}function Ol(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Lh(t,n)}}function dg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?s=a=i:a=a.next=i,n=n.next}while(n!==null);a===null?s=a=e:a=a.next=e}else s=a=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function au(t,e,n,r){var s=t.updateQueue;pr=!1;var a=s.firstBaseUpdate,i=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,u=l.next;l.next=null,i===null?a=u:i.next=u,i=l;var c=t.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==i&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(a!==null){var d=s.baseState;i=0,c=u=l=null,o=a;do{var f=o.lane,h=o.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var y=t,m=o;switch(f=e,h=n,m.tag){case 1:if(y=m.payload,typeof y=="function"){d=y.call(h,d,f);break e}d=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=m.payload,f=typeof y=="function"?y.call(h,d,f):y,f==null)break e;d=Se({},d,f);break e;case 2:pr=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[o]:f.push(o))}else h={eventTime:h,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=h,l=d):c=c.next=h,i|=f;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;f=o,o=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do i|=s.lane,s=s.next;while(s!==e)}else a===null&&(s.shared.lanes=0);ls|=i,t.lanes=i,t.memoizedState=d}}function fg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(C(191,s));s.call(r)}}}var So={},$n=Mr(So),eo=Mr(So),to=Mr(So);function Kr(t){if(t===So)throw Error(C(174));return t}function Xh(t,e){switch(he(to,e),he(eo,t),he($n,So),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:df(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=df(e,t)}me($n),he($n,e)}function la(){me($n),me(eo),me(to)}function nw(t){Kr(to.current);var e=Kr($n.current),n=df(e,t.type);e!==n&&(he(eo,t),he($n,n))}function Yh(t){eo.current===t&&(me($n),me(eo))}var be=Mr(0);function iu(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ld=[];function ep(){for(var t=0;t<ld.length;t++)ld[t]._workInProgressVersionPrimary=null;ld.length=0}var Cl=sr.ReactCurrentDispatcher,ud=sr.ReactCurrentBatchConfig,os=0,Ee=null,Ne=null,De=null,ou=!1,ji=!1,no=0,wP=0;function Xe(){throw Error(C(321))}function tp(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!gn(t[n],e[n]))return!1;return!0}function np(t,e,n,r,s,a){if(os=a,Ee=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Cl.current=t===null||t.memoizedState===null?PP:kP,t=n(r,s),ji){a=0;do{if(ji=!1,no=0,25<=a)throw Error(C(301));a+=1,De=Ne=null,e.updateQueue=null,Cl.current=xP,t=n(r,s)}while(ji)}if(Cl.current=lu,e=Ne!==null&&Ne.next!==null,os=0,De=Ne=Ee=null,ou=!1,e)throw Error(C(300));return t}function rp(){var t=no!==0;return no=0,t}function xn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return De===null?Ee.memoizedState=De=t:De=De.next=t,De}function Xt(){if(Ne===null){var t=Ee.alternate;t=t!==null?t.memoizedState:null}else t=Ne.next;var e=De===null?Ee.memoizedState:De.next;if(e!==null)De=e,Ne=t;else{if(t===null)throw Error(C(310));Ne=t,t={memoizedState:Ne.memoizedState,baseState:Ne.baseState,baseQueue:Ne.baseQueue,queue:Ne.queue,next:null},De===null?Ee.memoizedState=De=t:De=De.next=t}return De}function ro(t,e){return typeof e=="function"?e(t):e}function cd(t){var e=Xt(),n=e.queue;if(n===null)throw Error(C(311));n.lastRenderedReducer=t;var r=Ne,s=r.baseQueue,a=n.pending;if(a!==null){if(s!==null){var i=s.next;s.next=a.next,a.next=i}r.baseQueue=s=a,n.pending=null}if(s!==null){a=s.next,r=r.baseState;var o=i=null,l=null,u=a;do{var c=u.lane;if((os&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,i=r):l=l.next=d,Ee.lanes|=c,ls|=c}u=u.next}while(u!==null&&u!==a);l===null?i=r:l.next=o,gn(r,e.memoizedState)||(vt=!0),e.memoizedState=r,e.baseState=i,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do a=s.lane,Ee.lanes|=a,ls|=a,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function dd(t){var e=Xt(),n=e.queue;if(n===null)throw Error(C(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,a=e.memoizedState;if(s!==null){n.pending=null;var i=s=s.next;do a=t(a,i.action),i=i.next;while(i!==s);gn(a,e.memoizedState)||(vt=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function rw(){}function sw(t,e){var n=Ee,r=Xt(),s=e(),a=!gn(r.memoizedState,s);if(a&&(r.memoizedState=s,vt=!0),r=r.queue,sp(ow.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||De!==null&&De.memoizedState.tag&1){if(n.flags|=2048,so(9,iw.bind(null,n,r,s,e),void 0,null),Fe===null)throw Error(C(349));os&30||aw(n,e,s)}return s}function aw(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ee.updateQueue,e===null?(e={lastEffect:null,stores:null},Ee.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function iw(t,e,n,r){e.value=n,e.getSnapshot=r,lw(e)&&uw(t)}function ow(t,e,n){return n(function(){lw(e)&&uw(t)})}function lw(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!gn(t,n)}catch{return!0}}function uw(t){var e=Qn(t,1);e!==null&&mn(e,t,1,-1)}function hg(t){var e=xn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ro,lastRenderedState:t},e.queue=t,t=t.dispatch=SP.bind(null,Ee,t),[e.memoizedState,t]}function so(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ee.updateQueue,e===null?(e={lastEffect:null,stores:null},Ee.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function cw(){return Xt().memoizedState}function Tl(t,e,n,r){var s=xn();Ee.flags|=t,s.memoizedState=so(1|e,n,void 0,r===void 0?null:r)}function Vu(t,e,n,r){var s=Xt();r=r===void 0?null:r;var a=void 0;if(Ne!==null){var i=Ne.memoizedState;if(a=i.destroy,r!==null&&tp(r,i.deps)){s.memoizedState=so(e,n,a,r);return}}Ee.flags|=t,s.memoizedState=so(1|e,n,a,r)}function pg(t,e){return Tl(8390656,8,t,e)}function sp(t,e){return Vu(2048,8,t,e)}function dw(t,e){return Vu(4,2,t,e)}function fw(t,e){return Vu(4,4,t,e)}function hw(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function pw(t,e,n){return n=n!=null?n.concat([t]):null,Vu(4,4,hw.bind(null,e,t),n)}function ap(){}function mw(t,e){var n=Xt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&tp(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function gw(t,e){var n=Xt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&tp(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function yw(t,e,n){return os&21?(gn(n,e)||(n=Ev(),Ee.lanes|=n,ls|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,vt=!0),t.memoizedState=n)}function bP(t,e){var n=de;de=n!==0&&4>n?n:4,t(!0);var r=ud.transition;ud.transition={};try{t(!1),e()}finally{de=n,ud.transition=r}}function _w(){return Xt().memoizedState}function EP(t,e,n){var r=Ar(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},vw(t))ww(e,n);else if(n=ew(t,e,n,r),n!==null){var s=ut();mn(n,t,r,s),bw(n,e,r)}}function SP(t,e,n){var r=Ar(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(vw(t))ww(e,s);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var i=e.lastRenderedState,o=a(i,n);if(s.hasEagerState=!0,s.eagerState=o,gn(o,i)){var l=e.interleaved;l===null?(s.next=s,Jh(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=ew(t,e,s,r),n!==null&&(s=ut(),mn(n,t,r,s),bw(n,e,r))}}function vw(t){var e=t.alternate;return t===Ee||e!==null&&e===Ee}function ww(t,e){ji=ou=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function bw(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Lh(t,n)}}var lu={readContext:Qt,useCallback:Xe,useContext:Xe,useEffect:Xe,useImperativeHandle:Xe,useInsertionEffect:Xe,useLayoutEffect:Xe,useMemo:Xe,useReducer:Xe,useRef:Xe,useState:Xe,useDebugValue:Xe,useDeferredValue:Xe,useTransition:Xe,useMutableSource:Xe,useSyncExternalStore:Xe,useId:Xe,unstable_isNewReconciler:!1},PP={readContext:Qt,useCallback:function(t,e){return xn().memoizedState=[t,e===void 0?null:e],t},useContext:Qt,useEffect:pg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Tl(4194308,4,hw.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Tl(4194308,4,t,e)},useInsertionEffect:function(t,e){return Tl(4,2,t,e)},useMemo:function(t,e){var n=xn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=xn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=EP.bind(null,Ee,t),[r.memoizedState,t]},useRef:function(t){var e=xn();return t={current:t},e.memoizedState=t},useState:hg,useDebugValue:ap,useDeferredValue:function(t){return xn().memoizedState=t},useTransition:function(){var t=hg(!1),e=t[0];return t=bP.bind(null,t[1]),xn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ee,s=xn();if(_e){if(n===void 0)throw Error(C(407));n=n()}else{if(n=e(),Fe===null)throw Error(C(349));os&30||aw(r,e,n)}s.memoizedState=n;var a={value:n,getSnapshot:e};return s.queue=a,pg(ow.bind(null,r,a,t),[t]),r.flags|=2048,so(9,iw.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=xn(),e=Fe.identifierPrefix;if(_e){var n=qn,r=Zn;n=(r&~(1<<32-pn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=no++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=wP++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},kP={readContext:Qt,useCallback:mw,useContext:Qt,useEffect:sp,useImperativeHandle:pw,useInsertionEffect:dw,useLayoutEffect:fw,useMemo:gw,useReducer:cd,useRef:cw,useState:function(){return cd(ro)},useDebugValue:ap,useDeferredValue:function(t){var e=Xt();return yw(e,Ne.memoizedState,t)},useTransition:function(){var t=cd(ro)[0],e=Xt().memoizedState;return[t,e]},useMutableSource:rw,useSyncExternalStore:sw,useId:_w,unstable_isNewReconciler:!1},xP={readContext:Qt,useCallback:mw,useContext:Qt,useEffect:sp,useImperativeHandle:pw,useInsertionEffect:dw,useLayoutEffect:fw,useMemo:gw,useReducer:dd,useRef:cw,useState:function(){return dd(ro)},useDebugValue:ap,useDeferredValue:function(t){var e=Xt();return Ne===null?e.memoizedState=t:yw(e,Ne.memoizedState,t)},useTransition:function(){var t=dd(ro)[0],e=Xt().memoizedState;return[t,e]},useMutableSource:rw,useSyncExternalStore:sw,useId:_w,unstable_isNewReconciler:!1};function ln(t,e){if(t&&t.defaultProps){e=Se({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function If(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Se({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Hu={isMounted:function(t){return(t=t._reactInternals)?gs(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=ut(),s=Ar(t),a=Gn(r,s);a.payload=e,n!=null&&(a.callback=n),e=kr(t,a,s),e!==null&&(mn(e,t,s,r),Ol(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=ut(),s=Ar(t),a=Gn(r,s);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=kr(t,a,s),e!==null&&(mn(e,t,s,r),Ol(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=ut(),r=Ar(t),s=Gn(n,r);s.tag=2,e!=null&&(s.callback=e),e=kr(t,s,r),e!==null&&(mn(e,t,r,n),Ol(e,t,r))}};function mg(t,e,n,r,s,a,i){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,i):e.prototype&&e.prototype.isPureReactComponent?!Ji(n,r)||!Ji(s,a):!0}function Ew(t,e,n){var r=!1,s=Nr,a=e.contextType;return typeof a=="object"&&a!==null?a=Qt(a):(s=bt(e)?as:st.current,r=e.contextTypes,a=(r=r!=null)?aa(t,s):Nr),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Hu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=a),e}function gg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Hu.enqueueReplaceState(e,e.state,null)}function Nf(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Qh(t);var a=e.contextType;typeof a=="object"&&a!==null?s.context=Qt(a):(a=bt(e)?as:st.current,s.context=aa(t,a)),s.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(If(t,e,a,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Hu.enqueueReplaceState(s,s.state,null),au(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function ua(t,e){try{var n="",r=e;do n+=e1(r),r=r.return;while(r);var s=n}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:s,digest:null}}function fd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function $f(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var AP=typeof WeakMap=="function"?WeakMap:Map;function Sw(t,e,n){n=Gn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){cu||(cu=!0,Hf=r),$f(t,e)},n}function Pw(t,e,n){n=Gn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){$f(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){$f(t,e),typeof r!="function"&&(xr===null?xr=new Set([this]):xr.add(this));var i=e.stack;this.componentDidCatch(e.value,{componentStack:i!==null?i:""})}),n}function yg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new AP;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=zP.bind(null,t,e,n),e.then(t,t))}function _g(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function vg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Gn(-1,1),e.tag=2,kr(n,e,1))),n.lanes|=1),t)}var OP=sr.ReactCurrentOwner,vt=!1;function lt(t,e,n,r){e.child=t===null?Yv(e,null,n,r):oa(e,t.child,n,r)}function wg(t,e,n,r,s){n=n.render;var a=e.ref;return Xs(e,s),r=np(t,e,n,r,a,s),n=rp(),t!==null&&!vt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xn(t,e,s)):(_e&&n&&Hh(e),e.flags|=1,lt(t,e,r,s),e.child)}function bg(t,e,n,r,s){if(t===null){var a=n.type;return typeof a=="function"&&!hp(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,kw(t,e,a,r,s)):(t=$l(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&s)){var i=a.memoizedProps;if(n=n.compare,n=n!==null?n:Ji,n(i,r)&&t.ref===e.ref)return Xn(t,e,s)}return e.flags|=1,t=Or(a,r),t.ref=e.ref,t.return=e,e.child=t}function kw(t,e,n,r,s){if(t!==null){var a=t.memoizedProps;if(Ji(a,r)&&t.ref===e.ref)if(vt=!1,e.pendingProps=r=a,(t.lanes&s)!==0)t.flags&131072&&(vt=!0);else return e.lanes=t.lanes,Xn(t,e,s)}return jf(t,e,n,r,s)}function xw(t,e,n){var r=e.pendingProps,s=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},he(Bs,It),It|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,he(Bs,It),It|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,he(Bs,It),It|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,he(Bs,It),It|=r;return lt(t,e,s,n),e.child}function Aw(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function jf(t,e,n,r,s){var a=bt(n)?as:st.current;return a=aa(e,a),Xs(e,s),n=np(t,e,n,r,a,s),r=rp(),t!==null&&!vt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xn(t,e,s)):(_e&&r&&Hh(e),e.flags|=1,lt(t,e,n,s),e.child)}function Eg(t,e,n,r,s){if(bt(n)){var a=!0;eu(e)}else a=!1;if(Xs(e,s),e.stateNode===null)Rl(t,e),Ew(e,n,r),Nf(e,n,r,s),r=!0;else if(t===null){var i=e.stateNode,o=e.memoizedProps;i.props=o;var l=i.context,u=n.contextType;typeof u=="object"&&u!==null?u=Qt(u):(u=bt(n)?as:st.current,u=aa(e,u));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof i.getSnapshotBeforeUpdate=="function";d||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(o!==r||l!==u)&&gg(e,i,r,u),pr=!1;var f=e.memoizedState;i.state=f,au(e,r,i,s),l=e.memoizedState,o!==r||f!==l||wt.current||pr?(typeof c=="function"&&(If(e,n,c,r),l=e.memoizedState),(o=pr||mg(e,n,o,r,f,l,u))?(d||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),i.props=r,i.state=l,i.context=u,r=o):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{i=e.stateNode,tw(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:ln(e.type,o),i.props=u,d=e.pendingProps,f=i.context,l=n.contextType,typeof l=="object"&&l!==null?l=Qt(l):(l=bt(n)?as:st.current,l=aa(e,l));var h=n.getDerivedStateFromProps;(c=typeof h=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(o!==d||f!==l)&&gg(e,i,r,l),pr=!1,f=e.memoizedState,i.state=f,au(e,r,i,s);var y=e.memoizedState;o!==d||f!==y||wt.current||pr?(typeof h=="function"&&(If(e,n,h,r),y=e.memoizedState),(u=pr||mg(e,n,u,r,f,y,l)||!1)?(c||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(r,y,l),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(r,y,l)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=y),i.props=r,i.state=y,i.context=l,r=u):(typeof i.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Lf(t,e,n,r,a,s)}function Lf(t,e,n,r,s,a){Aw(t,e);var i=(e.flags&128)!==0;if(!r&&!i)return s&&og(e,n,!1),Xn(t,e,a);r=e.stateNode,OP.current=e;var o=i&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&i?(e.child=oa(e,t.child,null,a),e.child=oa(e,null,o,a)):lt(t,e,o,a),e.memoizedState=r.state,s&&og(e,n,!0),e.child}function Ow(t){var e=t.stateNode;e.pendingContext?ig(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ig(t,e.context,!1),Xh(t,e.containerInfo)}function Sg(t,e,n,r,s){return ia(),qh(s),e.flags|=256,lt(t,e,n,r),e.child}var Df={dehydrated:null,treeContext:null,retryLane:0};function Mf(t){return{baseLanes:t,cachePool:null,transitions:null}}function Cw(t,e,n){var r=e.pendingProps,s=be.current,a=!1,i=(e.flags&128)!==0,o;if((o=i)||(o=t!==null&&t.memoizedState===null?!1:(s&2)!==0),o?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),he(be,s&1),t===null)return Tf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(i=r.children,t=r.fallback,a?(r=e.mode,a=e.child,i={mode:"hidden",children:i},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=i):a=Gu(i,r,0,null),t=ts(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Mf(n),e.memoizedState=Df,t):ip(e,i));if(s=t.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return CP(t,e,i,r,o,s,n);if(a){a=r.fallback,i=e.mode,s=t.child,o=s.sibling;var l={mode:"hidden",children:r.children};return!(i&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Or(s,l),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?a=Or(o,a):(a=ts(a,i,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,i=t.child.memoizedState,i=i===null?Mf(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},a.memoizedState=i,a.childLanes=t.childLanes&~n,e.memoizedState=Df,r}return a=t.child,t=a.sibling,r=Or(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function ip(t,e){return e=Gu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function el(t,e,n,r){return r!==null&&qh(r),oa(e,t.child,null,n),t=ip(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function CP(t,e,n,r,s,a,i){if(n)return e.flags&256?(e.flags&=-257,r=fd(Error(C(422))),el(t,e,i,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,s=e.mode,r=Gu({mode:"visible",children:r.children},s,0,null),a=ts(a,s,i,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&oa(e,t.child,null,i),e.child.memoizedState=Mf(i),e.memoizedState=Df,a);if(!(e.mode&1))return el(t,e,i,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,a=Error(C(419)),r=fd(a,r,void 0),el(t,e,i,r)}if(o=(i&t.childLanes)!==0,vt||o){if(r=Fe,r!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|i)?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,Qn(t,s),mn(r,t,s,-1))}return fp(),r=fd(Error(C(421))),el(t,e,i,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=BP.bind(null,t),s._reactRetry=e,null):(t=a.treeContext,$t=Pr(s.nextSibling),Lt=e,_e=!0,dn=null,t!==null&&(Ht[Zt++]=Zn,Ht[Zt++]=qn,Ht[Zt++]=is,Zn=t.id,qn=t.overflow,is=e),e=ip(e,r.children),e.flags|=4096,e)}function Pg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Rf(t.return,e,n)}function hd(t,e,n,r,s){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function Tw(t,e,n){var r=e.pendingProps,s=r.revealOrder,a=r.tail;if(lt(t,e,r.children,n),r=be.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Pg(t,n,e);else if(t.tag===19)Pg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(he(be,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&iu(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),hd(e,!1,s,n,a);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&iu(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}hd(e,!0,n,null,a);break;case"together":hd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Rl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ls|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(C(153));if(e.child!==null){for(t=e.child,n=Or(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Or(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function TP(t,e,n){switch(e.tag){case 3:Ow(e),ia();break;case 5:nw(e);break;case 1:bt(e.type)&&eu(e);break;case 4:Xh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;he(ru,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(he(be,be.current&1),e.flags|=128,null):n&e.child.childLanes?Cw(t,e,n):(he(be,be.current&1),t=Xn(t,e,n),t!==null?t.sibling:null);he(be,be.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Tw(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),he(be,be.current),r)break;return null;case 22:case 23:return e.lanes=0,xw(t,e,n)}return Xn(t,e,n)}var Rw,Ff,Iw,Nw;Rw=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ff=function(){};Iw=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Kr($n.current);var a=null;switch(n){case"input":s=of(t,s),r=of(t,r),a=[];break;case"select":s=Se({},s,{value:void 0}),r=Se({},r,{value:void 0}),a=[];break;case"textarea":s=cf(t,s),r=cf(t,r),a=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Xl)}ff(n,r);var i;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(i in o)o.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Vi.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var l=r[u];if(o=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(i in o)!o.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in l)l.hasOwnProperty(i)&&o[i]!==l[i]&&(n||(n={}),n[i]=l[i])}else n||(a||(a=[]),a.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(a=a||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(a=a||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Vi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&pe("scroll",t),a||o===l||(a=[])):(a=a||[]).push(u,l))}n&&(a=a||[]).push("style",n);var u=a;(e.updateQueue=u)&&(e.flags|=4)}};Nw=function(t,e,n,r){n!==r&&(e.flags|=4)};function Wa(t,e){if(!_e)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ye(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function RP(t,e,n){var r=e.pendingProps;switch(Zh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ye(e),null;case 1:return bt(e.type)&&Yl(),Ye(e),null;case 3:return r=e.stateNode,la(),me(wt),me(st),ep(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Xo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dn!==null&&(Gf(dn),dn=null))),Ff(t,e),Ye(e),null;case 5:Yh(e);var s=Kr(to.current);if(n=e.type,t!==null&&e.stateNode!=null)Iw(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(C(166));return Ye(e),null}if(t=Kr($n.current),Xo(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[Tn]=e,r[Yi]=a,t=(e.mode&1)!==0,n){case"dialog":pe("cancel",r),pe("close",r);break;case"iframe":case"object":case"embed":pe("load",r);break;case"video":case"audio":for(s=0;s<vi.length;s++)pe(vi[s],r);break;case"source":pe("error",r);break;case"img":case"image":case"link":pe("error",r),pe("load",r);break;case"details":pe("toggle",r);break;case"input":Nm(r,a),pe("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},pe("invalid",r);break;case"textarea":jm(r,a),pe("invalid",r)}ff(n,a),s=null;for(var i in a)if(a.hasOwnProperty(i)){var o=a[i];i==="children"?typeof o=="string"?r.textContent!==o&&(a.suppressHydrationWarning!==!0&&Qo(r.textContent,o,t),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(a.suppressHydrationWarning!==!0&&Qo(r.textContent,o,t),s=["children",""+o]):Vi.hasOwnProperty(i)&&o!=null&&i==="onScroll"&&pe("scroll",r)}switch(n){case"input":Vo(r),$m(r,a,!0);break;case"textarea":Vo(r),Lm(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Xl)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ov(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=i.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=i.createElement(n,{is:r.is}):(t=i.createElement(n),n==="select"&&(i=t,r.multiple?i.multiple=!0:r.size&&(i.size=r.size))):t=i.createElementNS(t,n),t[Tn]=e,t[Yi]=r,Rw(t,e,!1,!1),e.stateNode=t;e:{switch(i=hf(n,r),n){case"dialog":pe("cancel",t),pe("close",t),s=r;break;case"iframe":case"object":case"embed":pe("load",t),s=r;break;case"video":case"audio":for(s=0;s<vi.length;s++)pe(vi[s],t);s=r;break;case"source":pe("error",t),s=r;break;case"img":case"image":case"link":pe("error",t),pe("load",t),s=r;break;case"details":pe("toggle",t),s=r;break;case"input":Nm(t,r),s=of(t,r),pe("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Se({},r,{value:void 0}),pe("invalid",t);break;case"textarea":jm(t,r),s=cf(t,r),pe("invalid",t);break;default:s=r}ff(n,s),o=s;for(a in o)if(o.hasOwnProperty(a)){var l=o[a];a==="style"?cv(t,l):a==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&lv(t,l)):a==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Hi(t,l):typeof l=="number"&&Hi(t,""+l):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(Vi.hasOwnProperty(a)?l!=null&&a==="onScroll"&&pe("scroll",t):l!=null&&Th(t,a,l,i))}switch(n){case"input":Vo(t),$m(t,r,!1);break;case"textarea":Vo(t),Lm(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ir(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?Ws(t,!!r.multiple,a,!1):r.defaultValue!=null&&Ws(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Xl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ye(e),null;case 6:if(t&&e.stateNode!=null)Nw(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(C(166));if(n=Kr(to.current),Kr($n.current),Xo(e)){if(r=e.stateNode,n=e.memoizedProps,r[Tn]=e,(a=r.nodeValue!==n)&&(t=Lt,t!==null))switch(t.tag){case 3:Qo(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Qo(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Tn]=e,e.stateNode=r}return Ye(e),null;case 13:if(me(be),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_e&&$t!==null&&e.mode&1&&!(e.flags&128))Qv(),ia(),e.flags|=98560,a=!1;else if(a=Xo(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(C(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(C(317));a[Tn]=e}else ia(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ye(e),a=!1}else dn!==null&&(Gf(dn),dn=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||be.current&1?$e===0&&($e=3):fp())),e.updateQueue!==null&&(e.flags|=4),Ye(e),null);case 4:return la(),Ff(t,e),t===null&&Qi(e.stateNode.containerInfo),Ye(e),null;case 10:return Kh(e.type._context),Ye(e),null;case 17:return bt(e.type)&&Yl(),Ye(e),null;case 19:if(me(be),a=e.memoizedState,a===null)return Ye(e),null;if(r=(e.flags&128)!==0,i=a.rendering,i===null)if(r)Wa(a,!1);else{if($e!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(i=iu(t),i!==null){for(e.flags|=128,Wa(a,!1),r=i.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,i=a.alternate,i===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,a.type=i.type,t=i.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return he(be,be.current&1|2),e.child}t=t.sibling}a.tail!==null&&Ae()>ca&&(e.flags|=128,r=!0,Wa(a,!1),e.lanes=4194304)}else{if(!r)if(t=iu(i),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Wa(a,!0),a.tail===null&&a.tailMode==="hidden"&&!i.alternate&&!_e)return Ye(e),null}else 2*Ae()-a.renderingStartTime>ca&&n!==1073741824&&(e.flags|=128,r=!0,Wa(a,!1),e.lanes=4194304);a.isBackwards?(i.sibling=e.child,e.child=i):(n=a.last,n!==null?n.sibling=i:e.child=i,a.last=i)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Ae(),e.sibling=null,n=be.current,he(be,r?n&1|2:n&1),e):(Ye(e),null);case 22:case 23:return dp(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?It&1073741824&&(Ye(e),e.subtreeFlags&6&&(e.flags|=8192)):Ye(e),null;case 24:return null;case 25:return null}throw Error(C(156,e.tag))}function IP(t,e){switch(Zh(e),e.tag){case 1:return bt(e.type)&&Yl(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return la(),me(wt),me(st),ep(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Yh(e),null;case 13:if(me(be),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(C(340));ia()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return me(be),null;case 4:return la(),null;case 10:return Kh(e.type._context),null;case 22:case 23:return dp(),null;case 24:return null;default:return null}}var tl=!1,tt=!1,NP=typeof WeakSet=="function"?WeakSet:Set,D=null;function zs(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Pe(t,e,r)}else n.current=null}function Uf(t,e,n){try{n()}catch(r){Pe(t,e,r)}}var kg=!1;function $P(t,e){if(Sf=Kl,t=Mv(),Vh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var i=0,o=-1,l=-1,u=0,c=0,d=t,f=null;t:for(;;){for(var h;d!==n||s!==0&&d.nodeType!==3||(o=i+s),d!==a||r!==0&&d.nodeType!==3||(l=i+r),d.nodeType===3&&(i+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===t)break t;if(f===n&&++u===s&&(o=i),f===a&&++c===r&&(l=i),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=o===-1||l===-1?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Pf={focusedElem:t,selectionRange:n},Kl=!1,D=e;D!==null;)if(e=D,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,D=t;else for(;D!==null;){e=D;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var m=y.memoizedProps,v=y.memoizedState,g=e.stateNode,p=g.getSnapshotBeforeUpdate(e.elementType===e.type?m:ln(e.type,m),v);g.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(C(163))}}catch(w){Pe(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,D=t;break}D=e.return}return y=kg,kg=!1,y}function Li(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var a=s.destroy;s.destroy=void 0,a!==void 0&&Uf(e,n,a)}s=s.next}while(s!==r)}}function Zu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function zf(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function $w(t){var e=t.alternate;e!==null&&(t.alternate=null,$w(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Tn],delete e[Yi],delete e[Af],delete e[gP],delete e[yP])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function jw(t){return t.tag===5||t.tag===3||t.tag===4}function xg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||jw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Bf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Xl));else if(r!==4&&(t=t.child,t!==null))for(Bf(t,e,n),t=t.sibling;t!==null;)Bf(t,e,n),t=t.sibling}function Vf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Vf(t,e,n),t=t.sibling;t!==null;)Vf(t,e,n),t=t.sibling}var Be=null,cn=!1;function ar(t,e,n){for(n=n.child;n!==null;)Lw(t,e,n),n=n.sibling}function Lw(t,e,n){if(Nn&&typeof Nn.onCommitFiberUnmount=="function")try{Nn.onCommitFiberUnmount(Du,n)}catch{}switch(n.tag){case 5:tt||zs(n,e);case 6:var r=Be,s=cn;Be=null,ar(t,e,n),Be=r,cn=s,Be!==null&&(cn?(t=Be,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Be.removeChild(n.stateNode));break;case 18:Be!==null&&(cn?(t=Be,n=n.stateNode,t.nodeType===8?id(t.parentNode,n):t.nodeType===1&&id(t,n),Wi(t)):id(Be,n.stateNode));break;case 4:r=Be,s=cn,Be=n.stateNode.containerInfo,cn=!0,ar(t,e,n),Be=r,cn=s;break;case 0:case 11:case 14:case 15:if(!tt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var a=s,i=a.destroy;a=a.tag,i!==void 0&&(a&2||a&4)&&Uf(n,e,i),s=s.next}while(s!==r)}ar(t,e,n);break;case 1:if(!tt&&(zs(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){Pe(n,e,o)}ar(t,e,n);break;case 21:ar(t,e,n);break;case 22:n.mode&1?(tt=(r=tt)||n.memoizedState!==null,ar(t,e,n),tt=r):ar(t,e,n);break;default:ar(t,e,n)}}function Ag(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new NP),e.forEach(function(r){var s=VP.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function tn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var a=t,i=e,o=i;e:for(;o!==null;){switch(o.tag){case 5:Be=o.stateNode,cn=!1;break e;case 3:Be=o.stateNode.containerInfo,cn=!0;break e;case 4:Be=o.stateNode.containerInfo,cn=!0;break e}o=o.return}if(Be===null)throw Error(C(160));Lw(a,i,s),Be=null,cn=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){Pe(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Dw(e,t),e=e.sibling}function Dw(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(tn(e,t),En(t),r&4){try{Li(3,t,t.return),Zu(3,t)}catch(m){Pe(t,t.return,m)}try{Li(5,t,t.return)}catch(m){Pe(t,t.return,m)}}break;case 1:tn(e,t),En(t),r&512&&n!==null&&zs(n,n.return);break;case 5:if(tn(e,t),En(t),r&512&&n!==null&&zs(n,n.return),t.flags&32){var s=t.stateNode;try{Hi(s,"")}catch(m){Pe(t,t.return,m)}}if(r&4&&(s=t.stateNode,s!=null)){var a=t.memoizedProps,i=n!==null?n.memoizedProps:a,o=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{o==="input"&&a.type==="radio"&&a.name!=null&&av(s,a),hf(o,i);var u=hf(o,a);for(i=0;i<l.length;i+=2){var c=l[i],d=l[i+1];c==="style"?cv(s,d):c==="dangerouslySetInnerHTML"?lv(s,d):c==="children"?Hi(s,d):Th(s,c,d,u)}switch(o){case"input":lf(s,a);break;case"textarea":iv(s,a);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var h=a.value;h!=null?Ws(s,!!a.multiple,h,!1):f!==!!a.multiple&&(a.defaultValue!=null?Ws(s,!!a.multiple,a.defaultValue,!0):Ws(s,!!a.multiple,a.multiple?[]:"",!1))}s[Yi]=a}catch(m){Pe(t,t.return,m)}}break;case 6:if(tn(e,t),En(t),r&4){if(t.stateNode===null)throw Error(C(162));s=t.stateNode,a=t.memoizedProps;try{s.nodeValue=a}catch(m){Pe(t,t.return,m)}}break;case 3:if(tn(e,t),En(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Wi(e.containerInfo)}catch(m){Pe(t,t.return,m)}break;case 4:tn(e,t),En(t);break;case 13:tn(e,t),En(t),s=t.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(up=Ae())),r&4&&Ag(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(tt=(u=tt)||c,tn(e,t),tt=u):tn(e,t),En(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(D=t,c=t.child;c!==null;){for(d=D=c;D!==null;){switch(f=D,h=f.child,f.tag){case 0:case 11:case 14:case 15:Li(4,f,f.return);break;case 1:zs(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(m){Pe(r,n,m)}}break;case 5:zs(f,f.return);break;case 22:if(f.memoizedState!==null){Cg(d);continue}}h!==null?(h.return=f,D=h):Cg(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(o=d.stateNode,l=d.memoizedProps.style,i=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=uv("display",i))}catch(m){Pe(t,t.return,m)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(m){Pe(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:tn(e,t),En(t),r&4&&Ag(t);break;case 21:break;default:tn(e,t),En(t)}}function En(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(jw(n)){var r=n;break e}n=n.return}throw Error(C(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Hi(s,""),r.flags&=-33);var a=xg(t);Vf(t,a,s);break;case 3:case 4:var i=r.stateNode.containerInfo,o=xg(t);Bf(t,o,i);break;default:throw Error(C(161))}}catch(l){Pe(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function jP(t,e,n){D=t,Mw(t)}function Mw(t,e,n){for(var r=(t.mode&1)!==0;D!==null;){var s=D,a=s.child;if(s.tag===22&&r){var i=s.memoizedState!==null||tl;if(!i){var o=s.alternate,l=o!==null&&o.memoizedState!==null||tt;o=tl;var u=tt;if(tl=i,(tt=l)&&!u)for(D=s;D!==null;)i=D,l=i.child,i.tag===22&&i.memoizedState!==null?Tg(s):l!==null?(l.return=i,D=l):Tg(s);for(;a!==null;)D=a,Mw(a),a=a.sibling;D=s,tl=o,tt=u}Og(t)}else s.subtreeFlags&8772&&a!==null?(a.return=s,D=a):Og(t)}}function Og(t){for(;D!==null;){var e=D;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:tt||Zu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!tt)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:ln(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&fg(e,a,r);break;case 3:var i=e.updateQueue;if(i!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}fg(e,i,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Wi(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(C(163))}tt||e.flags&512&&zf(e)}catch(f){Pe(e,e.return,f)}}if(e===t){D=null;break}if(n=e.sibling,n!==null){n.return=e.return,D=n;break}D=e.return}}function Cg(t){for(;D!==null;){var e=D;if(e===t){D=null;break}var n=e.sibling;if(n!==null){n.return=e.return,D=n;break}D=e.return}}function Tg(t){for(;D!==null;){var e=D;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Zu(4,e)}catch(l){Pe(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Pe(e,s,l)}}var a=e.return;try{zf(e)}catch(l){Pe(e,a,l)}break;case 5:var i=e.return;try{zf(e)}catch(l){Pe(e,i,l)}}}catch(l){Pe(e,e.return,l)}if(e===t){D=null;break}var o=e.sibling;if(o!==null){o.return=e.return,D=o;break}D=e.return}}var LP=Math.ceil,uu=sr.ReactCurrentDispatcher,op=sr.ReactCurrentOwner,Wt=sr.ReactCurrentBatchConfig,oe=0,Fe=null,Te=null,Ze=0,It=0,Bs=Mr(0),$e=0,ao=null,ls=0,qu=0,lp=0,Di=null,yt=null,up=0,ca=1/0,Vn=null,cu=!1,Hf=null,xr=null,nl=!1,wr=null,du=0,Mi=0,Zf=null,Il=-1,Nl=0;function ut(){return oe&6?Ae():Il!==-1?Il:Il=Ae()}function Ar(t){return t.mode&1?oe&2&&Ze!==0?Ze&-Ze:vP.transition!==null?(Nl===0&&(Nl=Ev()),Nl):(t=de,t!==0||(t=window.event,t=t===void 0?16:Cv(t.type)),t):1}function mn(t,e,n,r){if(50<Mi)throw Mi=0,Zf=null,Error(C(185));wo(t,n,r),(!(oe&2)||t!==Fe)&&(t===Fe&&(!(oe&2)&&(qu|=n),$e===4&&_r(t,Ze)),Et(t,r),n===1&&oe===0&&!(e.mode&1)&&(ca=Ae()+500,Bu&&Fr()))}function Et(t,e){var n=t.callbackNode;v1(t,e);var r=Wl(t,t===Fe?Ze:0);if(r===0)n!==null&&Fm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Fm(n),e===1)t.tag===0?_P(Rg.bind(null,t)):Wv(Rg.bind(null,t)),pP(function(){!(oe&6)&&Fr()}),n=null;else{switch(Sv(r)){case 1:n=jh;break;case 4:n=wv;break;case 16:n=Gl;break;case 536870912:n=bv;break;default:n=Gl}n=qw(n,Fw.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Fw(t,e){if(Il=-1,Nl=0,oe&6)throw Error(C(327));var n=t.callbackNode;if(Ys()&&t.callbackNode!==n)return null;var r=Wl(t,t===Fe?Ze:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=fu(t,r);else{e=r;var s=oe;oe|=2;var a=zw();(Fe!==t||Ze!==e)&&(Vn=null,ca=Ae()+500,es(t,e));do try{FP();break}catch(o){Uw(t,o)}while(!0);Wh(),uu.current=a,oe=s,Te!==null?e=0:(Fe=null,Ze=0,e=$e)}if(e!==0){if(e===2&&(s=_f(t),s!==0&&(r=s,e=qf(t,s))),e===1)throw n=ao,es(t,0),_r(t,r),Et(t,Ae()),n;if(e===6)_r(t,r);else{if(s=t.current.alternate,!(r&30)&&!DP(s)&&(e=fu(t,r),e===2&&(a=_f(t),a!==0&&(r=a,e=qf(t,a))),e===1))throw n=ao,es(t,0),_r(t,r),Et(t,Ae()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(C(345));case 2:Hr(t,yt,Vn);break;case 3:if(_r(t,r),(r&130023424)===r&&(e=up+500-Ae(),10<e)){if(Wl(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){ut(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=xf(Hr.bind(null,t,yt,Vn),e);break}Hr(t,yt,Vn);break;case 4:if(_r(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var i=31-pn(r);a=1<<i,i=e[i],i>s&&(s=i),r&=~a}if(r=s,r=Ae()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*LP(r/1960))-r,10<r){t.timeoutHandle=xf(Hr.bind(null,t,yt,Vn),r);break}Hr(t,yt,Vn);break;case 5:Hr(t,yt,Vn);break;default:throw Error(C(329))}}}return Et(t,Ae()),t.callbackNode===n?Fw.bind(null,t):null}function qf(t,e){var n=Di;return t.current.memoizedState.isDehydrated&&(es(t,e).flags|=256),t=fu(t,e),t!==2&&(e=yt,yt=n,e!==null&&Gf(e)),t}function Gf(t){yt===null?yt=t:yt.push.apply(yt,t)}function DP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!gn(a(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function _r(t,e){for(e&=~lp,e&=~qu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-pn(e),r=1<<n;t[n]=-1,e&=~r}}function Rg(t){if(oe&6)throw Error(C(327));Ys();var e=Wl(t,0);if(!(e&1))return Et(t,Ae()),null;var n=fu(t,e);if(t.tag!==0&&n===2){var r=_f(t);r!==0&&(e=r,n=qf(t,r))}if(n===1)throw n=ao,es(t,0),_r(t,e),Et(t,Ae()),n;if(n===6)throw Error(C(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Hr(t,yt,Vn),Et(t,Ae()),null}function cp(t,e){var n=oe;oe|=1;try{return t(e)}finally{oe=n,oe===0&&(ca=Ae()+500,Bu&&Fr())}}function us(t){wr!==null&&wr.tag===0&&!(oe&6)&&Ys();var e=oe;oe|=1;var n=Wt.transition,r=de;try{if(Wt.transition=null,de=1,t)return t()}finally{de=r,Wt.transition=n,oe=e,!(oe&6)&&Fr()}}function dp(){It=Bs.current,me(Bs)}function es(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hP(n)),Te!==null)for(n=Te.return;n!==null;){var r=n;switch(Zh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Yl();break;case 3:la(),me(wt),me(st),ep();break;case 5:Yh(r);break;case 4:la();break;case 13:me(be);break;case 19:me(be);break;case 10:Kh(r.type._context);break;case 22:case 23:dp()}n=n.return}if(Fe=t,Te=t=Or(t.current,null),Ze=It=e,$e=0,ao=null,lp=qu=ls=0,yt=Di=null,Wr!==null){for(e=0;e<Wr.length;e++)if(n=Wr[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,a=n.pending;if(a!==null){var i=a.next;a.next=s,r.next=i}n.pending=r}Wr=null}return t}function Uw(t,e){do{var n=Te;try{if(Wh(),Cl.current=lu,ou){for(var r=Ee.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}ou=!1}if(os=0,De=Ne=Ee=null,ji=!1,no=0,op.current=null,n===null||n.return===null){$e=1,ao=e,Te=null;break}e:{var a=t,i=n.return,o=n,l=e;if(e=Ze,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=_g(i);if(h!==null){h.flags&=-257,vg(h,i,o,a,e),h.mode&1&&yg(a,u,e),e=h,l=u;var y=e.updateQueue;if(y===null){var m=new Set;m.add(l),e.updateQueue=m}else y.add(l);break e}else{if(!(e&1)){yg(a,u,e),fp();break e}l=Error(C(426))}}else if(_e&&o.mode&1){var v=_g(i);if(v!==null){!(v.flags&65536)&&(v.flags|=256),vg(v,i,o,a,e),qh(ua(l,o));break e}}a=l=ua(l,o),$e!==4&&($e=2),Di===null?Di=[a]:Di.push(a),a=i;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var g=Sw(a,l,e);dg(a,g);break e;case 1:o=l;var p=a.type,_=a.stateNode;if(!(a.flags&128)&&(typeof p.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(xr===null||!xr.has(_)))){a.flags|=65536,e&=-e,a.lanes|=e;var w=Pw(a,o,e);dg(a,w);break e}}a=a.return}while(a!==null)}Vw(n)}catch(b){e=b,Te===n&&n!==null&&(Te=n=n.return);continue}break}while(!0)}function zw(){var t=uu.current;return uu.current=lu,t===null?lu:t}function fp(){($e===0||$e===3||$e===2)&&($e=4),Fe===null||!(ls&268435455)&&!(qu&268435455)||_r(Fe,Ze)}function fu(t,e){var n=oe;oe|=2;var r=zw();(Fe!==t||Ze!==e)&&(Vn=null,es(t,e));do try{MP();break}catch(s){Uw(t,s)}while(!0);if(Wh(),oe=n,uu.current=r,Te!==null)throw Error(C(261));return Fe=null,Ze=0,$e}function MP(){for(;Te!==null;)Bw(Te)}function FP(){for(;Te!==null&&!c1();)Bw(Te)}function Bw(t){var e=Zw(t.alternate,t,It);t.memoizedProps=t.pendingProps,e===null?Vw(t):Te=e,op.current=null}function Vw(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=IP(n,e),n!==null){n.flags&=32767,Te=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{$e=6,Te=null;return}}else if(n=RP(n,e,It),n!==null){Te=n;return}if(e=e.sibling,e!==null){Te=e;return}Te=e=t}while(e!==null);$e===0&&($e=5)}function Hr(t,e,n){var r=de,s=Wt.transition;try{Wt.transition=null,de=1,UP(t,e,n,r)}finally{Wt.transition=s,de=r}return null}function UP(t,e,n,r){do Ys();while(wr!==null);if(oe&6)throw Error(C(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(C(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(w1(t,a),t===Fe&&(Te=Fe=null,Ze=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||nl||(nl=!0,qw(Gl,function(){return Ys(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Wt.transition,Wt.transition=null;var i=de;de=1;var o=oe;oe|=4,op.current=null,$P(t,n),Dw(n,t),iP(Pf),Kl=!!Sf,Pf=Sf=null,t.current=n,jP(n),d1(),oe=o,de=i,Wt.transition=a}else t.current=n;if(nl&&(nl=!1,wr=t,du=s),a=t.pendingLanes,a===0&&(xr=null),p1(n.stateNode),Et(t,Ae()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(cu)throw cu=!1,t=Hf,Hf=null,t;return du&1&&t.tag!==0&&Ys(),a=t.pendingLanes,a&1?t===Zf?Mi++:(Mi=0,Zf=t):Mi=0,Fr(),null}function Ys(){if(wr!==null){var t=Sv(du),e=Wt.transition,n=de;try{if(Wt.transition=null,de=16>t?16:t,wr===null)var r=!1;else{if(t=wr,wr=null,du=0,oe&6)throw Error(C(331));var s=oe;for(oe|=4,D=t.current;D!==null;){var a=D,i=a.child;if(D.flags&16){var o=a.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(D=u;D!==null;){var c=D;switch(c.tag){case 0:case 11:case 15:Li(8,c,a)}var d=c.child;if(d!==null)d.return=c,D=d;else for(;D!==null;){c=D;var f=c.sibling,h=c.return;if($w(c),c===u){D=null;break}if(f!==null){f.return=h,D=f;break}D=h}}}var y=a.alternate;if(y!==null){var m=y.child;if(m!==null){y.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}D=a}}if(a.subtreeFlags&2064&&i!==null)i.return=a,D=i;else e:for(;D!==null;){if(a=D,a.flags&2048)switch(a.tag){case 0:case 11:case 15:Li(9,a,a.return)}var g=a.sibling;if(g!==null){g.return=a.return,D=g;break e}D=a.return}}var p=t.current;for(D=p;D!==null;){i=D;var _=i.child;if(i.subtreeFlags&2064&&_!==null)_.return=i,D=_;else e:for(i=p;D!==null;){if(o=D,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Zu(9,o)}}catch(b){Pe(o,o.return,b)}if(o===i){D=null;break e}var w=o.sibling;if(w!==null){w.return=o.return,D=w;break e}D=o.return}}if(oe=s,Fr(),Nn&&typeof Nn.onPostCommitFiberRoot=="function")try{Nn.onPostCommitFiberRoot(Du,t)}catch{}r=!0}return r}finally{de=n,Wt.transition=e}}return!1}function Ig(t,e,n){e=ua(n,e),e=Sw(t,e,1),t=kr(t,e,1),e=ut(),t!==null&&(wo(t,1,e),Et(t,e))}function Pe(t,e,n){if(t.tag===3)Ig(t,t,n);else for(;e!==null;){if(e.tag===3){Ig(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xr===null||!xr.has(r))){t=ua(n,t),t=Pw(e,t,1),e=kr(e,t,1),t=ut(),e!==null&&(wo(e,1,t),Et(e,t));break}}e=e.return}}function zP(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=ut(),t.pingedLanes|=t.suspendedLanes&n,Fe===t&&(Ze&n)===n&&($e===4||$e===3&&(Ze&130023424)===Ze&&500>Ae()-up?es(t,0):lp|=n),Et(t,e)}function Hw(t,e){e===0&&(t.mode&1?(e=qo,qo<<=1,!(qo&130023424)&&(qo=4194304)):e=1);var n=ut();t=Qn(t,e),t!==null&&(wo(t,e,n),Et(t,n))}function BP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Hw(t,n)}function VP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(C(314))}r!==null&&r.delete(e),Hw(t,n)}var Zw;Zw=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||wt.current)vt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return vt=!1,TP(t,e,n);vt=!!(t.flags&131072)}else vt=!1,_e&&e.flags&1048576&&Kv(e,nu,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Rl(t,e),t=e.pendingProps;var s=aa(e,st.current);Xs(e,n),s=np(null,e,r,t,s,n);var a=rp();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,bt(r)?(a=!0,eu(e)):a=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Qh(e),s.updater=Hu,e.stateNode=s,s._reactInternals=e,Nf(e,r,t,n),e=Lf(null,e,r,!0,a,n)):(e.tag=0,_e&&a&&Hh(e),lt(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Rl(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=ZP(r),t=ln(r,t),s){case 0:e=jf(null,e,r,t,n);break e;case 1:e=Eg(null,e,r,t,n);break e;case 11:e=wg(null,e,r,t,n);break e;case 14:e=bg(null,e,r,ln(r.type,t),n);break e}throw Error(C(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ln(r,s),jf(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ln(r,s),Eg(t,e,r,s,n);case 3:e:{if(Ow(e),t===null)throw Error(C(387));r=e.pendingProps,a=e.memoizedState,s=a.element,tw(t,e),au(e,r,null,n);var i=e.memoizedState;if(r=i.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){s=ua(Error(C(423)),e),e=Sg(t,e,r,n,s);break e}else if(r!==s){s=ua(Error(C(424)),e),e=Sg(t,e,r,n,s);break e}else for($t=Pr(e.stateNode.containerInfo.firstChild),Lt=e,_e=!0,dn=null,n=Yv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ia(),r===s){e=Xn(t,e,n);break e}lt(t,e,r,n)}e=e.child}return e;case 5:return nw(e),t===null&&Tf(e),r=e.type,s=e.pendingProps,a=t!==null?t.memoizedProps:null,i=s.children,kf(r,s)?i=null:a!==null&&kf(r,a)&&(e.flags|=32),Aw(t,e),lt(t,e,i,n),e.child;case 6:return t===null&&Tf(e),null;case 13:return Cw(t,e,n);case 4:return Xh(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=oa(e,null,r,n):lt(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ln(r,s),wg(t,e,r,s,n);case 7:return lt(t,e,e.pendingProps,n),e.child;case 8:return lt(t,e,e.pendingProps.children,n),e.child;case 12:return lt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,a=e.memoizedProps,i=s.value,he(ru,r._currentValue),r._currentValue=i,a!==null)if(gn(a.value,i)){if(a.children===s.children&&!wt.current){e=Xn(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var o=a.dependencies;if(o!==null){i=a.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(a.tag===1){l=Gn(-1,n&-n),l.tag=2;var u=a.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),Rf(a.return,n,e),o.lanes|=n;break}l=l.next}}else if(a.tag===10)i=a.type===e.type?null:a.child;else if(a.tag===18){if(i=a.return,i===null)throw Error(C(341));i.lanes|=n,o=i.alternate,o!==null&&(o.lanes|=n),Rf(i,n,e),i=a.sibling}else i=a.child;if(i!==null)i.return=a;else for(i=a;i!==null;){if(i===e){i=null;break}if(a=i.sibling,a!==null){a.return=i.return,i=a;break}i=i.return}a=i}lt(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Xs(e,n),s=Qt(s),r=r(s),e.flags|=1,lt(t,e,r,n),e.child;case 14:return r=e.type,s=ln(r,e.pendingProps),s=ln(r.type,s),bg(t,e,r,s,n);case 15:return kw(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:ln(r,s),Rl(t,e),e.tag=1,bt(r)?(t=!0,eu(e)):t=!1,Xs(e,n),Ew(e,r,s),Nf(e,r,s,n),Lf(null,e,r,!0,t,n);case 19:return Tw(t,e,n);case 22:return xw(t,e,n)}throw Error(C(156,e.tag))};function qw(t,e){return vv(t,e)}function HP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qt(t,e,n,r){return new HP(t,e,n,r)}function hp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function ZP(t){if(typeof t=="function")return hp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ih)return 11;if(t===Nh)return 14}return 2}function Or(t,e){var n=t.alternate;return n===null?(n=qt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function $l(t,e,n,r,s,a){var i=2;if(r=t,typeof t=="function")hp(t)&&(i=1);else if(typeof t=="string")i=5;else e:switch(t){case Is:return ts(n.children,s,a,e);case Rh:i=8,s|=8;break;case nf:return t=qt(12,n,e,s|2),t.elementType=nf,t.lanes=a,t;case rf:return t=qt(13,n,e,s),t.elementType=rf,t.lanes=a,t;case sf:return t=qt(19,n,e,s),t.elementType=sf,t.lanes=a,t;case nv:return Gu(n,s,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ev:i=10;break e;case tv:i=9;break e;case Ih:i=11;break e;case Nh:i=14;break e;case hr:i=16,r=null;break e}throw Error(C(130,t==null?t:typeof t,""))}return e=qt(i,n,e,s),e.elementType=t,e.type=r,e.lanes=a,e}function ts(t,e,n,r){return t=qt(7,t,r,e),t.lanes=n,t}function Gu(t,e,n,r){return t=qt(22,t,r,e),t.elementType=nv,t.lanes=n,t.stateNode={isHidden:!1},t}function pd(t,e,n){return t=qt(6,t,null,e),t.lanes=n,t}function md(t,e,n){return e=qt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function qP(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Kc(0),this.expirationTimes=Kc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kc(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function pp(t,e,n,r,s,a,i,o,l){return t=new qP(t,e,n,o,l),e===1?(e=1,a===!0&&(e|=8)):e=0,a=qt(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Qh(a),t}function GP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rs,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Gw(t){if(!t)return Nr;t=t._reactInternals;e:{if(gs(t)!==t||t.tag!==1)throw Error(C(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(bt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(C(171))}if(t.tag===1){var n=t.type;if(bt(n))return Gv(t,n,e)}return e}function Ww(t,e,n,r,s,a,i,o,l){return t=pp(n,r,!0,t,s,a,i,o,l),t.context=Gw(null),n=t.current,r=ut(),s=Ar(n),a=Gn(r,s),a.callback=e??null,kr(n,a,s),t.current.lanes=s,wo(t,s,r),Et(t,r),t}function Wu(t,e,n,r){var s=e.current,a=ut(),i=Ar(s);return n=Gw(n),e.context===null?e.context=n:e.pendingContext=n,e=Gn(a,i),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=kr(s,e,i),t!==null&&(mn(t,s,i,a),Ol(t,s,i)),i}function hu(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ng(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function mp(t,e){Ng(t,e),(t=t.alternate)&&Ng(t,e)}function WP(){return null}var Kw=typeof reportError=="function"?reportError:function(t){console.error(t)};function gp(t){this._internalRoot=t}Ku.prototype.render=gp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(C(409));Wu(t,e,null,null)};Ku.prototype.unmount=gp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;us(function(){Wu(null,t,null,null)}),e[Jn]=null}};function Ku(t){this._internalRoot=t}Ku.prototype.unstable_scheduleHydration=function(t){if(t){var e=xv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<yr.length&&e!==0&&e<yr[n].priority;n++);yr.splice(n,0,t),n===0&&Ov(t)}};function yp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ju(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $g(){}function KP(t,e,n,r,s){if(s){if(typeof r=="function"){var a=r;r=function(){var u=hu(i);a.call(u)}}var i=Ww(e,r,t,0,null,!1,!1,"",$g);return t._reactRootContainer=i,t[Jn]=i.current,Qi(t.nodeType===8?t.parentNode:t),us(),i}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var u=hu(l);o.call(u)}}var l=pp(t,0,!1,null,null,!1,!1,"",$g);return t._reactRootContainer=l,t[Jn]=l.current,Qi(t.nodeType===8?t.parentNode:t),us(function(){Wu(e,l,n,r)}),l}function Qu(t,e,n,r,s){var a=n._reactRootContainer;if(a){var i=a;if(typeof s=="function"){var o=s;s=function(){var l=hu(i);o.call(l)}}Wu(e,i,t,s)}else i=KP(n,e,t,s,r);return hu(i)}Pv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=_i(e.pendingLanes);n!==0&&(Lh(e,n|1),Et(e,Ae()),!(oe&6)&&(ca=Ae()+500,Fr()))}break;case 13:us(function(){var r=Qn(t,1);if(r!==null){var s=ut();mn(r,t,1,s)}}),mp(t,1)}};Dh=function(t){if(t.tag===13){var e=Qn(t,134217728);if(e!==null){var n=ut();mn(e,t,134217728,n)}mp(t,134217728)}};kv=function(t){if(t.tag===13){var e=Ar(t),n=Qn(t,e);if(n!==null){var r=ut();mn(n,t,e,r)}mp(t,e)}};xv=function(){return de};Av=function(t,e){var n=de;try{return de=t,e()}finally{de=n}};mf=function(t,e,n){switch(e){case"input":if(lf(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=zu(r);if(!s)throw Error(C(90));sv(r),lf(r,s)}}}break;case"textarea":iv(t,n);break;case"select":e=n.value,e!=null&&Ws(t,!!n.multiple,e,!1)}};hv=cp;pv=us;var JP={usingClientEntryPoint:!1,Events:[Eo,Ls,zu,dv,fv,cp]},Ka={findFiberByHostInstance:Gr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},QP={bundleType:Ka.bundleType,version:Ka.version,rendererPackageName:Ka.rendererPackageName,rendererConfig:Ka.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:sr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=yv(t),t===null?null:t.stateNode},findFiberByHostInstance:Ka.findFiberByHostInstance||WP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{Du=rl.inject(QP),Nn=rl}catch{}}zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=JP;zt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yp(e))throw Error(C(200));return GP(t,e,null,n)};zt.createRoot=function(t,e){if(!yp(t))throw Error(C(299));var n=!1,r="",s=Kw;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=pp(t,1,!1,null,null,n,!1,r,s),t[Jn]=e.current,Qi(t.nodeType===8?t.parentNode:t),new gp(e)};zt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(C(188)):(t=Object.keys(t).join(","),Error(C(268,t)));return t=yv(e),t=t===null?null:t.stateNode,t};zt.flushSync=function(t){return us(t)};zt.hydrate=function(t,e,n){if(!Ju(e))throw Error(C(200));return Qu(null,t,e,!0,n)};zt.hydrateRoot=function(t,e,n){if(!yp(t))throw Error(C(405));var r=n!=null&&n.hydratedSources||null,s=!1,a="",i=Kw;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),e=Ww(e,null,t,1,n??null,s,!1,a,i),t[Jn]=e.current,Qi(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Ku(e)};zt.render=function(t,e,n){if(!Ju(e))throw Error(C(200));return Qu(null,t,e,!1,n)};zt.unmountComponentAtNode=function(t){if(!Ju(t))throw Error(C(40));return t._reactRootContainer?(us(function(){Qu(null,null,t,!1,function(){t._reactRootContainer=null,t[Jn]=null})}),!0):!1};zt.unstable_batchedUpdates=cp;zt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Ju(n))throw Error(C(200));if(t==null||t._reactInternals===void 0)throw Error(C(38));return Qu(t,e,n,!1,r)};zt.version="18.3.1-next-f1338f8080-20240426";function Jw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Jw)}catch(t){console.error(t)}}Jw(),J_.exports=zt;var XP=J_.exports,jg=XP;ef.createRoot=jg.createRoot,ef.hydrateRoot=jg.hydrateRoot;var ae;(function(t){t.assertEqual=s=>s;function e(s){}t.assertIs=e;function n(s){throw new Error}t.assertNever=n,t.arrayToEnum=s=>{const a={};for(const i of s)a[i]=i;return a},t.getValidEnumValues=s=>{const a=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(const o of a)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(a){return s[a]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const a=[];for(const i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},t.find=(s,a)=>{for(const i of s)if(a(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(ae||(ae={}));var pu;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(pu||(pu={}));const L=ae.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Cn=t=>{switch(typeof t){case"undefined":return L.undefined;case"string":return L.string;case"number":return isNaN(t)?L.nan:L.number;case"boolean":return L.boolean;case"function":return L.function;case"bigint":return L.bigint;case"symbol":return L.symbol;case"object":return Array.isArray(t)?L.array:t===null?L.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?L.promise:typeof Map<"u"&&t instanceof Map?L.map:typeof Set<"u"&&t instanceof Set?L.set:typeof Date<"u"&&t instanceof Date?L.date:L.object;default:return L.unknown}},O=ae.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Qw=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class St extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},r={_errors:[]},s=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(n(i));else{let o=r,l=0;for(;l<i.path.length;){const u=i.path[l];l===i.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(n(i))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),r}static assert(e){if(!(e instanceof St))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ae.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}St.create=t=>new St(t);const cs=(t,e)=>{let n;switch(t.code){case O.invalid_type:t.received===L.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,ae.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:n=`Unrecognized key(s) in object: ${ae.joinValues(t.keys,", ")}`;break;case O.invalid_union:n="Invalid input";break;case O.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${ae.joinValues(t.options)}`;break;case O.invalid_enum_value:n=`Invalid enum value. Expected ${ae.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:n="Invalid function arguments";break;case O.invalid_return_type:n="Invalid function return type";break;case O.invalid_date:n="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:ae.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case O.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case O.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case O.custom:n="Invalid input";break;case O.invalid_intersection_types:n="Intersection results could not be merged";break;case O.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:n="Number must be finite";break;default:n=e.defaultError,ae.assertNever(t)}return{message:n}};let Xw=cs;function Yw(t){Xw=t}function io(){return Xw}const oo=t=>{const{data:e,path:n,errorMaps:r,issueData:s}=t,a=[...n,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="";const l=r.filter(u=>!!u).slice().reverse();for(const u of l)o=u(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},e0=[];function $(t,e){const n=io(),r=oo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===cs?void 0:cs].filter(s=>!!s)});t.common.issues.push(r)}class Ge{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const s of n){if(s.status==="aborted")return G;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const s of n){const a=await s.key,i=await s.value;r.push({key:a,value:i})}return Ge.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const s of n){const{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return G;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:e.value,value:r}}}const G=Object.freeze({status:"aborted"}),Jr=t=>({status:"dirty",value:t}),at=t=>({status:"valid",value:t}),mu=t=>t.status==="aborted",gu=t=>t.status==="dirty",$r=t=>t.status==="valid",da=t=>typeof Promise<"u"&&t instanceof Promise;function yu(t,e,n,r){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function t0(t,e,n,r,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}var U;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(U||(U={}));var wi,bi;class jn{constructor(e,n,r,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Lg=(t,e)=>{if($r(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new St(t.common.issues);return this._error=n,this._error}}};function X(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:s}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{var l,u;const{message:c}=t;return i.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}},description:s}}class J{get description(){return this._def.description}_getType(e){return Cn(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Cn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ge,ctx:{common:e.parent.common,data:e.data,parsedType:Cn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(da(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){var r;const s={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cn(e)},a=this._parseSync({data:e,path:s.path,parent:s});return Lg(s,a)}"~validate"(e){var n,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cn(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:s});return $r(a)?{value:a.value}:{issues:s.common.issues}}catch(a){!((r=(n=a==null?void 0:a.message)===null||n===void 0?void 0:n.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(a=>$r(a)?{value:a.value}:{issues:s.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Cn(e)},s=this._parse({data:e,path:r.path,parent:r}),a=await(da(s)?s:Promise.resolve(s));return Lg(r,a)}refine(e,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,a)=>{const i=e(s),o=()=>a.addIssue({code:O.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(e){return new Ft({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Jt.create(this,this._def)}nullable(){return nr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Kt.create(this)}promise(){return fs.create(this,this._def)}or(e){return ma.create([this,e],this._def)}and(e){return ga.create(this,e,this._def)}transform(e){return new Ft({...X(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new ba({...X(this._def),innerType:this,defaultValue:n,typeName:T.ZodDefault})}brand(){return new Xu({typeName:T.ZodBranded,type:this,...X(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new Ea({...X(this._def),innerType:this,catchValue:n,typeName:T.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Sa.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const YP=/^c[^\s-]{8,}$/i,ek=/^[0-9a-z]+$/,tk=/^[0-9A-HJKMNP-TV-Z]{26}$/i,nk=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,rk=/^[a-z0-9_-]{21}$/i,sk=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ak=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ik=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ok="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let gd;const lk=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,uk=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ck=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,dk=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,fk=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,hk=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,n0="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",pk=new RegExp(`^${n0}$`);function r0(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function mk(t){return new RegExp(`^${r0(t)}$`)}function _p(t){let e=`${n0}T${r0(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function gk(t,e){return!!((e==="v4"||!e)&&lk.test(t)||(e==="v6"||!e)&&ck.test(t))}function yk(t,e){if(!sk.test(t))return!1;try{const[n]=t.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function _k(t,e){return!!((e==="v4"||!e)&&uk.test(t)||(e==="v6"||!e)&&dk.test(t))}class Gt extends J{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==L.string){const a=this._getOrReturnCtx(e);return $(a,{code:O.invalid_type,expected:L.string,received:a.parsedType}),G}const r=new Ge;let s;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:O.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:O.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?$(s,{code:O.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&$(s,{code:O.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")ik.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"email",code:O.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")gd||(gd=new RegExp(ok,"u")),gd.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"emoji",code:O.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")nk.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"uuid",code:O.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")rk.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"nanoid",code:O.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")YP.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cuid",code:O.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")ek.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cuid2",code:O.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")tk.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"ulid",code:O.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),$(s,{validation:"url",code:O.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"regex",code:O.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),$(s,{code:O.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),$(s,{code:O.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),$(s,{code:O.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?_p(a).test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:O.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?pk.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:O.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?mk(a).test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{code:O.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?ak.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"duration",code:O.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?gk(e.data,a.version)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"ip",code:O.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?yk(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"jwt",code:O.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?_k(e.data,a.version)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"cidr",code:O.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?fk.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"base64",code:O.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?hk.test(e.data)||(s=this._getOrReturnCtx(e,s),$(s,{validation:"base64url",code:O.invalid_string,message:a.message}),r.dirty()):ae.assertNever(a);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(s=>e.test(s),{validation:n,code:O.invalid_string,...U.errToObj(r)})}_addCheck(e){return new Gt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...U.errToObj(e)})}url(e){return this._addCheck({kind:"url",...U.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...U.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...U.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...U.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...U.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...U.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...U.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...U.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...U.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...U.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...U.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...U.errToObj(e)})}datetime(e){var n,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...U.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...U.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...U.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...U.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...U.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...U.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...U.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...U.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...U.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...U.errToObj(n)})}nonempty(e){return this.min(1,U.errToObj(e))}trim(){return new Gt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Gt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Gt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Gt.create=t=>{var e;return new Gt({checks:[],typeName:T.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...X(t)})};function vk(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=n>r?n:r,a=parseInt(t.toFixed(s).replace(".","")),i=parseInt(e.toFixed(s).replace(".",""));return a%i/Math.pow(10,s)}class Yn extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==L.number){const a=this._getOrReturnCtx(e);return $(a,{code:O.invalid_type,expected:L.number,received:a.parsedType}),G}let r;const s=new Ge;for(const a of this._def.checks)a.kind==="int"?ae.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),$(r,{code:O.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:O.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:O.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?vk(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),$(r,{code:O.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),$(r,{code:O.not_finite,message:a.message}),s.dirty()):ae.assertNever(a);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,U.toString(n))}gt(e,n){return this.setLimit("min",e,!1,U.toString(n))}lte(e,n){return this.setLimit("max",e,!0,U.toString(n))}lt(e,n){return this.setLimit("max",e,!1,U.toString(n))}setLimit(e,n,r,s){return new Yn({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:U.toString(s)}]})}_addCheck(e){return new Yn({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:U.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:U.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:U.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:U.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:U.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ae.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Yn.create=t=>new Yn({checks:[],typeName:T.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...X(t)});class er extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==L.bigint)return this._getInvalidInput(e);let r;const s=new Ge;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:O.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),$(r,{code:O.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),$(r,{code:O.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):ae.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return $(n,{code:O.invalid_type,expected:L.bigint,received:n.parsedType}),G}gte(e,n){return this.setLimit("min",e,!0,U.toString(n))}gt(e,n){return this.setLimit("min",e,!1,U.toString(n))}lte(e,n){return this.setLimit("max",e,!0,U.toString(n))}lt(e,n){return this.setLimit("max",e,!1,U.toString(n))}setLimit(e,n,r,s){return new er({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:U.toString(s)}]})}_addCheck(e){return new er({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:U.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:U.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:U.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:U.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:U.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}er.create=t=>{var e;return new er({checks:[],typeName:T.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...X(t)})};class fa extends J{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==L.boolean){const r=this._getOrReturnCtx(e);return $(r,{code:O.invalid_type,expected:L.boolean,received:r.parsedType}),G}return at(e.data)}}fa.create=t=>new fa({typeName:T.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...X(t)});class jr extends J{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==L.date){const a=this._getOrReturnCtx(e);return $(a,{code:O.invalid_type,expected:L.date,received:a.parsedType}),G}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return $(a,{code:O.invalid_date}),G}const r=new Ge;let s;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:O.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),$(s,{code:O.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):ae.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new jr({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:U.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:U.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}jr.create=t=>new jr({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:T.ZodDate,...X(t)});class lo extends J{_parse(e){if(this._getType(e)!==L.symbol){const r=this._getOrReturnCtx(e);return $(r,{code:O.invalid_type,expected:L.symbol,received:r.parsedType}),G}return at(e.data)}}lo.create=t=>new lo({typeName:T.ZodSymbol,...X(t)});class ha extends J{_parse(e){if(this._getType(e)!==L.undefined){const r=this._getOrReturnCtx(e);return $(r,{code:O.invalid_type,expected:L.undefined,received:r.parsedType}),G}return at(e.data)}}ha.create=t=>new ha({typeName:T.ZodUndefined,...X(t)});class pa extends J{_parse(e){if(this._getType(e)!==L.null){const r=this._getOrReturnCtx(e);return $(r,{code:O.invalid_type,expected:L.null,received:r.parsedType}),G}return at(e.data)}}pa.create=t=>new pa({typeName:T.ZodNull,...X(t)});class ds extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return at(e.data)}}ds.create=t=>new ds({typeName:T.ZodAny,...X(t)});class Cr extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return at(e.data)}}Cr.create=t=>new Cr({typeName:T.ZodUnknown,...X(t)});class Ln extends J{_parse(e){const n=this._getOrReturnCtx(e);return $(n,{code:O.invalid_type,expected:L.never,received:n.parsedType}),G}}Ln.create=t=>new Ln({typeName:T.ZodNever,...X(t)});class uo extends J{_parse(e){if(this._getType(e)!==L.undefined){const r=this._getOrReturnCtx(e);return $(r,{code:O.invalid_type,expected:L.void,received:r.parsedType}),G}return at(e.data)}}uo.create=t=>new uo({typeName:T.ZodVoid,...X(t)});class Kt extends J{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),s=this._def;if(n.parsedType!==L.array)return $(n,{code:O.invalid_type,expected:L.array,received:n.parsedType}),G;if(s.exactLength!==null){const i=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(i||o)&&($(n,{code:i?O.too_big:O.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&($(n,{code:O.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&($(n,{code:O.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((i,o)=>s.type._parseAsync(new jn(n,i,n.path,o)))).then(i=>Ge.mergeArray(r,i));const a=[...n.data].map((i,o)=>s.type._parseSync(new jn(n,i,n.path,o)));return Ge.mergeArray(r,a)}get element(){return this._def.type}min(e,n){return new Kt({...this._def,minLength:{value:e,message:U.toString(n)}})}max(e,n){return new Kt({...this._def,maxLength:{value:e,message:U.toString(n)}})}length(e,n){return new Kt({...this._def,exactLength:{value:e,message:U.toString(n)}})}nonempty(e){return this.min(1,e)}}Kt.create=(t,e)=>new Kt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...X(e)});function ks(t){if(t instanceof ye){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=Jt.create(ks(r))}return new ye({...t._def,shape:()=>e})}else return t instanceof Kt?new Kt({...t._def,type:ks(t.element)}):t instanceof Jt?Jt.create(ks(t.unwrap())):t instanceof nr?nr.create(ks(t.unwrap())):t instanceof yn?yn.create(t.items.map(e=>ks(e))):t}class ye extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=ae.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==L.object){const u=this._getOrReturnCtx(e);return $(u,{code:O.invalid_type,expected:L.object,received:u.parsedType}),G}const{status:r,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ln&&this._def.unknownKeys==="strip"))for(const u in s.data)i.includes(u)||o.push(u);const l=[];for(const u of i){const c=a[u],d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new jn(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Ln){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&($(s,{code:O.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new jn(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,f=await c.value;u.push({key:d,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>Ge.mergeObjectSync(r,u)):Ge.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return U.errToObj,new ye({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var s,a,i,o;const l=(i=(a=(s=this._def).errorMap)===null||a===void 0?void 0:a.call(s,n,r).message)!==null&&i!==void 0?i:r.defaultError;return n.code==="unrecognized_keys"?{message:(o=U.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new ye({...this._def,unknownKeys:"strip"})}passthrough(){return new ye({...this._def,unknownKeys:"passthrough"})}extend(e){return new ye({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ye({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new ye({...this._def,catchall:e})}pick(e){const n={};return ae.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new ye({...this._def,shape:()=>n})}omit(e){const n={};return ae.objectKeys(this.shape).forEach(r=>{e[r]||(n[r]=this.shape[r])}),new ye({...this._def,shape:()=>n})}deepPartial(){return ks(this)}partial(e){const n={};return ae.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?n[r]=s:n[r]=s.optional()}),new ye({...this._def,shape:()=>n})}required(e){const n={};return ae.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])n[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof Jt;)a=a._def.innerType;n[r]=a}}),new ye({...this._def,shape:()=>n})}keyof(){return s0(ae.objectKeys(this.shape))}}ye.create=(t,e)=>new ye({shape:()=>t,unknownKeys:"strip",catchall:Ln.create(),typeName:T.ZodObject,...X(e)});ye.strictCreate=(t,e)=>new ye({shape:()=>t,unknownKeys:"strict",catchall:Ln.create(),typeName:T.ZodObject,...X(e)});ye.lazycreate=(t,e)=>new ye({shape:t,unknownKeys:"strip",catchall:Ln.create(),typeName:T.ZodObject,...X(e)});class ma extends J{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function s(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const i=a.map(o=>new St(o.ctx.common.issues));return $(n,{code:O.invalid_union,unionErrors:i}),G}if(n.common.async)return Promise.all(r.map(async a=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(s);{let a;const i=[];for(const l of r){const u={...n,common:{...n.common,issues:[]},parent:null},c=l._parseSync({data:n.data,path:n.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(l=>new St(l));return $(n,{code:O.invalid_union,unionErrors:o}),G}}get options(){return this._def.options}}ma.create=(t,e)=>new ma({options:t,typeName:T.ZodUnion,...X(e)});const Un=t=>t instanceof _a?Un(t.schema):t instanceof Ft?Un(t.innerType()):t instanceof va?[t.value]:t instanceof tr?t.options:t instanceof wa?ae.objectValues(t.enum):t instanceof ba?Un(t._def.innerType):t instanceof ha?[void 0]:t instanceof pa?[null]:t instanceof Jt?[void 0,...Un(t.unwrap())]:t instanceof nr?[null,...Un(t.unwrap())]:t instanceof Xu||t instanceof Sa?Un(t.unwrap()):t instanceof Ea?Un(t._def.innerType):[];class Po extends J{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.object)return $(n,{code:O.invalid_type,expected:L.object,received:n.parsedType}),G;const r=this.discriminator,s=n.data[r],a=this.optionsMap.get(s);return a?n.common.async?a._parseAsync({data:n.data,path:n.path,parent:n}):a._parseSync({data:n.data,path:n.path,parent:n}):($(n,{code:O.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),G)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){const s=new Map;for(const a of n){const i=Un(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new Po({typeName:T.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:s,...X(r)})}}function Wf(t,e){const n=Cn(t),r=Cn(e);if(t===e)return{valid:!0,data:t};if(n===L.object&&r===L.object){const s=ae.objectKeys(e),a=ae.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(const o of a){const l=Wf(t[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(n===L.array&&r===L.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let a=0;a<t.length;a++){const i=t[a],o=e[a],l=Wf(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return n===L.date&&r===L.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class ga extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=(a,i)=>{if(mu(a)||mu(i))return G;const o=Wf(a.value,i.value);return o.valid?((gu(a)||gu(i))&&n.dirty(),{status:n.value,value:o.data}):($(r,{code:O.invalid_intersection_types}),G)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ga.create=(t,e,n)=>new ga({left:t,right:e,typeName:T.ZodIntersection,...X(n)});class yn extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.array)return $(r,{code:O.invalid_type,expected:L.array,received:r.parsedType}),G;if(r.data.length<this._def.items.length)return $(r,{code:O.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),G;!this._def.rest&&r.data.length>this._def.items.length&&($(r,{code:O.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...r.data].map((i,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new jn(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>Ge.mergeArray(n,i)):Ge.mergeArray(n,a)}get items(){return this._def.items}rest(e){return new yn({...this._def,rest:e})}}yn.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new yn({items:t,typeName:T.ZodTuple,rest:null,...X(e)})};class ya extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.object)return $(r,{code:O.invalid_type,expected:L.object,received:r.parsedType}),G;const s=[],a=this._def.keyType,i=this._def.valueType;for(const o in r.data)s.push({key:a._parse(new jn(r,o,r.path,o)),value:i._parse(new jn(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Ge.mergeObjectAsync(n,s):Ge.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof J?new ya({keyType:e,valueType:n,typeName:T.ZodRecord,...X(r)}):new ya({keyType:Gt.create(),valueType:e,typeName:T.ZodRecord,...X(n)})}}class co extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.map)return $(r,{code:O.invalid_type,expected:L.map,received:r.parsedType}),G;const s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,l],u)=>({key:s._parse(new jn(r,o,r.path,[u,"key"])),value:a._parse(new jn(r,l,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of i){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return G;(u.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(u.value,c.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const l of i){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return G;(u.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(u.value,c.value)}return{status:n.value,value:o}}}}co.create=(t,e,n)=>new co({valueType:e,keyType:t,typeName:T.ZodMap,...X(n)});class Lr extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.set)return $(r,{code:O.invalid_type,expected:L.set,received:r.parsedType}),G;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&($(r,{code:O.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&($(r,{code:O.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const a=this._def.valueType;function i(l){const u=new Set;for(const c of l){if(c.status==="aborted")return G;c.status==="dirty"&&n.dirty(),u.add(c.value)}return{status:n.value,value:u}}const o=[...r.data.values()].map((l,u)=>a._parse(new jn(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,n){return new Lr({...this._def,minSize:{value:e,message:U.toString(n)}})}max(e,n){return new Lr({...this._def,maxSize:{value:e,message:U.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Lr.create=(t,e)=>new Lr({valueType:t,minSize:null,maxSize:null,typeName:T.ZodSet,...X(e)});class ns extends J{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.function)return $(n,{code:O.invalid_type,expected:L.function,received:n.parsedType}),G;function r(o,l){return oo({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,io(),cs].filter(u=>!!u),issueData:{code:O.invalid_arguments,argumentsError:l}})}function s(o,l){return oo({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,io(),cs].filter(u=>!!u),issueData:{code:O.invalid_return_type,returnTypeError:l}})}const a={errorMap:n.common.contextualErrorMap},i=n.data;if(this._def.returns instanceof fs){const o=this;return at(async function(...l){const u=new St([]),c=await o._def.args.parseAsync(l,a).catch(h=>{throw u.addIssue(r(l,h)),u}),d=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(d,a).catch(h=>{throw u.addIssue(s(d,h)),u})})}else{const o=this;return at(function(...l){const u=o._def.args.safeParse(l,a);if(!u.success)throw new St([r(l,u.error)]);const c=Reflect.apply(i,this,u.data),d=o._def.returns.safeParse(c,a);if(!d.success)throw new St([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ns({...this._def,args:yn.create(e).rest(Cr.create())})}returns(e){return new ns({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new ns({args:e||yn.create([]).rest(Cr.create()),returns:n||Cr.create(),typeName:T.ZodFunction,...X(r)})}}class _a extends J{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}_a.create=(t,e)=>new _a({getter:t,typeName:T.ZodLazy,...X(e)});class va extends J{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return $(n,{received:n.data,code:O.invalid_literal,expected:this._def.value}),G}return{status:"valid",value:e.data}}get value(){return this._def.value}}va.create=(t,e)=>new va({value:t,typeName:T.ZodLiteral,...X(e)});function s0(t,e){return new tr({values:t,typeName:T.ZodEnum,...X(e)})}class tr extends J{constructor(){super(...arguments),wi.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return $(n,{expected:ae.joinValues(r),received:n.parsedType,code:O.invalid_type}),G}if(yu(this,wi)||t0(this,wi,new Set(this._def.values)),!yu(this,wi).has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return $(n,{received:n.data,code:O.invalid_enum_value,options:r}),G}return at(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return tr.create(e,{...this._def,...n})}exclude(e,n=this._def){return tr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}wi=new WeakMap;tr.create=s0;class wa extends J{constructor(){super(...arguments),bi.set(this,void 0)}_parse(e){const n=ae.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==L.string&&r.parsedType!==L.number){const s=ae.objectValues(n);return $(r,{expected:ae.joinValues(s),received:r.parsedType,code:O.invalid_type}),G}if(yu(this,bi)||t0(this,bi,new Set(ae.getValidEnumValues(this._def.values))),!yu(this,bi).has(e.data)){const s=ae.objectValues(n);return $(r,{received:r.data,code:O.invalid_enum_value,options:s}),G}return at(e.data)}get enum(){return this._def.values}}bi=new WeakMap;wa.create=(t,e)=>new wa({values:t,typeName:T.ZodNativeEnum,...X(e)});class fs extends J{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.promise&&n.common.async===!1)return $(n,{code:O.invalid_type,expected:L.promise,received:n.parsedType}),G;const r=n.parsedType===L.promise?n.data:Promise.resolve(n.data);return at(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}fs.create=(t,e)=>new fs({type:t,typeName:T.ZodPromise,...X(e)});class Ft extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{$(r,i),i.fatal?n.abort():n.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){const i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(n.value==="aborted")return G;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?G:l.status==="dirty"||n.value==="dirty"?Jr(l.value):l});{if(n.value==="aborted")return G;const o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?G:o.status==="dirty"||n.value==="dirty"?Jr(o.value):o}}if(s.type==="refinement"){const i=o=>{const l=s.refinement(o,a);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?G:(o.status==="dirty"&&n.dirty(),i(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?G:(o.status==="dirty"&&n.dirty(),i(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!$r(i))return i;const o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>$r(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:n.value,value:o})):i);ae.assertNever(s)}}Ft.create=(t,e,n)=>new Ft({schema:t,typeName:T.ZodEffects,effect:e,...X(n)});Ft.createWithPreprocess=(t,e,n)=>new Ft({schema:e,effect:{type:"preprocess",transform:t},typeName:T.ZodEffects,...X(n)});class Jt extends J{_parse(e){return this._getType(e)===L.undefined?at(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Jt.create=(t,e)=>new Jt({innerType:t,typeName:T.ZodOptional,...X(e)});class nr extends J{_parse(e){return this._getType(e)===L.null?at(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}nr.create=(t,e)=>new nr({innerType:t,typeName:T.ZodNullable,...X(e)});class ba extends J{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===L.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}ba.create=(t,e)=>new ba({innerType:t,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...X(e)});class Ea extends J{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return da(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new St(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new St(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Ea.create=(t,e)=>new Ea({innerType:t,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...X(e)});class fo extends J{_parse(e){if(this._getType(e)!==L.nan){const r=this._getOrReturnCtx(e);return $(r,{code:O.invalid_type,expected:L.nan,received:r.parsedType}),G}return{status:"valid",value:e.data}}}fo.create=t=>new fo({typeName:T.ZodNaN,...X(t)});const a0=Symbol("zod_brand");class Xu extends J{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class Ta extends J{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?G:a.status==="dirty"?(n.dirty(),Jr(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?G:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,n){return new Ta({in:e,out:n,typeName:T.ZodPipeline})}}class Sa extends J{_parse(e){const n=this._def.innerType._parse(e),r=s=>($r(s)&&(s.value=Object.freeze(s.value)),s);return da(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}}Sa.create=(t,e)=>new Sa({innerType:t,typeName:T.ZodReadonly,...X(e)});function Dg(t,e){const n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function vp(t,e={},n){return t?ds.create().superRefine((r,s)=>{var a,i;const o=t(r);if(o instanceof Promise)return o.then(l=>{var u,c;if(!l){const d=Dg(e,r),f=(c=(u=d.fatal)!==null&&u!==void 0?u:n)!==null&&c!==void 0?c:!0;s.addIssue({code:"custom",...d,fatal:f})}});if(!o){const l=Dg(e,r),u=(i=(a=l.fatal)!==null&&a!==void 0?a:n)!==null&&i!==void 0?i:!0;s.addIssue({code:"custom",...l,fatal:u})}}):ds.create()}const i0={object:ye.lazycreate};var T;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(T||(T={}));const o0=(t,e={message:`Input not instance of ${t.name}`})=>vp(n=>n instanceof t,e),wp=Gt.create,bp=Yn.create,l0=fo.create,u0=er.create,Ep=fa.create,c0=jr.create,d0=lo.create,f0=ha.create,h0=pa.create,p0=ds.create,m0=Cr.create,g0=Ln.create,y0=uo.create,_0=Kt.create,v0=ye.create,w0=ye.strictCreate,b0=ma.create,E0=Po.create,S0=ga.create,P0=yn.create,k0=ya.create,x0=co.create,A0=Lr.create,O0=ns.create,C0=_a.create,T0=va.create,R0=tr.create,I0=wa.create,N0=fs.create,_u=Ft.create,$0=Jt.create,j0=nr.create,L0=Ft.createWithPreprocess,D0=Ta.create,M0=()=>wp().optional(),F0=()=>bp().optional(),U0=()=>Ep().optional(),z0={string:t=>Gt.create({...t,coerce:!0}),number:t=>Yn.create({...t,coerce:!0}),boolean:t=>fa.create({...t,coerce:!0}),bigint:t=>er.create({...t,coerce:!0}),date:t=>jr.create({...t,coerce:!0})},B0=G;var le=Object.freeze({__proto__:null,defaultErrorMap:cs,setErrorMap:Yw,getErrorMap:io,makeIssue:oo,EMPTY_PATH:e0,addIssueToContext:$,ParseStatus:Ge,INVALID:G,DIRTY:Jr,OK:at,isAborted:mu,isDirty:gu,isValid:$r,isAsync:da,get util(){return ae},get objectUtil(){return pu},ZodParsedType:L,getParsedType:Cn,ZodType:J,datetimeRegex:_p,ZodString:Gt,ZodNumber:Yn,ZodBigInt:er,ZodBoolean:fa,ZodDate:jr,ZodSymbol:lo,ZodUndefined:ha,ZodNull:pa,ZodAny:ds,ZodUnknown:Cr,ZodNever:Ln,ZodVoid:uo,ZodArray:Kt,ZodObject:ye,ZodUnion:ma,ZodDiscriminatedUnion:Po,ZodIntersection:ga,ZodTuple:yn,ZodRecord:ya,ZodMap:co,ZodSet:Lr,ZodFunction:ns,ZodLazy:_a,ZodLiteral:va,ZodEnum:tr,ZodNativeEnum:wa,ZodPromise:fs,ZodEffects:Ft,ZodTransformer:Ft,ZodOptional:Jt,ZodNullable:nr,ZodDefault:ba,ZodCatch:Ea,ZodNaN:fo,BRAND:a0,ZodBranded:Xu,ZodPipeline:Ta,ZodReadonly:Sa,custom:vp,Schema:J,ZodSchema:J,late:i0,get ZodFirstPartyTypeKind(){return T},coerce:z0,any:p0,array:_0,bigint:u0,boolean:Ep,date:c0,discriminatedUnion:E0,effect:_u,enum:R0,function:O0,instanceof:o0,intersection:S0,lazy:C0,literal:T0,map:x0,nan:l0,nativeEnum:I0,never:g0,null:h0,nullable:j0,number:bp,object:v0,oboolean:U0,onumber:F0,optional:$0,ostring:M0,pipeline:D0,preprocess:L0,promise:N0,record:k0,set:A0,strictObject:w0,string:wp,symbol:d0,transformer:_u,tuple:P0,undefined:f0,union:b0,unknown:m0,void:y0,NEVER:B0,ZodIssueCode:O,quotelessJson:Qw,ZodError:St});const wk=Object.freeze(Object.defineProperty({__proto__:null,BRAND:a0,DIRTY:Jr,EMPTY_PATH:e0,INVALID:G,NEVER:B0,OK:at,ParseStatus:Ge,Schema:J,ZodAny:ds,ZodArray:Kt,ZodBigInt:er,ZodBoolean:fa,ZodBranded:Xu,ZodCatch:Ea,ZodDate:jr,ZodDefault:ba,ZodDiscriminatedUnion:Po,ZodEffects:Ft,ZodEnum:tr,ZodError:St,get ZodFirstPartyTypeKind(){return T},ZodFunction:ns,ZodIntersection:ga,ZodIssueCode:O,ZodLazy:_a,ZodLiteral:va,ZodMap:co,ZodNaN:fo,ZodNativeEnum:wa,ZodNever:Ln,ZodNull:pa,ZodNullable:nr,ZodNumber:Yn,ZodObject:ye,ZodOptional:Jt,ZodParsedType:L,ZodPipeline:Ta,ZodPromise:fs,ZodReadonly:Sa,ZodRecord:ya,ZodSchema:J,ZodSet:Lr,ZodString:Gt,ZodSymbol:lo,ZodTransformer:Ft,ZodTuple:yn,ZodType:J,ZodUndefined:ha,ZodUnion:ma,ZodUnknown:Cr,ZodVoid:uo,addIssueToContext:$,any:p0,array:_0,bigint:u0,boolean:Ep,coerce:z0,custom:vp,date:c0,datetimeRegex:_p,default:le,defaultErrorMap:cs,discriminatedUnion:E0,effect:_u,enum:R0,function:O0,getErrorMap:io,getParsedType:Cn,instanceof:o0,intersection:S0,isAborted:mu,isAsync:da,isDirty:gu,isValid:$r,late:i0,lazy:C0,literal:T0,makeIssue:oo,map:x0,nan:l0,nativeEnum:I0,never:g0,null:h0,nullable:j0,number:bp,object:v0,get objectUtil(){return pu},oboolean:U0,onumber:F0,optional:$0,ostring:M0,pipeline:D0,preprocess:L0,promise:N0,quotelessJson:Qw,record:k0,set:A0,setErrorMap:Yw,strictObject:w0,string:wp,symbol:d0,transformer:_u,tuple:P0,undefined:f0,union:b0,unknown:m0,get util(){return ae},void:y0,z:le},Symbol.toStringTag,{value:"Module"})),bk=le.object({id:le.string(),name:le.string(),description:le.string().optional(),type:le.string().optional(),tags:le.array(le.string()).optional(),url:le.string().optional()}),zr=le.object({input:le.string(),taskPlan:le.string().optional(),selectedDatabases:le.array(bk).optional(),databaseSelectionText:le.string().optional(),generatedCode:le.string().optional(),errors:le.string().optional(),debugLog:le.array(le.string()).optional(),inspectionResults:le.string().optional(),response:le.string().optional()}),xs=le.object({response:le.string(),code:le.string().optional(),debugLog:le.array(le.string()).optional()}),Kf="RFC3986",Jf={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:t=>String(t)},Ek="RFC1738",Sk=Array.isArray,Sn=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),yd=1024,Pk=(t,e,n,r,s)=>{if(t.length===0)return t;let a=t;if(typeof t=="symbol"?a=Symbol.prototype.toString.call(t):typeof t!="string"&&(a=String(t)),n==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=yd){const l=a.length>=yd?a.slice(o,o+yd):a,u=[];for(let c=0;c<l.length;++c){let d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===Ek&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=Sn[d];continue}if(d<2048){u[u.length]=Sn[192|d>>6]+Sn[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=Sn[224|d>>12]+Sn[128|d>>6&63]+Sn[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=Sn[240|d>>18]+Sn[128|d>>12&63]+Sn[128|d>>6&63]+Sn[128|d&63]}i+=u.join("")}return i};function kk(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function Mg(t,e){if(Sk(t)){const n=[];for(let r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)}const xk=Object.prototype.hasOwnProperty,V0={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},An=Array.isArray,Ak=Array.prototype.push,H0=function(t,e){Ak.apply(t,An(e)?e:[e])},Ok=Date.prototype.toISOString,Ie={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Pk,encodeValuesOnly:!1,format:Kf,formatter:Jf[Kf],indices:!1,serializeDate(t){return Ok.call(t)},skipNulls:!1,strictNullHandling:!1};function Ck(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const _d={};function Z0(t,e,n,r,s,a,i,o,l,u,c,d,f,h,y,m,v,g){let p=t,_=g,w=0,b=!1;for(;(_=_.get(_d))!==void 0&&!b;){const M=_.get(t);if(w+=1,typeof M<"u"){if(M===w)throw new RangeError("Cyclic object value");b=!0}typeof _.get(_d)>"u"&&(w=0)}if(typeof u=="function"?p=u(e,p):p instanceof Date?p=f==null?void 0:f(p):n==="comma"&&An(p)&&(p=Mg(p,function(M){return M instanceof Date?f==null?void 0:f(M):M})),p===null){if(a)return l&&!m?l(e,Ie.encoder,v,"key",h):e;p=""}if(Ck(p)||kk(p)){if(l){const M=m?e:l(e,Ie.encoder,v,"key",h);return[(y==null?void 0:y(M))+"="+(y==null?void 0:y(l(p,Ie.encoder,v,"value",h)))]}return[(y==null?void 0:y(e))+"="+(y==null?void 0:y(String(p)))]}const P=[];if(typeof p>"u")return P;let k;if(n==="comma"&&An(p))m&&l&&(p=Mg(p,l)),k=[{value:p.length>0?p.join(",")||null:void 0}];else if(An(u))k=u;else{const M=Object.keys(p);k=c?M.sort(c):M}const R=o?String(e).replace(/\./g,"%2E"):String(e),Z=r&&An(p)&&p.length===1?R+"[]":R;if(s&&An(p)&&p.length===0)return Z+"[]";for(let M=0;M<k.length;++M){const K=k[M],Qe=typeof K=="object"&&typeof K.value<"u"?K.value:p[K];if(i&&Qe===null)continue;const At=d&&o?K.replace(/\./g,"%2E"):K,j=An(p)?typeof n=="function"?n(Z,At):Z:Z+(d?"."+At:"["+At+"]");g.set(t,w);const N=new WeakMap;N.set(_d,g),H0(P,Z0(Qe,j,n,r,s,a,i,o,n==="comma"&&m&&An(p)?null:l,u,c,d,f,h,y,m,v,N))}return P}function Tk(t=Ie){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||Ie.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=Kf;if(typeof t.format<"u"){if(!xk.call(Jf,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const r=Jf[n];let s=Ie.filter;(typeof t.filter=="function"||An(t.filter))&&(s=t.filter);let a;if(t.arrayFormat&&t.arrayFormat in V0?a=t.arrayFormat:"indices"in t?a=t.indices?"indices":"repeat":a=Ie.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:Ie.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:Ie.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:Ie.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Ie.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?Ie.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:Ie.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:Ie.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:Ie.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:Ie.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:Ie.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:Ie.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Ie.strictNullHandling}}function Rk(t,e={}){let n=t;const r=Tk(e);let s,a;typeof r.filter=="function"?(a=r.filter,n=a("",n)):An(r.filter)&&(a=r.filter,s=a);const i=[];if(typeof n!="object"||n===null)return"";const o=V0[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);const u=new WeakMap;for(let f=0;f<s.length;++f){const h=s[f];r.skipNulls&&n[h]===null||H0(i,Z0(n[h],h,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const c=i.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}const As="4.95.1";let Fg=!1,Fi,q0,G0,Qf,W0,K0,J0,Q0,X0;function Ik(t,e={auto:!1}){if(Fg)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(Fi)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${Fi}'\``);Fg=e.auto,Fi=t.kind,q0=t.fetch,G0=t.FormData,Qf=t.File,W0=t.ReadableStream,K0=t.getMultipartRequestOptions,J0=t.getDefaultAgent,Q0=t.fileFromPath,X0=t.isFsReadStream}class Nk{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function $k({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,s,a;try{n=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Nk(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}const Y0=()=>{Fi||Ik($k(),{auto:!0})};Y0();class q extends Error{}class We extends q{constructor(e,n,r,s){super(`${We.makeMessage(e,n,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=n;const a=n;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,n,r,s){if(!e||!s)return new Yu({message:r,cause:Yf(n)});const a=n==null?void 0:n.error;return e===400?new eb(e,a,r,s):e===401?new tb(e,a,r,s):e===403?new nb(e,a,r,s):e===404?new rb(e,a,r,s):e===409?new sb(e,a,r,s):e===422?new ab(e,a,r,s):e===429?new ib(e,a,r,s):e>=500?new ob(e,a,r,s):new We(e,a,r,s)}}class jt extends We{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Yu extends We{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class ec extends Yu{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eb extends We{}class tb extends We{}class nb extends We{}class rb extends We{}class sb extends We{}class ab extends We{}class ib extends We{}class ob extends We{}class lb extends q{constructor(){super("Could not parse response content as the length limit was reached")}}class ub extends q{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var sl=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Br=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Tt;class tc{constructor(){Tt.set(this,void 0),this.buffer=new Uint8Array,sl(this,Tt,null,"f")}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let r=new Uint8Array(this.buffer.length+n.length);r.set(this.buffer),r.set(n,this.buffer.length),this.buffer=r;const s=[];let a;for(;(a=jk(this.buffer,Br(this,Tt,"f")))!=null;){if(a.carriage&&Br(this,Tt,"f")==null){sl(this,Tt,a.index,"f");continue}if(Br(this,Tt,"f")!=null&&(a.index!==Br(this,Tt,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,Br(this,Tt,"f")-1))),this.buffer=this.buffer.slice(Br(this,Tt,"f")),sl(this,Tt,null,"f");continue}const i=Br(this,Tt,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),sl(this,Tt,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new q(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new q(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new q("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}Tt=new WeakMap;tc.NEWLINE_CHARS=new Set([`
`,"\r"]);tc.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function jk(t,e){for(let s=e??0;s<t.length;s++){if(t[s]===10)return{preceding:s,index:s+1,carriage:!1};if(t[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Lk(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}function cb(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class In{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const i of Dk(e,n))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new We(void 0,o.error,void 0,yb(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new We(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||n.abort()}}return new In(s,n)}static fromReadableStream(e,n){let r=!1;async function*s(){const i=new tc,o=cb(e);for await(const l of o)for(const u of i.decode(l))yield u;for(const l of i.flush())yield l}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||n.abort()}}return new In(a,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=r.next();e.push(i),n.push(i)}return a.shift()}});return[new In(()=>s(e),this.controller),new In(()=>s(n),this.controller)]}toReadableStream(){const e=this;let n;const r=new TextEncoder;return new W0({async start(){n=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await n.next();if(i)return s.close();const o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=n.return)==null?void 0:s.call(n))}})}}async function*Dk(t,e){if(!t.body)throw e.abort(),new q("Attempted to iterate over a response with no body");const n=new Fk,r=new tc,s=cb(t.body);for await(const a of Mk(s))for(const i of r.decode(a)){const o=n.decode(i);o&&(yield o)}for(const a of r.flush()){const i=n.decode(a);i&&(yield i)}}async function*Mk(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=Lk(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Fk{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,s]=Uk(e,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}function Uk(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}const db=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",fb=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&nc(t),nc=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",zk=t=>fb(t)||db(t)||X0(t);async function hb(t,e,n){var s;if(t=await t,fb(t))return t;if(db(t)){const a=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=nc(a)?[await a.arrayBuffer()]:[a];return new Qf(i,e,n)}const r=await Bk(t);if(e||(e=Hk(t)??"unknown_file"),!(n!=null&&n.type)){const a=(s=r[0])==null?void 0:s.type;typeof a=="string"&&(n={...n,type:a})}return new Qf(r,e,n)}async function Bk(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(nc(t))e.push(await t.arrayBuffer());else if(Zk(t))for await(const r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${Vk(t)}`);return e}function Vk(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function Hk(t){var e;return vd(t.name)||vd(t.filename)||((e=vd(t.path))==null?void 0:e.split(/[\\/]/).pop())}const vd=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},Zk=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",Ug=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",Pa=async t=>{const e=await qk(t.body);return K0(e,t)},qk=async t=>{const e=new G0;return await Promise.all(Object.entries(t||{}).map(([n,r])=>Xf(e,n,r))),e},Xf=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(zk(n)){const r=await hb(n);t.append(e,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>Xf(t,e+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,s])=>Xf(t,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var ea={},Gk=function(t,e,n,r,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n},Wk=function(t,e,n,r){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},al;Y0();async function pb(t){var i;const{response:e}=t;if(t.options.stream)return Tr("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):In.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type"),r=(i=n==null?void 0:n.split(";")[0])==null?void 0:i.trim();if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.endsWith("+json"))){const o=await e.json();return Tr("response",e.status,e.url,e.headers,o),mb(o,e)}const a=await e.text();return Tr("response",e.status,e.url,e.headers,a),a}function mb(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class rc extends Promise{constructor(e,n=pb){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new rc(this.responsePromise,async n=>mb(e(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Kk{constructor({baseURL:e,maxRetries:n=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=wd("maxRetries",n),this.timeout=wd("timeout",r),this.httpAgent=s,this.fetch=a??q0}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ex(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${sx()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(async s=>{const a=s&&nc(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:n,...s,body:a}}))}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:n=0}={}){var m;const r={...e},{method:s,path:a,query:i,headers:o={}}=r,l=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:Ug(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,u=this.calculateContentLength(l),c=this.buildURL(a,i);"timeout"in r&&wd("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const d=r.httpAgent??this.httpAgent??J0(c),f=r.timeout+1e3;typeof((m=d==null?void 0:d.options)==null?void 0:m.timeout)=="number"&&f>(d.options.timeout??0)&&(d.options.timeout=f),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const h=this.buildHeaders({options:r,headers:o,contentLength:u,retryCount:n});return{req:{method:s,...l&&{body:l},headers:h,...d&&{agent:d},signal:r.signal??null},url:c,timeout:r.timeout}}buildHeaders({options:e,headers:n,contentLength:r,retryCount:s}){const a={};r&&(a["content-length"]=r);const i=this.defaultHeaders(e);return Hg(a,i),Hg(a,n),Ug(e.body)&&Fi!=="node"&&delete a["content-type"],ol(i,"x-stainless-retry-count")===void 0&&ol(n,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),ol(i,"x-stainless-timeout")===void 0&&ol(n,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,n),a}async prepareOptions(e){}async prepareRequest(e,{url:n,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,r,s){return We.generate(e,n,r,s)}request(e,n=null){return new rc(this.makeRequest(e,n))}async makeRequest(e,n){var d,f;const r=await e,s=r.maxRetries??this.maxRetries;n==null&&(n=s),await this.prepareOptions(r);const{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-n});if(await this.prepareRequest(a,{url:i,options:r}),Tr("request",i,r,a.headers),(d=r.signal)!=null&&d.aborted)throw new jt;const l=new AbortController,u=await this.fetchWithTimeout(i,a,o,l).catch(Yf);if(u instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new jt;if(n)return this.retryRequest(r,n);throw u.name==="AbortError"?new ec:new Yu({cause:u})}const c=yb(u.headers);if(!u.ok){if(n&&this.shouldRetry(u)){const p=`retrying, ${n} attempts remaining`;return Tr(`response (error; ${p})`,u.status,i,c),this.retryRequest(r,n,c)}const h=await u.text().catch(p=>Yf(p).message),y=tx(h),m=y?void 0:h;throw Tr(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,c,m),this.makeStatusError(u.status,y,m,c)}return{response:u,options:r,controller:l}}requestAPIList(e,n){const r=this.makeRequest(n,null);return new Jk(this,r,e)}buildURL(e,n){const r=rx(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return _b(s)||(n={...s,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new q(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,r,s){const{signal:a,...i}=n||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),l={signal:s.signal,...i};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r){let s;const a=r==null?void 0:r["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=r==null?void 0:r["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,o)}return await ko(s),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const a=n-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${As}`}}class gb{constructor(e,n,r,s){al.set(this,void 0),Gk(this,al,e),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new q("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const r=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[s,a]of r)e.url.searchParams.set(s,a);n.query=void 0,n.path=e.url.toString()}return await Wk(this,al,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(al=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class Jk extends rc{constructor(e,n,r){super(n,async s=>new r(e,s.response,await pb(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const yb=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const r=n.toString();return e[r.toLowerCase()]||e[r]}}),Qk={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ke=t=>typeof t=="object"&&t!==null&&!_b(t)&&Object.keys(t).every(e=>vb(Qk,e)),Xk=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":As,"X-Stainless-OS":Bg(Deno.build.os),"X-Stainless-Arch":zg(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":As,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":As,"X-Stainless-OS":Bg(process.platform),"X-Stainless-Arch":zg(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=Yk();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":As,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":As,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Yk(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const zg=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",Bg=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let Vg;const ex=()=>Vg??(Vg=Xk()),tx=t=>{try{return JSON.parse(t)}catch{return}},nx=/^[a-z][a-z0-9+.-]*:/i,rx=t=>nx.test(t),ko=t=>new Promise(e=>setTimeout(e,t)),wd=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new q(`${t} must be an integer`);if(e<0)throw new q(`${t} must be a positive integer`);return e},Yf=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},il=t=>{var e,n,r,s;if(typeof process<"u")return((e=ea==null?void 0:ea[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,t))==null?void 0:s.trim()};function _b(t){if(!t)return!0;for(const e in t)return!1;return!0}function vb(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Hg(t,e){for(const n in e){if(!vb(e,n))continue;const r=n.toLowerCase();if(!r)continue;const s=e[n];s===null?delete t[r]:s!==void 0&&(t[r]=s)}}const Zg=new Set(["authorization","api-key"]);function Tr(t,...e){if(typeof process<"u"&&(ea==null?void 0:ea.DEBUG)==="true"){const n=e.map(r=>{if(!r)return r;if(r.headers){const a={...r,headers:{...r.headers}};for(const i in r.headers)Zg.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(const a in r)Zg.has(a.toLowerCase())&&(s??(s={...r}),s[a]="REDACTED");return s??r});console.log(`OpenAI:DEBUG:${t}`,...n)}}const sx=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),ax=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ix=t=>typeof(t==null?void 0:t.get)=="function",ol=(t,e)=>{var r;const n=e.toLowerCase();if(ix(t)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,n,e.toUpperCase(),s]){const i=t.get(a);if(i)return i}}for(const[s,a]of Object.entries(t))if(s.toLowerCase()===n)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a},ox=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};function bd(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}class sc extends gb{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Ke extends gb{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const n=(r=e[e.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}}class te{constructor(e){this._client=e}}let wb=class extends te{list(e,n={},r){return ke(n)?this.list(e,{},n):this._client.getAPIList(`/chat/completions/${e}/messages`,lx,{query:n,...r})}},ac=class extends te{constructor(){super(...arguments),this.messages=new wb(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(`/chat/completions/${e}`,n)}update(e,n,r){return this._client.post(`/chat/completions/${e}`,{body:n,...r})}list(e={},n){return ke(e)?this.list({},e):this._client.getAPIList("/chat/completions",ic,{query:e,...n})}del(e,n){return this._client.delete(`/chat/completions/${e}`,n)}};class ic extends Ke{}class lx extends Ke{}ac.ChatCompletionsPage=ic;ac.Messages=wb;let oc=class extends te{constructor(){super(...arguments),this.completions=new ac(this._client)}};oc.Completions=ac;oc.ChatCompletionsPage=ic;class bb extends te{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class Eb extends te{create(e,n){return this._client.post("/audio/transcriptions",Pa({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}}))}}class Sb extends te{create(e,n){return this._client.post("/audio/translations",Pa({body:e,...n,__metadata:{model:e.model}}))}}class xo extends te{constructor(){super(...arguments),this.transcriptions=new Eb(this._client),this.translations=new Sb(this._client),this.speech=new bb(this._client)}}xo.Transcriptions=Eb;xo.Translations=Sb;xo.Speech=bb;class Sp extends te{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return ke(e)?this.list({},e):this._client.getAPIList("/batches",Pp,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class Pp extends Ke{}Sp.BatchesPage=Pp;class kp extends te{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/assistants/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return ke(e)?this.list({},e):this._client.getAPIList("/assistants",xp,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class xp extends Ke{}kp.AssistantsPage=xp;function qg(t){return typeof t.parse=="function"}const ta=t=>(t==null?void 0:t.role)==="assistant",Pb=t=>(t==null?void 0:t.role)==="function",kb=t=>(t==null?void 0:t.role)==="tool";var on=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},we=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},eh,jl,Ll,Ei,Si,Dl,Pi,zn,ki,vu,wu,Os,xb;class Ap{constructor(){eh.add(this),this.controller=new AbortController,jl.set(this,void 0),Ll.set(this,()=>{}),Ei.set(this,()=>{}),Si.set(this,void 0),Dl.set(this,()=>{}),Pi.set(this,()=>{}),zn.set(this,{}),ki.set(this,!1),vu.set(this,!1),wu.set(this,!1),Os.set(this,!1),on(this,jl,new Promise((e,n)=>{on(this,Ll,e,"f"),on(this,Ei,n,"f")}),"f"),on(this,Si,new Promise((e,n)=>{on(this,Dl,e,"f"),on(this,Pi,n,"f")}),"f"),we(this,jl,"f").catch(()=>{}),we(this,Si,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},we(this,eh,"m",xb).bind(this))},0)}_connected(){this.ended||(we(this,Ll,"f").call(this),this._emit("connect"))}get ended(){return we(this,ki,"f")}get errored(){return we(this,vu,"f")}get aborted(){return we(this,wu,"f")}abort(){this.controller.abort()}on(e,n){return(we(this,zn,"f")[e]||(we(this,zn,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=we(this,zn,"f")[e];if(!r)return this;const s=r.findIndex(a=>a.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(we(this,zn,"f")[e]||(we(this,zn,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{on(this,Os,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){on(this,Os,!0,"f"),await we(this,Si,"f")}_emit(e,...n){if(we(this,ki,"f"))return;e==="end"&&(on(this,ki,!0,"f"),we(this,Dl,"f").call(this));const r=we(this,zn,"f")[e];if(r&&(we(this,zn,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!we(this,Os,"f")&&!(r!=null&&r.length)&&Promise.reject(s),we(this,Ei,"f").call(this,s),we(this,Pi,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!we(this,Os,"f")&&!(r!=null&&r.length)&&Promise.reject(s),we(this,Ei,"f").call(this,s),we(this,Pi,"f").call(this,s),this._emit("end")}}_emitFinal(){}}jl=new WeakMap,Ll=new WeakMap,Ei=new WeakMap,Si=new WeakMap,Dl=new WeakMap,Pi=new WeakMap,zn=new WeakMap,ki=new WeakMap,vu=new WeakMap,wu=new WeakMap,Os=new WeakMap,eh=new WeakSet,xb=function(e){if(on(this,vu,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new jt),e instanceof jt)return on(this,wu,!0,"f"),this._emit("abort",e);if(e instanceof q)return this._emit("error",e);if(e instanceof Error){const n=new q(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new q(String(e)))};function Op(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function Ao(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function ux(t,e){return!e||!Ab(e)?{...t,choices:t.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:Cp(t,e)}function Cp(t,e){const n=t.choices.map(r=>{var s;if(r.finish_reason==="length")throw new lb;if(r.finish_reason==="content_filter")throw new ub;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(a=>dx(e,a)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?cx(e,r.message.content):null}}});return{...t,choices:n}}function cx(t,e){var n,r;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=t.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function dx(t,e){var r;const n=(r=t.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Ao(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function fx(t,e){var r;if(!t)return!1;const n=(r=t.tools)==null?void 0:r.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return Ao(n)||(n==null?void 0:n.function.strict)||!1}function Ab(t){var e;return Op(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>Ao(n)||n.type==="function"&&n.function.strict===!0))??!1}function hx(t){for(const e of t??[]){if(e.type!=="function")throw new q(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new q(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var gt=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},et,th,bu,nh,rh,sh,Ob,ah;const Gg=10;class Cb extends Ap{constructor(){super(...arguments),et.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(r=e.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(Pb(e)||kb(e))&&e.content)this._emit("functionCallResult",e.content);else if(ta(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ta(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new q("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),gt(this,et,"m",th).call(this)}async finalMessage(){return await this.done(),gt(this,et,"m",bu).call(this)}async finalFunctionCall(){return await this.done(),gt(this,et,"m",nh).call(this)}async finalFunctionCallResult(){return await this.done(),gt(this,et,"m",rh).call(this)}async totalUsage(){return await this.done(),gt(this,et,"m",sh).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=gt(this,et,"m",bu).call(this);n&&this._emit("finalMessage",n);const r=gt(this,et,"m",th).call(this);r&&this._emit("finalContent",r);const s=gt(this,et,"m",nh).call(this);s&&this._emit("finalFunctionCall",s);const a=gt(this,et,"m",rh).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",gt(this,et,"m",sh).call(this))}async _createChatCompletion(e,n,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),gt(this,et,"m",Ob).call(this,n);const a=await e.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Cp(a,n))}async _runChatCompletion(e,n,r){for(const s of n.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,n,r)}async _runFunctions(e,n,r){var f;const s="function",{function_call:a="auto",stream:i,...o}=n,l=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=Gg}=r||{},c={};for(const h of n.functions)c[h.name||h.function.name]=h;const d=n.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of n.messages)this._addMessage(h,!1);for(let h=0;h<u;++h){const m=(f=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!m)throw new q("missing message in ChatCompletion response");if(!m.function_call)return;const{name:v,arguments:g}=m.function_call,p=c[v];if(p){if(l&&l!==v){const P=`Invalid function_call: ${JSON.stringify(v)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:v,content:P});continue}}else{const P=`Invalid function_call: ${JSON.stringify(v)}. Available options are: ${d.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:v,content:P});continue}let _;try{_=qg(p)?await p.parse(g):g}catch(P){this._addMessage({role:s,name:v,content:P instanceof Error?P.message:String(P)});continue}const w=await p.function(_,this),b=gt(this,et,"m",ah).call(this,w);if(this._addMessage({role:s,name:v,content:b}),l)return}}async _runTools(e,n,r){var h,y,m;const s="tool",{tool_choice:a="auto",stream:i,...o}=n,l=typeof a!="string"&&((h=a==null?void 0:a.function)==null?void 0:h.name),{maxChatCompletions:u=Gg}=r||{},c=n.tools.map(v=>{if(Ao(v)){if(!v.$callback)throw new q("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),d={};for(const v of c)v.type==="function"&&(d[v.function.name||v.function.function.name]=v.function);const f="tools"in n?c.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of n.messages)this._addMessage(v,!1);for(let v=0;v<u;++v){const p=(y=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:y.message;if(!p)throw new q("missing message in ChatCompletion response");if(!((m=p.tool_calls)!=null&&m.length))return;for(const _ of p.tool_calls){if(_.type!=="function")continue;const w=_.id,{name:b,arguments:P}=_.function,k=d[b];if(k){if(l&&l!==b){const K=`Invalid tool_call: ${JSON.stringify(b)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:w,content:K});continue}}else{const K=`Invalid tool_call: ${JSON.stringify(b)}. Available options are: ${Object.keys(d).map(Qe=>JSON.stringify(Qe)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:w,content:K});continue}let R;try{R=qg(k)?await k.parse(P):P}catch(K){const Qe=K instanceof Error?K.message:String(K);this._addMessage({role:s,tool_call_id:w,content:Qe});continue}const Z=await k.function(R,this),M=gt(this,et,"m",ah).call(this,Z);if(this._addMessage({role:s,tool_call_id:w,content:M}),l)return}}}}et=new WeakSet,th=function(){return gt(this,et,"m",bu).call(this).content??null},bu=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(ta(n)){const{function_call:r,...s}=n,a={...s,content:n.content??null,refusal:n.refusal??null};return r&&(a.function_call=r),a}}throw new q("stream ended without producing a ChatCompletionMessage with role=assistant")},nh=function(){var e,n;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(ta(s)&&(s!=null&&s.function_call))return s.function_call;if(ta(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(n=s.tool_calls.at(-1))==null?void 0:n.function}},rh=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(Pb(n)&&n.content!=null||kb(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===n.tool_call_id))}))return n.content}},sh=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},Ob=function(e){if(e.n!=null&&e.n>1)throw new q("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ah=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class ho extends Cb{static runFunctions(e,n,r){const s=new ho,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,a)),s}static runTools(e,n,r){const s=new ho,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,a)),s}_addMessage(e,n=!0){super._addMessage(e,n),ta(e)&&e.content&&this._emit("content",e.content)}}const Tb=1,Rb=2,Ib=4,Nb=8,$b=16,jb=32,Lb=64,Db=128,Mb=256,Fb=Db|Mb,Ub=$b|jb|Fb|Lb,zb=Tb|Rb|Ub,Bb=Ib|Nb,px=zb|Bb,Le={STR:Tb,NUM:Rb,ARR:Ib,OBJ:Nb,NULL:$b,BOOL:jb,NAN:Lb,INFINITY:Db,MINUS_INFINITY:Mb,INF:Fb,SPECIAL:Ub,ATOM:zb,COLLECTION:Bb,ALL:px};class mx extends Error{}class gx extends Error{}function yx(t,e=Le.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return _x(t.trim(),e)}const _x=(t,e)=>{const n=t.length;let r=0;const s=f=>{throw new mx(`${f} at position ${r}`)},a=f=>{throw new gx(`${f} at position ${r}`)},i=()=>(d(),r>=n&&s("Unexpected end of input"),t[r]==='"'?o():t[r]==="{"?l():t[r]==="["?u():t.substring(r,r+4)==="null"||Le.NULL&e&&n-r<4&&"null".startsWith(t.substring(r))?(r+=4,null):t.substring(r,r+4)==="true"||Le.BOOL&e&&n-r<4&&"true".startsWith(t.substring(r))?(r+=4,!0):t.substring(r,r+5)==="false"||Le.BOOL&e&&n-r<5&&"false".startsWith(t.substring(r))?(r+=5,!1):t.substring(r,r+8)==="Infinity"||Le.INFINITY&e&&n-r<8&&"Infinity".startsWith(t.substring(r))?(r+=8,1/0):t.substring(r,r+9)==="-Infinity"||Le.MINUS_INFINITY&e&&1<n-r&&n-r<9&&"-Infinity".startsWith(t.substring(r))?(r+=9,-1/0):t.substring(r,r+3)==="NaN"||Le.NAN&e&&n-r<3&&"NaN".startsWith(t.substring(r))?(r+=3,NaN):c()),o=()=>{const f=r;let h=!1;for(r++;r<n&&(t[r]!=='"'||h&&t[r-1]==="\\");)h=t[r]==="\\"?!h:!1,r++;if(t.charAt(r)=='"')try{return JSON.parse(t.substring(f,++r-Number(h)))}catch(y){a(String(y))}else if(Le.STR&e)try{return JSON.parse(t.substring(f,r-Number(h))+'"')}catch{return JSON.parse(t.substring(f,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,d();const f={};try{for(;t[r]!=="}";){if(d(),r>=n&&Le.OBJ&e)return f;const h=o();d(),r++;try{const y=i();Object.defineProperty(f,h,{value:y,writable:!0,enumerable:!0,configurable:!0})}catch(y){if(Le.OBJ&e)return f;throw y}d(),t[r]===","&&r++}}catch{if(Le.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},u=()=>{r++;const f=[];try{for(;t[r]!=="]";)f.push(i()),d(),t[r]===","&&r++}catch{if(Le.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},c=()=>{if(r===0){t==="-"&&Le.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(h){if(Le.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}a(String(h))}}const f=r;for(t[r]==="-"&&r++;t[r]&&!",]}".includes(t[r]);)r++;r==n&&!(Le.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(f,r))}catch{t.substring(f,r)==="-"&&Le.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(f,t.lastIndexOf("e")))}catch(y){a(String(y))}}},d=()=>{for(;r<n&&` 
\r	`.includes(t[r]);)r++};return i()},Wg=t=>yx(t,Le.ALL^Le.NUM);var vs=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},fe=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Re,Mn,ws,ir,Ed,ll,Sd,Pd,kd,ul,xd,Kg;class po extends Cb{constructor(e){super(),Re.add(this),Mn.set(this,void 0),ws.set(this,void 0),ir.set(this,void 0),vs(this,Mn,e,"f"),vs(this,ws,[],"f")}get currentChatCompletionSnapshot(){return fe(this,ir,"f")}static fromReadableStream(e){const n=new po(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,r){const s=new po(n);return s._run(()=>s._runChatCompletion(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,n,r){var i;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),fe(this,Re,"m",Ed).call(this);const a=await e.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)fe(this,Re,"m",Sd).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new jt;return this._addChatCompletion(fe(this,Re,"m",ul).call(this))}async _fromReadableStream(e,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),fe(this,Re,"m",Ed).call(this),this._connected();const s=In.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(fe(this,Re,"m",ul).call(this)),fe(this,Re,"m",Sd).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new jt;return this._addChatCompletion(fe(this,Re,"m",ul).call(this))}[(Mn=new WeakMap,ws=new WeakMap,ir=new WeakMap,Re=new WeakSet,Ed=function(){this.ended||vs(this,ir,void 0,"f")},ll=function(n){let r=fe(this,ws,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},fe(this,ws,"f")[n.index]=r,r)},Sd=function(n){var s,a,i,o,l,u,c,d,f,h,y,m,v,g,p;if(this.ended)return;const r=fe(this,Re,"m",Kg).call(this,n);this._emit("chunk",n,r);for(const _ of n.choices){const w=r.choices[_.index];_.delta.content!=null&&((s=w.message)==null?void 0:s.role)==="assistant"&&((a=w.message)!=null&&a.content)&&(this._emit("content",_.delta.content,w.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:w.message.content,parsed:w.message.parsed})),_.delta.refusal!=null&&((i=w.message)==null?void 0:i.role)==="assistant"&&((o=w.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:w.message.refusal}),((l=_.logprobs)==null?void 0:l.content)!=null&&((u=w.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=_.logprobs)==null?void 0:c.content,snapshot:((d=w.logprobs)==null?void 0:d.content)??[]}),((f=_.logprobs)==null?void 0:f.refusal)!=null&&((h=w.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(y=_.logprobs)==null?void 0:y.refusal,snapshot:((m=w.logprobs)==null?void 0:m.refusal)??[]});const b=fe(this,Re,"m",ll).call(this,w);w.finish_reason&&(fe(this,Re,"m",kd).call(this,w),b.current_tool_call_index!=null&&fe(this,Re,"m",Pd).call(this,w,b.current_tool_call_index));for(const P of _.delta.tool_calls??[])b.current_tool_call_index!==P.index&&(fe(this,Re,"m",kd).call(this,w),b.current_tool_call_index!=null&&fe(this,Re,"m",Pd).call(this,w,b.current_tool_call_index)),b.current_tool_call_index=P.index;for(const P of _.delta.tool_calls??[]){const k=(v=w.message.tool_calls)==null?void 0:v[P.index];k!=null&&k.type&&((k==null?void 0:k.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(g=k.function)==null?void 0:g.name,index:P.index,arguments:k.function.arguments,parsed_arguments:k.function.parsed_arguments,arguments_delta:((p=P.function)==null?void 0:p.arguments)??""}):(k==null||k.type,void 0))}}},Pd=function(n,r){var i,o,l;if(fe(this,Re,"m",ll).call(this,n).done_tool_calls.has(r))return;const a=(i=n.message.tool_calls)==null?void 0:i[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const u=(l=(o=fe(this,Mn,"f"))==null?void 0:o.tools)==null?void 0:l.find(c=>c.type==="function"&&c.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Ao(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},kd=function(n){var s,a;const r=fe(this,Re,"m",ll).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const i=fe(this,Re,"m",xd).call(this);this._emit("content.done",{content:n.message.content,parsed:i?i.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(s=n.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(a=n.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},ul=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");const n=fe(this,ir,"f");if(!n)throw new q("request ended without sending any chunks");return vs(this,ir,void 0,"f"),vs(this,ws,[],"f"),vx(n,fe(this,Mn,"f"))},xd=function(){var r;const n=(r=fe(this,Mn,"f"))==null?void 0:r.response_format;return Op(n)?n:null},Kg=function(n){var r,s,a,i;let o=fe(this,ir,"f");const{choices:l,...u}=n;o?Object.assign(o,u):o=vs(this,ir,{...u,choices:[]},"f");for(const{delta:c,finish_reason:d,index:f,logprobs:h=null,...y}of n.choices){let m=o.choices[f];if(m||(m=o.choices[f]={finish_reason:d,index:f,message:{},logprobs:h,...y}),h)if(!m.logprobs)m.logprobs=Object.assign({},h);else{const{content:P,refusal:k,...R}=h;Object.assign(m.logprobs,R),P&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...P)),k&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...k))}if(d&&(m.finish_reason=d,fe(this,Mn,"f")&&Ab(fe(this,Mn,"f")))){if(d==="length")throw new lb;if(d==="content_filter")throw new ub}if(Object.assign(m,y),!c)continue;const{content:v,refusal:g,function_call:p,role:_,tool_calls:w,...b}=c;if(Object.assign(m.message,b),g&&(m.message.refusal=(m.message.refusal||"")+g),_&&(m.message.role=_),p&&(m.message.function_call?(p.name&&(m.message.function_call.name=p.name),p.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=p.arguments)):m.message.function_call=p),v&&(m.message.content=(m.message.content||"")+v,!m.message.refusal&&fe(this,Re,"m",xd).call(this)&&(m.message.parsed=Wg(m.message.content))),w){m.message.tool_calls||(m.message.tool_calls=[]);for(const{index:P,id:k,type:R,function:Z,...M}of w){const K=(i=m.message.tool_calls)[P]??(i[P]={});Object.assign(K,M),k&&(K.id=k),R&&(K.type=R),Z&&(K.function??(K.function={name:Z.name??"",arguments:""})),Z!=null&&Z.name&&(K.function.name=Z.name),Z!=null&&Z.arguments&&(K.function.arguments+=Z.arguments,fx(fe(this,Mn,"f"),K)&&(K.function.parsed_arguments=Wg(K.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("chunk",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new In(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function vx(t,e){const{id:n,choices:r,created:s,model:a,system_fingerprint:i,...o}=t,l={...o,id:n,choices:r.map(({message:u,finish_reason:c,index:d,logprobs:f,...h})=>{if(!c)throw new q(`missing finish_reason for choice ${d}`);const{content:y=null,function_call:m,tool_calls:v,...g}=u,p=u.role;if(!p)throw new q(`missing role for choice ${d}`);if(m){const{arguments:_,name:w}=m;if(_==null)throw new q(`missing function_call.arguments for choice ${d}`);if(!w)throw new q(`missing function_call.name for choice ${d}`);return{...h,message:{content:y,function_call:{arguments:_,name:w},role:p,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}return v?{...h,index:d,finish_reason:c,logprobs:f,message:{...g,role:p,content:y,refusal:u.refusal??null,tool_calls:v.map((_,w)=>{const{function:b,type:P,id:k,...R}=_,{arguments:Z,name:M,...K}=b||{};if(k==null)throw new q(`missing choices[${d}].tool_calls[${w}].id
${cl(t)}`);if(P==null)throw new q(`missing choices[${d}].tool_calls[${w}].type
${cl(t)}`);if(M==null)throw new q(`missing choices[${d}].tool_calls[${w}].function.name
${cl(t)}`);if(Z==null)throw new q(`missing choices[${d}].tool_calls[${w}].function.arguments
${cl(t)}`);return{...R,id:k,type:P,function:{...K,name:M,arguments:Z}}})}}:{...h,message:{...g,content:y,role:p,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:f}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return ux(l,e)}function cl(t){return JSON.stringify(t)}class na extends po{static fromReadableStream(e){const n=new na(null);return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,r){const s=new na(null),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,a)),s}static runTools(e,n,r){const s=new na(n),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,a)),s}}let Vb=class extends te{parse(e,n){return hx(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Cp(r,e))}runFunctions(e,n){return e.stream?na.runFunctions(this._client,e,n):ho.runFunctions(this._client,e,n)}runTools(e,n){return e.stream?na.runTools(this._client,e,n):ho.runTools(this._client,e,n)}stream(e,n){return po.createChatCompletion(this._client,e,n)}};class ih extends te{constructor(){super(...arguments),this.completions=new Vb(this._client)}}(function(t){t.Completions=Vb})(ih||(ih={}));class Hb extends te{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Zb extends te{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class lc extends te{constructor(){super(...arguments),this.sessions=new Hb(this._client),this.transcriptionSessions=new Zb(this._client)}}lc.Sessions=Hb;lc.TranscriptionSessions=Zb;var B=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Ct=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Ve,oh,On,Ml,un,Qr,Vs,Zr,Eu,Rt,Fl,Ul,Ui,xi,Ai,Jg,Qg,Xg,Yg,ey,ty,ny;class fn extends Ap{constructor(){super(...arguments),Ve.add(this),oh.set(this,[]),On.set(this,{}),Ml.set(this,{}),un.set(this,void 0),Qr.set(this,void 0),Vs.set(this,void 0),Zr.set(this,void 0),Eu.set(this,void 0),Rt.set(this,void 0),Fl.set(this,void 0),Ul.set(this,void 0),Ui.set(this,void 0)}[(oh=new WeakMap,On=new WeakMap,Ml=new WeakMap,un=new WeakMap,Qr=new WeakMap,Vs=new WeakMap,Zr=new WeakMap,Eu=new WeakMap,Rt=new WeakMap,Fl=new WeakMap,Ul=new WeakMap,Ui=new WeakMap,Ve=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("event",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new fn;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=In.fromReadableStream(e,this.controller);for await(const i of s)B(this,Ve,"m",xi).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new jt;return this._addRun(B(this,Ve,"m",Ai).call(this))}toReadableStream(){return new In(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,r,s,a){const i=new fn;return i._run(()=>i._runToolAssistantStream(e,n,r,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,n,r,s,a){var u;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(n,r,o,{...a,signal:this.controller.signal});this._connected();for await(const c of l)B(this,Ve,"m",xi).call(this,c);if((u=l.controller.signal)!=null&&u.aborted)throw new jt;return this._addRun(B(this,Ve,"m",Ai).call(this))}static createThreadAssistantStream(e,n,r){const s=new fn;return s._run(()=>s._threadAssistantStream(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,n,r,s){const a=new fn;return a._run(()=>a._runAssistantStream(e,n,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return B(this,Fl,"f")}currentRun(){return B(this,Ul,"f")}currentMessageSnapshot(){return B(this,un,"f")}currentRunStepSnapshot(){return B(this,Ui,"f")}async finalRunSteps(){return await this.done(),Object.values(B(this,On,"f"))}async finalMessages(){return await this.done(),Object.values(B(this,Ml,"f"))}async finalRun(){if(await this.done(),!B(this,Qr,"f"))throw Error("Final run was not received.");return B(this,Qr,"f")}async _createThreadAssistantStream(e,n,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...n,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(const l of i)B(this,Ve,"m",xi).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new jt;return this._addRun(B(this,Ve,"m",Ai).call(this))}async _createAssistantStream(e,n,r,s){var l;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...r,stream:!0},o=await e.create(n,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)B(this,Ve,"m",xi).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new jt;return this._addRun(B(this,Ve,"m",Ai).call(this))}static accumulateDelta(e,n){for(const[r,s]of Object.entries(n)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let a=e[r];if(a==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(bd(a)&&bd(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!bd(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,n,r){return await this._createThreadAssistantStream(n,e,r)}async _runAssistantStream(e,n,r,s){return await this._createAssistantStream(n,e,r,s)}async _runToolAssistantStream(e,n,r,s,a){return await this._createToolAssistantStream(r,e,n,s,a)}}xi=function(e){if(!this.ended)switch(Ct(this,Fl,e,"f"),B(this,Ve,"m",Xg).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":B(this,Ve,"m",ny).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":B(this,Ve,"m",Qg).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":B(this,Ve,"m",Jg).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ai=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");if(!B(this,Qr,"f"))throw Error("Final run has not been received");return B(this,Qr,"f")},Jg=function(e){const[n,r]=B(this,Ve,"m",ey).call(this,e,B(this,un,"f"));Ct(this,un,n,"f"),B(this,Ml,"f")[n.id]=n;for(const s of r){const a=n.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=n.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=B(this,Vs,"f")){if(B(this,Zr,"f"))switch(B(this,Zr,"f").type){case"text":this._emit("textDone",B(this,Zr,"f").text,B(this,un,"f"));break;case"image_file":this._emit("imageFileDone",B(this,Zr,"f").image_file,B(this,un,"f"));break}Ct(this,Vs,s.index,"f")}Ct(this,Zr,n.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(B(this,Vs,"f")!==void 0){const s=e.data.content[B(this,Vs,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,B(this,un,"f"));break;case"text":this._emit("textDone",s.text,B(this,un,"f"));break}}B(this,un,"f")&&this._emit("messageDone",e.data),Ct(this,un,void 0,"f")}},Qg=function(e){const n=B(this,Ve,"m",Yg).call(this,e);switch(Ct(this,Ui,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const a of r.step_details.tool_calls)a.index==B(this,Eu,"f")?this._emit("toolCallDelta",a,n.step_details.tool_calls[a.index]):(B(this,Rt,"f")&&this._emit("toolCallDone",B(this,Rt,"f")),Ct(this,Eu,a.index,"f"),Ct(this,Rt,n.step_details.tool_calls[a.index],"f"),B(this,Rt,"f")&&this._emit("toolCallCreated",B(this,Rt,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ct(this,Ui,void 0,"f"),e.data.step_details.type=="tool_calls"&&B(this,Rt,"f")&&(this._emit("toolCallDone",B(this,Rt,"f")),Ct(this,Rt,void 0,"f")),this._emit("runStepDone",e.data,n);break}},Xg=function(e){B(this,oh,"f").push(e),this._emit("event",e)},Yg=function(e){switch(e.event){case"thread.run.step.created":return B(this,On,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=B(this,On,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=fn.accumulateDelta(n,r.delta);B(this,On,"f")[e.data.id]=s}return B(this,On,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":B(this,On,"f")[e.data.id]=e.data;break}if(B(this,On,"f")[e.data.id])return B(this,On,"f")[e.data.id];throw new Error("No snapshot available")},ey=function(e,n){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in n.content){let i=n.content[a.index];n.content[a.index]=B(this,Ve,"m",ty).call(this,a,i)}else n.content[a.index]=a,r.push(a);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ty=function(e,n){return fn.accumulateDelta(n,e)},ny=function(e){switch(Ct(this,Ul,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Ct(this,Qr,e.data,"f"),B(this,Rt,"f")&&(this._emit("toolCallDone",B(this,Rt,"f")),Ct(this,Rt,void 0,"f"));break}};class Tp extends te{create(e,n,r){return this._client.post(`/threads/${e}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/messages/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return ke(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,Rp,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Rp extends Ke{}Tp.MessagesPage=Rp;class Ip extends te{retrieve(e,n,r,s={},a){return ke(s)?this.retrieve(e,n,r,{},s):this._client.get(`/threads/${e}/runs/${n}/steps/${r}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,n,r={},s){return ke(r)?this.list(e,n,{},r):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,Np,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Np extends Ke{}Ip.RunStepsPage=Np;let Oo=class extends te{constructor(){super(...arguments),this.steps=new Ip(this._client)}create(e,n,r){const{include:s,...a}=n;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}retrieve(e,n,r){return this._client.get(`/threads/${e}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return ke(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,$p,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}createAndStream(e,n,r){return fn.createAssistantStream(e,this._client.beta.threads.runs,n,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,n,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await ko(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,n,r){return fn.createAssistantStream(e,this._client.beta.threads.runs,n,r)}submitToolOutputs(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,n,r,s){const a=await this.submitToolOutputs(e,n,r,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,n,r,s){return fn.createToolAssistantStream(e,n,this._client.beta.threads.runs,r,s)}};class $p extends Ke{}Oo.RunsPage=$p;Oo.Steps=Ip;Oo.RunStepsPage=Np;class Ra extends te{constructor(){super(...arguments),this.runs=new Oo(this._client),this.messages=new Tp(this._client)}create(e={},n){return ke(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/threads/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const r=await this.createAndRun(e,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(e,n){return fn.createThreadAssistantStream(e,this._client.beta.threads,n)}}Ra.Runs=Oo;Ra.RunsPage=$p;Ra.Messages=Tp;Ra.MessagesPage=Rp;class Ia extends te{constructor(){super(...arguments),this.realtime=new lc(this._client),this.chat=new ih(this._client),this.assistants=new kp(this._client),this.threads=new Ra(this._client)}}Ia.Realtime=lc;Ia.Assistants=kp;Ia.AssistantsPage=xp;Ia.Threads=Ra;class qb extends te{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class Gb extends te{create(e,n){const r=!!e.encoding_format;let s=r?e.encoding_format:"base64";r&&Tr("Request","User defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:s},...n});return r?a:(Tr("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const l=o.embedding;o.embedding=ox(l)}),i)))}}class jp extends te{retrieve(e,n,r,s){return this._client.get(`/evals/${e}/runs/${n}/output_items/${r}`,s)}list(e,n,r={},s){return ke(r)?this.list(e,n,{},r):this._client.getAPIList(`/evals/${e}/runs/${n}/output_items`,Lp,{query:r,...s})}}class Lp extends Ke{}jp.OutputItemListResponsesPage=Lp;class Co extends te{constructor(){super(...arguments),this.outputItems=new jp(this._client)}create(e,n,r){return this._client.post(`/evals/${e}/runs`,{body:n,...r})}retrieve(e,n,r){return this._client.get(`/evals/${e}/runs/${n}`,r)}list(e,n={},r){return ke(n)?this.list(e,{},n):this._client.getAPIList(`/evals/${e}/runs`,Dp,{query:n,...r})}del(e,n,r){return this._client.delete(`/evals/${e}/runs/${n}`,r)}cancel(e,n,r){return this._client.post(`/evals/${e}/runs/${n}`,r)}}class Dp extends Ke{}Co.RunListResponsesPage=Dp;Co.OutputItems=jp;Co.OutputItemListResponsesPage=Lp;class To extends te{constructor(){super(...arguments),this.runs=new Co(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(`/evals/${e}`,n)}update(e,n,r){return this._client.post(`/evals/${e}`,{body:n,...r})}list(e={},n){return ke(e)?this.list({},e):this._client.getAPIList("/evals",Mp,{query:e,...n})}del(e,n){return this._client.delete(`/evals/${e}`,n)}}class Mp extends Ke{}To.EvalListResponsesPage=Mp;To.Runs=Co;To.RunListResponsesPage=Dp;let Fp=class extends te{create(e,n){return this._client.post("/files",Pa({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return ke(e)?this.list({},e):this._client.getAPIList("/files",Up,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,n)}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await ko(n),i=await this.retrieve(e),Date.now()-a>r)throw new ec({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}};class Up extends Ke{}Fp.FileObjectsPage=Up;class zp extends te{create(e,n,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Bp,{body:n,method:"post",...r})}retrieve(e,n={},r){return ke(n)?this.retrieve(e,{},n):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...r})}del(e,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions`,n)}}class Bp extends sc{}zp.PermissionCreateResponsesPage=Bp;let uc=class extends te{constructor(){super(...arguments),this.permissions=new zp(this._client)}};uc.Permissions=zp;uc.PermissionCreateResponsesPage=Bp;class Vp extends te{list(e,n={},r){return ke(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Hp,{query:n,...r})}}class Hp extends Ke{}Vp.FineTuningJobCheckpointsPage=Hp;class Na extends te{constructor(){super(...arguments),this.checkpoints=new Vp(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return ke(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Zp,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},r){return ke(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,qp,{query:n,...r})}}class Zp extends Ke{}class qp extends Ke{}Na.FineTuningJobsPage=Zp;Na.FineTuningJobEventsPage=qp;Na.Checkpoints=Vp;Na.FineTuningJobCheckpointsPage=Hp;class $a extends te{constructor(){super(...arguments),this.jobs=new Na(this._client),this.checkpoints=new uc(this._client)}}$a.Jobs=Na;$a.FineTuningJobsPage=Zp;$a.FineTuningJobEventsPage=qp;$a.Checkpoints=uc;class Wb extends te{createVariation(e,n){return this._client.post("/images/variations",Pa({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",Pa({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}class Gp extends te{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",Wp,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class Wp extends sc{}Gp.ModelsPage=Wp;class Kb extends te{create(e,n){return this._client.post("/moderations",{body:e,...n})}}function wx(t,e){return!e||!Ex(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(r=>({...r,parsed:null}))}:n)}:Jb(t,e)}function Jb(t,e){const n=t.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:kx(e,s)};if(s.type==="message"){const a=s.content.map(i=>i.type==="output_text"?{...i,parsed:bx(e,i.text)}:i);return{...s,content:a}}return s}),r=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||Qb(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const s of r.output)if(s.type==="message"){for(const a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function bx(t,e){var n,r,s,a;return((r=(n=t.text)==null?void 0:n.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((s=t.text)==null?void 0:s.format)?((a=t.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function Ex(t){var e;return!!Op((e=t.text)==null?void 0:e.format)}function Sx(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function Px(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function kx(t,e){const n=Px(t.tools??[],e.name);return{...e,...e,parsed_arguments:Sx(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function Qb(t){const e=[];for(const n of t.output)if(n.type==="message")for(const r of n.content)r.type==="output_text"&&e.push(r.text);t.output_text=e.join("")}class Xb extends te{list(e,n={},r){return ke(n)?this.list(e,{},n):this._client.getAPIList(`/responses/${e}/input_items`,Ax,{query:n,...r})}}var bs=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},or=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Es,dl,lr,fl,ry,sy,ay,iy;class Kp extends Ap{constructor(e){super(),Es.add(this),dl.set(this,void 0),lr.set(this,void 0),fl.set(this,void 0),bs(this,dl,e,"f")}static createResponse(e,n,r){const s=new Kp(n);return s._run(()=>s._createResponse(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createResponse(e,n,r){var i;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),or(this,Es,"m",ry).call(this);const a=await e.responses.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)or(this,Es,"m",sy).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new jt;return or(this,Es,"m",ay).call(this)}[(dl=new WeakMap,lr=new WeakMap,fl=new WeakMap,Es=new WeakSet,ry=function(){this.ended||bs(this,lr,void 0,"f")},sy=function(n){if(this.ended)return;const r=or(this,Es,"m",iy).call(this,n);switch(this._emit("event",n),n.type){case"response.output_text.delta":{const s=r.output[n.output_index];if(!s)throw new q(`missing output at index ${n.output_index}`);if(s.type==="message"){const a=s.content[n.content_index];if(!a)throw new q(`missing content at index ${n.content_index}`);if(a.type!=="output_text")throw new q(`expected content to be 'output_text', got ${a.type}`);this._emit("response.output_text.delta",{...n,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const s=r.output[n.output_index];if(!s)throw new q(`missing output at index ${n.output_index}`);s.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...n,snapshot:s.arguments});break}default:this._emit(n.type,n);break}},ay=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");const n=or(this,lr,"f");if(!n)throw new q("request ended without sending any events");bs(this,lr,void 0,"f");const r=xx(n,or(this,dl,"f"));return bs(this,fl,r,"f"),r},iy=function(n){let r=or(this,lr,"f");if(!r){if(n.type!=="response.created")throw new q(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=bs(this,lr,n.response,"f"),r}switch(n.type){case"response.output_item.added":{r.output.push(n.item);break}case"response.content_part.added":{const s=r.output[n.output_index];if(!s)throw new q(`missing output at index ${n.output_index}`);s.type==="message"&&s.content.push(n.part);break}case"response.output_text.delta":{const s=r.output[n.output_index];if(!s)throw new q(`missing output at index ${n.output_index}`);if(s.type==="message"){const a=s.content[n.content_index];if(!a)throw new q(`missing content at index ${n.content_index}`);if(a.type!=="output_text")throw new q(`expected content to be 'output_text', got ${a.type}`);a.text+=n.delta}break}case"response.function_call_arguments.delta":{const s=r.output[n.output_index];if(!s)throw new q(`missing output at index ${n.output_index}`);s.type==="function_call"&&(s.arguments+=n.delta);break}case"response.completed":{bs(this,lr,n.response,"f");break}}return r},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("event",s=>{const a=n.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const a of n)a.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>n.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=or(this,fl,"f");if(!e)throw new q("stream ended without producing a ChatCompletion");return e}}function xx(t,e){return wx(t,e)}class Jp extends te{constructor(){super(...arguments),this.inputItems=new Xb(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&Qb(r),r))}retrieve(e,n={},r){return ke(n)?this.retrieve(e,{},n):this._client.get(`/responses/${e}`,{query:n,...r})}del(e,n){return this._client.delete(`/responses/${e}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(r=>Jb(r,e))}stream(e,n){return Kp.createResponse(this._client,e,n)}}class Ax extends Ke{}Jp.InputItems=Xb;class Yb extends te{create(e,n,r){return this._client.post(`/uploads/${e}/parts`,Pa({body:n,...r}))}}class Qp extends te{constructor(){super(...arguments),this.parts=new Yb(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(`/uploads/${e}/cancel`,n)}complete(e,n,r){return this._client.post(`/uploads/${e}/complete`,{body:n,...r})}}Qp.Parts=Yb;const Ox=async t=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="rejected");if(n.length){for(const s of n)console.error(s.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};class cc extends te{create(e,n,r){return this._client.post(`/vector_stores/${e}/files`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/vector_stores/${e}/files/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return ke(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,dc,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const a=await this.retrieve(e,n,{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await ko(o);break;case"failed":case"completed":return i}}}async upload(e,n,r){const s=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,n,r){const s=await this.upload(e,n,r);return await this.poll(e,s.id,r)}content(e,n,r){return this._client.getAPIList(`/vector_stores/${e}/files/${n}/content`,Xp,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class dc extends Ke{}class Xp extends sc{}cc.VectorStoreFilesPage=dc;cc.FileContentResponsesPage=Xp;class eE extends te{create(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n);return await this.poll(e,s.id,r)}listFiles(e,n,r={},s){return ke(r)?this.listFiles(e,n,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,dc,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,n,{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await ko(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:n,fileIds:r=[]},s){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,n.length),o=this._client,l=n.values(),u=[...r];async function c(f){for(let h of f){const y=await o.files.create({file:h,purpose:"assistants"},s);u.push(y.id)}}const d=Array(i).fill(l).map(c);return await Ox(d),await this.createAndPoll(e,{file_ids:u})}}class Ur extends te{constructor(){super(...arguments),this.files=new cc(this._client),this.fileBatches=new eE(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/vector_stores/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return ke(e)?this.list({},e):this._client.getAPIList("/vector_stores",Yp,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(e,n,r){return this._client.getAPIList(`/vector_stores/${e}/search`,em,{body:n,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Yp extends Ke{}class em extends sc{}Ur.VectorStoresPage=Yp;Ur.VectorStoreSearchResponsesPage=em;Ur.Files=cc;Ur.VectorStoreFilesPage=dc;Ur.FileContentResponsesPage=Xp;Ur.FileBatches=eE;var tE;let Y=class extends Kk{constructor({baseURL:e=il("OPENAI_BASE_URL"),apiKey:n=il("OPENAI_API_KEY"),organization:r=il("OPENAI_ORG_ID")??null,project:s=il("OPENAI_PROJECT_ID")??null,...a}={}){if(n===void 0)throw new q("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:n,organization:r,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&ax())throw new q(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new qb(this),this.chat=new oc(this),this.embeddings=new Gb(this),this.files=new Fp(this),this.images=new Wb(this),this.audio=new xo(this),this.moderations=new Kb(this),this.models=new Gp(this),this.fineTuning=new $a(this),this.vectorStores=new Ur(this),this.beta=new Ia(this),this.batches=new Sp(this),this.uploads=new Qp(this),this.responses=new Jp(this),this.evals=new To(this),this._options=i,this.apiKey=n,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Rk(e,{arrayFormat:"brackets"})}};tE=Y;Y.OpenAI=tE;Y.DEFAULT_TIMEOUT=6e5;Y.OpenAIError=q;Y.APIError=We;Y.APIConnectionError=Yu;Y.APIConnectionTimeoutError=ec;Y.APIUserAbortError=jt;Y.NotFoundError=rb;Y.ConflictError=sb;Y.RateLimitError=ib;Y.BadRequestError=eb;Y.AuthenticationError=tb;Y.InternalServerError=ob;Y.PermissionDeniedError=nb;Y.UnprocessableEntityError=ab;Y.toFile=hb;Y.fileFromPath=Q0;Y.Completions=qb;Y.Chat=oc;Y.ChatCompletionsPage=ic;Y.Embeddings=Gb;Y.Files=Fp;Y.FileObjectsPage=Up;Y.Images=Wb;Y.Audio=xo;Y.Moderations=Kb;Y.Models=Gp;Y.ModelsPage=Wp;Y.FineTuning=$a;Y.VectorStores=Ur;Y.VectorStoresPage=Yp;Y.VectorStoreSearchResponsesPage=em;Y.Beta=Ia;Y.Batches=Sp;Y.BatchesPage=Pp;Y.Uploads=Qp;Y.Responses=Jp;Y.Evals=To;Y.EvalListResponsesPage=Mp;function Cx(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const n=[];let r=!1,s=!1;for(let a of t){if(r)a==='"'&&!s?r=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')r=!0,s=!1;else if(a==="{")n.push("}");else if(a==="[")n.push("]");else if(a==="}"||a==="]")if(n&&n[n.length-1]===a)n.pop();else return null;e+=a}r&&(e+='"');for(let a=n.length-1;a>=0;a-=1)e+=n[a];try{return JSON.parse(e)}catch{return null}}var Tx=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const Rx=ju(Tx);var nE={exports:{}};const Ix=/[\p{Lu}]/u,Nx=/[\p{Ll}]/u,oy=/^[\p{Lu}](?![\p{Lu}])/gu,rE=/([\p{Alpha}\p{N}_]|$)/u,sE=/[_.\- ]+/,$x=new RegExp("^"+sE.source),ly=new RegExp(sE.source+rE.source,"gu"),uy=new RegExp("\\d+"+rE.source,"gu"),jx=(t,e,n)=>{let r=!1,s=!1,a=!1;for(let i=0;i<t.length;i++){const o=t[i];r&&Ix.test(o)?(t=t.slice(0,i)+"-"+t.slice(i),r=!1,a=s,s=!0,i++):s&&a&&Nx.test(o)?(t=t.slice(0,i-1)+"-"+t.slice(i-1),a=s,s=!1,r=!0):(r=e(o)===o&&n(o)!==o,a=s,s=n(o)===o&&e(o)!==o)}return t},Lx=(t,e)=>(oy.lastIndex=0,t.replace(oy,n=>e(n))),Dx=(t,e)=>(ly.lastIndex=0,uy.lastIndex=0,t.replace(ly,(n,r)=>e(r)).replace(uy,n=>e(n))),aE=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const n=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),r=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?r(t):n(t):(t!==n(t)&&(t=jx(t,n,r)),t=t.replace($x,""),e.preserveConsecutiveUppercase?t=Lx(t,n):t=n(t),e.pascalCase&&(t=r(t.charAt(0))+t.slice(1)),Dx(t,r))};nE.exports=aE;nE.exports.default=aE;function Mx(t,e){return(e==null?void 0:e[t])||Rx(t)}function Fx(t,e,n){const r={};for(const s in t)Object.hasOwn(t,s)&&(r[e(s,n)]=t[s]);return r}function cy(t){return Array.isArray(t)?[...t]:{...t}}function Ux(t,e){const n=cy(t);for(const[r,s]of Object.entries(e)){const[a,...i]=r.split(".").reverse();let o=n;for(const l of i.reverse()){if(o[l]===void 0)break;o[l]=cy(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return n}function iE(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}class hs{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,iE(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...n){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof hs||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},n={},r=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(n,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(n).forEach(s=>{let a=this,i=r;const[o,...l]=s.split(".").reverse();for(const u of l.reverse()){if(!(u in a)||a[u]===void 0)return;(!(u in i)||i[u]===void 0)&&(typeof a[u]=="object"&&a[u]!=null?i[u]={}:Array.isArray(a[u])&&(i[u]=[])),a=a[u],i=i[u]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Fx(Object.keys(n).length?Ux(r,n):r,Mx,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function ja(t,e){return typeof t=="string"?typeof e=="string"?t+e:[{type:"text",text:t},...e]:Array.isArray(e)?[...t,...e]:[...t,{type:"text",text:e}]}class Ro extends hs{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,n){typeof e=="string"&&(e={content:e,additional_kwargs:n,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function xt(t,e){const n={...t};for(const[r,s]of Object.entries(e))if(n[r]==null)n[r]=s;else{if(s==null)continue;if(typeof n[r]!=typeof s||Array.isArray(n[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof n[r]=="string")n[r]=n[r]+s;else if(!Array.isArray(n[r])&&typeof n[r]=="object")n[r]=xt(n[r],s);else if(Array.isArray(n[r]))n[r]=oE(n[r],s);else{if(n[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return n}function oE(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const n=[...t];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const s=n.findIndex(a=>a.index===r.index);s!==-1?n[s]=xt(n[s],r):n.push(r)}else n.push(r);return n}}}class La extends Ro{}function zx(t){return typeof(t==null?void 0:t._getType)=="function"}class tm extends La{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new tm({content:ja(this.content,e.content),additional_kwargs:xt(this.additional_kwargs,e.additional_kwargs),response_metadata:xt(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}}function Bx(t){const e=[],n=[];for(const r of t)if(r.function){const s=r.function.name;try{const a=JSON.parse(r.function.arguments),i={name:s||"",args:a||{},id:r.id};e.push(i)}catch{n.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,n]}class lE extends Ro{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,n){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:n??{}};else{r=e;const a=(s=r.additional_kwargs)==null?void 0:s.tool_calls,i=r.tool_calls;a!=null&&a.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&i===void 0){const[o,l]=Bx(a);r.tool_calls=o??[],r.invalid_tool_calls=l??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}}class fc extends La{constructor(e){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)n={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],s=[];for(const a of e.tool_call_chunks){let i={};try{if(i=Cx(a.args??"{}")??{},typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:i,id:a.id})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args."})}}n={...e,tool_calls:r,invalid_tool_calls:s}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=(n==null?void 0:n.tool_call_chunks)??this.tool_call_chunks,this.tool_calls=(n==null?void 0:n.tool_calls)??this.tool_calls,this.invalid_tool_calls=(n==null?void 0:n.invalid_tool_calls)??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const n={content:ja(this.content,e.content),additional_kwargs:xt(this.additional_kwargs,e.additional_kwargs),response_metadata:xt(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=oE(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(n.tool_call_chunks=r)}return new fc(n)}}class hc extends Ro{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return hc}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}}class nm extends La{static lc_name(){return"ChatMessageChunk"}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new nm({content:ja(this.content,e.content),additional_kwargs:xt(this.additional_kwargs,e.additional_kwargs),response_metadata:xt(this.response_metadata,e.response_metadata),role:this.role})}}class rm extends La{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new rm({content:ja(this.content,e.content),additional_kwargs:xt(this.additional_kwargs,e.additional_kwargs),response_metadata:xt(this.response_metadata,e.response_metadata),name:this.name??""})}}class Su extends Ro{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class sm extends La{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new sm({content:ja(this.content,e.content),additional_kwargs:xt(this.additional_kwargs,e.additional_kwargs),response_metadata:xt(this.response_metadata,e.response_metadata)})}}class Vx extends Ro{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class am extends La{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new am({content:ja(this.content,e.content),additional_kwargs:xt(this.additional_kwargs,e.additional_kwargs),response_metadata:xt(this.response_metadata,e.response_metadata)})}}function Oi(t){if(typeof t=="string")return new Su(t);if(zx(t))return t;const[e,n]=t;if(e==="human"||e==="user")return new Su({content:n});if(e==="ai"||e==="assistant")return new lE({content:n});if(e==="system")return new Vx({content:n});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function uE(t,e="Human",n="AI"){const r=[];for(const s of t){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=n;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const i=s.name?`${s.name}, `:"";r.push(`${a}: ${i}${s.content}`)}return r.join(`
`)}const dy="__run";class im{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new im({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class om extends im{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new om({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}var Ad={};const Hx=()=>typeof window<"u"&&typeof window.document<"u",Zx=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",qx=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),cE=()=>typeof Deno<"u",Gx=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!cE(),Wx=()=>{let t;return Hx()?t="browser":Gx()?t="node":Zx()?t="webworker":qx()?t="jsdom":cE()?t="deno":t="other",t};let Od;async function Kx(){return Od===void 0&&(Od={library:"langchain-js",runtime:Wx()}),Od}function Nt(t){try{return typeof process<"u"?Ad==null?void 0:Ad[t]:void 0}catch{return}}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var Jx=typeof window=="object"?window:{},ee="0123456789abcdef".split(""),Qx=[-2147483648,8388608,32768,128],nn=[24,16,8,0],je=[];function _n(t){t?(je[0]=je[16]=je[1]=je[2]=je[3]=je[4]=je[5]=je[6]=je[7]=je[8]=je[9]=je[10]=je[11]=je[12]=je[13]=je[14]=je[15]=0,this.blocks=je):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}_n.prototype.update=function(t){if(!this.finalized){var e=typeof t!="string";e&&t.constructor===Jx.ArrayBuffer&&(t=new Uint8Array(t));for(var n,r=0,s,a=t.length||0,i=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;r<a&&s<64;++r)i[s>>2]|=t[r]<<nn[s++&3];else for(s=this.start;r<a&&s<64;++r)n=t.charCodeAt(r),n<128?i[s>>2]|=n<<nn[s++&3]:n<2048?(i[s>>2]|=(192|n>>6)<<nn[s++&3],i[s>>2]|=(128|n&63)<<nn[s++&3]):n<55296||n>=57344?(i[s>>2]|=(224|n>>12)<<nn[s++&3],i[s>>2]|=(128|n>>6&63)<<nn[s++&3],i[s>>2]|=(128|n&63)<<nn[s++&3]):(n=65536+((n&1023)<<10|t.charCodeAt(++r)&1023),i[s>>2]|=(240|n>>18)<<nn[s++&3],i[s>>2]|=(128|n>>12&63)<<nn[s++&3],i[s>>2]|=(128|n>>6&63)<<nn[s++&3],i[s>>2]|=(128|n&63)<<nn[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};_n.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=Qx[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};_n.prototype.hash=function(){var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4,a,i,o,l=this.blocks;for(i=16;i<80;++i)o=l[i-3]^l[i-8]^l[i-14]^l[i-16],l[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&n|~e&r,o=t<<5|t>>>27,s=o+a+s+1518500249+l[i]<<0,e=e<<30|e>>>2,a=t&e|~t&n,o=s<<5|s>>>27,r=o+a+r+1518500249+l[i+1]<<0,t=t<<30|t>>>2,a=s&t|~s&e,o=r<<5|r>>>27,n=o+a+n+1518500249+l[i+2]<<0,s=s<<30|s>>>2,a=r&s|~r&t,o=n<<5|n>>>27,e=o+a+e+1518500249+l[i+3]<<0,r=r<<30|r>>>2,a=n&r|~n&s,o=e<<5|e>>>27,t=o+a+t+1518500249+l[i+4]<<0,n=n<<30|n>>>2;for(;i<40;i+=5)a=e^n^r,o=t<<5|t>>>27,s=o+a+s+1859775393+l[i]<<0,e=e<<30|e>>>2,a=t^e^n,o=s<<5|s>>>27,r=o+a+r+1859775393+l[i+1]<<0,t=t<<30|t>>>2,a=s^t^e,o=r<<5|r>>>27,n=o+a+n+1859775393+l[i+2]<<0,s=s<<30|s>>>2,a=r^s^t,o=n<<5|n>>>27,e=o+a+e+1859775393+l[i+3]<<0,r=r<<30|r>>>2,a=n^r^s,o=e<<5|e>>>27,t=o+a+t+1859775393+l[i+4]<<0,n=n<<30|n>>>2;for(;i<60;i+=5)a=e&n|e&r|n&r,o=t<<5|t>>>27,s=o+a+s-1894007588+l[i]<<0,e=e<<30|e>>>2,a=t&e|t&n|e&n,o=s<<5|s>>>27,r=o+a+r-1894007588+l[i+1]<<0,t=t<<30|t>>>2,a=s&t|s&e|t&e,o=r<<5|r>>>27,n=o+a+n-1894007588+l[i+2]<<0,s=s<<30|s>>>2,a=r&s|r&t|s&t,o=n<<5|n>>>27,e=o+a+e-1894007588+l[i+3]<<0,r=r<<30|r>>>2,a=n&r|n&s|r&s,o=e<<5|e>>>27,t=o+a+t-1894007588+l[i+4]<<0,n=n<<30|n>>>2;for(;i<80;i+=5)a=e^n^r,o=t<<5|t>>>27,s=o+a+s-899497514+l[i]<<0,e=e<<30|e>>>2,a=t^e^n,o=s<<5|s>>>27,r=o+a+r-899497514+l[i+1]<<0,t=t<<30|t>>>2,a=s^t^e,o=r<<5|r>>>27,n=o+a+n-899497514+l[i+2]<<0,s=s<<30|s>>>2,a=r^s^t,o=n<<5|n>>>27,e=o+a+e-899497514+l[i+3]<<0,r=r<<30|r>>>2,a=n^r^s,o=e<<5|e>>>27,t=o+a+t-899497514+l[i+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};_n.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return ee[t>>28&15]+ee[t>>24&15]+ee[t>>20&15]+ee[t>>16&15]+ee[t>>12&15]+ee[t>>8&15]+ee[t>>4&15]+ee[t&15]+ee[e>>28&15]+ee[e>>24&15]+ee[e>>20&15]+ee[e>>16&15]+ee[e>>12&15]+ee[e>>8&15]+ee[e>>4&15]+ee[e&15]+ee[n>>28&15]+ee[n>>24&15]+ee[n>>20&15]+ee[n>>16&15]+ee[n>>12&15]+ee[n>>8&15]+ee[n>>4&15]+ee[n&15]+ee[r>>28&15]+ee[r>>24&15]+ee[r>>20&15]+ee[r>>16&15]+ee[r>>12&15]+ee[r>>8&15]+ee[r>>4&15]+ee[r&15]+ee[s>>28&15]+ee[s>>24&15]+ee[s>>20&15]+ee[s>>16&15]+ee[s>>12&15]+ee[s>>8&15]+ee[s>>4&15]+ee[s&15]};_n.prototype.toString=_n.prototype.hex;_n.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};_n.prototype.array=_n.prototype.digest;_n.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};const Xx=t=>new _n(!0).update(t).hex(),fy=(...t)=>Xx(t.join("_"));class Yx{}const eA=new Map;class lm extends Yx{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,n){return Promise.resolve(this.cache.get(fy(e,n))??null)}async update(e,n,r){this.cache.set(fy(e,n),r)}static global(){return new lm(eA)}}class dE extends hs{}class fE extends dE{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Su(this.value)]}}class tA extends dE{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return uE(this.messages)}toChatMessages(){return this.messages}}var pc={exports:{}},hE={};function Yt(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var nA=Yt;Yt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Yt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Yt.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0};Yt.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Yt.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};Yt.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};Yt.prototype.start=Yt.prototype.try;Yt.prototype.errors=function(){return this._errors};Yt.prototype.attempts=function(){return this._attempts};Yt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var s=this._errors[r],a=s.message,i=(t[a]||0)+1;t[a]=i,i>=n&&(e=s,n=i)}return e};(function(t){var e=nA;t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in n)r[s]=n[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<r.retries;i++)a.push(this.createTimeout(i,r));return n&&n.forever&&!a.length&&a.push(this.createTimeout(i,r)),a.sort(function(o,l){return o-l}),a},t.createTimeout=function(n,r){var s=r.randomize?Math.random()+1:1,a=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return a=Math.min(a,r.maxTimeout),a},t.wrap=function(n,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var a in n)typeof n[a]=="function"&&s.push(a)}for(var i=0;i<s.length;i++){var o=s[i],l=n[o];n[o]=(function(c){var d=t.operation(r),f=Array.prototype.slice.call(arguments,1),h=f.pop();f.push(function(y){d.retry(y)||(y&&(arguments[0]=d.mainError()),h.apply(this,arguments))}),d.attempt(function(){c.apply(n,f)})}).bind(n,l),n[o].options=r}}})(hE);var rA=hE;const sA=rA,aA=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class pE extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const iA=(t,e,n)=>{const r=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=r,t},oA=t=>aA.includes(t),mE=(t,e)=>new Promise((n,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=sA.operation(e);s.attempt(async a=>{try{n(await t(a))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof pE)s.stop(),r(i.originalError);else if(i instanceof TypeError&&!oA(i.message))s.stop(),r(i);else{iA(i,a,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}s.retry(i)||r(s.mainError())}}})});pc.exports=mE;pc.exports.default=mE;pc.exports.AbortError=pE;var lA=pc.exports;const Pu=ju(lA);var gE={},yE={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new s(c,d||l,f),y=n?n+u:u;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],h]:l._events[y].push(h):(l._events[y]=h,l._eventsCount++),l}function i(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=n?n+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,y=new Array(h);f<h;f++)y[f]=d[f].fn;return y},o.prototype.listenerCount=function(u){var c=n?n+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,h,y){var m=n?n+u:u;if(!this._events[m])return!1;var v=this._events[m],g=arguments.length,p,_;if(v.fn){switch(v.once&&this.removeListener(u,v.fn,void 0,!0),g){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,d),!0;case 4:return v.fn.call(v.context,c,d,f),!0;case 5:return v.fn.call(v.context,c,d,f,h),!0;case 6:return v.fn.call(v.context,c,d,f,h,y),!0}for(_=1,p=new Array(g-1);_<g;_++)p[_-1]=arguments[_];v.fn.apply(v.context,p)}else{var w=v.length,b;for(_=0;_<w;_++)switch(v[_].once&&this.removeListener(u,v[_].fn,void 0,!0),g){case 1:v[_].fn.call(v[_].context);break;case 2:v[_].fn.call(v[_].context,c);break;case 3:v[_].fn.call(v[_].context,c,d);break;case 4:v[_].fn.call(v[_].context,c,d,f);break;default:if(!p)for(b=1,p=new Array(g-1);b<g;b++)p[b-1]=arguments[b];v[_].fn.apply(v[_].context,p)}}return!0},o.prototype.on=function(u,c,d){return a(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return a(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var h=n?n+u:u;if(!this._events[h])return this;if(!c)return i(this,h),this;var y=this._events[h];if(y.fn)y.fn===c&&(!f||y.once)&&(!d||y.context===d)&&i(this,h);else{for(var m=0,v=[],g=y.length;m<g;m++)(y[m].fn!==c||f&&!y[m].once||d&&y[m].context!==d)&&v.push(y[m]);v.length?this._events[h]=v.length===1?v[0]:v:i(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=n?n+u:u,this._events[c]&&i(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o})(yE);var uA=yE.exports,mc={exports:{}},cA=(t,e)=>(e=e||(()=>{}),t.then(n=>new Promise(r=>{r(e())}).then(()=>n),n=>new Promise(r=>{r(e())}).then(()=>{throw n})));const dA=cA;class _E extends Error{constructor(e){super(e),this.name="TimeoutError"}}const vE=(t,e,n)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(t);return}const a=setTimeout(()=>{if(typeof n=="function"){try{r(n())}catch(l){s(l)}return}const i=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,o=n instanceof Error?n:new _E(i);typeof t.cancel=="function"&&t.cancel(),s(o)},e);dA(t.then(r,s),()=>{clearTimeout(a)})});mc.exports=vE;mc.exports.default=vE;mc.exports.TimeoutError=_E;var fA=mc.exports,um={},cm={};Object.defineProperty(cm,"__esModule",{value:!0});function hA(t,e,n){let r=0,s=t.length;for(;s>0;){const a=s/2|0;let i=r+a;n(t[i],e)<=0?(r=++i,s-=a+1):s=a}return r}cm.default=hA;Object.defineProperty(um,"__esModule",{value:!0});const pA=cm;class mA{constructor(){this._queue=[]}enqueue(e,n){n=Object.assign({priority:0},n);const r={priority:n.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(r);return}const s=pA.default(this._queue,r,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(n=>n.priority===e.priority).map(n=>n.run)}get size(){return this._queue.length}}um.default=mA;Object.defineProperty(gE,"__esModule",{value:!0});const gA=uA,wE=fA,yA=um,hl=()=>{},_A=new wE.TimeoutError;class vA extends gA{constructor(e){var n,r,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=hl,this._resolveIdle=hl,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:yA.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(n=e.intervalCap)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=hl,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=hl,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const n=this._queue.dequeue();return n?(this.emit("active"),n(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((r,s)=>{const a=async()=>{this._pendingCount++,this._intervalCount++;try{const i=this._timeout===void 0&&n.timeout===void 0?e():wE.default(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&s(_A)});r(await i)}catch(i){s(i)}this._next()};this._queue.enqueue(a,n),this._tryToStartAnother(),this.emit("add")})}async addAll(e,n){return Promise.all(e.map(async r=>this.add(r,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var Wn=gE.default=vA;const wA=[400,401,402,403,404,405,406,407,409],bA=t=>{var n,r;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((n=t==null?void 0:t.response)==null?void 0:n.status)??(t==null?void 0:t.status);if(e&&wA.includes(+e))throw t;if(((r=t==null?void 0:t.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(t==null?void 0:t.message);throw s.name="InsufficientQuotaError",s}};let dm=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??bA;const n="default"in Wn?Wn.default:Wn;this.queue=new n({concurrency:this.maxConcurrency})}call(e,...n){return this.queue.add(()=>Pu(()=>e(...n).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>fetch(...e).then(n=>n.ok?n:Promise.reject(n)))}};var gc={};gc.byteLength=PA;gc.toByteArray=xA;gc.fromByteArray=CA;var Rn=[],Vt=[],EA=typeof Uint8Array<"u"?Uint8Array:Array,Cd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ss=0,SA=Cd.length;Ss<SA;++Ss)Rn[Ss]=Cd[Ss],Vt[Cd.charCodeAt(Ss)]=Ss;Vt[45]=62;Vt[95]=63;function bE(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function PA(t){var e=bE(t),n=e[0],r=e[1];return(n+r)*3/4-r}function kA(t,e,n){return(e+n)*3/4-n}function xA(t){var e,n=bE(t),r=n[0],s=n[1],a=new EA(kA(t,r,s)),i=0,o=s>0?r-4:r,l;for(l=0;l<o;l+=4)e=Vt[t.charCodeAt(l)]<<18|Vt[t.charCodeAt(l+1)]<<12|Vt[t.charCodeAt(l+2)]<<6|Vt[t.charCodeAt(l+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=Vt[t.charCodeAt(l)]<<2|Vt[t.charCodeAt(l+1)]>>4,a[i++]=e&255),s===1&&(e=Vt[t.charCodeAt(l)]<<10|Vt[t.charCodeAt(l+1)]<<4|Vt[t.charCodeAt(l+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function AA(t){return Rn[t>>18&63]+Rn[t>>12&63]+Rn[t>>6&63]+Rn[t&63]}function OA(t,e,n){for(var r,s=[],a=e;a<n;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(t[a+2]&255),s.push(AA(r));return s.join("")}function CA(t){for(var e,n=t.length,r=n%3,s=[],a=16383,i=0,o=n-r;i<o;i+=a)s.push(OA(t,i,i+a>o?o:i+a));return r===1?(e=t[n-1],s.push(Rn[e>>2]+Rn[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],s.push(Rn[e>>10]+Rn[e>>4&63]+Rn[e<<2&63]+"=")),s.join("")}var TA=Object.defineProperty,RA=(t,e,n)=>e in t?TA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,IA=(t,e,n)=>(RA(t,e+"",n),n);function NA(t,e){let n=Array.from({length:t.length},(r,s)=>({start:s,end:s+1}));for(;n.length>1;){let r=null;for(let s=0;s<n.length-1;s++){const a=t.slice(n[s].start,n[s+1].end),i=e.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){const s=r[1];n[s]={start:n[s].start,end:n[s+1].end},n.splice(s+1,1)}else break}return n}function $A(t,e){return t.length===1?[e.get(t.join(","))]:NA(t,e).map(n=>e.get(t.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function jA(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var lh=class{constructor(t,e){en(this,"specialTokens");en(this,"inverseSpecialTokens");en(this,"patStr");en(this,"textEncoder",new TextEncoder);en(this,"textDecoder",new TextDecoder("utf-8"));en(this,"rankMap",new Map);en(this,"textMap",new Map);this.patStr=t.pat_str;const n=t.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[a,i,...o]=s.split(" "),l=Number.parseInt(i,10);return o.forEach((u,c)=>r[u]=l+c),r},{});for(const[r,s]of Object.entries(n)){const a=gc.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(t,e=[],n="all"){const r=new RegExp(this.patStr,"ug"),s=lh.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(n==="all"?Object.keys(this.specialTokens).filter(u=>!i.has(u)):n);if(o.size>0){const u=lh.specialTokenRegex([...o]),c=t.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;s.lastIndex=c,u=s.exec(t),!(u==null||i.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??t.length;for(const h of t.substring(l,d).matchAll(r)){const y=this.textEncoder.encode(h[0]),m=this.rankMap.get(y.join(","));if(m!=null){a.push(m);continue}a.push(...$A(y,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];a.push(f),l=u.index+u[0].length}return a}decode(t){const e=[];let n=0;for(let a=0;a<t.length;++a){const i=t[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),n+=o.length)}const r=new Uint8Array(n);let s=0;for(const a of e)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},EE=lh;IA(EE,"specialTokenRegex",t=>new RegExp(t.map(e=>jA(e)).join("|"),"g"));function LA(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const pl={},DA=new dm({});async function MA(t){return t in pl||(pl[t]=DA.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new EE(e)).catch(e=>{throw delete pl[t],e})),await pl[t]}async function FA(t){return MA(LA(t))}let ml;const UA=new Uint8Array(16);function zA(){if(!ml&&(ml=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ml))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ml(UA)}const BA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function VA(t){return typeof t=="string"&&BA.test(t)}const Ue=[];for(let t=0;t<256;++t)Ue.push((t+256).toString(16).slice(1));function HA(t,e=0){return Ue[t[e+0]]+Ue[t[e+1]]+Ue[t[e+2]]+Ue[t[e+3]]+"-"+Ue[t[e+4]]+Ue[t[e+5]]+"-"+Ue[t[e+6]]+Ue[t[e+7]]+"-"+Ue[t[e+8]]+Ue[t[e+9]]+"-"+Ue[t[e+10]]+Ue[t[e+11]]+Ue[t[e+12]]+Ue[t[e+13]]+Ue[t[e+14]]+Ue[t[e+15]]}const ZA=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),hy={randomUUID:ZA};function mr(t,e,n){if(hy.randomUUID&&!t)return hy.randomUUID();t=t||{};const r=t.random||(t.rng||zA)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,HA(r)}class qA{}class Io extends qA{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,iE(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Nt("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return hs.prototype.toJSON.call(this)}toJSONNotImplemented(){return hs.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class n extends Io{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:mr()}),Object.assign(this,e)}}return new n}}var fm={exports:{}};fm.exports;(function(t){const n=(a=0)=>i=>`\x1B[${38+a};5;${i}m`,r=(a=0)=>(i,o,l)=>`\x1B[${38+a};2;${i};${o};${l}m`;function s(){const a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright;for(const[o,l]of Object.entries(i)){for(const[u,c]of Object.entries(l))i[u]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},l[u]=i[u],a.set(c[0],c[1]);Object.defineProperty(i,o,{value:l,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1B[39m",i.bgColor.close="\x1B[49m",i.color.ansi256=n(),i.color.ansi16m=r(),i.bgColor.ansi256=n(10),i.bgColor.ansi16m=r(10),Object.defineProperties(i,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const c=Number.parseInt(u,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>i.rgbToAnsi256(...i.hexToRgb(o)),enumerable:!1}}),i}Object.defineProperty(t,"exports",{enumerable:!0,get:s})})(fm);var GA=fm.exports;const SE=ju(GA);function Td(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function WA(t){return t.replace(/[-:.]/g,"")}function KA(t,e,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return WA(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}class yc extends Io{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,n){e.child_runs.push(n)}async _startTrace(e){var s;const n=KA(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const a=this.runMap.get(r.parent_run_id);a&&(this._addChildRun(a,r),a.child_execution_order=Math.max(a.child_execution_order,r.child_execution_order),r.trace_id=a.trace_id,a.dotted_order!==void 0&&(r.dotted_order=[a.dotted_order,n].join(".")))}else r.trace_id=r.id,r.dotted_order=n;this.runMap.set(r.id,r),await((s=this.onRunCreate)==null?void 0:s.call(this,r))}async _endTrace(e){var r;const n=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);n?n.child_execution_order=Math.max(n.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const n=e!==void 0&&this.runMap.get(e);return n?n.child_execution_order+1:1}async handleLLMStart(e,n,r,s,a,i,o,l){var h;const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:n},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleChatModelStart(e,n,r,s,a,i,o,l){var h;const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...a,metadata:o}:a,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:n},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:i||[]};return await this._startTrace(f),await((h=this.onLLMStart)==null?void 0:h.call(this,f)),f}async handleLLMEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleLLMError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleChainStart(e,n,r,s,a,i,o,l){var f;const u=this._getExecutionOrder(s),c=Date.now(),d={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:n,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return await this._startTrace(d),await((f=this.onChainStart)==null?void 0:f.call(this,d)),d}async handleChainEnd(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=Td(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=Td(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleChainError(e,n,r,s,a){var o;const i=this.runMap.get(n);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(i.inputs=Td(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,i)),await this._endTrace(i),i}async handleToolStart(e,n,r,s,a,i,o){var d;const l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:n},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return await this._startTrace(c),await((d=this.onToolStart)==null?void 0:d.call(this,c)),c}async handleToolEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,n){var a;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,r))}async handleAgentEnd(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}async handleRetrieverStart(e,n,r,s,a,i,o){var d;const l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:n},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return await this._startTrace(c),await((d=this.onRetrieverStart)==null?void 0:d.call(this,c)),c}async handleRetrieverEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,n,r,s,a,i){var l;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:n,chunk:i==null?void 0:i.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:i==null?void 0:i.chunk})),o}}function it(t,e){return`${t.open}${e}${t.close}`}function rn(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function ur(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:mt}=SE;class py extends yc{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const n=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)n.push(s),r=s;else break}return n}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,a,i)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?it(SE.bold,o):o}).join(" > ");return it(mt.grey,r)}onChainStart(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.green,"[chain/start]")} [${n}] Entering Chain run with input: ${rn(e.inputs,"[inputs]")}`)}onChainEnd(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.cyan,"[chain/end]")} [${n}] [${ur(e)}] Exiting Chain run with output: ${rn(e.outputs,"[outputs]")}`)}onChainError(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.red,"[chain/error]")} [${n}] [${ur(e)}] Chain run errored with error: ${rn(e.error,"[error]")}`)}onLLMStart(e){const n=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${it(mt.green,"[llm/start]")} [${n}] Entering LLM run with input: ${rn(r,"[inputs]")}`)}onLLMEnd(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.cyan,"[llm/end]")} [${n}] [${ur(e)}] Exiting LLM run with output: ${rn(e.outputs,"[response]")}`)}onLLMError(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.red,"[llm/error]")} [${n}] [${ur(e)}] LLM run errored with error: ${rn(e.error,"[error]")}`)}onToolStart(e){var r;const n=this.getBreadcrumbs(e);console.log(`${it(mt.green,"[tool/start]")} [${n}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,s;const n=this.getBreadcrumbs(e);console.log(`${it(mt.cyan,"[tool/end]")} [${n}] [${ur(e)}] Exiting Tool run with output: "${(s=(r=e.outputs)==null?void 0:r.output)==null?void 0:s.trim()}"`)}onToolError(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.red,"[tool/error]")} [${n}] [${ur(e)}] Tool run errored with error: ${rn(e.error,"[error]")}`)}onRetrieverStart(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.green,"[retriever/start]")} [${n}] Entering Retriever run with input: ${rn(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.cyan,"[retriever/end]")} [${n}] [${ur(e)}] Exiting Retriever run with output: ${rn(e.outputs,"[outputs]")}`)}onRetrieverError(e){const n=this.getBreadcrumbs(e);console.log(`${it(mt.red,"[retriever/error]")} [${n}] [${ur(e)}] Retriever run errored with error: ${rn(e.error,"[error]")}`)}onAgentAction(e){const n=e,r=this.getBreadcrumbs(e);console.log(`${it(mt.blue,"[agent/action]")} [${r}] Agent selected action: ${rn(n.actions[n.actions.length-1],"[action]")}`)}}const JA=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function QA(t){return typeof t=="string"&&JA.test(t)}var ze=[];for(var Rd=0;Rd<256;++Rd)ze.push((Rd+256).toString(16).slice(1));function XA(t,e=0){return(ze[t[e+0]]+ze[t[e+1]]+ze[t[e+2]]+ze[t[e+3]]+"-"+ze[t[e+4]]+ze[t[e+5]]+"-"+ze[t[e+6]]+ze[t[e+7]]+"-"+ze[t[e+8]]+ze[t[e+9]]+"-"+ze[t[e+10]]+ze[t[e+11]]+ze[t[e+12]]+ze[t[e+13]]+ze[t[e+14]]+ze[t[e+15]]).toLowerCase()}var gl,YA=new Uint8Array(16);function eO(){if(!gl&&(gl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!gl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return gl(YA)}var tO=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const my={randomUUID:tO};function Id(t,e,n){if(my.randomUUID&&!t)return my.randomUUID();t=t||{};var r=t.random||(t.rng||eO)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,XA(r)}const nO=(...t)=>fetch(...t),rO=Symbol.for("ls:fetch_implementation"),H=()=>globalThis[rO]??nO,sO=[400,401,403,404,405,406,407,408],aO=[409];class gy{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Wn?this.queue=new Wn.default({concurrency:this.maxConcurrency}):this.queue=new Wn({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...n){const r=this.onFailedResponseHook;return this.queue.add(()=>Pu(()=>e(...n).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const a=s==null?void 0:s.response,i=a==null?void 0:a.status;if(i){if(sO.includes(+i))throw s;if(aO.includes(+i))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,a)=>{var i;(i=e.signal)==null||i.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>H()(...e).then(n=>n.ok?n:Promise.reject(n)))}}function yy(t){return typeof(t==null?void 0:t._getType)=="function"}function _y(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}var zi={};let Fn;const iO=()=>typeof window<"u"&&typeof window.document<"u",oO=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",lO=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),PE=()=>typeof Deno<"u",uO=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!PE(),cO=()=>Fn||(iO()?Fn="browser":uO()?Fn="node":oO()?Fn="webworker":lO()?Fn="jsdom":PE()?Fn="deno":Fn="other",Fn);let Nd;function dO(){if(Nd===void 0){const t=cO(),e=pO();Nd={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:IE,...e}}return Nd}function fO(){const t=hO()||{},e={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,s]of Object.entries(t))r.startsWith("LANGCHAIN_")&&typeof s=="string"&&!n.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function hO(){try{return typeof process<"u"&&zi?Object.entries(zi).reduce((t,[e,n])=>(t[e]=String(n),t),{}):void 0}catch{return}}function uh(t){try{return typeof process<"u"?zi==null?void 0:zi[t]:void 0}catch{return}}function Cs(t){return uh(`LANGSMITH_${t}`)||uh(`LANGCHAIN_${t}`)}let $d;function pO(){if($d!==void 0)return $d;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const n of t){const r=uh(n);r!==void 0&&(e[n]=r)}return $d=e,e}function se(t,e){if(!QA(t)){const n=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(n)}return t}const vy={};function mO(t){vy[t]||(console.warn(t),vy[t]=!0)}var ch={exports:{}};const gO="2.0.0",kE=256,yO=Number.MAX_SAFE_INTEGER||9007199254740991,_O=16,vO=kE-6,wO=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var _c={MAX_LENGTH:kE,MAX_SAFE_COMPONENT_LENGTH:_O,MAX_SAFE_BUILD_LENGTH:vO,MAX_SAFE_INTEGER:yO,RELEASE_TYPES:wO,SEMVER_SPEC_VERSION:gO,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},jd={};const bO=typeof process=="object"&&jd&&jd.NODE_DEBUG&&/\bsemver\b/i.test(jd.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var vc=bO;(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=_c,a=vc;e=t.exports={};const i=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],c=e.t={};let d=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",s],[f,r]],y=v=>{for(const[g,p]of h)v=v.split(`${g}*`).join(`${g}{0,${p}}`).split(`${g}+`).join(`${g}{1,${p}}`);return v},m=(v,g,p)=>{const _=y(g),w=d++;a(v,w,g),c[v]=w,l[w]=g,u[w]=_,i[w]=new RegExp(g,p?"g":void 0),o[w]=new RegExp(_,p?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[c.NUMERICIDENTIFIER]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NUMERICIDENTIFIERLOOSE]}|${l[c.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),m("FULL",`^${l[c.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),m("LOOSE",`^${l[c.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),m("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[c.COERCE],!0),m("COERCERTLFULL",l[c.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(ch,ch.exports);var No=ch.exports;const EO=Object.freeze({loose:!0}),SO=Object.freeze({}),PO=t=>t?typeof t!="object"?EO:t:SO;var hm=PO;const wy=/^[0-9]+$/,xE=(t,e)=>{const n=wy.test(t),r=wy.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1},kO=(t,e)=>xE(e,t);var AE={compareIdentifiers:xE,rcompareIdentifiers:kO};const yl=vc,{MAX_LENGTH:by,MAX_SAFE_INTEGER:_l}=_c,{safeRe:Ey,safeSrc:Sy,t:vl}=No,xO=hm,{compareIdentifiers:Ps}=AE;let AO=class kn{constructor(e,n){if(n=xO(n),e instanceof kn){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>by)throw new TypeError(`version is longer than ${by} characters`);yl("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=e.trim().match(n.loose?Ey[vl.LOOSE]:Ey[vl.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>_l||this.major<0)throw new TypeError("Invalid major version");if(this.minor>_l||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>_l||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const a=+s;if(a>=0&&a<_l)return a}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(yl("SemVer.compare",this.version,this.options,e),!(e instanceof kn)){if(typeof e=="string"&&e===this.version)return 0;e=new kn(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof kn||(e=new kn(e,this.options)),Ps(this.major,e.major)||Ps(this.minor,e.minor)||Ps(this.patch,e.patch)}comparePre(e){if(e instanceof kn||(e=new kn(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{const r=this.prerelease[n],s=e.prerelease[n];if(yl("prerelease compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Ps(r,s)}while(++n)}compareBuild(e){e instanceof kn||(e=new kn(e,this.options));let n=0;do{const r=this.build[n],s=e.build[n];if(yl("build compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Ps(r,s)}while(++n)}inc(e,n,r){if(e.startsWith("pre")){if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(n){const s=new RegExp(`^${this.options.loose?Sy[vl.PRERELEASELOOSE]:Sy[vl.PRERELEASE]}$`),a=`-${n}`.match(s);if(!a||a[1]!==n)throw new Error(`invalid identifier: ${n}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(n){let a=[n,s];r===!1&&(a=[n]),Ps(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var ht=AO;const Py=ht,OO=(t,e,n=!1)=>{if(t instanceof Py)return t;try{return new Py(t,e)}catch(r){if(!n)return null;throw r}};var Da=OO;const CO=Da,TO=(t,e)=>{const n=CO(t,e);return n?n.version:null};var RO=TO;const IO=Da,NO=(t,e)=>{const n=IO(t.trim().replace(/^[=v]+/,""),e);return n?n.version:null};var $O=NO;const ky=ht,jO=(t,e,n,r,s)=>{typeof n=="string"&&(s=r,r=n,n=void 0);try{return new ky(t instanceof ky?t.version:t,n).inc(e,r,s).version}catch{return null}};var LO=jO;const xy=Da,DO=(t,e)=>{const n=xy(t,null,!0),r=xy(e,null,!0),s=n.compare(r);if(s===0)return null;const a=s>0,i=a?n:r,o=a?r:n,l=!!i.prerelease.length;if(!!o.prerelease.length&&!l){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}const c=l?"pre":"";return n.major!==r.major?c+"major":n.minor!==r.minor?c+"minor":n.patch!==r.patch?c+"patch":"prerelease"};var MO=DO;const FO=ht,UO=(t,e)=>new FO(t,e).major;var zO=UO;const BO=ht,VO=(t,e)=>new BO(t,e).minor;var HO=VO;const ZO=ht,qO=(t,e)=>new ZO(t,e).patch;var GO=qO;const WO=Da,KO=(t,e)=>{const n=WO(t,e);return n&&n.prerelease.length?n.prerelease:null};var JO=KO;const Ay=ht,QO=(t,e,n)=>new Ay(t,n).compare(new Ay(e,n));var vn=QO;const XO=vn,YO=(t,e,n)=>XO(e,t,n);var eC=YO;const tC=vn,nC=(t,e)=>tC(t,e,!0);var rC=nC;const Oy=ht,sC=(t,e,n)=>{const r=new Oy(t,n),s=new Oy(e,n);return r.compare(s)||r.compareBuild(s)};var pm=sC;const aC=pm,iC=(t,e)=>t.sort((n,r)=>aC(n,r,e));var oC=iC;const lC=pm,uC=(t,e)=>t.sort((n,r)=>lC(r,n,e));var cC=uC;const dC=vn,fC=(t,e,n)=>dC(t,e,n)>0;var wc=fC;const hC=vn,pC=(t,e,n)=>hC(t,e,n)<0;var mm=pC;const mC=vn,gC=(t,e,n)=>mC(t,e,n)===0;var OE=gC;const yC=vn,_C=(t,e,n)=>yC(t,e,n)!==0;var CE=_C;const vC=vn,wC=(t,e,n)=>vC(t,e,n)>=0;var gm=wC;const bC=vn,EC=(t,e,n)=>bC(t,e,n)<=0;var ym=EC;const SC=OE,PC=CE,kC=wc,xC=gm,AC=mm,OC=ym,CC=(t,e,n,r)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return SC(t,n,r);case"!=":return PC(t,n,r);case">":return kC(t,n,r);case">=":return xC(t,n,r);case"<":return AC(t,n,r);case"<=":return OC(t,n,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var TE=CC;const TC=ht,RC=Da,{safeRe:wl,t:bl}=No,IC=(t,e)=>{if(t instanceof TC)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let n=null;if(!e.rtl)n=t.match(e.includePrerelease?wl[bl.COERCEFULL]:wl[bl.COERCE]);else{const l=e.includePrerelease?wl[bl.COERCERTLFULL]:wl[bl.COERCERTL];let u;for(;(u=l.exec(t))&&(!n||n.index+n[0].length!==t.length);)(!n||u.index+u[0].length!==n.index+n[0].length)&&(n=u),l.lastIndex=u.index+u[1].length+u[2].length;l.lastIndex=-1}if(n===null)return null;const r=n[2],s=n[3]||"0",a=n[4]||"0",i=e.includePrerelease&&n[5]?`-${n[5]}`:"",o=e.includePrerelease&&n[6]?`+${n[6]}`:"";return RC(`${r}.${s}.${a}${i}${o}`,e)};var NC=IC;class $C{constructor(){this.max=1e3,this.map=new Map}get(e){const n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(e,n)}return this}}var jC=$C,Ld,Cy;function wn(){if(Cy)return Ld;Cy=1;const t=/\s+/g;class e{constructor(N,V){if(V=s(V),N instanceof e)return N.loose===!!V.loose&&N.includePrerelease===!!V.includePrerelease?N:new e(N.raw,V);if(N instanceof a)return this.raw=N.value,this.set=[[N]],this.formatted=void 0,this;if(this.options=V,this.loose=!!V.loose,this.includePrerelease=!!V.includePrerelease,this.raw=N.trim().replace(t," "),this.set=this.raw.split("||").map(z=>this.parseRange(z.trim())).filter(z=>z.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const z=this.set[0];if(this.set=this.set.filter(x=>!m(x[0])),this.set.length===0)this.set=[z];else if(this.set.length>1){for(const x of this.set)if(x.length===1&&v(x[0])){this.set=[x];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let N=0;N<this.set.length;N++){N>0&&(this.formatted+="||");const V=this.set[N];for(let z=0;z<V.length;z++)z>0&&(this.formatted+=" "),this.formatted+=V[z].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(N){const z=((this.options.includePrerelease&&h)|(this.options.loose&&y))+":"+N,x=r.get(z);if(x)return x;const E=this.options.loose,A=E?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];N=N.replace(A,Qe(this.options.includePrerelease)),i("hyphen replace",N),N=N.replace(l[u.COMPARATORTRIM],c),i("comparator trim",N),N=N.replace(l[u.TILDETRIM],d),i("tilde trim",N),N=N.replace(l[u.CARETTRIM],f),i("caret trim",N);let I=N.split(" ").map(ge=>p(ge,this.options)).join(" ").split(/\s+/).map(ge=>K(ge,this.options));E&&(I=I.filter(ge=>(i("loose invalid filter",ge,this.options),!!ge.match(l[u.COMPARATORLOOSE])))),i("range list",I);const F=new Map,ie=I.map(ge=>new a(ge,this.options));for(const ge of ie){if(m(ge))return[ge];F.set(ge.value,ge)}F.size>1&&F.has("")&&F.delete("");const ve=[...F.values()];return r.set(z,ve),ve}intersects(N,V){if(!(N instanceof e))throw new TypeError("a Range is required");return this.set.some(z=>g(z,V)&&N.set.some(x=>g(x,V)&&z.every(E=>x.every(A=>E.intersects(A,V)))))}test(N){if(!N)return!1;if(typeof N=="string")try{N=new o(N,this.options)}catch{return!1}for(let V=0;V<this.set.length;V++)if(At(this.set[V],N,this.options))return!0;return!1}}Ld=e;const n=jC,r=new n,s=hm,a=bc(),i=vc,o=ht,{safeRe:l,t:u,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:f}=No,{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:y}=_c,m=j=>j.value==="<0.0.0-0",v=j=>j.value==="",g=(j,N)=>{let V=!0;const z=j.slice();let x=z.pop();for(;V&&z.length;)V=z.every(E=>x.intersects(E,N)),x=z.pop();return V},p=(j,N)=>(i("comp",j,N),j=P(j,N),i("caret",j),j=w(j,N),i("tildes",j),j=R(j,N),i("xrange",j),j=M(j,N),i("stars",j),j),_=j=>!j||j.toLowerCase()==="x"||j==="*",w=(j,N)=>j.trim().split(/\s+/).map(V=>b(V,N)).join(" "),b=(j,N)=>{const V=N.loose?l[u.TILDELOOSE]:l[u.TILDE];return j.replace(V,(z,x,E,A,I)=>{i("tilde",j,z,x,E,A,I);let F;return _(x)?F="":_(E)?F=`>=${x}.0.0 <${+x+1}.0.0-0`:_(A)?F=`>=${x}.${E}.0 <${x}.${+E+1}.0-0`:I?(i("replaceTilde pr",I),F=`>=${x}.${E}.${A}-${I} <${x}.${+E+1}.0-0`):F=`>=${x}.${E}.${A} <${x}.${+E+1}.0-0`,i("tilde return",F),F})},P=(j,N)=>j.trim().split(/\s+/).map(V=>k(V,N)).join(" "),k=(j,N)=>{i("caret",j,N);const V=N.loose?l[u.CARETLOOSE]:l[u.CARET],z=N.includePrerelease?"-0":"";return j.replace(V,(x,E,A,I,F)=>{i("caret",j,x,E,A,I,F);let ie;return _(E)?ie="":_(A)?ie=`>=${E}.0.0${z} <${+E+1}.0.0-0`:_(I)?E==="0"?ie=`>=${E}.${A}.0${z} <${E}.${+A+1}.0-0`:ie=`>=${E}.${A}.0${z} <${+E+1}.0.0-0`:F?(i("replaceCaret pr",F),E==="0"?A==="0"?ie=`>=${E}.${A}.${I}-${F} <${E}.${A}.${+I+1}-0`:ie=`>=${E}.${A}.${I}-${F} <${E}.${+A+1}.0-0`:ie=`>=${E}.${A}.${I}-${F} <${+E+1}.0.0-0`):(i("no pr"),E==="0"?A==="0"?ie=`>=${E}.${A}.${I}${z} <${E}.${A}.${+I+1}-0`:ie=`>=${E}.${A}.${I}${z} <${E}.${+A+1}.0-0`:ie=`>=${E}.${A}.${I} <${+E+1}.0.0-0`),i("caret return",ie),ie})},R=(j,N)=>(i("replaceXRanges",j,N),j.split(/\s+/).map(V=>Z(V,N)).join(" ")),Z=(j,N)=>{j=j.trim();const V=N.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return j.replace(V,(z,x,E,A,I,F)=>{i("xRange",j,z,x,E,A,I,F);const ie=_(E),ve=ie||_(A),ge=ve||_(I),Ot=ge;return x==="="&&Ot&&(x=""),F=N.includePrerelease?"-0":"",ie?x===">"||x==="<"?z="<0.0.0-0":z="*":x&&Ot?(ve&&(A=0),I=0,x===">"?(x=">=",ve?(E=+E+1,A=0,I=0):(A=+A+1,I=0)):x==="<="&&(x="<",ve?E=+E+1:A=+A+1),x==="<"&&(F="-0"),z=`${x+E}.${A}.${I}${F}`):ve?z=`>=${E}.0.0${F} <${+E+1}.0.0-0`:ge&&(z=`>=${E}.${A}.0${F} <${E}.${+A+1}.0-0`),i("xRange return",z),z})},M=(j,N)=>(i("replaceStars",j,N),j.trim().replace(l[u.STAR],"")),K=(j,N)=>(i("replaceGTE0",j,N),j.trim().replace(l[N.includePrerelease?u.GTE0PRE:u.GTE0],"")),Qe=j=>(N,V,z,x,E,A,I,F,ie,ve,ge,Ot)=>(_(z)?V="":_(x)?V=`>=${z}.0.0${j?"-0":""}`:_(E)?V=`>=${z}.${x}.0${j?"-0":""}`:A?V=`>=${V}`:V=`>=${V}${j?"-0":""}`,_(ie)?F="":_(ve)?F=`<${+ie+1}.0.0-0`:_(ge)?F=`<${ie}.${+ve+1}.0-0`:Ot?F=`<=${ie}.${ve}.${ge}-${Ot}`:j?F=`<${ie}.${ve}.${+ge+1}-0`:F=`<=${F}`,`${V} ${F}`.trim()),At=(j,N,V)=>{for(let z=0;z<j.length;z++)if(!j[z].test(N))return!1;if(N.prerelease.length&&!V.includePrerelease){for(let z=0;z<j.length;z++)if(i(j[z].semver),j[z].semver!==a.ANY&&j[z].semver.prerelease.length>0){const x=j[z].semver;if(x.major===N.major&&x.minor===N.minor&&x.patch===N.patch)return!0}return!1}return!0};return Ld}var Dd,Ty;function bc(){if(Ty)return Dd;Ty=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(c,d){if(d=n(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),i("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===t?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}parse(c){const d=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],f=c.match(d);if(!f)throw new TypeError(`Invalid comparator: ${c}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=t}toString(){return this.value}test(c){if(i("Comparator.test",c,this.options.loose),this.semver===t||c===t)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return a(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new l(this.value,d).test(c.semver):(d=n(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||a(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||a(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}Dd=e;const n=hm,{safeRe:r,t:s}=No,a=TE,i=vc,o=ht,l=wn();return Dd}const LC=wn(),DC=(t,e,n)=>{try{e=new LC(e,n)}catch{return!1}return e.test(t)};var Ec=DC;const MC=wn(),FC=(t,e)=>new MC(t,e).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));var UC=FC;const zC=ht,BC=wn(),VC=(t,e,n)=>{let r=null,s=null,a=null;try{a=new BC(e,n)}catch{return null}return t.forEach(i=>{a.test(i)&&(!r||s.compare(i)===-1)&&(r=i,s=new zC(r,n))}),r};var HC=VC;const ZC=ht,qC=wn(),GC=(t,e,n)=>{let r=null,s=null,a=null;try{a=new qC(e,n)}catch{return null}return t.forEach(i=>{a.test(i)&&(!r||s.compare(i)===1)&&(r=i,s=new ZC(r,n))}),r};var WC=GC;const Md=ht,KC=wn(),Ry=wc,JC=(t,e)=>{t=new KC(t,e);let n=new Md("0.0.0");if(t.test(n)||(n=new Md("0.0.0-0"),t.test(n)))return n;n=null;for(let r=0;r<t.set.length;++r){const s=t.set[r];let a=null;s.forEach(i=>{const o=new Md(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||Ry(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),a&&(!n||Ry(n,a))&&(n=a)}return n&&t.test(n)?n:null};var QC=JC;const XC=wn(),YC=(t,e)=>{try{return new XC(t,e).range||"*"}catch{return null}};var eT=YC;const tT=ht,RE=bc(),{ANY:nT}=RE,rT=wn(),sT=Ec,Iy=wc,Ny=mm,aT=ym,iT=gm,oT=(t,e,n,r)=>{t=new tT(t,r),e=new rT(e,r);let s,a,i,o,l;switch(n){case">":s=Iy,a=aT,i=Ny,o=">",l=">=";break;case"<":s=Ny,a=iT,i=Iy,o="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(sT(t,e,r))return!1;for(let u=0;u<e.set.length;++u){const c=e.set[u];let d=null,f=null;if(c.forEach(h=>{h.semver===nT&&(h=new RE(">=0.0.0")),d=d||h,f=f||h,s(h.semver,d.semver,r)?d=h:i(h.semver,f.semver,r)&&(f=h)}),d.operator===o||d.operator===l||(!f.operator||f.operator===o)&&a(t,f.semver))return!1;if(f.operator===l&&i(t,f.semver))return!1}return!0};var _m=oT;const lT=_m,uT=(t,e,n)=>lT(t,e,">",n);var cT=uT;const dT=_m,fT=(t,e,n)=>dT(t,e,"<",n);var hT=fT;const $y=wn(),pT=(t,e,n)=>(t=new $y(t,n),e=new $y(e,n),t.intersects(e,n));var mT=pT;const gT=Ec,yT=vn;var _T=(t,e,n)=>{const r=[];let s=null,a=null;const i=t.sort((c,d)=>yT(c,d,n));for(const c of i)gT(c,e,n)?(a=c,s||(s=c)):(a&&r.push([s,a]),a=null,s=null);s&&r.push([s,null]);const o=[];for(const[c,d]of r)c===d?o.push(c):!d&&c===i[0]?o.push("*"):d?c===i[0]?o.push(`<=${d}`):o.push(`${c} - ${d}`):o.push(`>=${c}`);const l=o.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return l.length<u.length?l:e};const jy=wn(),vm=bc(),{ANY:Fd}=vm,Ja=Ec,wm=vn,vT=(t,e,n={})=>{if(t===e)return!0;t=new jy(t,n),e=new jy(e,n);let r=!1;e:for(const s of t.set){for(const a of e.set){const i=bT(s,a,n);if(r=r||i!==null,i)continue e}if(r)return!1}return!0},wT=[new vm(">=0.0.0-0")],Ly=[new vm(">=0.0.0")],bT=(t,e,n)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===Fd){if(e.length===1&&e[0].semver===Fd)return!0;n.includePrerelease?t=wT:t=Ly}if(e.length===1&&e[0].semver===Fd){if(n.includePrerelease)return!0;e=Ly}const r=new Set;let s,a;for(const h of t)h.operator===">"||h.operator===">="?s=Dy(s,h,n):h.operator==="<"||h.operator==="<="?a=My(a,h,n):r.add(h.semver);if(r.size>1)return null;let i;if(s&&a){if(i=wm(s.semver,a.semver,n),i>0)return null;if(i===0&&(s.operator!==">="||a.operator!=="<="))return null}for(const h of r){if(s&&!Ja(h,String(s),n)||a&&!Ja(h,String(a),n))return null;for(const y of e)if(!Ja(h,String(y),n))return!1;return!0}let o,l,u,c,d=a&&!n.includePrerelease&&a.semver.prerelease.length?a.semver:!1,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(const h of e){if(c=c||h.operator===">"||h.operator===">=",u=u||h.operator==="<"||h.operator==="<=",s){if(f&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===f.major&&h.semver.minor===f.minor&&h.semver.patch===f.patch&&(f=!1),h.operator===">"||h.operator===">="){if(o=Dy(s,h,n),o===h&&o!==s)return!1}else if(s.operator===">="&&!Ja(s.semver,String(h),n))return!1}if(a){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator==="<"||h.operator==="<="){if(l=My(a,h,n),l===h&&l!==a)return!1}else if(a.operator==="<="&&!Ja(a.semver,String(h),n))return!1}if(!h.operator&&(a||s)&&i!==0)return!1}return!(s&&u&&!a&&i!==0||a&&c&&!s&&i!==0||f||d)},Dy=(t,e,n)=>{if(!t)return e;const r=wm(t.semver,e.semver,n);return r>0?t:r<0||e.operator===">"&&t.operator===">="?e:t},My=(t,e,n)=>{if(!t)return e;const r=wm(t.semver,e.semver,n);return r<0?t:r>0||e.operator==="<"&&t.operator==="<="?e:t};var ET=vT;const Ud=No,Fy=_c,ST=ht,Uy=AE,PT=Da,kT=RO,xT=$O,AT=LO,OT=MO,CT=zO,TT=HO,RT=GO,IT=JO,NT=vn,$T=eC,jT=rC,LT=pm,DT=oC,MT=cC,FT=wc,UT=mm,zT=OE,BT=CE,VT=gm,HT=ym,ZT=TE,qT=NC,GT=bc(),WT=wn(),KT=Ec,JT=UC,QT=HC,XT=WC,YT=QC,eR=eT,tR=_m,nR=cT,rR=hT,sR=mT,aR=_T,iR=ET;var zy={parse:PT,valid:kT,clean:xT,inc:AT,diff:OT,major:CT,minor:TT,patch:RT,prerelease:IT,compare:NT,rcompare:$T,compareLoose:jT,compareBuild:LT,sort:DT,rsort:MT,gt:FT,lt:UT,eq:zT,neq:BT,gte:VT,lte:HT,cmp:ZT,coerce:qT,Comparator:GT,Range:WT,satisfies:KT,toComparators:JT,maxSatisfying:QT,minSatisfying:XT,minVersion:YT,validRange:eR,outside:tR,gtr:nR,ltr:rR,intersects:sR,simplifyRange:aR,subset:iR,SemVer:ST,re:Ud.re,src:Ud.src,tokens:Ud.t,SEMVER_SPEC_VERSION:Fy.SEMVER_SPEC_VERSION,RELEASE_TYPES:Fy.RELEASE_TYPES,compareIdentifiers:Uy.compareIdentifiers,rcompareIdentifiers:Uy.rcompareIdentifiers};function oR(t,e){const n=zy.parse(t),r=zy.parse(e);if(!n||!r)throw new Error("Invalid version format.");return n.compare(r)>=0}function cr(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,n]=t.split(":"),r=n||"latest";if(e.includes("/")){const[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${t}`);return[s,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,r]}}class lR extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function ne(t,e,n){let r;if(t.ok){n&&(r=await t.text());return}r=await t.text();const s=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Server response: ${r}`;throw t.status===409?new lR(s):new Error(s)}var By="[...]",uR={result:"[Circular]"},ku=[],Hs=[];function cR(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Ts(t,e,n,r){var i;try{return JSON.stringify(t,e,n)}catch(o){if(!((i=o.message)!=null&&i.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=cR()),dh(t,"",0,[],void 0,0,r);var s;try{Hs.length===0?s=JSON.stringify(t,e,n):s=JSON.stringify(t,dR(e),n)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ku.length!==0;){var a=ku.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return s}}function zd(t,e,n,r){var s=Object.getOwnPropertyDescriptor(r,n);s.get!==void 0?s.configurable?(Object.defineProperty(r,n,{value:t}),ku.push([r,n,e,s])):Hs.push([e,n,t]):(r[n]=t,ku.push([r,n,e]))}function dh(t,e,n,r,s,a,i){a+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<r.length;o++)if(r[o]===t){zd(uR,t,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){zd(By,t,e,s);return}if(typeof i.edgesLimit<"u"&&n+1>i.edgesLimit){zd(By,t,e,s);return}if(r.push(t),Array.isArray(t))for(o=0;o<t.length;o++)dh(t[o],o,o,r,t,a,i);else{var l=Object.keys(t);for(o=0;o<l.length;o++){var u=l[o];dh(t[u],u,o,r,t,a,i)}}r.pop()}}function dR(t){return t=typeof t<"u"?t:function(e,n){return n},function(e,n){if(Hs.length>0)for(var r=0;r<Hs.length;r++){var s=Hs[r];if(s[1]===e&&s[0]===n){n=s[2],Hs.splice(r,1);break}}return t.call(this,e,n)}}function Vy(t){const e=dO(),n=fO(),r=t.extra??{},s=r.metadata;return t.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...n,...n.revision_id||t.revision_id?{revision_id:t.revision_id??n.revision_id}:{},...s}},t}const fR=()=>{const t=Cs("TRACING_SAMPLING_RATE");if(t===void 0)return;const e=parseFloat(t);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},hR=t=>{const n=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return n==="localhost"||n==="127.0.0.1"||n==="::1"};async function pR(t){const e=[];for await(const n of t)e.push(n);return e}function Bd(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const mR=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(n=>setTimeout(n,e)),!0}return!1};class gR{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let n;const r=new Promise(a=>{n=a}),s=Ts(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:n,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const n=[];let r=0;for(;r+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(n.push(a),r+=a.size,this.sizeBytes-=a.size)}if(n.length===0&&this.items.length>0){const a=this.items.shift();n.push(a),r+=a.size,this.sizeBytes-=a.size}return[n.map(a=>({action:a.action,item:a.payload})),()=>n.forEach(a=>a.itemPromiseResolve())]}}const yR=20971520,_R=1e3;class xu{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new gR}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const n=xu.getDefaultClientConfig();this.tracingSampleRate=fR(),this.apiUrl=Bd(e.apiUrl??n.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Bd(e.apiKey??n.apiKey),this.webUrl=Bd(e.webUrl??n.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new gy(e.callerOptions??{}),this.batchIngestCaller=new gy({...e.callerOptions??{},onFailedResponseHook:mR}),this.hideInputs=e.hideInputs??e.anonymizer??n.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??n.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=Cs("API_KEY"),n=Cs("ENDPOINT")??"https://api.smith.langchain.com",r=Cs("HIDE_INPUTS")==="true",s=Cs("HIDE_OUTPUTS")==="true";return{apiUrl:n,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:hR(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${IE}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const n={...e};return n.inputs!==void 0&&(n.inputs=this.processInputs(n.inputs)),n.outputs!==void 0&&(n.outputs=this.processOutputs(n.outputs)),n}async _getResponse(e,n){const r=(n==null?void 0:n.toString())??"",s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(H(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(a,`Failed to fetch ${e}`),a}async _get(e,n){return(await this._getResponse(e,n)).json()}async*_getPaginated(e,n=new URLSearchParams,r){let s=Number(n.get("offset"))||0;const a=Number(n.get("limit"))||100;for(;;){n.set("offset",String(s)),n.set("limit",String(a));const i=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(H(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(o,`Failed to fetch ${e}`);const l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;s+=l.length}}async*_getCursorPaginatedList(e,n=null,r="POST",s="runs"){const a=n?{...n}:{};for(;;){const o=await(await this.caller.call(H(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_filterForSampling(e,n=!1){if(this.tracingSampleRate===void 0)return e;if(n){const r=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{const r=[];for(const s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){var n;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((n=e.batch_ingest_config)==null?void 0:n.size_limit_bytes)??yR}async drainAutoBatchQueue(){var e;for(;this.autoBatchQueue.items.length>=0;){const[n,r]=this.autoBatchQueue.pop(await this._getBatchSizeLimitBytes());if(!n.length){r();return}try{const s={runCreates:n.filter(i=>i.action==="create").map(i=>i.item),runUpdates:n.filter(i=>i.action==="update").map(i=>i.item)},a=await this._ensureServerInfo();(e=a==null?void 0:a.batch_ingest_config)!=null&&e.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{r()}}}async processRunOperation(e,n){const r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Vy(e.item));const s=this.autoBatchQueue.push(e),a=await this._getBatchSizeLimitBytes();return(n||this.autoBatchQueue.sizeBytes>a)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){const e=await H()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(_R),...this.fetchOptions});return await ne(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const a=Vy(s),i=await this.caller.call(H(),`${this.apiUrl}/runs`,{method:"POST",headers:n,body:Ts(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:n}){if(e===void 0&&n===void 0)return;let r=(e==null?void 0:e.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[],s=(n==null?void 0:n.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[];if(r.length>0&&s.length>0){const l=r.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),u=[];for(const c of s)c.id!==void 0&&l[c.id]?l[c.id]={...l[c.id],...c}:u.push(c);r=Object.values(l),s=u}const a={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!a.post.length&&!a.patch.length)return;if((await this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(const l of a.post)await this.createRun(l);for(const l of a.patch)l.id!==void 0&&await this.updateRun(l.id,l);return}const o={post:[],patch:[]};for(const l of["post","patch"]){const u=l,c=a[u].reverse();let d=c.pop();for(;d!==void 0;)o[u].push(d),d=c.pop()}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(Ts(o))}async _postBatchIngestRuns(e){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(H(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:n}){if(e===void 0&&n===void 0)return;const r={};let s=[];for(const c of e??[]){const d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(const c of n??[])a.push(this.prepareRunCreateOrUpdateInputs(c));if(s.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){const c=s.reduce((f,h)=>(h.id&&(f[h.id]=h),f),{}),d=[];for(const f of a)f.id!==void 0&&c[f.id]?c[f.id]={...c[f.id],...f}:d.push(f);s=Object.values(c),a=d}if(s.length===0&&a.length===0)return;const l=[],u=[];for(const[c,d]of[["post",s],["patch",a]])for(const f of d){const{inputs:h,outputs:y,events:m,...v}=f,g={inputs:h,outputs:y,events:m},p=Ts(v);u.push({name:`${c}.${v.id}`,payload:new Blob([p],{type:`application/json; length=${p.length}`})});for(const[_,w]of Object.entries(g)){if(w===void 0)continue;const b=Ts(w);u.push({name:`${c}.${v.id}.${_}`,payload:new Blob([b],{type:`application/json; length=${b.length}`})})}if(v.id!==void 0){const _=r[v.id];if(_){delete r[v.id];for(const[w,[b,P]]of Object.entries(_))u.push({name:`attachment.${v.id}.${w}`,payload:new Blob([P],{type:`${b}; length=${P.length}`})})}}l.push(`trace=${v.trace_id},id=${v.id}`)}await this._sendMultipartRequest(u,l.join("; "))}async _sendMultipartRequest(e,n){try{const r=new FormData;for(const s of e)r.append(s.name,s.payload);await this.batchIngestCaller.call(H(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers},body:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})}catch(r){let s="Failed to multipart ingest runs";r instanceof Error?s+=`: ${r.stack||r.message}`:s+=`: ${String(r)}`,console.warn(`${s.trim()}

Context: ${n}`)}}async updateRun(e,n){se(e),n.inputs&&(n.inputs=this.processInputs(n.inputs)),n.outputs&&(n.outputs=this.processOutputs(n.outputs));const r={...n,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(n.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(H(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:Ts(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(a,"update run",!0)}async readRun(e,{loadChildRuns:n}={loadChildRuns:!1}){se(e);let r=await this._get(`/runs/${e}`);return n&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:n,projectOpts:r}){if(n!==void 0){let s;n.session_id?s=n.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:Cs("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${n.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const n=await pR(this.listRuns({id:e.child_run_ids})),r={},s={};n.sort((a,i)=>((a==null?void 0:a.dotted_order)??"").localeCompare((i==null?void 0:i.dotted_order)??""));for(const a of n){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:n,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:h,filter:y,traceFilter:m,treeFilter:v,limit:g,select:p}=e;let _=[];if(n&&(_=Array.isArray(n)?n:[n]),r){const k=Array.isArray(r)?r:[r],R=await Promise.all(k.map(Z=>this.readProject({projectName:Z}).then(M=>M.id)));_.push(...R)}const w=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],b={session:_.length?_:null,run_type:c,reference_example:i,query:h,filter:y,trace_filter:m,tree_filter:v,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:g,trace:a,select:p||w,is_root:u};let P=0;for await(const k of this._getCursorPaginatedList("/runs/query",b))if(g){if(P>=g)break;if(k.length+P>g){yield*k.slice(0,g-P);break}P+=k.length,yield*k}else yield*k}async getRunStats({id:e,trace:n,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:f,traceFilter:h,treeFilter:y,isRoot:m,dataSourceType:v}){let g=i||[];a&&(g=[...i||[],...await Promise.all(a.map(P=>this.readProject({projectName:P}).then(k=>k.id)))]);const _=Object.fromEntries(Object.entries({id:e,trace:n,parent_run:r,run_type:s,session:g,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:f,trace_filter:h,tree_filter:y,is_root:m,data_source_type:v}).filter(([P,k])=>k!==void 0));return await(await this.caller.call(H(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(_),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:n}={}){const r={run_id:e,share_token:n||Id()};se(e);const a=await(await this.caller.call(H(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){se(e);const n=await this.caller.call(H(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(n,"unshare run",!0)}async readRunSharedLink(e){se(e);const r=await(await this.caller.call(H(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:n}={}){const r=new URLSearchParams({share_token:e});if(n!==void 0)for(const i of n)r.append("id",i);return se(e),await(await this.caller.call(H(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id),se(e);const s=await(await this.caller.call(H(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id);const r={dataset_id:e};se(e);const a=await(await this.caller.call(H(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){se(e);const n=await this.caller.call(H(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(n,"unshare dataset",!0)}async readSharedDataset(e){return se(e),await(await this.caller.call(H(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,n){const r={};n!=null&&n.exampleIds&&(r.id=n.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>s.append(o,u)):s.append(o,l)});const a=await this.caller.call(H(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:n=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=a||{};r&&(u.metadata=r);const c={name:e,extra:u,description:n};i!==null&&(c.reference_dataset_id=i);const d=await this.caller.call(H(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(d,"create project"),await d.json()}async updateProject(e,{name:n=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=a;s&&(l={...l||{},metadata:s});const u={name:n,extra:l,description:r,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(H(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:n}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)se(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(H(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:n,includeStats:r}){let s="/sessions";const a=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)se(e),s+=`/${e}`;else if(n!==void 0)a.append("name",n);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const i=await this._get(s,a);let o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${n}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const n of this._getPaginated("/sessions",e))return this._tenantId=n[0].tenant_id,n[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:n,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){const l=new URLSearchParams;if(e!==void 0)for(const u of e)l.append("id",u);if(n!==void 0&&l.append("name",n),r!==void 0&&l.append("name_contains",r),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){const u=await this.readDataset({datasetName:a});l.append("reference_dataset",u.id)}i!==void 0&&l.append("reference_free",i.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",l))yield*u}async deleteProject({projectId:e,projectName:n}){let r;if(e===void 0&&n===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:n})).id:r=e,se(r);const s=await this.caller.call(H(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(s,`delete session ${r} (${n})`,!0)}async uploadCsv({csvFile:e,fileName:n,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,n),r.forEach(f=>{u.append("input_keys",f)}),s.forEach(f=>{u.append("output_keys",f)}),a&&u.append("description",a),i&&u.append("data_type",i),o&&u.append("name",o);const c=await this.caller.call(H(),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(c,"upload CSV"),await c.json()}async createDataset(e,{description:n,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){const o={name:e,description:n,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);const l=await this.caller.call(H(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:n}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)se(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,s);let i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${n}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:n}){try{return await this.readDataset({datasetId:e,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:n,fromVersion:r,toVersion:s}){let a=e;if(a===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:n})).id);const i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:n}){const r="/datasets";if(e===void 0)if(n!==void 0)e=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:n=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:n.toString()});if(r!==void 0)for(const u of r)l.append("id",u);s!==void 0&&l.append("name",s),a!==void 0&&l.append("name_contains",a),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:n,datasetName:r,...s}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const a=n??(await this.readDataset({datasetName:r})).id;se(a);const i=await this.caller.call(H(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(i,"update dataset"),await i.json()}async deleteDataset({datasetId:e,datasetName:n}){let r="/datasets",s=e;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(n!==void 0&&(s=(await this.readDataset({datasetName:n})).id),s!==void 0)se(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(H(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:n,tag:r}){let s=e;if(!s&&!n)throw new Error("Must provide either datasetName or datasetId");if(s&&n)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:n})).id),se(s);const a={tag:r},i=await this.caller.call(H(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(i,"index dataset"),await i.json()}async similarExamples(e,n,r,{filter:s}={}){const a={limit:r,inputs:e};s!==void 0&&(a.filter=s),se(n);const i=await this.caller.call(H(),`${this.apiUrl}/datasets/${n}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,n,{datasetId:r,datasetName:s,createdAt:a,exampleId:i,metadata:o,split:l,sourceRunId:u}){let c=r;if(c===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:s})).id);const d=a||new Date,f={dataset_id:c,inputs:e,outputs:n,created_at:d==null?void 0:d.toISOString(),id:i,metadata:o,split:l,source_run_id:u},h=await this.caller.call(H(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(h,"create example"),await h.json()}async createExamples(e){const{inputs:n,outputs:r,metadata:s,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:l}=e;let u=o;if(u===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:l})).id);const c=n.map((h,y)=>({dataset_id:u,inputs:h,outputs:r?r[y]:void 0,metadata:s?s[y]:void 0,split:e.splits?e.splits[y]:void 0,id:i?i[y]:void 0,source_run_id:a?a[y]:void 0})),d=await this.caller.call(H(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(d,"create examples"),await d.json()}async createLLMExample(e,n,r){return this.createExample({input:e},{output:n},r)}async createChatExample(e,n,r){const s=e.map(i=>yy(i)?_y(i):i),a=yy(n)?_y(n):n;return this.createExample({input:s},{output:a},r)}async readExample(e){se(e);const n=`/examples/${e}`;return await this._get(n)}async*listExamples({datasetId:e,datasetName:n,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:l,offset:u,filter:c}={}){let d;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(n!==void 0)d=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:d}),h=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;h&&f.append("as_of",h);const y=i??!0;if(f.append("inline_s3_urls",y.toString()),r!==void 0)for(const v of r)f.append("id",v);if(a!==void 0)for(const v of a)f.append("splits",v);if(o!==void 0){const v=JSON.stringify(o);f.append("metadata",v)}l!==void 0&&f.append("limit",l.toString()),u!==void 0&&f.append("offset",u.toString()),c!==void 0&&f.append("filter",c);let m=0;for await(const v of this._getPaginated("/examples",f)){for(const g of v)yield g,m++;if(l!==void 0&&m>=l)break}}async deleteExample(e){se(e);const n=`/examples/${e}`,r=await this.caller.call(H(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(r,`delete ${n}`),await r.json()}async updateExample(e,n){se(e);const r=await this.caller.call(H(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(r,"update example"),await r.json()}async updateExamples(e){const n=await this.caller.call(H(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(n,"update examples"),await n.json()}async listDatasetSplits({datasetId:e,datasetName:n,asOf:r}){let s;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:n})).id:s=e,se(s);const a=new URLSearchParams,i=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:n,splitName:r,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:n})).id:i=e,se(i);const o={split_name:r,examples:s.map(u=>(se(u),u)),remove:a},l=await this.caller.call(H(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(l,"update dataset splits",!0)}async evaluateRun(e,n,{sourceInfo:r,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){mO("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));const o=await n.evaluateRun(i,a),[l,u]=await this._logEvaluationFeedback(o,i,r);return u[0]}async createFeedback(e,n,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:h}){var p;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const y={type:l??"api",metadata:o??{}};u!==void 0&&(y==null?void 0:y.metadata)!==void 0&&!y.metadata.__run&&(y.metadata.__run={run_id:u}),(y==null?void 0:y.metadata)!==void 0&&((p=y.metadata.__run)==null?void 0:p.run_id)!==void 0&&se(y.metadata.__run.run_id);const m={id:c??Id(),run_id:e,key:n,score:r,value:s,correction:a,comment:i,feedback_source:y,comparative_experiment_id:h,feedbackConfig:d,session_id:f},v=`${this.apiUrl}/feedback`,g=await this.caller.call(H(),v,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(g,"create feedback",!0),m}async updateFeedback(e,{score:n,value:r,correction:s,comment:a}){const i={};n!=null&&(i.score=n),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),se(e);const o=await this.caller.call(H(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(o,"update feedback",!0)}async readFeedback(e){se(e);const n=`/feedback/${e}`;return await this._get(n)}async deleteFeedback(e){se(e);const n=`/feedback/${e}`,r=await this.caller.call(H(),this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(r,`delete ${n}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:n,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),n)for(const a of n)s.append("key",a);if(r)for(const a of r)s.append("source",a);for await(const a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,n,{expiration:r,feedbackConfig:s}={}){const a={run_id:e,feedback_key:n,feedback_config:s};return r?typeof r=="string"?a.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(H(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:n,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){var c;if(n.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:n,reference_dataset_id:r,description:a,created_at:(c=s??new Date)==null?void 0:c.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(H(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){se(e);const n=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",n))yield*r}_selectEvalResults(e){let n;return"results"in e?n=e.results:n=[e],n}async _logEvaluationFeedback(e,n,r){const s=this._selectEvalResults(e),a=[];for(const i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let l=null;i.targetRunId?l=i.targetRunId:n&&(l=n.id),a.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,n,r){const[s]=await this._logEvaluationFeedback(e,n,r);return s}async*listAnnotationQueues(e={}){const{queueIds:n,name:r,nameContains:s,limit:a}=e,i=new URLSearchParams;n&&n.forEach((l,u)=>{se(l,`queueIds[${u}]`),i.append("ids",l)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",i))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:n,description:r,queueId:s}=e,a={name:n,description:r,id:s||Id()},i=await this.caller.call(H(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){const n=await this.listAnnotationQueues({queueIds:[e]}).next();if(n.done)throw new Error(`Annotation queue with ID ${e} not found`);return n.value}async updateAnnotationQueue(e,n){const{name:r,description:s}=n,a=await this.caller.call(H(),`${this.apiUrl}/annotation-queues/${se(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(a,"update annotation queue")}async deleteAnnotationQueue(e){const n=await this.caller.call(H(),`${this.apiUrl}/annotation-queues/${se(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(n,"delete annotation queue")}async addRunsToAnnotationQueue(e,n){const r=await this.caller.call(H(),`${this.apiUrl}/annotation-queues/${se(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n.map((s,a)=>se(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,n){const r=`/annotation-queues/${se(e,"queueId")}/run`,s=await this.caller.call(H(),`${this.apiUrl}${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(s,"get run from annotation queue"),await s.json()}async _currentTenantIsOwner(e){const n=await this._getSettings();return e=="-"||n.tenant_handle===e}async _ownerConflictError(e,n){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${n}`)}async _getLatestCommitHash(e){const n=await this.caller.call(H(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await n.json();if(!n.ok){const s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${n.status}: ${n.statusText}
${s}`);throw a.statusCode=n.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,n){const[r,s,a]=cr(e),i=await this.caller.call(H(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:n}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(i,`${n?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){const[n,r,s]=cr(e);if(await this._currentTenantIsOwner(n)){const a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${n}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${n}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const n of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*n}async*listPrompts(e){const n=new URLSearchParams;n.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),n.append("sort_direction","desc"),n.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&n.append("is_public",e.isPublic.toString()),e!=null&&e.query&&n.append("query",e.query);for await(const r of this._getPaginated("/repos",n,s=>s.repos))yield*r}async getPrompt(e){const[n,r,s]=cr(e),a=await this.caller.call(H(),`${this.apiUrl}/repos/${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await ne(a,"get prompt");const i=await a.json();return i.repo?i.repo:null}async createPrompt(e,n){const r=await this._getSettings();if(n!=null&&n.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,a,i]=cr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:a,...(n==null?void 0:n.description)&&{description:n.description},...(n==null?void 0:n.readme)&&{readme:n.readme},...(n==null?void 0:n.tags)&&{tags:n.tags},is_public:!!(n!=null&&n.isPublic)},l=await this.caller.call(H(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(l,"create prompt");const{repo:u}=await l.json();return u}async createCommit(e,n,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,a,i]=cr(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${s}/${a}`):r==null?void 0:r.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(n)),parent_commit:o},u=await this.caller.call(H(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(u,"create commit");const c=await u.json();return this._getPromptUrl(`${s}/${a}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updatePrompt(e,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=cr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if((n==null?void 0:n.description)!==void 0&&(a.description=n.description),(n==null?void 0:n.readme)!==void 0&&(a.readme=n.readme),(n==null?void 0:n.tags)!==void 0&&(a.tags=n.tags),(n==null?void 0:n.isPublic)!==void 0&&(a.is_public=n.isPublic),(n==null?void 0:n.isArchived)!==void 0&&(a.is_archived=n.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const i=await this.caller.call(H(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await ne(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,r,s]=cr(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("delete a prompt",n);return await(await this.caller.call(H(),`${this.apiUrl}/repos/${n}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,n){const[r,s,a]=cr(e),i=await this._getServerInfo(),o=oR(i.version,"0.5.23");let l=a;if(!o&&a==="latest"){const d=await this._getLatestCommitHash(`${r}/${s}`);if(d)l=d;else throw new Error("No commits found")}const u=await this.caller.call(H(),`${this.apiUrl}/commits/${r}/${s}/${l}${n!=null&&n.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await ne(u,"pull prompt commit");const c=await u.json();return{owner:r,repo:s,commit_hash:c.commit_hash,manifest:c.manifest,examples:c.examples}}async _pullPrompt(e,n){const r=await this.pullPromptCommit(e,{includeModel:n==null?void 0:n.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,n){return await this.promptExists(e)?n&&Object.keys(n).some(s=>s!=="object")&&await this.updatePrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}):await this.createPrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}),n!=null&&n.object?await this.createCommit(e,n==null?void 0:n.object,{parentCommitHash:n==null?void 0:n.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,n={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=n,[a,i]=this.parseTokenOrUrl(e,r),o=new xu({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(i),u=s||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(i),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(f=>f.inputs),outputs:c.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,n,r=2,s="dataset"){try{return se(e),[n,e]}catch{}try{const i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){const o=i[i.length-r];return[n,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}}const IE="0.1.68";class vR extends yc{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:n,projectName:r,client:s}=e;this.projectName=r??Nt("LANGCHAIN_PROJECT")??Nt("LANGCHAIN_SESSION"),this.exampleId=n,this.client=s??new xu({})}async _convertToCreate(e,n=void 0){return{...e,extra:{...e.extra,runtime:await Kx()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:n}}async persistRun(e){}async onRunCreate(e){const n=await this._convertToCreate(e,this.exampleId);await this.client.createRun(n)}async onRunUpdate(e){const n={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,n)}getRun(e){return this.runMap.get(e)}}async function wR(){return new vR}let Vd;function bR(){const t="default"in Wn?Wn.default:Wn;return new t({autoStart:!0,concurrency:1})}async function He(t,e){e===!0?await t():(typeof Vd>"u"&&(Vd=bR()),Vd.add(t))}class ER{setHandler(e){return this.setHandlers([e])}}class Sc{constructor(e,n,r,s,a,i,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}async handleText(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;try{await((r=n.handleText)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleText: ${s}`)}},n.awaitHandlers)))}}class SR extends Sc{getChild(e){const n=new Pt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch{console.error(`Error in handler ${n.constructor.name}, handleRetriever`)}},n.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleRetrieverError: ${s}`)}},n.awaitHandlers)))}}class Hy extends Sc{async handleLLMNewToken(e,n,r,s,a,i){await Promise.all(this.handlers.map(o=>He(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,n??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(u){console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`)}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreLLM)try{await((r=n.handleLLMError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleLLMError: ${s}`)}},n.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreLLM)try{await((r=n.handleLLMEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleLLMEnd: ${s}`)}},n.awaitHandlers)))}}class PR extends Sc{getChild(e){const n=new Pt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleChainError(e,n,r,s,a){await Promise.all(this.handlers.map(i=>He(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainError)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){console.error(`Error in handler ${i.constructor.name}, handleChainError: ${l}`)}},i.awaitHandlers)))}async handleChainEnd(e,n,r,s,a){await Promise.all(this.handlers.map(i=>He(async()=>{var o;if(!i.ignoreChain)try{await((o=i.handleChainEnd)==null?void 0:o.call(i,e,this.runId,this._parentRunId,this.tags,a))}catch(l){console.error(`Error in handler ${i.constructor.name}, handleChainEnd: ${l}`)}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentAction)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleAgentAction: ${s}`)}},n.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleAgentEnd: ${s}`)}},n.awaitHandlers)))}}class kR extends Sc{getChild(e){const n=new Pt(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleToolError(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleToolError: ${s}`)}},n.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(n=>He(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){console.error(`Error in handler ${n.constructor.name}, handleToolEnd: ${s}`)}},n.awaitHandlers)))}}class Pt extends ER{constructor(e,n){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(n==null?void 0:n.handlers)??this.handlers,this.inheritableHandlers=(n==null?void 0:n.inheritableHandlers)??this.inheritableHandlers,this.tags=(n==null?void 0:n.tags)??this.tags,this.inheritableTags=(n==null?void 0:n.inheritableTags)??this.inheritableTags,this.metadata=(n==null?void 0:n.metadata)??this.metadata,this.inheritableMetadata=(n==null?void 0:n.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(n.map(async(u,c)=>{const d=c===0&&r?r:mr();return await Promise.all(this.handlers.map(f=>He(async()=>{var h;if(!f.ignoreLLM)try{await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l))}catch(y){console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${y}`)}},f.awaitHandlers))),new Hy(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,n,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(n.map(async(u,c)=>{const d=c===0&&r?r:mr();return await Promise.all(this.handlers.map(f=>He(async()=>{var h,y;if(!f.ignoreLLM)try{if(f.handleChatModelStart)await((h=f.handleChatModelStart)==null?void 0:h.call(f,e,[u],d,this._parentRunId,a,this.tags,this.metadata,l));else if(f.handleLLMStart){const m=uE(u);await((y=f.handleLLMStart)==null?void 0:y.call(f,e,[m],d,this._parentRunId,a,this.tags,this.metadata,l))}}catch(m){console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`)}},f.awaitHandlers))),new Hy(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,n,r=mr(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>He(async()=>{var u;if(!l.ignoreChain)try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,n,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`)}},l.awaitHandlers))),new PR(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,n,r=mr(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>He(async()=>{var u;if(!l.ignoreAgent)try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`)}},l.awaitHandlers))),new kR(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,n,r=mr(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>He(async()=>{var u;if(!l.ignoreRetriever)try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){console.error(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`)}},l.awaitHandlers))),new SR(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,n=!0){this.handlers.push(e),n&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(n=>n!==e),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==e)}setHandlers(e,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,n)}addTags(e,n=!0){this.removeTags(e),this.tags.push(...e),n&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(n=>!e.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!e.includes(n))}addMetadata(e,n=!0){this.metadata={...this.metadata,...e},n&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const n of Object.keys(e))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(e=[],n=!0){const r=new Pt(this._parentRunId);for(const s of this.handlers){const a=this.inheritableHandlers.includes(s);r.addHandler(s,a)}for(const s of this.tags){const a=this.inheritableTags.includes(s);r.addTags([s],a)}for(const s of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},a)}for(const s of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||r.addHandler(s,n);return r}static fromHandlers(e){class n extends Io{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:mr()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new n),r}static async configure(e,n,r,s,a,i,o){let l;(e||n)&&(Array.isArray(e)||!e?(l=new Pt,l.setHandlers((e==null?void 0:e.map(Au))??[],!0)):l=e,l=l.copy(Array.isArray(n)?n.map(Au):n==null?void 0:n.handlers,!1));const u=Nt("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=Nt("LANGCHAIN_TRACING_V2")==="true",d=c||(Nt("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new Pt),u&&!l.handlers.some(f=>f.name===py.prototype.name)){const f=new py;l.addHandler(f,!0)}d&&!l.handlers.some(f=>f.name==="langchain_tracer")&&c&&l.addHandler(await wR(),!0)}return(r||s)&&l&&(l.addTags(r??[]),l.addTags(s??[],!1)),(a||i)&&l&&(l.addMetadata(a??{}),l.addMetadata(i??{},!1)),l}}function Au(t){return"name"in t?t:Io.fromMethods(t)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const xR=Object.prototype.hasOwnProperty;function AR(t,e){return xR.call(t,e)}function OR(t){if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=""+r;return n}if(Object.keys)return Object.keys(t);let e=[];for(let n in t)AR(t,n)&&e.push(n);return e}function ka(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function fh(t){let e=0;const n=t.length;let r;for(;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function CR(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function hh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(hh(t[n]))return!0}else if(typeof t=="object"){const n=OR(t),r=n.length;for(var e=0;e<r;e++)if(hh(t[n[e]]))return!0}}return!1}function Zy(t,e){const n=[t];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(`${r}: ${s}`)}return n.join(`
`)}class TR extends Error{constructor(e,n,r,s,a){super(Zy(e,{name:n,index:r,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=Zy(e,{name:n,index:r,operation:s,tree:a})}}const Ce=TR,Zs={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){let r=ph(n,this.path);r&&(r=ka(r));const s=Bi(n,{op:"remove",path:this.from}).removed;return Bi(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){const r=ph(n,this.from);return Bi(n,{op:"add",path:this.path,value:ka(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:Cu(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}};var RR={add:function(t,e,n){return fh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:Zs.move,copy:Zs.copy,test:Zs.test,_get:Zs._get};function ph(t,e){if(e=="")return t;var n={op:"_get",path:e};return Bi(t,n),n.value}function Bi(t,e,n=!1,r=!0,s=!0,a=0){if(n&&(typeof n=="function"?n(e,0,t,e.path):mh(e,0)),e.path===""){let i={newDocument:t};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=t,i;if(e.op==="move"||e.op==="copy")return i.newDocument=ph(t,e.from),e.op==="move"&&(i.removed=t),i;if(e.op==="test"){if(i.test=Cu(t,e.value),i.test===!1)throw new Ce("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return i.newDocument=t,i}else{if(e.op==="remove")return i.removed=t,i.newDocument=null,i;if(e.op==="_get")return e.value=t,i;if(n)throw new Ce("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,t);return i}}else{r||(t=ka(t));const o=(e.path||"").split("/");let l=t,u=1,c=o.length,d,f,h;for(typeof n=="function"?h=n:h=mh;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=CR(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&h(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!fh(f))throw new Ce("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,t);fh(f)&&(f=~~f)}if(u>=c){if(n&&e.op==="add"&&f>l.length)throw new Ce("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,t);const y=RR[e.op].call(e,l,f,t);if(y.test===!1)throw new Ce("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return y}}else if(u>=c){const y=Zs[e.op].call(e,l,f,t);if(y.test===!1)throw new Ce("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return y}if(l=l[f],n&&u<c&&(!l||typeof l!="object"))throw new Ce("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,t)}}}function Ou(t,e,n,r=!0,s=!0){if(n&&!Array.isArray(e))throw new Ce("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=ka(t));const a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=Bi(t,e[i],n,!0,s,i),t=a[i].newDocument;return a.newDocument=t,a}function mh(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Ce("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(Zs[t.op]){if(typeof t.path!="string")throw new Ce("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Ce('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Ce("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Ce("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&hh(t.value))throw new Ce("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new Ce("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Ce("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var i={op:"_get",path:t.from,value:void 0},o=IR([i],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ce("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new Ce("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function IR(t,e,n){try{if(!Array.isArray(t))throw new Ce("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Ou(ka(e),ka(t),n||!0);else{n=n||mh;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof Ce)return s;throw s}}function Cu(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,a,i;if(n&&r){if(a=t.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!Cu(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(t);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!Cu(t[i],e[i]))return!1;return!0}return t!==t&&e!==e}class Dn extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const n=e.getReader();return new Dn({start(r){return s();function s(){return n.read().then(({done:a,value:i})=>{if(a){r.close();return}return r.enqueue(i),s()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(e){return new Dn({async pull(n){const{value:r,done:s}=await e.next();s&&n.close(),n.enqueue(r)},async cancel(n){await e.return(n)}})}}function NE(t,e=2){const n=Array.from({length:e},()=>[]);return n.map(async function*(s){for(;;)if(s.length===0){const a=await t.next();for(const i of n)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function Rr(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const n={...t};for(const[r,s]of Object.entries(e))r in n&&!Array.isArray(n[r])?n[r]=Rr(n[r],s):n[r]=s;return n}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}class Ma{constructor(e,n){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise((r,s)=>{this.firstResult=e.next(),n?this.firstResult.then(n).then(r,s):this.firstResult.then(a=>r(void 0),s)})}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}async function NR(t,e,n,...r){const s=new Ma(e,n),a=await s.setup;return{output:t(s,a,...r),setup:a}}class gr{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const n=this.ops.concat(e.ops),r=Ou({},n);return new mo({ops:n,state:r[r.length-1].newDocument})}}class mo extends gr{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const n=this.ops.concat(e.ops),r=Ou(this.state,e.ops);return new mo({ops:n,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const n=Ou({},e.ops);return new mo({ops:e.ops,state:n[n.length-1].newDocument})}}async function qy(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=t;if(["retriever","llm","prompt"].includes(t.run_type))return n;if(!(Object.keys(n).length===1&&(n==null?void 0:n.input)===""))return n.input}async function Gy(t,e){const{outputs:n}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?n:n!==void 0&&Object.keys(n).length===1&&(n==null?void 0:n.output)!==void 0?n.output:n}function $R(t){return t!==void 0&&t.message!==void 0}class Wy extends yc{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Dn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||n.find(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}async*tapOutputIterable(e,n){for await(const r of n){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new gr({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new gr({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const n=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=n===1?e.name:`${e.name}:${n}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await qy(e,this._schemaFormat)),await this.writer.write(new gr({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const n=this.keyMapByRunId[e.id];if(n===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${n}/inputs`,value:await qy(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${n}/final_output`,value:await Gy(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${n}/end_time`,value:new Date(e.end_time).toISOString()});const s=new gr({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const n=new gr({ops:[{op:"replace",path:"/final_output",value:await Gy(e,this._schemaFormat)}]});await this.writer.write(n),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,n,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const a=e.inputs.messages!==void 0;let i;a?$R(r==null?void 0:r.chunk)?i=r==null?void 0:r.chunk:i=new fc(n):i=n;const o=new gr({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:n},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}class jR{getStore(){}run(e,n){return n()}}class LR{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new jR}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}}const go=new LR,Hd=25;async function rs(t){return Pt.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function Ky(...t){const e={};for(const n of t.filter(r=>!!r))for(const r of Object.keys(n))if(r==="metadata")e[r]={...e[r],...n[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(n[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...n[r]};else if(r==="callbacks"){const s=e.callbacks,a=n.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{const i=s.copy();for(const o of a)i.addHandler(Au(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){const i=a.copy();for(const o of s)i.addHandler(Au(o),!0);e.callbacks=i}else e.callbacks=new Pt(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{const s=r;e[s]=n[s]??e[s]}return e}const DR=new Set(["string","number","boolean"]);function xe(t){var r;const e=t??go.getInstance().getStore();let n={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(e&&(n={...n,...e}),e!=null&&e.configurable)for(const s of Object.keys(e.configurable))DR.has(typeof e.configurable[s])&&!((r=n.metadata)!=null&&r[s])&&(n.metadata||(n.metadata={}),n.metadata[s]=e.configurable[s]);return n}function _t(t={},{callbacks:e,maxConcurrency:n,recursionLimit:r,runName:s,configurable:a,runId:i}={}){const o=xe(t);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),n!==void 0&&(o.maxConcurrency=n),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}class $E extends yc{constructor({config:e,onStart:n,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=n,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}function jE(t){return t?t.lc_runnable:!1}class MR{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,n){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(n)),this.includeTags!==void 0&&(r=r||s.some(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(n)),this.excludeTags!==void 0&&(r=r&&s.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),r}}const FR=Symbol("Let zodToJsonSchema decide on which parser to use"),UR={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},zR=t=>({...UR,...t}),BR=t=>{const e=zR(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function LE(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function ce(t,e,n,r,s){t[e]=n,LE(t,e,r,s)}function VR(){return{}}function HR(t,e){var r,s,a;const n={type:"array"};return(r=t.type)!=null&&r._def&&((a=(s=t.type)==null?void 0:s._def)==null?void 0:a.typeName)!==T.ZodAny&&(n.items=ue(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&ce(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&ce(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(ce(n,"minItems",t.exactLength.value,t.exactLength.message,e),ce(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function ZR(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?ce(n,"minimum",r.value,r.message,e):ce(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),ce(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ce(n,"maximum",r.value,r.message,e):ce(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),ce(n,"maximum",r.value,r.message,e));break;case"multipleOf":ce(n,"multipleOf",r.value,r.message,e);break}return n}function qR(){return{type:"boolean"}}function DE(t,e){return ue(t.type._def,e)}const GR=(t,e)=>ue(t.innerType._def,e);function ME(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>ME(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return WR(t,e)}}const WR=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":ce(n,"minimum",r.value,r.message,e);break;case"max":ce(n,"maximum",r.value,r.message,e);break}return n};function KR(t,e){return{...ue(t.innerType._def,e),default:t.defaultValue()}}function JR(t,e){return e.effectStrategy==="input"?ue(t.schema._def,e):{}}function QR(t){return{type:"string",enum:Array.from(t.values)}}const XR=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function YR(t,e){const n=[ue(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ue(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(a=>{if(XR(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...l}=a;i=l}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}function eI(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}let Zd;const sn={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Zd===void 0&&(Zd=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Zd),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function FE(t,e){const n={type:"string"};if(t.checks)for(const r of t.checks)switch(r.kind){case"min":ce(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e);break;case"max":ce(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":an(n,"email",r.message,e);break;case"format:idn-email":an(n,"idn-email",r.message,e);break;case"pattern:zod":ot(n,sn.email,r.message,e);break}break;case"url":an(n,"uri",r.message,e);break;case"uuid":an(n,"uuid",r.message,e);break;case"regex":ot(n,r.regex,r.message,e);break;case"cuid":ot(n,sn.cuid,r.message,e);break;case"cuid2":ot(n,sn.cuid2,r.message,e);break;case"startsWith":ot(n,RegExp(`^${qd(r.value,e)}`),r.message,e);break;case"endsWith":ot(n,RegExp(`${qd(r.value,e)}$`),r.message,e);break;case"datetime":an(n,"date-time",r.message,e);break;case"date":an(n,"date",r.message,e);break;case"time":an(n,"time",r.message,e);break;case"duration":an(n,"duration",r.message,e);break;case"length":ce(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e),ce(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"includes":{ot(n,RegExp(qd(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&an(n,"ipv4",r.message,e),r.version!=="v4"&&an(n,"ipv6",r.message,e);break}case"base64url":ot(n,sn.base64url,r.message,e);break;case"jwt":ot(n,sn.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&ot(n,sn.ipv4Cidr,r.message,e),r.version!=="v4"&&ot(n,sn.ipv6Cidr,r.message,e);break}case"emoji":ot(n,sn.emoji(),r.message,e);break;case"ulid":{ot(n,sn.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{an(n,"binary",r.message,e);break}case"contentEncoding:base64":{ce(n,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{ot(n,sn.base64,r.message,e);break}}break}case"nanoid":ot(n,sn.nanoid,r.message,e)}return n}function qd(t,e){return e.patternStrategy==="escape"?nI(t):t}const tI=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function nI(t){let e="";for(let n=0;n<t.length;n++)tI.has(t[n])||(e+="\\"),e+=t[n];return e}function an(t,e,n,r){var s;t.format||(s=t.anyOf)!=null&&s.some(a=>a.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):ce(t,"format",e,n,r)}function ot(t,e,n,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Jy(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):ce(t,"pattern",Jy(e,r),n,r)}function Jy(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=n.i?t.source.toLowerCase():t.source;let s="",a=!1,i=!1,o=!1;for(let u=0;u<r.length;u++){if(a){s+=r[u],a=!1;continue}if(n.i){if(i){if(r[u].match(/[a-z]/)){o?(s+=r[u],s+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(s+=r[u],o=!0):s+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){s+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(n.m){if(r[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&r[u]==="."){s+=i?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}s+=r[u],r[u]==="\\"?a=!0:i&&r[u]==="]"?i=!1:!i&&r[u]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function UE(t,e){var r,s,a,i,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===T.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((u,c)=>({...u,[c]:ue(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const n={type:"object",additionalProperties:ue(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===T.ZodString&&((a=t.keyType._def.checks)!=null&&a.length)){const{type:u,...c}=FE(t.keyType._def,e);return{...n,propertyNames:c}}else{if(((i=t.keyType)==null?void 0:i._def.typeName)===T.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===T.ZodBranded&&t.keyType._def.type._def.typeName===T.ZodString&&((l=t.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...c}=DE(t.keyType._def,e);return{...n,propertyNames:c}}}return n}function rI(t,e){if(e.mapStrategy==="record")return UE(t,e);const n=ue(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ue(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function sI(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function aI(){return{not:{}}}function iI(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Tu={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function oI(t,e){if(e.target==="openApi3")return Qy(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in Tu&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,a)=>{const i=Tu[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,a)=>{const i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:n.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return Qy(t,e)}const Qy=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>ue(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function lI(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Tu[t.innerType._def.typeName],nullable:!0}:{type:[Tu[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ue(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=ue(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function uI(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",LE(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?ce(n,"minimum",r.value,r.message,e):ce(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),ce(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ce(n,"maximum",r.value,r.message,e):ce(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),ce(n,"maximum",r.value,r.message,e));break;case"multipleOf":ce(n,"multipleOf",r.value,r.message,e);break}return n}function cI(t,e){const n=e.target==="openAi",r={type:"object",properties:{}},s=[],a=t.shape();for(const o in a){let l=a[o];if(l===void 0||l._def===void 0)continue;let u=fI(l);u&&n&&(l instanceof Jt&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const c=ue(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(r.properties[o]=c,u||s.push(o))}s.length&&(r.required=s);const i=dI(t,e);return i!==void 0&&(r.additionalProperties=i),r}function dI(t,e){if(t.catchall._def.typeName!=="ZodNever")return ue(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function fI(t){try{return t.isOptional()}catch{return!0}}const hI=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ue(t.innerType._def,e);const n=ue(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},pI=(t,e)=>{if(e.pipeStrategy==="input")return ue(t.in._def,e);if(e.pipeStrategy==="output")return ue(t.out._def,e);const n=ue(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ue(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function mI(t,e){return ue(t.type._def,e)}function gI(t,e){const r={type:"array",uniqueItems:!0,items:ue(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&ce(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&ce(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function yI(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>ue(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:ue(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>ue(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function _I(){return{not:{}}}function vI(){return{}}const wI=(t,e)=>ue(t.innerType._def,e),bI=(t,e,n)=>{switch(e){case T.ZodString:return FE(t,n);case T.ZodNumber:return uI(t,n);case T.ZodObject:return cI(t,n);case T.ZodBigInt:return ZR(t,n);case T.ZodBoolean:return qR();case T.ZodDate:return ME(t,n);case T.ZodUndefined:return _I();case T.ZodNull:return iI(n);case T.ZodArray:return HR(t,n);case T.ZodUnion:case T.ZodDiscriminatedUnion:return oI(t,n);case T.ZodIntersection:return YR(t,n);case T.ZodTuple:return yI(t,n);case T.ZodRecord:return UE(t,n);case T.ZodLiteral:return eI(t,n);case T.ZodEnum:return QR(t);case T.ZodNativeEnum:return sI(t);case T.ZodNullable:return lI(t,n);case T.ZodOptional:return hI(t,n);case T.ZodMap:return rI(t,n);case T.ZodSet:return gI(t,n);case T.ZodLazy:return()=>t.getter()._def;case T.ZodPromise:return mI(t,n);case T.ZodNaN:case T.ZodNever:return aI();case T.ZodEffects:return JR(t,n);case T.ZodAny:return VR();case T.ZodUnknown:return vI();case T.ZodDefault:return KR(t,n);case T.ZodBranded:return DE(t,n);case T.ZodReadonly:return wI(t,n);case T.ZodCatch:return GR(t,n);case T.ZodPipeline:return pI(t,n);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(r=>{})()}};function ue(t,e,n=!1){var o;const r=e.seen.get(t);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,t,e,r,n);if(l!==FR)return l}if(r&&!n){const l=EI(r,e);if(l!==void 0)return l}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const a=bI(t,t.typeName,e),i=typeof a=="function"?ue(a(),e):a;if(i&&PI(t,e,i),e.postProcess){const l=e.postProcess(i,t,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}const EI=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:SI(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},SI=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},PI=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),zE=(t,e)=>{const n=BR(e),r=void 0,s=e==null?void 0:e.name,a=ue(t._def,n,!1)??{},i=s===void 0?r?{...a,[n.definitionPath]:r}:a:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...r,[s]:a}};return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function kI(t){return jE(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...zE(t.data.schema),title:t.data.name}}}class BE{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((n,r)=>{e[n.id]=VA(n.id)?r:n.id}),{nodes:Object.values(this.nodes).map(n=>({id:e[n.id],...kI(n)})),edges:this.edges.map(n=>n.data?{source:e[n.source],target:e[n.target],data:n.data}:{source:e[n.source],target:e[n.target]})}}addNode(e,n){if(n!==void 0&&this.nodes[n]!==void 0)throw new Error(`Node with id ${n} already exists`);const r=n||mr(),s={id:r,data:e};return this.nodes[r]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(n=>n.source!==e.id&&n.target!==e.id)}addEdge(e,n,r){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[n.id]===void 0)throw new Error(`Target node ${n.id} not in graph`);const s={source:e.id,target:n.id,data:r};return this.edges.push(s),s}firstNode(){const e=new Set(this.edges.map(r=>r.target)),n=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||n.push(r)}),n[0]}lastNode(){const e=new Set(this.edges.map(r=>r.source)),n=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||n.push(r)}),n[0]}extend(e){Object.entries(e.nodes).forEach(([n,r])=>{this.nodes[n]=r}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){const e=this.firstNode();if(e){const n=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||n.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const n=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||n.length===1)&&this.removeNode(e)}}}function xI(t){const e=new TextEncoder,n=new ReadableStream({async start(r){for await(const s of t)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Dn.fromReadableStream(n)}function Xy(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}function Yy(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*e_(t,e){const n=go.getInstance();for(;;){const{value:r,done:s}=n.run(t,e.next.bind(e));if(s)break;yield r}}async function*t_(t,e){const n=go.getInstance(),r=e[Symbol.asyncIterator]();for(;;){const{value:s,done:a}=await n.run(t,r.next.bind(e));if(a)break;yield s}}function nt(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}class ct extends hs{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const n=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${n}${e}`:n}bind(e){return new ra({bound:this,kwargs:e,config:{}})}map(){return new Ru({bound:this})}withRetry(e){return new AI({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new ra({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new OI({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,n=0){if(Array.isArray(e)&&e.length!==n)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${n} inputs`);if(Array.isArray(e))return e.map(xe);if(n>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:n},(s,a)=>xe(a===0?e:r))}return Array.from({length:n},()=>xe(e))}async batch(e,n,r){var l;const s=this._getOptionsList(n??{},e.length),a=((l=s[0])==null?void 0:l.maxConcurrency)??(r==null?void 0:r.maxConcurrency),i=new dm({maxConcurrency:a,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>i.call(async()=>{try{return await this.invoke(u,s[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,n){yield this.invoke(e,n)}async stream(e,n){const r=new Ma(this._streamIterator(e,xe(n)));return await r.setup,Dn.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e){let n;e===void 0?n=xe(e):n=xe({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,[n,r]}async _callWithConfig(e,n,r){const s=xe(r),a=await rs(s),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),nt(n,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{o=await e.call(this,n,s,i)}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(nt(o,"output"))),o}async _batchWithConfig(e,n,r,s){const a=this._getOptionsList(r??{},n.length),i=await Promise.all(a.map(rs)),o=await Promise.all(i.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),nt(n[c],"input"),a[c].runId,a[c].runType,void 0,void 0,a[c].runName??this.getName()));return delete a[c].runId,d}));let l;try{l=await e.call(this,n,a,o,s)}catch(u){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(nt(l,"output")))),l}async*_transformStreamWithConfig(e,n,r){let s,a=!0,i,o=!0;const l=xe(r),u=await rs(l);async function*c(){for await(const f of e){if(a)if(s===void 0)s=f;else try{s=Rr(s,f)}catch{s=void 0,a=!1}yield f}}let d;try{const f=await NR(n.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),l);delete l.runId,d=f.setup;const h=v=>v.name==="log_stream_tracer",y=d==null?void 0:d.handlers.find(h);let m=f.output;y!==void 0&&d!==void 0&&(m=await y.tapOutputIterable(d.runId,f.output));for await(const v of m)if(yield v,o)if(i===void 0)i=v;else try{i=Rr(i,v)}catch{i=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:nt(s,"input")})),f}await(d==null?void 0:d.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:nt(s,"input")}))}getGraph(e){const n=new BE,r=n.addNode({name:`${this.getName()}Input`,schema:le.any()}),s=n.addNode(this),a=n.addNode({name:`${this.getName()}Output`,schema:le.any()});return n.addEdge(r,s),n.addEdge(s,a),n}pipe(e){return new qs({first:this,last:Xr(e)})}pick(e){return this.pipe(new TI(e))}assign(e){return this.pipe(new CI(new $o({steps:e})))}async*transform(e,n){let r;for await(const s of e)r===void 0?r=s:r=Rr(r,s);yield*this._streamIterator(r,xe(n))}async*streamLog(e,n,r){const s=new Wy({...r,autoClose:!1,_schemaFormat:"original"}),a=xe(n);yield*this._streamLog(e,s,a)}async*_streamLog(e,n,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[n];else if(Array.isArray(s))r.callbacks=s.concat([n]);else{const l=s.copy();l.inheritableHandlers.push(n),r.callbacks=l}const a=this.stream(e,r);async function i(){try{const l=await a;for await(const u of l){const c=new gr({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await n.writer.write(c)}}finally{await n.writer.close()}}const o=i();try{for await(const l of n)yield l}finally{await o}}async*streamEvents(e,n,r){if(n.encoding==="text/event-stream"){const s=await this._streamEvents(e,n,r);yield*xI(s)}else yield*this._streamEvents(e,n,r)}async*_streamEvents(e,n,r){if(n.version!=="v1")throw new Error('Only version "v1" of the events schema is currently supported.');let s,a=!1;const i=xe(n),o=i.tags??[],l=i.metadata??{},u=i.runName??this.getName(),c=new Wy({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new MR({...r}),f=this._streamLog(e,c,i);for await(const y of f){if(s?s=s.concat(y):s=mo.fromRunLogPatch(y),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const p={...s.state},_={run_id:p.id,event:`on_${p.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(_,p.type)&&(yield _)}const m=y.ops.filter(p=>p.path.startsWith("/logs/")).map(p=>p.path.split("/")[2]),v=[...new Set(m)];for(const p of v){let _,w={};const b=s.state.logs[p];if(b.end_time===void 0?b.streamed_output.length>0?_="stream":_="start":_="end",_==="start")b.inputs!==void 0&&(w.input=b.inputs);else if(_==="end")b.inputs!==void 0&&(w.input=b.inputs),w.output=b.final_output;else if(_==="stream"){const P=b.streamed_output.length;if(P!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${P} instead. Encountered in: "${b.name}"`);w={chunk:b.streamed_output[0]},b.streamed_output=[]}yield{event:`on_${b.type}_${_}`,name:b.name,run_id:b.id,tags:b.tags,metadata:b.metadata,data:w}}const{state:g}=s;if(g.streamed_output.length>0){const p=g.streamed_output.length;if(p!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${p} instead. Encountered in: "${g.name}"`);const _={chunk:g.streamed_output[0]};g.streamed_output=[];const w={event:`on_${g.type}_stream`,run_id:g.id,tags:o,metadata:l,name:u,data:_};d.includeEvent(w,g.type)&&(yield w)}}const h=s==null?void 0:s.state;if(h!==void 0){const y={event:`on_${h.type}_end`,name:u,run_id:h.id,tags:o,metadata:l,data:{output:h.final_output}};d.includeEvent(y,h.type)&&(yield y)}}static isRunnable(e){return jE(e)}withListeners({onStart:e,onEnd:n,onError:r}){return new ra({bound:this,config:{},configFactories:[s=>({callbacks:[new $E({config:s,onStart:e,onEnd:n,onError:r})]})]})}}class ra extends ct{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const n=Ky(this.config,...e);return Ky(n,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(n))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,n){return this.bound.invoke(e,await this._mergeConfig(xe(n),this.kwargs))}async batch(e,n,r){const s=Array.isArray(n)?await Promise.all(n.map(async a=>this._mergeConfig(xe(a),this.kwargs))):await this._mergeConfig(xe(n),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,n){yield*this.bound._streamIterator(e,await this._mergeConfig(xe(n),this.kwargs))}async stream(e,n){return this.bound.stream(e,await this._mergeConfig(xe(n),this.kwargs))}async*transform(e,n){yield*this.bound.transform(e,await this._mergeConfig(xe(n),this.kwargs))}async*streamEvents(e,n,r){yield*this.bound.streamEvents(e,{...await this._mergeConfig(xe(n),this.kwargs),version:n.version},r)}static isRunnableBinding(e){return e.bound&&ct.isRunnable(e.bound)}withListeners({onStart:e,onEnd:n,onError:r}){return new ra({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new $E({config:s,onStart:e,onEnd:n,onError:r})]})]})}}class Ru extends ct{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Ru({bound:this.bound.bind(e)})}async invoke(e,n){return this._callWithConfig(this._invoke,e,n)}async _invoke(e,n,r){return this.bound.batch(e,_t(n,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:n,onError:r}){return new Ru({bound:this.bound.withListeners({onStart:e,onEnd:n,onError:r})})}}class AI extends ra{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,n,r){const s=e>1?`retry:attempt:${e}`:void 0;return _t(n,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,n,r){return Pu(s=>super.invoke(e,this._patchConfigForRetry(s,n,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,n){return this._callWithConfig(this._invoke,e,n)}async _batch(e,n,r,s){const a={};try{await Pu(async i=>{const o=e.map((f,h)=>h).filter(f=>a[f.toString()]===void 0||a[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(i,n==null?void 0:n[f],r==null?void 0:r[f])),c=await super.batch(l,u,{...s,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const h=c[f],y=o[f];h instanceof Error&&d===void 0&&(d=h,d.input=l[f]),a[y.toString()]=h}if(d)throw d;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if((s==null?void 0:s.returnExceptions)!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,n,r){return this._batchWithConfig(this._batch.bind(this),e,n,r)}}class qs extends ct{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,n){const r=xe(n),s=await rs(r),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),nt(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let i=e,o;try{const l=[this.first,...this.middle];for(let u=0;u<l.length;u+=1)i=await l[u].invoke(i,_t(r,{callbacks:a==null?void 0:a.getChild(`seq:step:${u+1}`)}));o=await this.last.invoke(i,_t(r,{callbacks:a==null?void 0:a.getChild(`seq:step:${this.steps.length}`)}))}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(nt(o,"output"))),o}async batch(e,n,r){const s=this._getOptionsList(n??{},e.length),a=await Promise.all(s.map(rs)),i=await Promise.all(a.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),nt(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,c}));let o=e;try{for(let l=0;l<this.steps.length;l+=1)o=await this.steps[l].batch(o,i.map((c,d)=>{const f=c==null?void 0:c.getChild(`seq:step:${l+1}`);return _t(s[d],{callbacks:f})}),r)}catch(l){throw await Promise.all(i.map(u=>u==null?void 0:u.handleChainError(l))),l}return await Promise.all(i.map(l=>l==null?void 0:l.handleChainEnd(nt(o,"output")))),o}async*_streamIterator(e,n){const r=await rs(n),{runId:s,...a}=n??{},i=await(r==null?void 0:r.handleChainStart(this.toJSON(),nt(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let d=o[0].transform(c(),_t(a,{callbacks:i==null?void 0:i.getChild("seq:step:1")}));for(let f=1;f<o.length;f+=1)d=await o[f].transform(d,_t(a,{callbacks:i==null?void 0:i.getChild(`seq:step:${f+1}`)}));for await(const f of d)if(yield f,l)if(u===void 0)u=f;else try{u=Rr(u,f)}catch{u=void 0,l=!1}}catch(d){throw await(i==null?void 0:i.handleChainError(d)),d}await(i==null?void 0:i.handleChainEnd(nt(u,"output")))}getGraph(e){const n=new BE;let r=null;return this.steps.forEach((s,a)=>{const i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),n.extend(i);const o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&n.addEdge(r,o),r=i.lastNode()}),n}pipe(e){return qs.isRunnableSequence(e)?new qs({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new qs({first:this.first,middle:[...this.middle,this.last],last:Xr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ct.isRunnable(e)}static from([e,...n],r){return new qs({first:Xr(e),middle:n.slice(0,-1).map(Xr),last:Xr(n[n.length-1]),name:r})}}class $o extends ct{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[n,r]of Object.entries(e.steps))this.steps[n]=Xr(r)}static from(e){return new $o({steps:e})}async invoke(e,n){const r=xe(n),s=await rs(r),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const i={};try{await Promise.all(Object.entries(this.steps).map(async([o,l])=>{i[o]=await l.invoke(e,_t(r,{callbacks:a==null?void 0:a.getChild(`map:key:${o}`)}))}))}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(i)),i}async*_transform(e,n,r){const s={...this.steps},a=NE(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,l],u)=>{const c=l.transform(a[u],_t(r,{callbacks:n==null?void 0:n.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;i.size;){const{key:o,result:l,gen:u}=await Promise.race(i.values());i.delete(o),l.done||(yield{[o]:l.value},i.set(o,u.next().then(c=>({key:o,gen:u,result:c}))))}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=new Ma(this.transform(r(),n));return await s.setup,Dn.fromAsyncGenerator(s)}}class bm extends ct{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new bm({func:e})}async _invoke(e,n,r){return new Promise((s,a)=>{const i=_t(n,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??Hd)-1});go.getInstance().run(i,async()=>{try{let o=await this.func(e,{...i,config:i});if(o&&ct.isRunnable(o)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...i,recursionLimit:(i.recursionLimit??Hd)-1})}else if(Yy(o)){let l;for await(const u of t_(i,o))if(l===void 0)l=u;else try{l=Rr(l,u)}catch{l=u}o=l}else if(Xy(o)){let l;for(const u of e_(i,o))if(l===void 0)l=u;else try{l=Rr(l,u)}catch{l=u}o=l}s(o)}catch(o){a(o)}})})}async invoke(e,n){return this._callWithConfig(this._invoke,e,n)}async*_transform(e,n,r){let s;for await(const i of e)if(s===void 0)s=i;else try{s=Rr(s,i)}catch{s=i}const a=await new Promise((i,o)=>{go.getInstance().run(r,async()=>{try{const l=await this.func(s,{...r,config:r});i(l)}catch(l){o(l)}})});if(a&&ct.isRunnable(a)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const i=await a.stream(s,_t(r,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??Hd)-1}));for await(const o of i)yield o}else if(Yy(a))for await(const i of t_(r,a))yield i;else if(Xy(a))for(const i of e_(r,a))yield i;else yield a}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=new Ma(this.transform(r(),n));return await s.setup,Dn.fromAsyncGenerator(s)}}class OI extends ct{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,n){const r=await Pt.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata),{runId:s,...a}=n??{},i=await(r==null?void 0:r.handleChainStart(this.toJSON(),nt(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName));let o;for(const l of this.runnables())try{const u=await l.invoke(e,_t(a,{callbacks:i==null?void 0:i.getChild()}));return await(i==null?void 0:i.handleChainEnd(nt(u,"output"))),u}catch(u){o===void 0&&(o=u)}throw o===void 0?new Error("No error stored at end of fallback."):(await(i==null?void 0:i.handleChainError(o)),o)}async batch(e,n,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(n??{},e.length),a=await Promise.all(s.map(l=>Pt.configure(l==null?void 0:l.callbacks,void 0,l==null?void 0:l.tags,void 0,l==null?void 0:l.metadata))),i=await Promise.all(a.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),nt(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,c}));let o;for(const l of this.runnables())try{const u=await l.batch(e,i.map((c,d)=>_t(s[d],{callbacks:c==null?void 0:c.getChild()})),r);return await Promise.all(i.map((c,d)=>c==null?void 0:c.handleChainEnd(nt(u[d],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(i.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Xr(t){if(typeof t=="function")return new bm({func:t});if(ct.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))e[n]=Xr(r);return new $o({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class CI extends ct{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof $o&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,n){const r=await this.mapper.invoke(e,n);return{...e,...r}}async*_transform(e,n,r){const s=this.mapper.getStepsKeys(),[a,i]=NE(e),o=this.mapper.transform(i,_t(r,{callbacks:n==null?void 0:n.getChild()})),l=o.next();for await(const u of a){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=new Ma(this.transform(r(),n));return await s.setup,Dn.fromAsyncGenerator(s)}}class TI extends ct{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const n=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return n.length===0?void 0:Object.fromEntries(n)}}async invoke(e,n){return this._callWithConfig(this._pick.bind(this),e,n)}async*_transform(e){for await(const n of e){const r=await this._pick(n);r!==void 0&&(yield r)}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=new Ma(this.transform(r(),n));return await s.setup,Dn.fromAsyncGenerator(s)}}const RI=t=>t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t,II=()=>!1;class NI extends ct{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??II(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class $I extends NI{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:n,...r}){super({callbacks:e??n,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=lm.global():this.cache=void 0,this.caller=new dm(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let n=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await FA("modelName"in this?RI(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new fE(e):Array.isArray(e)?new tA(e.map(Oi)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...n}){const r={...this._identifyingParams(),...n,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class qr extends $I{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[n,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[n,r]}async invoke(e,n){const r=qr._convertInputToPromptValue(e);return(await this.generatePrompt([r],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,n,r){throw new Error("Not implemented.")}async*_streamIterator(e,n){if(this._streamResponseChunks===qr.prototype._streamResponseChunks)yield this.invoke(e,n);else{const s=qr._convertInputToPromptValue(e).toChatMessages(),[a,i]=this._separateRunnableConfigFromCallOptions(n),o=await Pt.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),[s],a.runId,void 0,l,void 0,void 0,a.runName));let c;try{for await(const d of this._streamResponseChunks(s,i,u==null?void 0:u[0]))d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},yield d.message,c?c=c.concat(d):c=d}catch(d){throw await Promise.all((u??[]).map(f=>f==null?void 0:f.handleLLMError(d))),d}await Promise.all((u??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[c]]})))}}async _generateUncached(e,n,r){var f;const s=e.map(h=>h.map(Oi)),a=await Pt.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1},o=await(a==null?void 0:a.handleChatModelStart(this.toJSON(),s,r.runId,void 0,i,void 0,void 0,r.runName)),l=await Promise.allSettled(s.map((h,y)=>this._generate(h,{...n,promptIndex:y},o==null?void 0:o[y]))),u=[],c=[];await Promise.all(l.map(async(h,y)=>{var m,v;if(h.status==="fulfilled"){const g=h.value;for(const p of g.generations)p.message.response_metadata={...p.generationInfo,...p.message.response_metadata};return g.generations.length===1&&(g.generations[0].message.response_metadata={...g.llmOutput,...g.generations[0].message.response_metadata}),u[y]=g.generations,c[y]=g.llmOutput,(m=o==null?void 0:o[y])==null?void 0:m.handleLLMEnd({generations:[g.generations],llmOutput:g.llmOutput})}else return await((v=o==null?void 0:o[y])==null?void 0:v.handleLLMError(h.reason)),Promise.reject(h.reason)}));const d={generations:u,llmOutput:c.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...c):void 0};return Object.defineProperty(d,dy,{value:o?{runIds:o==null?void 0:o.map(h=>h.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:n,llmStringKey:r,parsedOptions:s,handledOptions:a}){const i=e.map(m=>m.map(Oi)),o=await Pt.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1,cached:!0},u=await(o==null?void 0:o.handleChatModelStart(this.toJSON(),i,a.runId,void 0,l,void 0,void 0,a.runName)),c=[],f=(await Promise.allSettled(i.map(async(m,v)=>{const g=qr._convertInputToPromptValue(m).toString(),p=await n.lookup(g,r);return p==null&&c.push(v),p}))).map((m,v)=>({result:m,runManager:u==null?void 0:u[v]})).filter(({result:m})=>m.status==="fulfilled"&&m.value!=null||m.status==="rejected"),h=[];await Promise.all(f.map(async({result:m,runManager:v},g)=>{if(m.status==="fulfilled"){const p=m.value;return h[g]=p,p.length&&await(v==null?void 0:v.handleLLMNewToken(p[0].text)),v==null?void 0:v.handleLLMEnd({generations:[p]})}else return await(v==null?void 0:v.handleLLMError(m.reason)),Promise.reject(m.reason)}));const y={generations:h,missingPromptIndices:c};return Object.defineProperty(y,dy,{value:u?{runIds:u==null?void 0:u.map(m=>m.runId)}:void 0,configurable:!0}),y}async generate(e,n,r){let s;Array.isArray(n)?s={stop:n}:s=n;const a=e.map(h=>h.map(Oi)),[i,o]=this._separateRunnableConfigFromCallOptions(s);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,o,i);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d}=await this._generateCached({messages:a,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:i});let f={};if(d.length>0){const h=await this._generateUncached(d.map(y=>a[y]),o,i);await Promise.all(h.generations.map(async(y,m)=>{const v=d[m];c[v]=y;const g=qr._convertInputToPromptValue(a[v]).toString();return l.update(g,u,y)})),f=h.llmOutput??{}}return{generations:c,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,n,r){const s=e.map(a=>a.toChatMessages());return this.generate(s,n,r)}async call(e,n,r){return(await this.generate([e.map(Oi)],n,r)).generations[0][0].message}async callPrompt(e,n,r){const s=e.toChatMessages();return this.call(s,n,r)}async predictMessages(e,n,r){return this.call(e,n,r)}async predict(e,n,r){const s=new Su(e),a=await this.call([s],n,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}}function jI(t){return{name:t.name,description:t.description,parameters:zE(t.schema)}}function LI(t){return DI(t)?{type:"function",function:jI(t)}:t}function DI(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function MI(t){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:a}=t;if(r&&s&&e)return`${s}/${e}`;if(r){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${e}`}return a}var FI={},Pc={},Qa={};const Em=kS(wk);var kc={};Object.defineProperty(kc,"__esModule",{value:!0});kc.parseAnyDef=void 0;function UI(){return{}}kc.parseAnyDef=UI;var Xa={},rr={};Object.defineProperty(rr,"__esModule",{value:!0});rr.setResponseValueAndErrors=rr.addErrorMessage=void 0;function VE(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage=Object.assign(Object.assign({},t.errorMessage),{[e]:n}))}rr.addErrorMessage=VE;function zI(t,e,n,r,s){t[e]=n,VE(t,e,r,s)}rr.setResponseValueAndErrors=zI;var n_;function BI(){if(n_)return Xa;n_=1,Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.parseArrayDef=void 0;const t=Em,e=rr,n=Je();function r(s,a){var i,o;const l={type:"array"};return((o=(i=s.type)===null||i===void 0?void 0:i._def)===null||o===void 0?void 0:o.typeName)!==t.ZodFirstPartyTypeKind.ZodAny&&(l.items=(0,n.parseDef)(s.type._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"items"]}))),s.minLength&&(0,e.setResponseValueAndErrors)(l,"minItems",s.minLength.value,s.minLength.message,a),s.maxLength&&(0,e.setResponseValueAndErrors)(l,"maxItems",s.maxLength.value,s.maxLength.message,a),l}return Xa.parseArrayDef=r,Xa}var xc={};Object.defineProperty(xc,"__esModule",{value:!0});xc.parseBigintDef=void 0;function VI(){return{type:"integer",format:"int64"}}xc.parseBigintDef=VI;var Ac={};Object.defineProperty(Ac,"__esModule",{value:!0});Ac.parseBooleanDef=void 0;function HI(){return{type:"boolean"}}Ac.parseBooleanDef=HI;var Ya={},r_;function ZI(){if(r_)return Ya;r_=1,Object.defineProperty(Ya,"__esModule",{value:!0}),Ya.parseBrandedDef=void 0;const t=Je();function e(n,r){return(0,t.parseDef)(n.type._def,r)}return Ya.parseBrandedDef=e,Ya}var ei={},s_;function qI(){if(s_)return ei;s_=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.parseCatchDef=void 0;const t=Je(),e=(n,r)=>(0,t.parseDef)(n.innerType._def,r);return ei.parseCatchDef=e,ei}var Oc={};Object.defineProperty(Oc,"__esModule",{value:!0});Oc.parseDateDef=void 0;function GI(){return{type:"string",format:"date-time"}}Oc.parseDateDef=GI;var ti={},a_;function WI(){if(a_)return ti;a_=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.parseDefaultDef=void 0;const t=Je();function e(n,r){return Object.assign(Object.assign({},(0,t.parseDef)(n.innerType._def,r)),{default:n.defaultValue()})}return ti.parseDefaultDef=e,ti}var ni={},i_;function KI(){if(i_)return ni;i_=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.parseEffectsDef=void 0;const t=Je();function e(n,r){return r.effectStrategy==="input"?(0,t.parseDef)(n.schema._def,r):{}}return ni.parseEffectsDef=e,ni}var Cc={};Object.defineProperty(Cc,"__esModule",{value:!0});Cc.parseEnumDef=void 0;function JI(t){return{type:"string",enum:t.values}}Cc.parseEnumDef=JI;var ri={},o_;function QI(){if(o_)return ri;o_=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.parseIntersectionDef=void 0;const t=Je();function e(n,r){const s=[(0,t.parseDef)(n.left._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf","0"]})),(0,t.parseDef)(n.right._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf","1"]}))].filter(a=>!!a);return s.length?{allOf:s}:void 0}return ri.parseIntersectionDef=e,ri}var Tc={};Object.defineProperty(Tc,"__esModule",{value:!0});Tc.parseLiteralDef=void 0;function XI(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}Tc.parseLiteralDef=XI;var si={},l_;function YI(){if(l_)return si;l_=1,Object.defineProperty(si,"__esModule",{value:!0}),si.parseMapDef=void 0;const t=Je();function e(n,r){const s=(0,t.parseDef)(n.keyType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","0"]}))||{},a=(0,t.parseDef)(n.valueType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items","items","1"]}))||{};return{type:"array",maxItems:125,items:{type:"array",items:[s,a],minItems:2,maxItems:2}}}return si.parseMapDef=e,si}var Rc={};Object.defineProperty(Rc,"__esModule",{value:!0});Rc.parseNativeEnumDef=void 0;function eN(t){const e=t.values,r=Object.keys(t.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}Rc.parseNativeEnumDef=eN;var Ic={};Object.defineProperty(Ic,"__esModule",{value:!0});Ic.parseNeverDef=void 0;function tN(){return{not:{}}}Ic.parseNeverDef=tN;var Nc={};Object.defineProperty(Nc,"__esModule",{value:!0});Nc.parseNullDef=void 0;function nN(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}Nc.parseNullDef=nN;var ai={},Gd={},u_;function HE(){return u_||(u_=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.parseUnionDef=t.primitiveMappings=void 0;const e=Je();t.primitiveMappings={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function n(s,a){if(a.target==="openApi3")return r(s,a);const i=s.options instanceof Map?Array.from(s.options.values()):s.options;if(i.every(o=>o._def.typeName in t.primitiveMappings&&(!o._def.checks||!o._def.checks.length))){const o=i.reduce((l,u)=>{const c=t.primitiveMappings[u._def.typeName];return c&&!l.includes(c)?[...l,c]:l},[]);return{type:o.length>1?o:o[0]}}else if(i.every(o=>o._def.typeName==="ZodLiteral")){const o=i.reduce((l,u)=>{const c=typeof u._def.value;switch(c){case"string":case"number":case"boolean":return[...l,c];case"bigint":return[...l,"integer"];case"object":if(u._def.value===null)return[...l,"null"];case"symbol":case"undefined":case"function":default:return l}},[]);if(o.length===i.length){const l=o.filter((u,c,d)=>d.indexOf(u)===c);return{type:l.length>1?l:l[0],enum:i.reduce((u,c)=>u.includes(c._def.value)?u:[...u,c._def.value],[])}}}else if(i.every(o=>o._def.typeName==="ZodEnum"))return{type:"string",enum:i.reduce((o,l)=>[...o,...l._def.values.filter(u=>!o.includes(u))],[])};return r(s,a)}t.parseUnionDef=n;const r=(s,a)=>{const i=(s.options instanceof Map?Array.from(s.options.values()):s.options).map((o,l)=>(0,e.parseDef)(o._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"anyOf",`${l}`]}))).filter(o=>!!o&&(!a.strictUnions||typeof o=="object"&&Object.keys(o).length>0));return i.length?{anyOf:i}:void 0}}(Gd)),Gd}var c_;function rN(){if(c_)return ai;c_=1,Object.defineProperty(ai,"__esModule",{value:!0}),ai.parseNullableDef=void 0;const t=Je(),e=HE();function n(r,s){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return s.target==="openApi3"?{type:e.primitiveMappings[r.innerType._def.typeName],nullable:!0}:{type:[e.primitiveMappings[r.innerType._def.typeName],"null"]};const a=(0,t.parseDef)(r.innerType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"anyOf","0"]}));return a?s.target==="openApi3"?Object.assign(Object.assign({},a),{nullable:!0}):{anyOf:[a,{type:"null"}]}:void 0}return ai.parseNullableDef=n,ai}var $c={};Object.defineProperty($c,"__esModule",{value:!0});$c.parseNumberDef=void 0;const dr=rr;function sN(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",(0,dr.addErrorMessage)(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?(0,dr.setResponseValueAndErrors)(n,"minimum",r.value,r.message,e):(0,dr.setResponseValueAndErrors)(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),(0,dr.setResponseValueAndErrors)(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?(0,dr.setResponseValueAndErrors)(n,"maximum",r.value,r.message,e):(0,dr.setResponseValueAndErrors)(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),(0,dr.setResponseValueAndErrors)(n,"maximum",r.value,r.message,e));break;case"multipleOf":(0,dr.setResponseValueAndErrors)(n,"multipleOf",r.value,r.message,e);break}return n}$c.parseNumberDef=sN;var ii={},d_;function aN(){if(d_)return ii;d_=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.parseObjectDef=void 0;const t=Je();function e(n,r){var s;const a=Object.assign(Object.assign({type:"object"},Object.entries(n.shape()).reduce((i,[o,l])=>{if(l===void 0||l._def===void 0)return i;const u=(0,t.parseDef)(l._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"properties",o],propertyPath:[...r.currentPath,"properties",o]}));return u===void 0?i:{properties:Object.assign(Object.assign({},i.properties),{[o]:u}),required:l.isOptional()?i.required:[...i.required,o]}},{properties:{},required:[]})),{additionalProperties:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":(s=(0,t.parseDef)(n.catchall._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"additionalProperties"]})))!==null&&s!==void 0?s:!0});return a.required.length||delete a.required,a}return ii.parseObjectDef=e,ii}var oi={},f_;function iN(){if(f_)return oi;f_=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.parseOptionalDef=void 0;const t=Je(),e=(n,r)=>{var s;if(r.currentPath.toString()===((s=r.propertyPath)===null||s===void 0?void 0:s.toString()))return(0,t.parseDef)(n.innerType._def,r);const a=(0,t.parseDef)(n.innerType._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"anyOf","1"]}));return a?{anyOf:[{not:{}},a]}:{}};return oi.parseOptionalDef=e,oi}var li={},h_;function oN(){if(h_)return li;h_=1,Object.defineProperty(li,"__esModule",{value:!0}),li.parsePipelineDef=void 0;const t=Je(),e=(n,r)=>{const s=(0,t.parseDef)(n.in._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf","0"]})),a=(0,t.parseDef)(n.out._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"allOf",s?"1":"0"]}));return{allOf:[s,a].filter(i=>i!==void 0)}};return li.parsePipelineDef=e,li}var ui={},p_;function lN(){if(p_)return ui;p_=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.parsePromiseDef=void 0;const t=Je();function e(n,r){return(0,t.parseDef)(n.type._def,r)}return ui.parsePromiseDef=e,ui}var ci={},jo={};Object.defineProperty(jo,"__esModule",{value:!0});jo.parseStringDef=void 0;const Bn=rr;function uN(t,e){const n={type:"string"};if(t.checks)for(const r of t.checks)switch(r.kind){case"min":(0,Bn.setResponseValueAndErrors)(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e);break;case"max":(0,Bn.setResponseValueAndErrors)(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"email":(0,Bn.setResponseValueAndErrors)(n,"format","email",r.message,e);break;case"url":(0,Bn.setResponseValueAndErrors)(n,"format","uri",r.message,e);break;case"uuid":(0,Bn.setResponseValueAndErrors)(n,"format","uuid",r.message,e);break;case"regex":di(n,r.regex.source,r.message,e);break;case"cuid":di(n,"^c[^\\s-]{8,}$",r.message,e);break;case"cuid2":di(n,"^[a-z][a-z0-9]*$",r.message,e);break;case"startsWith":di(n,"^"+m_(r.value),r.message,e);break;case"endsWith":di(n,m_(r.value)+"$",r.message,e);break;case"trim":break;case"datetime":(0,Bn.setResponseValueAndErrors)(n,"format","date-time",r.message,e);break;case"length":(0,Bn.setResponseValueAndErrors)(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e),(0,Bn.setResponseValueAndErrors)(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break}return n}jo.parseStringDef=uN;const m_=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),di=(t,e,n,r)=>{var s;t.pattern||!((s=t.allOf)===null||s===void 0)&&s.some(a=>a.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push(Object.assign({pattern:t.pattern},t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}})),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push(Object.assign({pattern:e},n&&r.errorMessages&&{errorMessage:{pattern:n}}))):(0,Bn.setResponseValueAndErrors)(t,"pattern",e,n,r)};var g_;function cN(){if(g_)return ci;g_=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.parseRecordDef=void 0;const t=Em,e=Je(),n=jo;function r(s,a){var i,o,l;const u={type:"object",additionalProperties:(0,e.parseDef)(s.valueType._def,Object.assign(Object.assign({},a),{currentPath:[...a.currentPath,"additionalProperties"]}))||{}};if(((i=s.keyType)===null||i===void 0?void 0:i._def.typeName)===t.ZodFirstPartyTypeKind.ZodString&&(!((o=s.keyType._def.checks)===null||o===void 0)&&o.length)){const c=Object.entries((0,n.parseStringDef)(s.keyType._def,a)).reduce((d,[f,h])=>f==="type"?d:Object.assign(Object.assign({},d),{[f]:h}),{});return Object.assign(Object.assign({},u),{propertyNames:c})}else if(((l=s.keyType)===null||l===void 0?void 0:l._def.typeName)===t.ZodFirstPartyTypeKind.ZodEnum)return Object.assign(Object.assign({},u),{propertyNames:{enum:s.keyType._def.values}});return u}return ci.parseRecordDef=r,ci}var fi={},y_;function dN(){if(y_)return fi;y_=1,Object.defineProperty(fi,"__esModule",{value:!0}),fi.parseSetDef=void 0;const t=rr,e=Je();function n(r,s){const i={type:"array",items:(0,e.parseDef)(r.valueType._def,Object.assign(Object.assign({},s),{currentPath:[...s.currentPath,"items"]}))};return r.minSize&&(0,t.setResponseValueAndErrors)(i,"minItems",r.minSize.value,r.minSize.message,s),r.maxSize&&(0,t.setResponseValueAndErrors)(i,"maxItems",r.maxSize.value,r.maxSize.message,s),i}return fi.parseSetDef=n,fi}var hi={},__;function fN(){if(__)return hi;__=1,Object.defineProperty(hi,"__esModule",{value:!0}),hi.parseTupleDef=void 0;const t=Je();function e(n,r){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((s,a)=>(0,t.parseDef)(s._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${a}`]}))).reduce((s,a)=>a===void 0?s:[...s,a],[]),additionalItems:(0,t.parseDef)(n.rest._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"additionalItems"]}))}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((s,a)=>(0,t.parseDef)(s._def,Object.assign(Object.assign({},r),{currentPath:[...r.currentPath,"items",`${a}`]}))).reduce((s,a)=>a===void 0?s:[...s,a],[])}}return hi.parseTupleDef=e,hi}var jc={};Object.defineProperty(jc,"__esModule",{value:!0});jc.parseUndefinedDef=void 0;function hN(){return{not:{}}}jc.parseUndefinedDef=hN;var Lc={};Object.defineProperty(Lc,"__esModule",{value:!0});Lc.parseUnknownDef=void 0;function pN(){return{}}Lc.parseUnknownDef=pN;var v_;function Je(){if(v_)return Qa;v_=1,Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.parseDef=void 0;const t=Em,e=kc,n=BI(),r=xc,s=Ac,a=ZI(),i=qI(),o=Oc,l=WI(),u=KI(),c=Cc,d=QI(),f=Tc,h=YI(),y=Rc,m=Ic,v=Nc,g=rN(),p=$c,_=aN(),w=iN(),b=oN(),P=lN(),k=cN(),R=dN(),Z=jo,M=fN(),K=jc,Qe=HE(),At=Lc;function j(E,A){const I=A.seen.find(ve=>Object.is(ve.def,E));if(I)return N(I,A);const F={def:E,path:A.currentPath,jsonSchema:void 0};A.seen.push(F);const ie=z(E,E.typeName,A);return ie&&x(E,ie),F.jsonSchema=ie,ie}Qa.parseDef=j;const N=(E,A)=>{switch(A.$refStrategy){case"root":return{$ref:E.path.length===0?"":E.path.length===1?`${E.path[0]}/`:E.path.join("/")};case"relative":return{$ref:V(A.currentPath,E.path)};case"none":return E.path.length<A.currentPath.length&&E.path.every((I,F)=>A.currentPath[F]===I)?(console.warn(`Recursive reference detected at ${A.currentPath.join("/")}! Defaulting to any`),{}):E.jsonSchema}},V=(E,A)=>{let I=0;for(;I<E.length&&I<A.length&&E[I]===A[I];I++);return[(E.length-I).toString(),...A.slice(I)].join("/")},z=(E,A,I)=>{switch(A){case t.ZodFirstPartyTypeKind.ZodString:return(0,Z.parseStringDef)(E,I);case t.ZodFirstPartyTypeKind.ZodNumber:return(0,p.parseNumberDef)(E,I);case t.ZodFirstPartyTypeKind.ZodObject:return(0,_.parseObjectDef)(E,I);case t.ZodFirstPartyTypeKind.ZodBigInt:return(0,r.parseBigintDef)();case t.ZodFirstPartyTypeKind.ZodBoolean:return(0,s.parseBooleanDef)();case t.ZodFirstPartyTypeKind.ZodDate:return(0,o.parseDateDef)();case t.ZodFirstPartyTypeKind.ZodUndefined:return(0,K.parseUndefinedDef)();case t.ZodFirstPartyTypeKind.ZodNull:return(0,v.parseNullDef)(I);case t.ZodFirstPartyTypeKind.ZodArray:return(0,n.parseArrayDef)(E,I);case t.ZodFirstPartyTypeKind.ZodUnion:case t.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return(0,Qe.parseUnionDef)(E,I);case t.ZodFirstPartyTypeKind.ZodIntersection:return(0,d.parseIntersectionDef)(E,I);case t.ZodFirstPartyTypeKind.ZodTuple:return(0,M.parseTupleDef)(E,I);case t.ZodFirstPartyTypeKind.ZodRecord:return(0,k.parseRecordDef)(E,I);case t.ZodFirstPartyTypeKind.ZodLiteral:return(0,f.parseLiteralDef)(E,I);case t.ZodFirstPartyTypeKind.ZodEnum:return(0,c.parseEnumDef)(E);case t.ZodFirstPartyTypeKind.ZodNativeEnum:return(0,y.parseNativeEnumDef)(E);case t.ZodFirstPartyTypeKind.ZodNullable:return(0,g.parseNullableDef)(E,I);case t.ZodFirstPartyTypeKind.ZodOptional:return(0,w.parseOptionalDef)(E,I);case t.ZodFirstPartyTypeKind.ZodMap:return(0,h.parseMapDef)(E,I);case t.ZodFirstPartyTypeKind.ZodSet:return(0,R.parseSetDef)(E,I);case t.ZodFirstPartyTypeKind.ZodLazy:return j(E.getter()._def,I);case t.ZodFirstPartyTypeKind.ZodPromise:return(0,P.parsePromiseDef)(E,I);case t.ZodFirstPartyTypeKind.ZodNaN:case t.ZodFirstPartyTypeKind.ZodNever:return(0,m.parseNeverDef)();case t.ZodFirstPartyTypeKind.ZodEffects:return(0,u.parseEffectsDef)(E,I);case t.ZodFirstPartyTypeKind.ZodAny:return(0,e.parseAnyDef)();case t.ZodFirstPartyTypeKind.ZodUnknown:return(0,At.parseUnknownDef)();case t.ZodFirstPartyTypeKind.ZodDefault:return(0,l.parseDefaultDef)(E,I);case t.ZodFirstPartyTypeKind.ZodBranded:return(0,a.parseBrandedDef)(E,I);case t.ZodFirstPartyTypeKind.ZodCatch:return(0,i.parseCatchDef)(E,I);case t.ZodFirstPartyTypeKind.ZodPipeline:return(0,b.parsePipelineDef)(E,I);case t.ZodFirstPartyTypeKind.ZodFunction:case t.ZodFirstPartyTypeKind.ZodVoid:case t.ZodFirstPartyTypeKind.ZodSymbol:return;default:return(F=>{})()}},x=(E,A)=>(E.description&&(A.description=E.description),A);return Qa}var Dc={},ZE={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultOptions=t.defaultOptions=void 0,t.defaultOptions={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1};const e=n=>typeof n=="string"?Object.assign(Object.assign({},t.defaultOptions),{name:n}):Object.assign(Object.assign({},t.defaultOptions),n);t.getDefaultOptions=e})(ZE);Object.defineProperty(Dc,"__esModule",{value:!0});Dc.getRefs=void 0;const mN=ZE,gN=t=>{const e=(0,mN.getDefaultOptions)(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return Object.assign(Object.assign({},e),{currentPath:n,propertyPath:void 0,seen:[]})};Dc.getRefs=gN;Object.defineProperty(Pc,"__esModule",{value:!0});Pc.zodToJsonSchema=void 0;const w_=Je(),yN=Dc,_N=(t,e)=>{var n;const r=(0,yN.getRefs)(e),s=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[u,c])=>{var d;return Object.assign(Object.assign({},l),{[u]:(d=(0,w_.parseDef)(c._def,Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,u]})))!==null&&d!==void 0?d:{}})},{}):void 0,a=typeof e=="string"?e:e==null?void 0:e.name,i=(n=(0,w_.parseDef)(t._def,a===void 0?r:Object.assign(Object.assign({},r),{currentPath:[...r.basePath,r.definitionPath,a]})))!==null&&n!==void 0?n:{},o=a===void 0?s?Object.assign(Object.assign({},i),{[r.definitionPath]:s}):i:{$ref:[...r.$refStrategy==="relative"?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:Object.assign(Object.assign({},s),{[a]:i})};return r.target==="jsonSchema7"&&(o.$schema="http://json-schema.org/draft-07/schema#"),o};Pc.zodToJsonSchema=_N;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.zodToJsonSchema=void 0;const e=Pc;Object.defineProperty(t,"zodToJsonSchema",{enumerable:!0,get:function(){return e.zodToJsonSchema}}),t.default=e.zodToJsonSchema})(FI);function vN(t){let e;return t.constructor.name===ec.name?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===jt.name?(e=new Error(t.message),e.name="AbortError"):e=t,e}function wN(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function bN(t){const e=["namespace functions {",""];for(const n of t)n.description&&e.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(e.push(`type ${n.name} = (_: {`),e.push(qE(n.parameters,0)),e.push("}) => any;")):e.push(`type ${n.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function qE(t,e){var r;const n=[];for(const[s,a]of Object.entries(t.properties??{}))a.description&&e<2&&n.push(`// ${a.description}`),(r=t.required)!=null&&r.includes(s)?n.push(`${s}: ${Iu(a,e)},`):n.push(`${s}?: ${Iu(a,e)},`);return n.map(s=>" ".repeat(e)+s).join(`
`)}function Iu(t,e){if(wN(t))return t.anyOf.map(n=>Iu(n,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",qE(t,e+2),"}"].join(`
`);case"array":return t.items?`${Iu(t.items,e)}[]`:"any[]";default:return""}}function EN(t){return t.role!=="system"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function GE(t){const e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!hc.isInstance(t))throw new Error("Invalid generic chat message");return EN(t)}default:throw new Error(`Unknown message type: ${e}`)}}function SN(t){switch(t.role){case"assistant":return new lE(t.content||"",{function_call:t.function_call,tool_calls:t.tool_calls});default:return new hc(t.content||"",t.role??"unknown")}}function PN(t,e){const n=t.role??e,r=t.content??"";let s;return t.function_call?s={function_call:t.function_call}:t.tool_calls?s={tool_calls:t.tool_calls}:s={},n==="user"?new sm({content:r}):n==="assistant"?new fc({content:r,additional_kwargs:s}):n==="system"?new am({content:r}):n==="function"?new rm({content:r,additional_kwargs:s,name:t.name}):n==="tool"?new tm({content:r,additional_kwargs:s,tool_call_id:t.tool_call_id}):new nm({content:r,role:n})}function b_(t){return t.map(e=>({role:GE(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id}))}class Lo extends qr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,n){var r,s,a,i,o,l,u,c;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.openAIApiKey)??Nt("OPENAI_API_KEY"),this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??Nt("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.openAIApiKey)throw new Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??Nt("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??Nt("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??Nt("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??Nt("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??Nt("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.modelName)??this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=e==null?void 0:e.stop,this.user=e==null?void 0:e.user,this.streaming=(e==null?void 0:e.streaming)??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.openAIApiKey=this.openAIApiKey??""}this.clientConfig={apiKey:this.openAIApiKey,organization:this.organization,baseURL:(n==null?void 0:n.basePath)??((s=e==null?void 0:e.configuration)==null?void 0:s.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((a=n==null?void 0:n.baseOptions)==null?void 0:a.headers)??((o=(i=e==null?void 0:e.configuration)==null?void 0:i.baseOptions)==null?void 0:o.headers),defaultQuery:((l=n==null?void 0:n.baseOptions)==null?void 0:l.params)??((c=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:c.params),...n,...e==null?void 0:e.configuration}}invocationParams(e){function n(s){return s!==void 0&&s.every(a=>Array.isArray(a.lc_namespace))}return{model:this.modelName,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stop,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:n(e==null?void 0:e.tools)?e==null?void 0:e.tools.map(LI):e==null?void 0:e.tools,tool_choice:e==null?void 0:e.tool_choice,response_format:e==null?void 0:e.response_format,seed:e==null?void 0:e.seed,...this.modelKwargs}}_identifyingParams(){return{model_name:this.modelName,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,n,r){var l;const s=b_(e),a={...this.invocationParams(n),messages:s,stream:!0};let i;const o=await this.completionWithRetry(a,n);for await(const u of o){const c=u==null?void 0:u.choices[0];if(!c)continue;const{delta:d}=c;if(!d)continue;const f=PN(d,i);i=d.role??i;const h={prompt:n.promptIndex??0,completion:c.index??0};if(typeof f.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const y=new om({message:f,text:f.content,generationInfo:h});yield y,r==null||r.handleLLMNewToken(y.text??"",h,void 0,void 0,void 0,{chunk:y})}if((l=n.signal)!=null&&l.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,n,r){var o,l;const s={},a=this.invocationParams(n),i=b_(e);if(a.stream){const u=this._streamResponseChunks(e,n,r),c={};for await(const v of u){const g=((o=v.generationInfo)==null?void 0:o.completion)??0;c[g]===void 0?c[g]=v:c[g]=c[g].concat(v)}const d=Object.entries(c).sort(([v],[g])=>parseInt(v,10)-parseInt(g,10)).map(([v,g])=>g),{functions:f,function_call:h}=this.invocationParams(n),y=await this.getEstimatedTokenCountFromPrompt(e,f,h),m=await this.getNumTokensFromGenerations(d);return s.promptTokens=y,s.completionTokens=m,s.totalTokens=y+m,{generations:d,llmOutput:{estimatedTokenUsage:s}}}else{const u=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options}),{completion_tokens:c,prompt_tokens:d,total_tokens:f}=(u==null?void 0:u.usage)??{};c&&(s.completionTokens=(s.completionTokens??0)+c),d&&(s.promptTokens=(s.promptTokens??0)+d),f&&(s.totalTokens=(s.totalTokens??0)+f);const h=[];for(const y of(u==null?void 0:u.choices)??[]){const v={text:((l=y.message)==null?void 0:l.content)??"",message:SN(y.message??{role:"assistant"})};v.generationInfo={...y.finish_reason?{finish_reason:y.finish_reason}:{},...y.logprobs?{logprobs:y.logprobs}:{}},h.push(v)}return{generations:h,llmOutput:{tokenUsage:s}}}}async getEstimatedTokenCountFromPrompt(e,n,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(n&&r!=="auto"){const a=bN(n);s+=await this.getNumTokens(a),s+=9}return n&&e.find(a=>a._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let n=0,r=0,s=0;this.modelName==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const a=await Promise.all(e.map(async i=>{var f,h,y,m,v;const o=await this.getNumTokens(i.content),l=await this.getNumTokens(GE(i)),u=i.name!==void 0?s+await this.getNumTokens(i.name):0;let c=o+r+l+u;const d=i;return d._getType()==="function"&&(c-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(c+=3),(h=d==null?void 0:d.additional_kwargs.function_call)!=null&&h.name&&(c+=await this.getNumTokens((y=d.additional_kwargs.function_call)==null?void 0:y.name)),(m=d.additional_kwargs.function_call)!=null&&m.arguments&&(c+=await this.getNumTokens(JSON.stringify(JSON.parse((v=d.additional_kwargs.function_call)==null?void 0:v.arguments)))),n+=c,c}));return n+=3,{totalCount:n,countPerMessage:a}}async completionWithRetry(e,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw vN(s)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=MI(r),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new Y(a)}const n={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(n.headers={"api-key":this.azureOpenAIApiKey,...n.headers},n.query={"api-version":this.azureOpenAIApiVersion,...n.query}),n}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((n,r)=>(r&&r.tokenUsage&&(n.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,n.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,n.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),n),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}}const kN="modulepreload",xN=function(t){return"/"+t},E_={},Wd=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),o=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=xN(l),l in E_)return;E_[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":kN,u||(d.as="script"),d.crossOrigin="",d.href=l,o&&d.setAttribute("nonce",o),document.head.appendChild(d),u)return new Promise((f,h)=>{d.addEventListener("load",f),d.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(i){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i}return s.then(i=>{for(const o of i||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})};class AN extends ct{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:n}=e;if(n.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const n=this.partialVariables??{},r={};for(const[a,i]of Object.entries(n))typeof i=="string"?r[a]=i:r[a]=await i();return{...r,...e}}async invoke(e,n){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...n,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:n}=await Wd(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>k_);return{PromptTemplate:r}},void 0);return n.deserialize(e)}case void 0:{const{PromptTemplate:n}=await Wd(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>k_);return{PromptTemplate:r}},void 0);return n.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:n}=await Wd(async()=>{const{FewShotPromptTemplate:r}=await import("./few_shot.js");return{FewShotPromptTemplate:r}},[]);return n.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class ON extends AN{async formatPromptValue(e){const n=await this.format(e);return new fE(n)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var CN=Object.prototype.toString,Fa=Array.isArray||function(e){return CN.call(e)==="[object Array]"};function Sm(t){return typeof t=="function"}function TN(t){return Fa(t)?"array":typeof t}function Kd(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function S_(t,e){return t!=null&&typeof t=="object"&&e in t}function RN(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var IN=RegExp.prototype.test;function NN(t,e){return IN.call(t,e)}var $N=/\S/;function jN(t){return!NN($N,t)}var LN={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function DN(t){return String(t).replace(/[&<>"'`=\/]/g,function(n){return LN[n]})}var MN=/\s*/,FN=/\s+/,P_=/\s*=/,UN=/\s*\}/,zN=/#|\^|\/|>|\{|&|=|!/;function BN(t,e){if(!t)return[];var n=!1,r=[],s=[],a=[],i=!1,o=!1,l="",u=0;function c(){if(i&&!o)for(;a.length;)delete s[a.pop()];else a=[];i=!1,o=!1}var d,f,h;function y(R){if(typeof R=="string"&&(R=R.split(FN,2)),!Fa(R)||R.length!==2)throw new Error("Invalid tags: "+R);d=new RegExp(Kd(R[0])+"\\s*"),f=new RegExp("\\s*"+Kd(R[1])),h=new RegExp("\\s*"+Kd("}"+R[1]))}y(e||Ut.tags);for(var m=new Do(t),v,g,p,_,w,b;!m.eos();){if(v=m.pos,p=m.scanUntil(d),p)for(var P=0,k=p.length;P<k;++P)_=p.charAt(P),jN(_)?(a.push(s.length),l+=_):(o=!0,n=!0,l+=" "),s.push(["text",_,v,v+1]),v+=1,_===`
`&&(c(),l="",u=0,n=!1);if(!m.scan(d))break;if(i=!0,g=m.scan(zN)||"name",m.scan(MN),g==="="?(p=m.scanUntil(P_),m.scan(P_),m.scanUntil(f)):g==="{"?(p=m.scanUntil(h),m.scan(UN),m.scanUntil(f),g="&"):p=m.scanUntil(f),!m.scan(f))throw new Error("Unclosed tag at "+m.pos);if(g==">"?w=[g,p,v,m.pos,l,u,n]:w=[g,p,v,m.pos],u++,s.push(w),g==="#"||g==="^")r.push(w);else if(g==="/"){if(b=r.pop(),!b)throw new Error('Unopened section "'+p+'" at '+v);if(b[1]!==p)throw new Error('Unclosed section "'+b[1]+'" at '+v)}else g==="name"||g==="{"||g==="&"?o=!0:g==="="&&y(p)}if(c(),b=r.pop(),b)throw new Error('Unclosed section "'+b[1]+'" at '+m.pos);return HN(VN(s))}function VN(t){for(var e=[],n,r,s=0,a=t.length;s<a;++s)n=t[s],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(e.push(n),r=n));return e}function HN(t){for(var e=[],n=e,r=[],s,a,i=0,o=t.length;i<o;++i)switch(s=t[i],s[0]){case"#":case"^":n.push(s),r.push(s),n=s[4]=[];break;case"/":a=r.pop(),a[5]=s[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(s)}return e}function Do(t){this.string=t,this.tail=t,this.pos=0}Do.prototype.eos=function(){return this.tail===""};Do.prototype.scan=function(e){var n=this.tail.match(e);if(!n||n.index!==0)return"";var r=n[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Do.prototype.scanUntil=function(e){var n=this.tail.search(e),r;switch(n){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=r.length,r};function xa(t,e){this.view=t,this.cache={".":this.view},this.parent=e}xa.prototype.push=function(e){return new xa(e,this)};xa.prototype.lookup=function(e){var n=this.cache,r;if(n.hasOwnProperty(e))r=n[e];else{for(var s=this,a,i,o,l=!1;s;){if(e.indexOf(".")>0)for(a=s.view,i=e.split("."),o=0;a!=null&&o<i.length;)o===i.length-1&&(l=S_(a,i[o])||RN(a,i[o])),a=a[i[o++]];else a=s.view[e],l=S_(s.view,e);if(l){r=a;break}s=s.parent}n[e]=r}return Sm(r)&&(r=r.call(this.view)),r};function pt(){this.templateCache={_cache:{},set:function(e,n){this._cache[e]=n},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}pt.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};pt.prototype.parse=function(e,n){var r=this.templateCache,s=e+":"+(n||Ut.tags).join(":"),a=typeof r<"u",i=a?r.get(s):void 0;return i==null&&(i=BN(e,n),a&&r.set(s,i)),i};pt.prototype.render=function(e,n,r,s){var a=this.getConfigTags(s),i=this.parse(e,a),o=n instanceof xa?n:new xa(n,void 0);return this.renderTokens(i,o,r,e,s)};pt.prototype.renderTokens=function(e,n,r,s,a){for(var i="",o,l,u,c=0,d=e.length;c<d;++c)u=void 0,o=e[c],l=o[0],l==="#"?u=this.renderSection(o,n,r,s,a):l==="^"?u=this.renderInverted(o,n,r,s,a):l===">"?u=this.renderPartial(o,n,r,a):l==="&"?u=this.unescapedValue(o,n):l==="name"?u=this.escapedValue(o,n,a):l==="text"&&(u=this.rawValue(o)),u!==void 0&&(i+=u);return i};pt.prototype.renderSection=function(e,n,r,s,a){var i=this,o="",l=n.lookup(e[1]);function u(f){return i.render(f,n,r,a)}if(l){if(Fa(l))for(var c=0,d=l.length;c<d;++c)o+=this.renderTokens(e[4],n.push(l[c]),r,s,a);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],n.push(l),r,s,a);else if(Sm(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(n.view,s.slice(e[3],e[5]),u),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],n,r,s,a);return o}};pt.prototype.renderInverted=function(e,n,r,s,a){var i=n.lookup(e[1]);if(!i||Fa(i)&&i.length===0)return this.renderTokens(e[4],n,r,s,a)};pt.prototype.indentPartial=function(e,n,r){for(var s=n.replace(/[^ \t]/g,""),a=e.split(`
`),i=0;i<a.length;i++)a[i].length&&(i>0||!r)&&(a[i]=s+a[i]);return a.join(`
`)};pt.prototype.renderPartial=function(e,n,r,s){if(r){var a=this.getConfigTags(s),i=Sm(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],l=e[5],u=e[4],c=i;l==0&&u&&(c=this.indentPartial(i,u,o));var d=this.parse(c,a);return this.renderTokens(d,n,r,c,s)}}};pt.prototype.unescapedValue=function(e,n){var r=n.lookup(e[1]);if(r!=null)return r};pt.prototype.escapedValue=function(e,n,r){var s=this.getConfigEscape(r)||Ut.escape,a=n.lookup(e[1]);if(a!=null)return typeof a=="number"&&s===Ut.escape?String(a):s(a)};pt.prototype.rawValue=function(e){return e[1]};pt.prototype.getConfigTags=function(e){return Fa(e)?e:e&&typeof e=="object"?e.tags:void 0};pt.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Fa(e))return e.escape};var Ut={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){yo.templateCache=t},get templateCache(){return yo.templateCache}},yo=new pt;Ut.clearCache=function(){return yo.clearCache()};Ut.parse=function(e,n){return yo.parse(e,n)};Ut.render=function(e,n,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+TN(e)+'" was given as the first argument for mustache#render(template, view, partials)');return yo.render(e,n,r,s)};Ut.escape=DN;Ut.Scanner=Do;Ut.Context=xa;Ut.Writer=pt;const WE=t=>{const e=t.split(""),n=[],r=(a,i)=>{for(let o=i;o<e.length;o+=1)if(a.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")n.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")n.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const a=r("}",s);if(a<0)throw new Error("Unclosed '{' in template.");n.push({type:"variable",name:e.slice(s+1,a).join("")}),s=a+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const a=r("{}",s),i=(a<0?e.slice(s):e.slice(s,a)).join("");n.push({type:"literal",text:i}),s=a<0?e.length:a}}return n},ZN=t=>t.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:e[0]==="#"?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),qN=t=>{const e=Ut.parse(t);return ZN(e)},GN=(t,e)=>WE(t).reduce((n,r)=>{if(r.type==="variable"){if(r.name in e)return n+e[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return n+r.text},""),WN=(t,e)=>Ut.render(t,e),gh={"f-string":GN,mustache:WN},KN={"f-string":WE,mustache:qN},Ci=(t,e,n)=>gh[e](t,n),JN=(t,e)=>KN[e](t),QN=(t,e,n)=>{if(!(e in gh)){const r=Object.keys(gh);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=n.reduce((s,a)=>(s[a]="foo",s),{});Array.isArray(t)?t.forEach(s=>{if(s.type==="text")Ci(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")Ci(s.image_url,e,r);else{const a=s.image_url.url;Ci(a,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):Ci(t,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class hn extends ON{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),QN(this.template,this.templateFormat,n)}}_getPromptType(){return"prompt"}async format(e){const n=await this.mergePartialAndUserVariables(e);return Ci(this.template,this.templateFormat,n)}static fromExamples(e,n,r,s=`

`,a=""){const i=[a,...e,n].join(s);return new hn({inputVariables:r,template:i})}static fromTemplate(e,n){const{templateFormat:r="f-string",...s}=n??{},a=new Set;return JN(e,r).forEach(i=>{i.type==="variable"&&a.add(i.name)}),new hn({inputVariables:[...a],templateFormat:r,template:e,...s})}async partial(e){const n=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:n,partialVariables:r};return new hn(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new hn({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const k_=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:hn},Symbol.toStringTag,{value:"Module"})),yh={OPENAI_API_KEY:"earth_agent_openai_api_key",SETTINGS:"earth_agent_settings"},XN=async t=>{try{if(typeof chrome>"u"||!chrome.storage||!chrome.storage.sync)throw console.warn("Chrome storage API is not available in saveApiKey"),new Error("Chrome storage API is not available");console.log("Saving API key to Chrome storage, length:",t.length),await chrome.storage.sync.set({[yh.OPENAI_API_KEY]:t}),console.log("API key saved successfully")}catch(e){throw console.error("Error saving API key:",e),new Error("Failed to save API key")}},ys=async()=>{try{if(typeof chrome>"u"||!chrome.storage||!chrome.storage.sync)return console.warn("Chrome storage API is not available in getApiKey"),null;console.log("Retrieving API key from Chrome storage...");const e=(await chrome.storage.sync.get([yh.OPENAI_API_KEY]))[yh.OPENAI_API_KEY]||null;return console.log("API key retrieved from storage:",e?`length: ${e.length}`:"not found"),e}catch(t){return console.error("Error retrieving API key:",t),null}},KE=async()=>{try{if(typeof chrome>"u"||!chrome.storage||!chrome.storage.sync)return console.warn("Chrome storage API is not available"),!1;const e=!!await ys();return console.log("API key is set:",e),e}catch(t){return console.error("Error checking if API key is set:",t),!1}};function JE(t,e){return function(){return t.apply(e,arguments)}}const{toString:YN}=Object.prototype,{getPrototypeOf:Pm}=Object,Mc=(t=>e=>{const n=YN.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),bn=t=>(t=t.toLowerCase(),e=>Mc(e)===t),Fc=t=>e=>typeof e===t,{isArray:Ua}=Array,_o=Fc("undefined");function e$(t){return t!==null&&!_o(t)&&t.constructor!==null&&!_o(t.constructor)&&Dt(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const QE=bn("ArrayBuffer");function t$(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&QE(t.buffer),e}const n$=Fc("string"),Dt=Fc("function"),XE=Fc("number"),Uc=t=>t!==null&&typeof t=="object",r$=t=>t===!0||t===!1,zl=t=>{if(Mc(t)!=="object")return!1;const e=Pm(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},s$=bn("Date"),a$=bn("File"),i$=bn("Blob"),o$=bn("FileList"),l$=t=>Uc(t)&&Dt(t.pipe),u$=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Dt(t.append)&&((e=Mc(t))==="formdata"||e==="object"&&Dt(t.toString)&&t.toString()==="[object FormData]"))},c$=bn("URLSearchParams"),[d$,f$,h$,p$]=["ReadableStream","Request","Response","Headers"].map(bn),m$=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Mo(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),Ua(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const a=n?Object.getOwnPropertyNames(t):Object.keys(t),i=a.length;let o;for(r=0;r<i;r++)o=a[r],e.call(null,t[o],o,t)}}function YE(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const Yr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,eS=t=>!_o(t)&&t!==Yr;function _h(){const{caseless:t}=eS(this)&&this||{},e={},n=(r,s)=>{const a=t&&YE(e,s)||s;zl(e[a])&&zl(r)?e[a]=_h(e[a],r):zl(r)?e[a]=_h({},r):Ua(r)?e[a]=r.slice():e[a]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Mo(arguments[r],n);return e}const g$=(t,e,n,{allOwnKeys:r}={})=>(Mo(e,(s,a)=>{n&&Dt(s)?t[a]=JE(s,n):t[a]=s},{allOwnKeys:r}),t),y$=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),_$=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},v$=(t,e,n,r)=>{let s,a,i;const o={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),a=s.length;a-- >0;)i=s[a],(!r||r(i,t,e))&&!o[i]&&(e[i]=t[i],o[i]=!0);t=n!==!1&&Pm(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},w$=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},b$=t=>{if(!t)return null;if(Ua(t))return t;let e=t.length;if(!XE(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},E$=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Pm(Uint8Array)),S$=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let s;for(;(s=r.next())&&!s.done;){const a=s.value;e.call(t,a[0],a[1])}},P$=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},k$=bn("HTMLFormElement"),x$=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,s){return r.toUpperCase()+s}),x_=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),A$=bn("RegExp"),tS=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};Mo(n,(s,a)=>{let i;(i=e(s,a,t))!==!1&&(r[a]=i||s)}),Object.defineProperties(t,r)},O$=t=>{tS(t,(e,n)=>{if(Dt(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(Dt(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},C$=(t,e)=>{const n={},r=s=>{s.forEach(a=>{n[a]=!0})};return Ua(t)?r(t):r(String(t).split(e)),n},T$=()=>{},R$=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function I$(t){return!!(t&&Dt(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const N$=t=>{const e=new Array(10),n=(r,s)=>{if(Uc(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const a=Ua(r)?[]:{};return Mo(r,(i,o)=>{const l=n(i,s+1);!_o(l)&&(a[o]=l)}),e[s]=void 0,a}}return r};return n(t,0)},$$=bn("AsyncFunction"),j$=t=>t&&(Uc(t)||Dt(t))&&Dt(t.then)&&Dt(t.catch),nS=((t,e)=>t?setImmediate:e?((n,r)=>(Yr.addEventListener("message",({source:s,data:a})=>{s===Yr&&a===n&&r.length&&r.shift()()},!1),s=>{r.push(s),Yr.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Dt(Yr.postMessage)),L$=typeof queueMicrotask<"u"?queueMicrotask.bind(Yr):typeof process<"u"&&process.nextTick||nS,S={isArray:Ua,isArrayBuffer:QE,isBuffer:e$,isFormData:u$,isArrayBufferView:t$,isString:n$,isNumber:XE,isBoolean:r$,isObject:Uc,isPlainObject:zl,isReadableStream:d$,isRequest:f$,isResponse:h$,isHeaders:p$,isUndefined:_o,isDate:s$,isFile:a$,isBlob:i$,isRegExp:A$,isFunction:Dt,isStream:l$,isURLSearchParams:c$,isTypedArray:E$,isFileList:o$,forEach:Mo,merge:_h,extend:g$,trim:m$,stripBOM:y$,inherits:_$,toFlatObject:v$,kindOf:Mc,kindOfTest:bn,endsWith:w$,toArray:b$,forEachEntry:S$,matchAll:P$,isHTMLForm:k$,hasOwnProperty:x_,hasOwnProp:x_,reduceDescriptors:tS,freezeMethods:O$,toObjectSet:C$,toCamelCase:x$,noop:T$,toFiniteNumber:R$,findKey:YE,global:Yr,isContextDefined:eS,isSpecCompliantForm:I$,toJSONObject:N$,isAsyncFn:$$,isThenable:j$,setImmediate:nS,asap:L$};function Q(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s,this.status=s.status?s.status:null)}S.inherits(Q,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:S.toJSONObject(this.config),code:this.code,status:this.status}}});const rS=Q.prototype,sS={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{sS[t]={value:t}});Object.defineProperties(Q,sS);Object.defineProperty(rS,"isAxiosError",{value:!0});Q.from=(t,e,n,r,s,a)=>{const i=Object.create(rS);return S.toFlatObject(t,i,function(l){return l!==Error.prototype},o=>o!=="isAxiosError"),Q.call(i,t.message,e,n,r,s),i.cause=t,i.name=t.name,a&&Object.assign(i,a),i};const D$=null;function vh(t){return S.isPlainObject(t)||S.isArray(t)}function aS(t){return S.endsWith(t,"[]")?t.slice(0,-2):t}function A_(t,e,n){return t?t.concat(e).map(function(s,a){return s=aS(s),!n&&a?"["+s+"]":s}).join(n?".":""):e}function M$(t){return S.isArray(t)&&!t.some(vh)}const F$=S.toFlatObject(S,{},null,function(e){return/^is[A-Z]/.test(e)});function zc(t,e,n){if(!S.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=S.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,v){return!S.isUndefined(v[m])});const r=n.metaTokens,s=n.visitor||c,a=n.dots,i=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&S.isSpecCompliantForm(e);if(!S.isFunction(s))throw new TypeError("visitor must be a function");function u(y){if(y===null)return"";if(S.isDate(y))return y.toISOString();if(!l&&S.isBlob(y))throw new Q("Blob is not supported. Use a Buffer instead.");return S.isArrayBuffer(y)||S.isTypedArray(y)?l&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function c(y,m,v){let g=y;if(y&&!v&&typeof y=="object"){if(S.endsWith(m,"{}"))m=r?m:m.slice(0,-2),y=JSON.stringify(y);else if(S.isArray(y)&&M$(y)||(S.isFileList(y)||S.endsWith(m,"[]"))&&(g=S.toArray(y)))return m=aS(m),g.forEach(function(_,w){!(S.isUndefined(_)||_===null)&&e.append(i===!0?A_([m],w,a):i===null?m:m+"[]",u(_))}),!1}return vh(y)?!0:(e.append(A_(v,m,a),u(y)),!1)}const d=[],f=Object.assign(F$,{defaultVisitor:c,convertValue:u,isVisitable:vh});function h(y,m){if(!S.isUndefined(y)){if(d.indexOf(y)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(y),S.forEach(y,function(g,p){(!(S.isUndefined(g)||g===null)&&s.call(e,g,S.isString(p)?p.trim():p,m,f))===!0&&h(g,m?m.concat(p):[p])}),d.pop()}}if(!S.isObject(t))throw new TypeError("data must be an object");return h(t),e}function O_(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function km(t,e){this._pairs=[],t&&zc(t,this,e)}const iS=km.prototype;iS.append=function(e,n){this._pairs.push([e,n])};iS.toString=function(e){const n=e?function(r){return e.call(this,r,O_)}:O_;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function U$(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function oS(t,e,n){if(!e)return t;const r=n&&n.encode||U$;S.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let a;if(s?a=s(e,n):a=S.isURLSearchParams(e)?e.toString():new km(e,n).toString(r),a){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class C_{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){S.forEach(this.handlers,function(r){r!==null&&e(r)})}}const lS={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},z$=typeof URLSearchParams<"u"?URLSearchParams:km,B$=typeof FormData<"u"?FormData:null,V$=typeof Blob<"u"?Blob:null,H$={isBrowser:!0,classes:{URLSearchParams:z$,FormData:B$,Blob:V$},protocols:["http","https","file","blob","url","data"]},xm=typeof window<"u"&&typeof document<"u",wh=typeof navigator=="object"&&navigator||void 0,Z$=xm&&(!wh||["ReactNative","NativeScript","NS"].indexOf(wh.product)<0),q$=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",G$=xm&&window.location.href||"http://localhost",W$=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:xm,hasStandardBrowserEnv:Z$,hasStandardBrowserWebWorkerEnv:q$,navigator:wh,origin:G$},Symbol.toStringTag,{value:"Module"})),rt={...W$,...H$};function K$(t,e){return zc(t,new rt.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,a){return rt.isNode&&S.isBuffer(n)?(this.append(r,n.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function J$(t){return S.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Q$(t){const e={},n=Object.keys(t);let r;const s=n.length;let a;for(r=0;r<s;r++)a=n[r],e[a]=t[a];return e}function uS(t){function e(n,r,s,a){let i=n[a++];if(i==="__proto__")return!0;const o=Number.isFinite(+i),l=a>=n.length;return i=!i&&S.isArray(s)?s.length:i,l?(S.hasOwnProp(s,i)?s[i]=[s[i],r]:s[i]=r,!o):((!s[i]||!S.isObject(s[i]))&&(s[i]=[]),e(n,r,s[i],a)&&S.isArray(s[i])&&(s[i]=Q$(s[i])),!o)}if(S.isFormData(t)&&S.isFunction(t.entries)){const n={};return S.forEachEntry(t,(r,s)=>{e(J$(r),s,n,0)}),n}return null}function X$(t,e,n){if(S.isString(t))try{return(e||JSON.parse)(t),S.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(t)}const Fo={transitional:lS,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const r=n.getContentType()||"",s=r.indexOf("application/json")>-1,a=S.isObject(e);if(a&&S.isHTMLForm(e)&&(e=new FormData(e)),S.isFormData(e))return s?JSON.stringify(uS(e)):e;if(S.isArrayBuffer(e)||S.isBuffer(e)||S.isStream(e)||S.isFile(e)||S.isBlob(e)||S.isReadableStream(e))return e;if(S.isArrayBufferView(e))return e.buffer;if(S.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return K$(e,this.formSerializer).toString();if((o=S.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return zc(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||s?(n.setContentType("application/json",!1),X$(e)):e}],transformResponse:[function(e){const n=this.transitional||Fo.transitional,r=n&&n.forcedJSONParsing,s=this.responseType==="json";if(S.isResponse(e)||S.isReadableStream(e))return e;if(e&&S.isString(e)&&(r&&!this.responseType||s)){const i=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(i)throw o.name==="SyntaxError"?Q.from(o,Q.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:rt.classes.FormData,Blob:rt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};S.forEach(["delete","get","head","post","put","patch"],t=>{Fo.headers[t]={}});const Y$=S.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ej=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(i){s=i.indexOf(":"),n=i.substring(0,s).trim().toLowerCase(),r=i.substring(s+1).trim(),!(!n||e[n]&&Y$[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},T_=Symbol("internals");function pi(t){return t&&String(t).trim().toLowerCase()}function Bl(t){return t===!1||t==null?t:S.isArray(t)?t.map(Bl):String(t)}function tj(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const nj=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Jd(t,e,n,r,s){if(S.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!S.isString(e)){if(S.isString(r))return e.indexOf(r)!==-1;if(S.isRegExp(r))return r.test(e)}}function rj(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function sj(t,e){const n=S.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,a,i){return this[r].call(this,e,s,a,i)},configurable:!0})})}let kt=class{constructor(e){e&&this.set(e)}set(e,n,r){const s=this;function a(o,l,u){const c=pi(l);if(!c)throw new Error("header name must be a non-empty string");const d=S.findKey(s,c);(!d||s[d]===void 0||u===!0||u===void 0&&s[d]!==!1)&&(s[d||l]=Bl(o))}const i=(o,l)=>S.forEach(o,(u,c)=>a(u,c,l));if(S.isPlainObject(e)||e instanceof this.constructor)i(e,n);else if(S.isString(e)&&(e=e.trim())&&!nj(e))i(ej(e),n);else if(S.isHeaders(e))for(const[o,l]of e.entries())a(l,o,r);else e!=null&&a(n,e,r);return this}get(e,n){if(e=pi(e),e){const r=S.findKey(this,e);if(r){const s=this[r];if(!n)return s;if(n===!0)return tj(s);if(S.isFunction(n))return n.call(this,s,r);if(S.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=pi(e),e){const r=S.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||Jd(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let s=!1;function a(i){if(i=pi(i),i){const o=S.findKey(r,i);o&&(!n||Jd(r,r[o],o,n))&&(delete r[o],s=!0)}}return S.isArray(e)?e.forEach(a):a(e),s}clear(e){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const a=n[r];(!e||Jd(this,this[a],a,e,!0))&&(delete this[a],s=!0)}return s}normalize(e){const n=this,r={};return S.forEach(this,(s,a)=>{const i=S.findKey(r,a);if(i){n[i]=Bl(s),delete n[a];return}const o=e?rj(a):String(a).trim();o!==a&&delete n[a],n[o]=Bl(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return S.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=e&&S.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[T_]=this[T_]={accessors:{}}).accessors,s=this.prototype;function a(i){const o=pi(i);r[o]||(sj(s,i),r[o]=!0)}return S.isArray(e)?e.forEach(a):a(e),this}};kt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);S.reduceDescriptors(kt.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});S.freezeMethods(kt);function Qd(t,e){const n=this||Fo,r=e||n,s=kt.from(r.headers);let a=r.data;return S.forEach(t,function(o){a=o.call(n,a,s.normalize(),e?e.status:void 0)}),s.normalize(),a}function cS(t){return!!(t&&t.__CANCEL__)}function za(t,e,n){Q.call(this,t??"canceled",Q.ERR_CANCELED,e,n),this.name="CanceledError"}S.inherits(za,Q,{__CANCEL__:!0});function dS(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Q("Request failed with status code "+n.status,[Q.ERR_BAD_REQUEST,Q.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function aj(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function ij(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,a=0,i;return e=e!==void 0?e:1e3,function(l){const u=Date.now(),c=r[a];i||(i=u),n[s]=l,r[s]=u;let d=a,f=0;for(;d!==s;)f+=n[d++],d=d%t;if(s=(s+1)%t,s===a&&(a=(a+1)%t),u-i<e)return;const h=c&&u-c;return h?Math.round(f*1e3/h):void 0}}function oj(t,e){let n=0,r=1e3/e,s,a;const i=(u,c=Date.now())=>{n=c,s=null,a&&(clearTimeout(a),a=null),t.apply(null,u)};return[(...u)=>{const c=Date.now(),d=c-n;d>=r?i(u,c):(s=u,a||(a=setTimeout(()=>{a=null,i(s)},r-d)))},()=>s&&i(s)]}const Nu=(t,e,n=3)=>{let r=0;const s=ij(50,250);return oj(a=>{const i=a.loaded,o=a.lengthComputable?a.total:void 0,l=i-r,u=s(l),c=i<=o;r=i;const d={loaded:i,total:o,progress:o?i/o:void 0,bytes:l,rate:u||void 0,estimated:u&&o&&c?(o-i)/u:void 0,event:a,lengthComputable:o!=null,[e?"download":"upload"]:!0};t(d)},n)},R_=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},I_=t=>(...e)=>S.asap(()=>t(...e)),lj=rt.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,rt.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(rt.origin),rt.navigator&&/(msie|trident)/i.test(rt.navigator.userAgent)):()=>!0,uj=rt.hasStandardBrowserEnv?{write(t,e,n,r,s,a){const i=[t+"="+encodeURIComponent(e)];S.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),S.isString(r)&&i.push("path="+r),S.isString(s)&&i.push("domain="+s),a===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function cj(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function dj(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function fS(t,e,n){let r=!cj(e);return t&&(r||n==!1)?dj(t,e):e}const N_=t=>t instanceof kt?{...t}:t;function ps(t,e){e=e||{};const n={};function r(u,c,d,f){return S.isPlainObject(u)&&S.isPlainObject(c)?S.merge.call({caseless:f},u,c):S.isPlainObject(c)?S.merge({},c):S.isArray(c)?c.slice():c}function s(u,c,d,f){if(S.isUndefined(c)){if(!S.isUndefined(u))return r(void 0,u,d,f)}else return r(u,c,d,f)}function a(u,c){if(!S.isUndefined(c))return r(void 0,c)}function i(u,c){if(S.isUndefined(c)){if(!S.isUndefined(u))return r(void 0,u)}else return r(void 0,c)}function o(u,c,d){if(d in e)return r(u,c);if(d in t)return r(void 0,u)}const l={url:a,method:a,data:a,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:o,headers:(u,c,d)=>s(N_(u),N_(c),d,!0)};return S.forEach(Object.keys(Object.assign({},t,e)),function(c){const d=l[c]||s,f=d(t[c],e[c],c);S.isUndefined(f)&&d!==o||(n[c]=f)}),n}const hS=t=>{const e=ps({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:a,headers:i,auth:o}=e;e.headers=i=kt.from(i),e.url=oS(fS(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),o&&i.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let l;if(S.isFormData(n)){if(rt.hasStandardBrowserEnv||rt.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((l=i.getContentType())!==!1){const[u,...c]=l?l.split(";").map(d=>d.trim()).filter(Boolean):[];i.setContentType([u||"multipart/form-data",...c].join("; "))}}if(rt.hasStandardBrowserEnv&&(r&&S.isFunction(r)&&(r=r(e)),r||r!==!1&&lj(e.url))){const u=s&&a&&uj.read(a);u&&i.set(s,u)}return e},fj=typeof XMLHttpRequest<"u",hj=fj&&function(t){return new Promise(function(n,r){const s=hS(t);let a=s.data;const i=kt.from(s.headers).normalize();let{responseType:o,onUploadProgress:l,onDownloadProgress:u}=s,c,d,f,h,y;function m(){h&&h(),y&&y(),s.cancelToken&&s.cancelToken.unsubscribe(c),s.signal&&s.signal.removeEventListener("abort",c)}let v=new XMLHttpRequest;v.open(s.method.toUpperCase(),s.url,!0),v.timeout=s.timeout;function g(){if(!v)return;const _=kt.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),b={data:!o||o==="text"||o==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:_,config:t,request:v};dS(function(k){n(k),m()},function(k){r(k),m()},b),v=null}"onloadend"in v?v.onloadend=g:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout(g)},v.onabort=function(){v&&(r(new Q("Request aborted",Q.ECONNABORTED,t,v)),v=null)},v.onerror=function(){r(new Q("Network Error",Q.ERR_NETWORK,t,v)),v=null},v.ontimeout=function(){let w=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const b=s.transitional||lS;s.timeoutErrorMessage&&(w=s.timeoutErrorMessage),r(new Q(w,b.clarifyTimeoutError?Q.ETIMEDOUT:Q.ECONNABORTED,t,v)),v=null},a===void 0&&i.setContentType(null),"setRequestHeader"in v&&S.forEach(i.toJSON(),function(w,b){v.setRequestHeader(b,w)}),S.isUndefined(s.withCredentials)||(v.withCredentials=!!s.withCredentials),o&&o!=="json"&&(v.responseType=s.responseType),u&&([f,y]=Nu(u,!0),v.addEventListener("progress",f)),l&&v.upload&&([d,h]=Nu(l),v.upload.addEventListener("progress",d),v.upload.addEventListener("loadend",h)),(s.cancelToken||s.signal)&&(c=_=>{v&&(r(!_||_.type?new za(null,t,v):_),v.abort(),v=null)},s.cancelToken&&s.cancelToken.subscribe(c),s.signal&&(s.signal.aborted?c():s.signal.addEventListener("abort",c)));const p=aj(s.url);if(p&&rt.protocols.indexOf(p)===-1){r(new Q("Unsupported protocol "+p+":",Q.ERR_BAD_REQUEST,t));return}v.send(a||null)})},pj=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,s;const a=function(u){if(!s){s=!0,o();const c=u instanceof Error?u:this.reason;r.abort(c instanceof Q?c:new za(c instanceof Error?c.message:c))}};let i=e&&setTimeout(()=>{i=null,a(new Q(`timeout ${e} of ms exceeded`,Q.ETIMEDOUT))},e);const o=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(a):u.removeEventListener("abort",a)}),t=null)};t.forEach(u=>u.addEventListener("abort",a));const{signal:l}=r;return l.unsubscribe=()=>S.asap(o),l}},mj=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,s;for(;r<n;)s=r+e,yield t.slice(r,s),r=s},gj=async function*(t,e){for await(const n of yj(t))yield*mj(n,e)},yj=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},$_=(t,e,n,r)=>{const s=gj(t,e);let a=0,i,o=l=>{i||(i=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:u,value:c}=await s.next();if(u){o(),l.close();return}let d=c.byteLength;if(n){let f=a+=d;n(f)}l.enqueue(new Uint8Array(c))}catch(u){throw o(u),u}},cancel(l){return o(l),s.return()}},{highWaterMark:2})},Bc=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",pS=Bc&&typeof ReadableStream=="function",_j=Bc&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),mS=(t,...e)=>{try{return!!t(...e)}catch{return!1}},vj=pS&&mS(()=>{let t=!1;const e=new Request(rt.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),j_=64*1024,bh=pS&&mS(()=>S.isReadableStream(new Response("").body)),$u={stream:bh&&(t=>t.body)};Bc&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!$u[e]&&($u[e]=S.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new Q(`Response type '${e}' is not supported`,Q.ERR_NOT_SUPPORT,r)})})})(new Response);const wj=async t=>{if(t==null)return 0;if(S.isBlob(t))return t.size;if(S.isSpecCompliantForm(t))return(await new Request(rt.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(S.isArrayBufferView(t)||S.isArrayBuffer(t))return t.byteLength;if(S.isURLSearchParams(t)&&(t=t+""),S.isString(t))return(await _j(t)).byteLength},bj=async(t,e)=>{const n=S.toFiniteNumber(t.getContentLength());return n??wj(e)},Ej=Bc&&(async t=>{let{url:e,method:n,data:r,signal:s,cancelToken:a,timeout:i,onDownloadProgress:o,onUploadProgress:l,responseType:u,headers:c,withCredentials:d="same-origin",fetchOptions:f}=hS(t);u=u?(u+"").toLowerCase():"text";let h=pj([s,a&&a.toAbortSignal()],i),y;const m=h&&h.unsubscribe&&(()=>{h.unsubscribe()});let v;try{if(l&&vj&&n!=="get"&&n!=="head"&&(v=await bj(c,r))!==0){let b=new Request(e,{method:"POST",body:r,duplex:"half"}),P;if(S.isFormData(r)&&(P=b.headers.get("content-type"))&&c.setContentType(P),b.body){const[k,R]=R_(v,Nu(I_(l)));r=$_(b.body,j_,k,R)}}S.isString(d)||(d=d?"include":"omit");const g="credentials"in Request.prototype;y=new Request(e,{...f,signal:h,method:n.toUpperCase(),headers:c.normalize().toJSON(),body:r,duplex:"half",credentials:g?d:void 0});let p=await fetch(y);const _=bh&&(u==="stream"||u==="response");if(bh&&(o||_&&m)){const b={};["status","statusText","headers"].forEach(Z=>{b[Z]=p[Z]});const P=S.toFiniteNumber(p.headers.get("content-length")),[k,R]=o&&R_(P,Nu(I_(o),!0))||[];p=new Response($_(p.body,j_,k,()=>{R&&R(),m&&m()}),b)}u=u||"text";let w=await $u[S.findKey($u,u)||"text"](p,t);return!_&&m&&m(),await new Promise((b,P)=>{dS(b,P,{data:w,headers:kt.from(p.headers),status:p.status,statusText:p.statusText,config:t,request:y})})}catch(g){throw m&&m(),g&&g.name==="TypeError"&&/fetch/i.test(g.message)?Object.assign(new Q("Network Error",Q.ERR_NETWORK,t,y),{cause:g.cause||g}):Q.from(g,g&&g.code,t,y)}}),Eh={http:D$,xhr:hj,fetch:Ej};S.forEach(Eh,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const L_=t=>`- ${t}`,Sj=t=>S.isFunction(t)||t===null||t===!1,gS={getAdapter:t=>{t=S.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let a=0;a<e;a++){n=t[a];let i;if(r=n,!Sj(n)&&(r=Eh[(i=String(n)).toLowerCase()],r===void 0))throw new Q(`Unknown adapter '${i}'`);if(r)break;s[i||"#"+a]=r}if(!r){const a=Object.entries(s).map(([o,l])=>`adapter ${o} `+(l===!1?"is not supported by the environment":"is not available in the build"));let i=e?a.length>1?`since :
`+a.map(L_).join(`
`):" "+L_(a[0]):"as no adapter specified";throw new Q("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return r},adapters:Eh};function Xd(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new za(null,t)}function D_(t){return Xd(t),t.headers=kt.from(t.headers),t.data=Qd.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),gS.getAdapter(t.adapter||Fo.adapter)(t).then(function(r){return Xd(t),r.data=Qd.call(t,t.transformResponse,r),r.headers=kt.from(r.headers),r},function(r){return cS(r)||(Xd(t),r&&r.response&&(r.response.data=Qd.call(t,t.transformResponse,r.response),r.response.headers=kt.from(r.response.headers))),Promise.reject(r)})}const yS="1.8.4",Vc={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Vc[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const M_={};Vc.transitional=function(e,n,r){function s(a,i){return"[Axios v"+yS+"] Transitional option '"+a+"'"+i+(r?". "+r:"")}return(a,i,o)=>{if(e===!1)throw new Q(s(i," has been removed"+(n?" in "+n:"")),Q.ERR_DEPRECATED);return n&&!M_[i]&&(M_[i]=!0,console.warn(s(i," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(a,i,o):!0}};Vc.spelling=function(e){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function Pj(t,e,n){if(typeof t!="object")throw new Q("options must be an object",Q.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const a=r[s],i=e[a];if(i){const o=t[a],l=o===void 0||i(o,a,t);if(l!==!0)throw new Q("option "+a+" must be "+l,Q.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Q("Unknown option "+a,Q.ERR_BAD_OPTION)}}const Vl={assertOptions:Pj,validators:Vc},Pn=Vl.validators;let ss=class{constructor(e){this.defaults=e,this.interceptors={request:new C_,response:new C_}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const a=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}catch{}}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=ps(this.defaults,n);const{transitional:r,paramsSerializer:s,headers:a}=n;r!==void 0&&Vl.assertOptions(r,{silentJSONParsing:Pn.transitional(Pn.boolean),forcedJSONParsing:Pn.transitional(Pn.boolean),clarifyTimeoutError:Pn.transitional(Pn.boolean)},!1),s!=null&&(S.isFunction(s)?n.paramsSerializer={serialize:s}:Vl.assertOptions(s,{encode:Pn.function,serialize:Pn.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Vl.assertOptions(n,{baseUrl:Pn.spelling("baseURL"),withXsrfToken:Pn.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=a&&S.merge(a.common,a[n.method]);a&&S.forEach(["delete","get","head","post","put","patch","common"],y=>{delete a[y]}),n.headers=kt.concat(i,a);const o=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(n)===!1||(l=l&&m.synchronous,o.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let c,d=0,f;if(!l){const y=[D_.bind(this),void 0];for(y.unshift.apply(y,o),y.push.apply(y,u),f=y.length,c=Promise.resolve(n);d<f;)c=c.then(y[d++],y[d++]);return c}f=o.length;let h=n;for(d=0;d<f;){const y=o[d++],m=o[d++];try{h=y(h)}catch(v){m.call(this,v);break}}try{c=D_.call(this,h)}catch(y){return Promise.reject(y)}for(d=0,f=u.length;d<f;)c=c.then(u[d++],u[d++]);return c}getUri(e){e=ps(this.defaults,e);const n=fS(e.baseURL,e.url,e.allowAbsoluteUrls);return oS(n,e.params,e.paramsSerializer)}};S.forEach(["delete","get","head","options"],function(e){ss.prototype[e]=function(n,r){return this.request(ps(r||{},{method:e,url:n,data:(r||{}).data}))}});S.forEach(["post","put","patch"],function(e){function n(r){return function(a,i,o){return this.request(ps(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:i}))}}ss.prototype[e]=n(),ss.prototype[e+"Form"]=n(!0)});let kj=class _S{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(a){n=a});const r=this;this.promise.then(s=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](s);r._listeners=null}),this.promise.then=s=>{let a;const i=new Promise(o=>{r.subscribe(o),a=o}).then(s);return i.cancel=function(){r.unsubscribe(a)},i},e(function(a,i,o){r.reason||(r.reason=new za(a,i,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new _S(function(s){e=s}),cancel:e}}};function xj(t){return function(n){return t.apply(null,n)}}function Aj(t){return S.isObject(t)&&t.isAxiosError===!0}const Sh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Sh).forEach(([t,e])=>{Sh[e]=t});function vS(t){const e=new ss(t),n=JE(ss.prototype.request,e);return S.extend(n,ss.prototype,e,{allOwnKeys:!0}),S.extend(n,e,null,{allOwnKeys:!0}),n.create=function(s){return vS(ps(t,s))},n}const Oe=vS(Fo);Oe.Axios=ss;Oe.CanceledError=za;Oe.CancelToken=kj;Oe.isCancel=cS;Oe.VERSION=yS;Oe.toFormData=zc;Oe.AxiosError=Q;Oe.Cancel=Oe.CanceledError;Oe.all=function(e){return Promise.all(e)};Oe.spread=xj;Oe.isAxiosError=Aj;Oe.mergeConfig=ps;Oe.AxiosHeaders=kt;Oe.formToJSON=t=>uS(S.isHTMLForm(t)?new FormData(t):t);Oe.getAdapter=gS.getAdapter;Oe.HttpStatusCode=Sh;Oe.default=Oe;const{Axios:hL,AxiosError:pL,CanceledError:mL,isCancel:gL,CancelToken:yL,VERSION:_L,all:vL,Cancel:wL,isAxiosError:bL,spread:EL,toFormData:SL,AxiosHeaders:PL,HttpStatusCode:kL,formToJSON:xL,getAdapter:AL,mergeConfig:OL}=Oe,Oj="https://raw.githubusercontent.com/samapriya/Earth-Engine-Datasets-List/master/gee_catalog.json";let Yd=null;async function Cj(){if(Yd)return Yd;try{const e=(await Oe.get(Oj)).data;return Yd=e,console.log(`Fetched ${e.length} datasets from GEE catalog`),e}catch(t){return console.error("Error fetching Earth Engine catalog:",t),wS()}}function wS(){return[{id:"USGS/SRTMGL1_003",title:"SRTM Global 1 arc second elevation",description:"Shuttle Radar Topography Mission (SRTM) digital elevation data is a worldwide elevation dataset.",tags:["elevation","topography","dem","srtm"],provider:"USGS",documentation_url:"https://developers.google.com/earth-engine/datasets/catalog/USGS_SRTMGL1_003",type:"image"},{id:"MODIS/006/MOD13Q1",title:"MODIS Terra Vegetation Indices 16-Day Global 250m",description:"Vegetation indices designed to provide consistent spatial and temporal comparisons of vegetation conditions.",tags:["modis","vegetation","ndvi","evi"],provider:"NASA",documentation_url:"https://developers.google.com/earth-engine/datasets/catalog/MODIS_006_MOD13Q1",type:"image_collection"},{id:"COPERNICUS/S2",title:"Sentinel-2 MSI: MultiSpectral Instrument, Level-1C",description:"Sentinel-2 is a wide-swath, high-resolution, multi-spectral imaging mission supporting Copernicus Land Monitoring studies.",tags:["sentinel","satellite","esa","copernicus"],provider:"ESA",documentation_url:"https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2",type:"image_collection"},{id:"LANDSAT/LC08/C01/T1_SR",title:"USGS Landsat 8 Surface Reflectance Tier 1",description:"Landsat 8 SR is atmospherically corrected surface reflectance from the Landsat 8 OLI/TIRS sensors.",tags:["landsat","usgs","sr","surface reflectance"],provider:"USGS",documentation_url:"https://developers.google.com/earth-engine/datasets/catalog/LANDSAT_LC08_C01_T1_SR",type:"image_collection"},{id:"NASA/GPM_L3/IMERG_V06",title:"GPM: Global Precipitation Measurement (GPM) v6",description:"Global Precipitation Measurement (GPM) IMERG precipitation data.",tags:["precipitation","rainfall","gpm","nasa"],provider:"NASA",documentation_url:"https://developers.google.com/earth-engine/datasets/catalog/NASA_GPM_L3_IMERG_V06",type:"image_collection"}]}async function Tj(t){console.log("Searching Earth Engine database for:",t);try{const e=await Cj(),r=t.toLowerCase().split(/\s+/).filter(a=>a.length>2);return e.filter(a=>{var o;const i=`${a.id} ${a.title||a.name||""} ${a.description||""} ${((o=a.tags)==null?void 0:o.join(" "))||""}`.toLowerCase();return r.some(l=>i.includes(l))}).map(a=>{var l;const i=`${a.id} ${a.title||a.name||""} ${a.description||""} ${((l=a.tags)==null?void 0:l.join(" "))||""}`.toLowerCase(),o=r.reduce((u,c)=>u+(i.split(c).length-1),0);return{dataset:a,score:o}}).sort((a,i)=>i.score-a.score).map(a=>a.dataset).slice(0,20)}catch(e){return console.error("Error searching Earth Engine database:",e),wS()}}const bS=[{title:"ee.Image - Constructor",content:"Creates an earth engine image. The Image constructor accepts a variety of arguments: constant value, EE object, asset ID, array, array of arrays.",url:"https://developers.google.com/earth-engine/apidocs/ee-image",category:"Core",apiClass:"ee.Image",examples:["// Create a constant image.","var image = ee.Image(1);","// Create an image from an asset ID.","var image = ee.Image('LANDSAT/LC08/C02/T1_L2/LC08_044034_20210508');"]},{title:"ee.ImageCollection - Constructor",content:"Creates an earth engine image collection. The constructor accepts a variety of arguments: filter, list, asset ID, etc.",url:"https://developers.google.com/earth-engine/apidocs/ee-imagecollection",category:"Core",apiClass:"ee.ImageCollection",examples:["// Create an ImageCollection from an asset ID.","var collection = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2');"]},{title:"ee.ImageCollection.filterDate",content:"Filter an image collection by date range. Accepts start and end dates as arguments.",url:"https://developers.google.com/earth-engine/apidocs/ee-imagecollection-filterdate",category:"Filtering",apiClass:"ee.ImageCollection",apiFunction:"filterDate",examples:["// Filter a collection by date.","var filtered = collection.filterDate('2021-01-01', '2021-12-31');"]},{title:"ee.Image.clip",content:"Clip an image to a geometry. Accepts a feature, feature collection, or geometry as an argument.",url:"https://developers.google.com/earth-engine/apidocs/ee-image-clip",category:"Image Processing",apiClass:"ee.Image",apiFunction:"clip",examples:["// Clip an image to a geometry.","var clipped = image.clip(geometry);"]},{title:"ee.Image.normalizedDifference",content:"Compute the normalized difference between two bands. This is often used for indices like NDVI.",url:"https://developers.google.com/earth-engine/apidocs/ee-image-normalizeddifference",category:"Image Processing",apiClass:"ee.Image",apiFunction:"normalizedDifference",examples:["// Compute NDVI from NIR and red bands.","var ndvi = image.normalizedDifference(['NIR', 'RED']);"]},{title:"ee.Reducer.mean",content:"Create a reducer that computes the mean of values. This is commonly used with reduceRegion or reduceNeighborhood.",url:"https://developers.google.com/earth-engine/apidocs/ee-reducer-mean",category:"Reducers",apiClass:"ee.Reducer",apiFunction:"mean",examples:["// Compute the mean value in a region.","var mean = image.reduceRegion({","  reducer: ee.Reducer.mean(),","  geometry: region,","  scale: 30","});"]},{title:"ee.Feature - Constructor",content:"Creates a feature with geometry and properties. Accepts various inputs, including a geometry and a property dictionary.",url:"https://developers.google.com/earth-engine/apidocs/ee-feature",category:"Vectors",apiClass:"ee.Feature",examples:["// Create a feature with a point geometry and properties.","var feature = ee.Feature(","  ee.Geometry.Point([-122.4, 37.8]),","  {name: 'San Francisco', population: 881000}",");"]},{title:"ee.FeatureCollection - Constructor",content:"Creates a feature collection. Accepts a list of features, a geometry, a computed object, or an asset ID.",url:"https://developers.google.com/earth-engine/apidocs/ee-featurecollection",category:"Vectors",apiClass:"ee.FeatureCollection",examples:["// Create a FeatureCollection from an asset ID.","var fc = ee.FeatureCollection('TIGER/2018/Counties');","// Filter the collection.","var filtered = fc.filter(ee.Filter.eq('STATEFP', '06'));"]},{title:"ee.Terrain.slope",content:"Compute the slope of a DEM image. Returns an image with the slope in degrees.",url:"https://developers.google.com/earth-engine/apidocs/ee-terrain-slope",category:"Terrain",apiClass:"ee.Terrain",apiFunction:"slope",examples:["// Load SRTM digital elevation model data.","var dem = ee.Image('USGS/SRTMGL1_003');","// Calculate slope.","var slope = ee.Terrain.slope(dem);","// Display the slope.","Map.addLayer(slope, {min: 0, max: 60}, 'slope');"]},{title:"ui.Map.addLayer",content:"Adds a layer to the map. Accepts an image, feature collection, or geometry, along with visualization parameters and a name.",url:"https://developers.google.com/earth-engine/apidocs/map-addlayer",category:"Visualization",apiClass:"ui.Map",apiFunction:"addLayer",examples:["// Add an image to the map.","Map.addLayer(image, {bands: ['B4', 'B3', 'B2'], min: 0, max: 3000}, 'Landsat');"]},{title:"ui.Chart.image.series",content:"Creates a chart from an image collection. Useful for time series analysis of image collections.",url:"https://developers.google.com/earth-engine/apidocs/ui-chart-image-series",category:"Visualization",apiClass:"ui.Chart.image",apiFunction:"series",examples:["// Create a time series chart of NDVI.","var chart = ui.Chart.image.series({","  imageCollection: ndviCollection,","  region: geometry,","  reducer: ee.Reducer.mean(),","  scale: 30","});"]}];function Rj(t,e){const n=t.toLowerCase(),r=n.split(/\W+/).filter(i=>i.length>2);let s=0;e.title.toLowerCase().includes(n)&&(s+=10),e.apiClass&&n.includes(e.apiClass.toLowerCase())&&(s+=8),e.apiFunction&&n.includes(e.apiFunction.toLowerCase())&&(s+=8);const a=e.content.toLowerCase();for(const i of r){const o=new RegExp(i,"g"),l=a.match(o);l&&(s+=l.length*.5)}if(e.examples){const i=e.examples.join(" ").toLowerCase();for(const o of r)i.includes(o)&&(s+=.3)}return s}function Ij(t,e=5){return bS.map(r=>({doc:r,score:Rj(t,r)})).sort((r,s)=>s.score-r.score).filter(r=>r.score>0).slice(0,e).map(r=>r.doc)}function ES(t,e){const n=bS.filter(r=>r.apiClass===t&&(!e||r.apiFunction===e));return n.length>0?n[0]:null}function Nj(t,e){const n=ES(t,e);return(n==null?void 0:n.examples)||[]}function $j(t){const e=t.toLowerCase();return e.includes("ndvi")||e.includes("vegetation index")?`// Load Landsat 8 imagery
var landsat = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
  .filterDate('2020-01-01', '2020-12-31')
  .filterBounds(geometry);

// Select the least cloudy image
var image = ee.Image(landsat.sort('CLOUD_COVER').first());

// Calculate NDVI
var nir = image.select('SR_B5');
var red = image.select('SR_B4');
var ndvi = nir.subtract(red).divide(nir.add(red)).rename('NDVI');

// Display the result
Map.centerObject(geometry, 10);
Map.addLayer(ndvi, {min: -0.2, max: 0.8, palette: ['brown', 'yellow', 'green']}, 'NDVI');`:e.includes("water")||e.includes("flood")?`// Load Sentinel-1 SAR imagery
var sentinel1 = ee.ImageCollection('COPERNICUS/S1_GRD')
  .filterDate('2020-01-01', '2020-12-31')
  .filterBounds(geometry)
  .filter(ee.Filter.eq('instrumentMode', 'IW'));

// Create a water mask using thresholding on VV band
var vvImage = sentinel1.select('VV').median();
var waterMask = vvImage.lt(-15);

// Add the layers to the map
Map.centerObject(geometry, 11);
Map.addLayer(vvImage, {min: -25, max: 0}, 'Sentinel-1 VV');
Map.addLayer(waterMask.mask(waterMask), {palette: ['blue']}, 'Water Mask');`:e.includes("land cover")||e.includes("landcover")?`// Load ESA WorldCover data
var worldcover = ee.ImageCollection('ESA/WorldCover/v100').first();

// Define visualization parameters
var visParams = {
  bands: ['Map'],
  min: 10,
  max: 110,
  palette: [
    '006400', '96ED69', 'FFBB22', 'F096FF', 'FA0000',
    'B4B4B4', 'F0F0F0', '0064C8', '0096A0', '00CF75',
    'FAE6A0'
  ]
};

// Add the layer to the map
Map.centerObject(geometry, 10);
Map.addLayer(worldcover, visParams, 'Land Cover');`:e.includes("time series")||e.includes("chart")?`// Load Landsat 8 imagery for a time series
var landsat = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
  .filterDate('2018-01-01', '2022-12-31')
  .filterBounds(geometry);

// Create an NDVI collection
var ndviCollection = landsat.map(function(image) {
  var ndvi = image.normalizedDifference(['SR_B5', 'SR_B4']).rename('NDVI');
  return image.addBands(ndvi);
});

// Create a time series chart
var chart = ui.Chart.image.series({
  imageCollection: ndviCollection.select('NDVI'),
  region: geometry,
  reducer: ee.Reducer.mean(),
  scale: 30
}).setOptions({
  title: 'NDVI Time Series',
  vAxis: {title: 'NDVI'},
  hAxis: {title: 'Date', format: 'yyyy-MM-dd', gridlines: {count: 7}}
});

// Display the chart
print(chart);`:`// Load Landsat 8 imagery
var landsat = ee.ImageCollection('LANDSAT/LC08/C02/T1_L2')
  .filterDate('2020-01-01', '2020-12-31')
  .filterBounds(geometry)
  .sort('CLOUD_COVER')
  .first();

// Display true color image
var trueColor = {
  bands: ['SR_B4', 'SR_B3', 'SR_B2'],
  min: 7000,
  max: 30000
};

Map.centerObject(geometry, 10);
Map.addLayer(landsat, trueColor, 'Landsat True Color');`}const El={search:Ij,getDocumentation:ES,getExamples:Nj,generateCodeSnippet:$j},mi=async(t,e)=>new Promise((n,r)=>{chrome.tabs.query({active:!0,currentWindow:!0},s=>{var a;if(!((a=s[0])!=null&&a.id)){r(new Error("No active tab found. Make sure you are on the Earth Engine Code Editor page."));return}chrome.tabs.sendMessage(s[0].id,{type:t,...e},i=>{if(chrome.runtime.lastError){r(new Error(chrome.runtime.lastError.message||"Could not communicate with Earth Engine. Make sure you are on the Earth Engine Code Editor page."));return}n(i)})})}),Gs={databaseSearch:async t=>(console.log("Searching Earth Engine database for:",t),Tj(t)),runCode:async t=>{console.log("Running code in Earth Engine:",t);try{const e=await mi("RUN_CODE",{code:t});return{success:(e==null?void 0:e.success)||!1,message:(e==null?void 0:e.message)||"Code execution completed",executionTime:e==null?void 0:e.executionTime}}catch(e){return console.error("Error running code:",e),{success:!1,message:e instanceof Error?e.message:"Unknown error running code"}}},inspectMap:async t=>{console.log("Inspecting map at:",t);try{const e=await mi("INSPECT_MAP",{coordinates:t});return{success:(e==null?void 0:e.success)||!1,data:(e==null?void 0:e.data)||null,error:e==null?void 0:e.error}}catch(e){return console.error("Error inspecting map:",e),{success:!1,data:null,error:e instanceof Error?e.message:"Unknown error inspecting map"}}},checkConsole:async()=>{console.log("Checking Earth Engine console");try{const t=await mi("CHECK_CONSOLE",{});return{success:(t==null?void 0:t.success)||!1,errors:(t==null?void 0:t.errors)||[]}}catch(t){return console.error("Error checking console:",t),{success:!1,errors:[{level:"error",message:t instanceof Error?t.message:"Unknown error checking console"}]}}},getTasks:async()=>{console.log("Accessing Earth Engine tasks");try{const t=await mi("GET_TASKS",{});return{success:(t==null?void 0:t.success)||!1,tasks:(t==null?void 0:t.tasks)||[],error:t==null?void 0:t.error}}catch(t){return console.error("Error accessing tasks:",t),{success:!1,tasks:[],error:t instanceof Error?t.message:"Unknown error accessing tasks"}}},editScript:async(t,e)=>{console.log("Editing script in Earth Engine:",t);try{const n=await mi("EDIT_SCRIPT",{scriptId:t,content:e});return{success:(n==null?void 0:n.success)||!1,message:(n==null?void 0:n.message)||"Script edited successfully",error:n==null?void 0:n.error}}catch(n){return console.error("Error editing script:",n),{success:!1,message:"Failed to edit script",error:n instanceof Error?n.message:"Unknown error editing script"}}},searchDocumentation:async(t,e=!1)=>{console.log("Searching Earth Engine API documentation for:",t);try{const n=El.search(t),r=e?El.generateCodeSnippet(t):void 0;return{results:n,suggestedCode:r}}catch(n){return console.error("Error searching documentation:",n),{results:[]}}},getAPIExamples:async(t,e)=>(console.log(`Getting examples for ${t}${e?"."+e:""}`),El.getExamples(t,e)),assessProblem:async t=>{if(console.log("Assessing problem feasibility:",t),!t)return{feasible:!1,explanation:"No query was provided. Please enter a valid request to analyze."};const e=El.search(t),n=[];e.forEach(d=>{if(d.apiClass){const f=d.apiFunction?`${d.apiClass}.${d.apiFunction}`:d.apiClass;n.push(f)}});const r=t.toLowerCase(),s=["map","satellite","image","elevation","terrain","landsat","sentinel","modis","ndvi","vegetation","forest","water","land cover","temperature","climate","flood","drought","fire","urban","agriculture","time series","change","detection","glacier","snow","rainfall","precipitation","landslide","erosion","deforestation","reforestation","cropland"],a=["indoor","indoor map","street view","navigation","driving directions","traffic","restaurant","hotel","booking","flight","weather forecast","stock","market","exchange rate","currency","news","social media"];Object.entries({image:["ee.Image","ee.ImageCollection"],satellite:["ee.ImageCollection","ee.Image.visualize"],landsat:['ee.ImageCollection("LANDSAT/LC08/C02/T1_L2")','ee.ImageCollection("LANDSAT/LC09/C02/T1_L2")'],sentinel:['ee.ImageCollection("COPERNICUS/S2_SR")','ee.ImageCollection("COPERNICUS/S2")'],modis:['ee.ImageCollection("MODIS/006/MOD13Q1")','ee.ImageCollection("MODIS/006/MCD12Q1")'],ndvi:["image.normalizedDifference()","image.expression()"],vegetation:['ee.ImageCollection("MODIS/006/MOD13Q1")',"image.normalizedDifference()"],forest:['ee.ImageCollection("UMD/hansen/global_forest_change_2021_v1_9")','ee.ImageCollection("JAXA/ALOS/PALSAR/YEARLY/FNF")'],water:['ee.Image("JRC/GSW1_3/GlobalSurfaceWater")',"ee.Image.normalizedDifference()"],"land cover":['ee.ImageCollection("MODIS/006/MCD12Q1")','ee.ImageCollection("ESA/WorldCover/v100")'],temperature:['ee.ImageCollection("MODIS/006/MOD11A1")','ee.ImageCollection("NOAA/CFSV2/FOR6H")'],elevation:['ee.Image("USGS/SRTMGL1_003")',"ee.Terrain.slope"],terrain:["ee.Terrain",'ee.Image("USGS/SRTMGL1_003")'],"time series":["ee.ImageCollection.filterDate()","ui.Chart.image.series"]}).forEach(([d,f])=>{r.includes(d)&&n.push(...f)});const o=[...new Set(n)],l=s.some(d=>r.includes(d)),u=a.some(d=>r.includes(d)),c=e.length>=2;return(l||c)&&!u?{feasible:!0,explanation:"This task can be accomplished with Google Earth Engine.",suggestedApproach:"Use Earth Engine to analyze satellite imagery and geospatial data.",relevantAPIs:o.length>0?o:void 0}:u?{feasible:!1,explanation:"This task is not suitable for Google Earth Engine. Earth Engine is designed for geospatial analysis, not for this type of request."}:{feasible:!0,explanation:"This task might be accomplishable with Google Earth Engine, but I'm not completely sure based on your request.",suggestedApproach:"Let's try using Earth Engine to analyze geospatial data related to your query.",relevantAPIs:o.length>0?o:void 0}}},jj=hn.fromTemplate(`
You are a planning agent for Google Earth Engine. Your role is to analyze the user's request and determine:
1. If the request can be accomplished using Google Earth Engine
2. What Earth Engine datasets might be needed
3. What processing steps would be required
4. A step-by-step plan to fulfill the request

USER REQUEST: {input}

First, determine if this request can be accomplished using Google Earth Engine. Earth Engine is good for:
- Analyzing satellite imagery and geospatial data
- Processing large-scale Earth observation data
- Creating visualizations and maps of geographic data
- Performing spatial and temporal analysis of environmental data

Earth Engine is NOT suitable for:
- Non-geospatial tasks (general programming, web development, etc.)
- Tasks that don't involve Earth observation data
- Personal navigation or routing

If the request is not suitable for Earth Engine, explain why and suggest alternatives.
If the request is suitable, provide a detailed plan for how to accomplish it using Earth Engine.

Your plan should include:
1. The specific Earth Engine datasets that might be useful
2. The processing steps required
3. How to visualize or present the results

Be specific and detailed in your plan.
`),Lj=()=>async t=>{console.log("Planner processing input:",t.input);try{console.log("Assessing problem feasibility...");const e=await Gs.assessProblem(t.input);if(console.log("Assessment result:",JSON.stringify(e)),!e.feasible)return console.log("Request not feasible with Earth Engine:",e.explanation),{...t,response:`I'm sorry, but I don't think Google Earth Engine is the right tool for this request. ${e.explanation}`};console.log("Retrieving API key...");const n=await ys();if(!n)return console.error("API key not found in storage"),{...t,response:"OpenAI API key is not configured. Please set your API key in the settings."};console.log("API key retrieved, length:",n.length),console.log("Initializing LLM...");try{const r=new Lo({modelName:"gpt-4o",temperature:0,openAIApiKey:n,configuration:{dangerouslyAllowBrowser:!0}});console.log("Generating plan using LLM...");const s=await jj.format({input:t.input});console.log("Prompt formatted, calling OpenAI API...");const i=(await r.invoke(s)).content.toString();return console.log("Generated plan:",i),{...t,taskPlan:i}}catch(r){return console.error("OpenAI API error:",r),r instanceof Error&&console.error("Error details:",r.message,r.stack),{...t,response:`Error calling OpenAI API: ${r instanceof Error?r.message:"Unknown error"}`}}}catch(e){return console.error("Error in planner agent:",e),e instanceof Error&&console.error("Error details:",e.message,e.stack),{...t,response:`I encountered an error while planning the task: ${e instanceof Error?e.message:"Unknown error"}`}}},Dj=hn.fromTemplate(`
You are a database selection agent for Google Earth Engine. Your job is to select the most appropriate 
Earth Engine datasets for a given task.

USER REQUEST: {input}
TASK PLAN: {taskPlan}
AVAILABLE DATASETS:
{availableDatabases}

Select the most appropriate datasets from the available options to accomplish the task. For each selected 
dataset, briefly explain why it's appropriate for the task.

Consider the following factors:
1. Spatial resolution - Is high spatial detail required?
2. Temporal coverage - Is historical data needed? How recent should the data be?
3. Update frequency - Does the task require the most up-to-date data?
4. Data type - What physical variables are needed (e.g., elevation, temperature, vegetation)?
5. Relevance to the specific task

Return your selections in a well-formatted list with justifications for each choice.
Be specific about which dataset IDs you are selecting from the provided list.
`),Mj=()=>async t=>{if(!t.taskPlan)return console.log("Database selector: No task plan available"),t;console.log("Database selector processing task plan");try{const e=await Gs.databaseSearch(t.input);if(!e||e.length===0)return{...t,response:"I couldn't find any relevant Earth Engine datasets for your request. Please try a different query."};const n=await ys();if(!n)return{...t,response:"OpenAI API key is not configured. Please set your API key in the settings."};const r=new Lo({modelName:"gpt-4o",temperature:0,openAIApiKey:n,configuration:{dangerouslyAllowBrowser:!0}}),s=JSON.stringify(e,null,2),a=await Dj.format({input:t.input,taskPlan:t.taskPlan,availableDatabases:s}),o=(await r.invoke(a)).content.toString();console.log("Database selections:",o);const l=Fj(o,e),u=e.filter(c=>l.includes(c.id));return console.log("Selected databases:",u),{...t,selectedDatabases:u,databaseSelectionText:o}}catch(e){return console.error("Error in database selector agent:",e),{...t,response:"I encountered an error while selecting Earth Engine datasets. Please try again with a more specific request."}}};function Fj(t,e){const n=new Set;for(const r of e)t.includes(r.id)&&n.add(r.id);return Array.from(n)}const Uj=hn.fromTemplate(`
You are a code generation agent for Google Earth Engine. Your role is to generate JavaScript code 
that runs in the Google Earth Engine Code Editor to fulfill the user's request.

USER REQUEST: {input}
TASK PLAN: {taskPlan}
SELECTED DATASETS: {selectedDatabases}

Generate complete, runnable Google Earth Engine JavaScript code that fulfills the user's request.
The code should:
1. Import and properly reference the selected datasets
2. Apply appropriate filters, transformations, and analyses
3. Create visualizations with good default parameters
4. Include comments explaining key steps
5. Be well-structured and follow Google Earth Engine best practices

Make sure the code is complete and ready to run in the Google Earth Engine Code Editor.
Use standard Earth Engine JavaScript API conventions.

Return only the code with no additional text before or after.
`),zj=()=>async t=>{if(!t.selectedDatabases||t.selectedDatabases.length===0)return console.log("Code generator: No databases selected"),t;console.log("Code generator processing selected databases");try{const e=await ys();if(!e)return{...t,response:"OpenAI API key is not configured. Please set your API key in the settings."};const n=new Lo({modelName:"gpt-4o",temperature:0,openAIApiKey:e,configuration:{dangerouslyAllowBrowser:!0}}),r=JSON.stringify(t.selectedDatabases,null,2),s=await Uj.format({input:t.input,taskPlan:t.taskPlan||"No specific task plan available.",selectedDatabases:r}),i=(await n.invoke(s)).content.toString();let o=i;const l=i.match(/```(?:javascript|js)?\s*([\s\S]*?)```/);return l&&(o=l[1].trim()),console.log("Generated code:",o),{...t,generatedCode:o,response:Bj(t.input,t.selectedDatabases,o)}}catch(e){return console.error("Error in code generator agent:",e),{...t,generatedCode:"// Error generating code",response:"I encountered an error while generating Google Earth Engine code for your request. Please try again with a more specific request."}}};function Bj(t,e,n){const r=e.map(a=>a.name).join(", "),s=n.length;return`
Based on your request to "${t}", I've generated Google Earth Engine code (${s} characters) that uses the following datasets: ${r}.

The code:
1. Loads the necessary Earth Engine datasets
2. Processes the data to extract the information you requested
3. Creates a visualization to display the results

You can run this code in the Google Earth Engine Code Editor by clicking the "Run Code" button below.
  `.trim()}const Vj=hn.fromTemplate(`
You are a code debugging agent for Google Earth Engine. Your role is to analyze error messages from
the Earth Engine console and fix the code to resolve these issues.

USER REQUEST: {input}
ORIGINAL CODE: 
\`\`\`javascript
{code}
\`\`\`

ERROR MESSAGES: 
{errors}

Carefully analyze the error messages and fix the code. Here are some common causes of errors in Earth Engine code:

1. Invalid dataset IDs or incorrect access to properties
2. Incorrect band names or indices
3. Geometry issues in regions/areas
4. Type mismatches (e.g., using an image function on an image collection)
5. Missing required parameters in functions
6. Incorrect use of Earth Engine API functions
7. Visualization parameter issues
8. Scale/projection issues

Return the fixed code with explanations of what you changed and why. The code should be complete and runnable in the Google Earth Engine Code Editor.

IMPORTANT: Only make changes necessary to fix the errors. Keep the overall structure and logic the same unless it's directly causing the error.
`),Hj=()=>async t=>{if(!t.generatedCode||!t.errors)return console.log("Code debugger: No code or errors to debug"),t;console.log("Code debugger processing errors");try{const e=await ys();if(!e)return{...t,response:"OpenAI API key is not configured. Please set your API key in the settings."};const n=new Lo({modelName:"gpt-4o",temperature:0,openAIApiKey:e,configuration:{dangerouslyAllowBrowser:!0}}),r=await Vj.format({input:t.input,code:t.generatedCode,errors:t.errors}),a=(await n.invoke(r)).content.toString();let i=t.generatedCode;const o=a.match(/```(?:javascript|js)?\s*([\s\S]*?)```/);return o&&(i=o[1].trim()),console.log("Debugged code:",i),{...t,generatedCode:i,debugLog:[...t.debugLog||[],`Fixed code issues: ${a}`],errors:void 0}}catch(e){return console.error("Error in code debugger agent:",e),{...t,debugLog:[...t.debugLog||[],`Error in debugging: ${e}`],response:t.response||"I encountered an error while debugging the code. Please try again with a simplified request."}}},Zj=hn.fromTemplate(`
You are a summarization agent for Google Earth Engine analyses. Your role is to provide clear, concise summaries
of Earth Engine analyses and their results in a way that is accessible to users of all technical levels.

USER REQUEST: {input}
TASK PLAN: {taskPlan}
SELECTED DATASETS: {selectedDatabases}
GENERATED CODE: 
\`\`\`javascript
{generatedCode}
\`\`\`
INSPECTION RESULTS: {inspectionResults}

Based on all the information above, create a comprehensive but concise summary that includes:

1. The original objective of the analysis
2. The datasets used and why they were selected
3. The key processing steps in the analysis
4. The main findings or visualizations produced
5. Any limitations or caveats of the analysis
6. Suggestions for further exploration or improvement

Make your explanation accessible to users who may not be familiar with Earth Engine or remote sensing terminology.
Use clear language and avoid unnecessary technical jargon. When mentioning technical concepts, briefly explain them.

Your summary should be comprehensive enough to be useful, but concise enough to be quickly digested.
`),qj=()=>async t=>{if(!t.generatedCode)return console.log("Summarizer: No analysis to summarize"),t;console.log("Summarizer processing analysis results");try{const e=await ys();if(!e)return{...t,response:"OpenAI API key is not configured. Please set your API key in the settings."};const n=new Lo({modelName:"gpt-4o",temperature:0,openAIApiKey:e,configuration:{dangerouslyAllowBrowser:!0}}),r=t.selectedDatabases?JSON.stringify(t.selectedDatabases,null,2):"No specific datasets were selected.",s=await Zj.format({input:t.input,taskPlan:t.taskPlan||"No specific task plan available.",selectedDatabases:r,generatedCode:t.generatedCode,inspectionResults:t.inspectionResults||"No inspection results available."});try{const a=await n.invoke(s);let i="I've generated Earth Engine code based on your request, but encountered an error generating a detailed summary.";return a&&a.content&&(i=typeof a.content=="string"?a.content:a.content.toString?a.content.toString():JSON.stringify(a.content)),console.log("Generated summary:",i),{...t,response:i}}catch(a){return console.error("Error invoking LLM for summary:",a),{...t,response:t.response||"I encountered an error while summarizing the analysis. Here's the raw code and results instead."}}}catch(e){return console.error("Error in summarizer agent:",e),{...t,response:t.response||"I encountered an error while summarizing the analysis. Here's the raw code and results instead."}}};class fr extends Error{constructor(n,r,s,a){super(n);en(this,"agent");en(this,"phase");en(this,"details");this.name="AgentError",this.agent=r,this.phase=s,this.details=a}}const Gj=async()=>{console.log("Initializing Earth Agent system");try{const t=Lj(),e=Mj(),n=zj(),r=Hj(),s=qj();if(!t||!e||!n||!r||!s)throw new Error("Failed to initialize one or more agents");return async a=>{console.log("Agent system received input:",a);try{if(!a)return xs.parse({response:"I couldn't process your request. Please provide a valid query.",code:"// No code was generated (empty input)"});let i;try{i=zr.parse({input:a})}catch(o){throw new fr(`Invalid initial state: ${o instanceof Error?o.message:"Unknown error"}`,"system","initialization",o)}console.log("Step 1: Planning");try{const o=await t(i);i=zr.parse(o)}catch(o){throw new fr(`Planning failed: ${o instanceof Error?o.message:"Unknown error"}`,"planner","planning",o)}if(i.response)return xs.parse({response:i.response,code:i.generatedCode||"// No code was generated"});console.log("Step 2: Database Selection");try{const o=await e(i);i=zr.parse(o)}catch(o){throw new fr(`Database selection failed: ${o instanceof Error?o.message:"Unknown error"}`,"databaseSelector","dataset selection",o)}console.log("Step 3: Code Generation");try{const o=await n(i);i=zr.parse(o)}catch(o){throw new fr(`Code generation failed: ${o instanceof Error?o.message:"Unknown error"}`,"codeGenerator","code generation",o)}console.log("Step 4: Executing code");try{const o=await Gs.runCode(i.generatedCode||"");console.log("Code execution result:",o);const l=await Gs.checkConsole();if(l.success&&l.errors&&Array.isArray(l.errors)&&l.errors.length>0){console.log("Detected errors:",l.errors),i.errors=l.errors.map(c=>`${c.level}: ${c.message}`).join(`
`),console.log("Step 5: Debugging code");try{const c=await r(i);i=zr.parse(c)}catch(c){throw new fr(`Code debugging failed: ${c instanceof Error?c.message:"Unknown error"}`,"codeDebugger","debugging",c)}if(i.generatedCode){console.log("Retrying with fixed code");const c=await Gs.runCode(i.generatedCode);console.log("Retry result:",c)}}console.log("Step 6: Inspecting results");const u=await Gs.inspectMap({lat:37.7749,lng:-122.4194});u&&u.data&&(i.inspectionResults=typeof u.data=="string"?u.data:JSON.stringify(u.data,null,2))}catch(o){console.error("Error during execution or inspection:",o),o instanceof Error?i.errors=o.message:typeof o=="string"?i.errors=o:i.errors="Unknown error during execution";try{const l=await r(i);i=zr.parse(l)}catch(l){console.error("Error in code debugger:",l)}}console.log("Step 7: Summarizing");try{const o=await s(i);i=zr.parse(o)}catch(o){throw new fr(`Summarization failed: ${o instanceof Error?o.message:"Unknown error"}`,"summarizer","summarization",o)}try{return xs.parse({response:i.response||"No response was generated.",code:i.generatedCode||"// No code was generated",debugLog:i.debugLog})}catch(o){throw new fr(`Response validation failed: ${o instanceof Error?o.message:"Unknown error"}`,"system","response validation",o)}}catch(i){console.error("Error in agent workflow:",i);try{const o=i instanceof fr?`${i.message} (${i.agent} agent during ${i.phase})`:`${i instanceof Error?i.message:"Unknown error"}`;return xs.parse({response:`I encountered an error while processing your request: ${o}. Please try again with a more specific request.`,code:"// Error processing request",debugLog:[o]})}catch{return{response:"A critical error occurred while processing your request. Please try again later.",code:"// Critical error",debugLog:["Critical error in agent system"]}}}}}catch(t){return console.error("Error initializing agent system:",t),async e=>xs.parse({response:`The Earth Agent system could not be initialized. Error: ${t instanceof Error?t.message:"Unknown initialization error"}`,code:"// System initialization error",debugLog:t instanceof Error?[t.message]:["Unknown initialization error"]})}},Wj=({onQuerySubmit:t})=>{const[e,n]=Me.useState([]),[r,s]=Me.useState(""),[a,i]=Me.useState(!1),[o,l]=Me.useState(null),u=Me.useRef(null);Me.useEffect(()=>{(async()=>{try{console.log("Initializing agent system...");const h=await Gj();console.log("Agent system initialized"),l(h)}catch(h){console.error("Error initializing agent system:",h)}})()},[]),Me.useEffect(()=>{var f;(f=u.current)==null||f.scrollIntoView({behavior:"smooth"})},[e]);const c=async f=>{f.preventDefault();const h=r.trim();if(!h)return;const y={id:Date.now().toString(),role:"user",content:h};n(m=>[...m,y]),s(""),i(!0);try{if(t&&await t(),o)if(h)try{console.log("Sending query to agent system:",h);const m=await o(h);console.log("Raw response from agent system:",m);try{const v=xs.parse(m),g={id:(Date.now()+1).toString(),role:"assistant",content:v.response,code:v.code};n(p=>[...p,g])}catch(v){throw console.error("Zod validation error:",v),new Error(`Response validation failed: ${v instanceof le.ZodError?v.errors.map(g=>g.message).join(", "):"Unknown Zod error"}`)}}catch(m){if(m instanceof Error){const _=m.agent||"unknown",w=m.phase||"unknown",b=m.details;console.error(`Error in agent system [${_}][${w}]:`,m),console.error("Error details:",b),console.error("Error stack:",m.stack)}else console.error("Non-Error object thrown in agent system:",m);let v="Unknown error",g="";if(m instanceof Error){if(v=m.message,m.agent)g=`in ${m.agent} agent`;else if(m.phase)g=`during ${m.phase}`;else if(m.stack){const _=m.stack.split(`
`);for(const w of _)if(w.includes("/agents/")&&!w.includes("/index.ts")){const b=w.match(/\/agents\/([^\/\.]+)/);if(b&&b[1]){g=`in ${b[1]} agent`;break}}}}else m instanceof le.ZodError&&(v=`Data validation error: ${m.errors.map(_=>_.message).join(", ")}`);const p={id:(Date.now()+1).toString(),role:"assistant",content:`I encountered an error ${g} while processing your request: ${v}. Please try again with a different query.`};n(_=>[..._,p])}else{const m={id:(Date.now()+1).toString(),role:"assistant",content:"I couldn't process your request. Please provide a valid query."};n(v=>[...v,m])}else setTimeout(()=>{const m={id:(Date.now()+1).toString(),role:"assistant",content:"The Earth Agent system is still initializing. Please try again in a moment.",code:"// Agent system initializing"};n(v=>[...v,m]),i(!1)},1e3)}catch(m){console.error("Error processing message:",m);const v={id:(Date.now()+1).toString(),role:"assistant",content:"I encountered an error while processing your request. Please try again with a different query."};n(g=>[...g,v])}finally{i(!1)}},d=f=>{console.log("Running code in Earth Engine:",f),chrome.tabs.query({active:!0,currentWindow:!0},h=>{var y;(y=h[0])!=null&&y.id?chrome.tabs.sendMessage(h[0].id,{type:"RUN_CODE",code:f},m=>{if(chrome.runtime.lastError){console.error("Error sending message:",chrome.runtime.lastError),alert("Error: Could not run code in Earth Engine. Make sure you are on the Earth Engine Code Editor page.");return}m!=null&&m.success?alert("Code successfully sent to Earth Engine."):alert(`Error: ${(m==null?void 0:m.error)||"Could not run code in Earth Engine"}`)}):alert("Error: No active tab found. Make sure you are on the Earth Engine Code Editor page.")})};return W.jsxs("div",{className:"flex flex-col h-full",children:[W.jsxs("div",{className:"flex-1 overflow-auto mb-4",children:[e.map(f=>W.jsxs("div",{className:`mb-4 p-3 rounded-lg ${f.role==="user"?"bg-blue-100 ml-8":"bg-gray-100 mr-8"}`,children:[W.jsx("div",{className:"font-semibold mb-1",children:f.role==="user"?"You":"Earth Agent"}),W.jsx("div",{className:"whitespace-pre-wrap",children:f.content}),f.code&&W.jsxs("div",{className:"mt-2",children:[W.jsx("div",{className:"bg-gray-800 text-gray-200 p-3 rounded-md overflow-x-auto",children:W.jsx("pre",{children:W.jsx("code",{children:f.code})})}),W.jsx("button",{onClick:()=>d(f.code),className:"mt-2 px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Run Code"})]})]},f.id)),a&&W.jsx("div",{className:"flex justify-center items-center my-4",children:W.jsx("div",{className:"animate-pulse text-gray-500",children:"Earth Agent is thinking..."})}),W.jsx("div",{ref:u})]}),W.jsxs("form",{onSubmit:c,className:"flex",children:[W.jsx("input",{type:"text",value:r,onChange:f=>s(f.target.value),placeholder:"Ask Earth Agent something...",className:"flex-1 border rounded-l-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:a}),W.jsx("button",{type:"submit",disabled:a||!r.trim(),className:"bg-blue-600 text-white px-4 py-2 rounded-r-md hover:bg-blue-700 transition-colors disabled:bg-gray-400",children:"Send"})]})]})},Kj=({onApiKeySet:t})=>{const[e,n]=Me.useState(""),[r,s]=Me.useState(!1),[a,i]=Me.useState(null),[o,l]=Me.useState(null);Me.useEffect(()=>{(async()=>{try{if(await KE())try{const h=await ys();if(h){const y="*".repeat(h.length-4)+h.slice(-4);n(y)}}catch(h){console.error("Error retrieving API key:",h),l("Error retrieving your API key. You may need to enter it again.")}}catch(f){console.error("Error checking API key status:",f),l("Error checking API key status. Please try refreshing the page.")}})()},[]);const u=d=>!d||d.trim()===""?(i("API key is required"),!1):d.includes("*")?(i("Please enter your full API key"),!1):/^sk-[a-zA-Z0-9]{32,}$/.test(d.trim())?!0:(i('Invalid API key format. OpenAI keys should start with "sk-" followed by at least 32 characters.'),!1),c=async d=>{d.preventDefault(),i(null);const f=e.trim();if(u(f))try{s(!0),await XN(f),t()}catch(h){console.error("Error saving API key:",h),i("Failed to save API key: "+(h instanceof Error?h.message:"Unknown error"))}finally{s(!1)}};return W.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-md",children:[W.jsx("h2",{className:"text-xl font-semibold mb-4",children:"API Key Configuration"}),W.jsx("p",{className:"mb-4 text-gray-700",children:"To use the Earth Agent, you need to provide your OpenAI API key. Your key will be stored securely in your browser's local storage."}),o&&W.jsx("div",{className:"mb-4 p-3 bg-yellow-100 text-yellow-800 rounded-md",children:W.jsx("p",{children:o})}),W.jsxs("form",{onSubmit:c,children:[W.jsxs("div",{className:"mb-4",children:[W.jsx("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"OpenAI API Key"}),W.jsx("input",{id:"apiKey",type:"password",value:e,onChange:d=>{n(d.target.value),i(null)},placeholder:"sk-...",className:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"}),a&&W.jsx("p",{className:"mt-1 text-sm text-red-600",children:a})]}),W.jsx("button",{type:"submit",disabled:r,className:`w-full py-2 px-4 rounded-md text-white font-medium 
            ${r?"bg-gray-400":"bg-green-600 hover:bg-green-700"}`,children:r?"Saving...":"Save API Key"})]}),W.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[W.jsxs("p",{children:["You can get an API key from ",W.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",className:"text-blue-600 hover:underline",children:"OpenAI's website"}),"."]}),W.jsx("p",{className:"mt-1",children:"Your API key is only stored in your browser and is never sent to our servers."})]})]})},Jj=()=>{const[t,e]=Me.useState(!1),[n,r]=Me.useState(!0);Me.useEffect(()=>{(async()=>{try{const i=await KE();e(i)}catch(i){console.error("Error checking API key status:",i)}finally{r(!1)}})()},[]);const s=()=>{e(!0)};return W.jsxs("div",{className:"flex flex-col h-screen",children:[W.jsxs("header",{className:"p-4 border-b",children:[W.jsx("h1",{className:"text-xl font-bold mb-2",children:"Earth Agent"}),W.jsx("p",{className:"text-sm text-gray-600",children:"AI-powered assistant for Google Earth Engine"})]}),W.jsx("main",{className:"flex-1 overflow-auto p-4 flex flex-col",children:n?W.jsx("div",{className:"flex items-center justify-center h-full",children:W.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})}):t?W.jsx(Wj,{}):W.jsx("div",{className:"flex-1 flex items-center justify-center",children:W.jsx("div",{className:"w-full max-w-md",children:W.jsx(Kj,{onApiKeySet:s})})})})]})};ef.createRoot(document.getElementById("root")).render(W.jsx(zS.StrictMode,{children:W.jsx(Jj,{})}));console.log("Earth Agent sidepanel loaded");export{ON as B,hn as P,QN as c,Ci as r};
